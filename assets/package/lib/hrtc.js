!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).HRTC=t()}(this,(function(){function e(e,t){return t.forEach((function(t){Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var i=function(e){return e&&e.Math==Math&&e},n=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof t&&t)||function(){return this}()||Function("return this")(),s={},o=function(e){try{return!!e()}catch(t){return!0}},a=!o((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),c={},u={}.propertyIsEnumerable,d=Object.getOwnPropertyDescriptor,l=d&&!u.call({1:2},1);c.f=l?function(e){var t=d(this,e);return!!t&&t.enumerable}:u;var h,f,p=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},m={}.toString,_=function(e){return m.call(e).slice(8,-1)},g=_,S="".split,v=o((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==g(e)?S.call(e,""):Object(e)}:Object,R=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},T=v,I=R,y=function(e){return T(I(e))},E=function(e){return"function"==typeof e},b=E,C=function(e){return"object"==typeof e?null!==e:b(e)},A=n,k=E,w=function(e){return k(e)?e:void 0},O=function(e,t){return arguments.length<2?w(A[e]):A[e]&&A[e][t]},P=O("navigator","userAgent")||"",M=n,D=P,x=M.process,N=M.Deno,U=x&&x.versions||N&&N.version,L=U&&U.v8;L?f=(h=L.split("."))[0]<4?1:h[0]+h[1]:D&&(!(h=D.match(/Edge\/(\d+)/))||h[1]>=74)&&(h=D.match(/Chrome\/(\d+)/))&&(f=h[1]);var V=f&&+f,B=V,Y=o,F=!!Object.getOwnPropertySymbols&&!Y((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&B&&B<41})),j=F&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,z=E,H=O,K=j?function(e){return"symbol"==typeof e}:function(e){var t=H("Symbol");return z(t)&&Object(e)instanceof t},W=function(e){try{return String(e)}catch(t){return"Object"}},G=E,J=W,q=function(e){if(G(e))return e;throw TypeError(J(e)+" is not a function")},X=q,Q=function(e,t){var r=e[t];return null==r?void 0:X(r)},Z=E,$=C,ee={exports:{}},te=n,re=function(e,t){try{Object.defineProperty(te,e,{value:t,configurable:!0,writable:!0})}catch(r){te[e]=t}return t},ie=re,ne="__core-js_shared__",se=n[ne]||ie(ne,{}),oe=se;(ee.exports=function(e,t){return oe[e]||(oe[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.18.3",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var ae=R,ce=function(e){return Object(ae(e))},ue=ce,de={}.hasOwnProperty,le=Object.hasOwn||function(e,t){return de.call(ue(e),t)},he=0,fe=Math.random(),pe=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++he+fe).toString(36)},me=n,_e=ee.exports,ge=le,Se=pe,ve=F,Re=j,Te=_e("wks"),Ie=me.Symbol,ye=Re?Ie:Ie&&Ie.withoutSetter||Se,Ee=function(e){return ge(Te,e)&&(ve||"string"==typeof Te[e])||(ve&&ge(Ie,e)?Te[e]=Ie[e]:Te[e]=ye("Symbol."+e)),Te[e]},be=C,Ce=K,Ae=Q,ke=function(e,t){var r,i;if("string"===t&&Z(r=e.toString)&&!$(i=r.call(e)))return i;if(Z(r=e.valueOf)&&!$(i=r.call(e)))return i;if("string"!==t&&Z(r=e.toString)&&!$(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")},we=Ee("toPrimitive"),Oe=function(e,t){if(!be(e)||Ce(e))return e;var r,i=Ae(e,we);if(i){if(void 0===t&&(t="default"),r=i.call(e,t),!be(r)||Ce(r))return r;throw TypeError("Can't convert object to primitive value")}return void 0===t&&(t="number"),ke(e,t)},Pe=K,Me=function(e){var t=Oe(e,"string");return Pe(t)?t:String(t)},De=C,xe=n.document,Ne=De(xe)&&De(xe.createElement),Ue=function(e){return Ne?xe.createElement(e):{}},Le=Ue,Ve=!a&&!o((function(){return 7!=Object.defineProperty(Le("div"),"a",{get:function(){return 7}}).a})),Be=a,Ye=c,Fe=p,je=y,ze=Me,He=le,Ke=Ve,We=Object.getOwnPropertyDescriptor;s.f=Be?We:function(e,t){if(e=je(e),t=ze(t),Ke)try{return We(e,t)}catch(r){}if(He(e,t))return Fe(!Ye.f.call(e,t),e[t])};var Ge={},Je=C,qe=function(e){if(Je(e))return e;throw TypeError(String(e)+" is not an object")},Xe=a,Qe=Ve,Ze=qe,$e=Me,et=Object.defineProperty;Ge.f=Xe?et:function(e,t,r){if(Ze(e),t=$e(t),Ze(r),Qe)try{return et(e,t,r)}catch(i){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var tt=Ge,rt=p,it=a?function(e,t,r){return tt.f(e,t,rt(1,r))}:function(e,t,r){return e[t]=r,e},nt={exports:{}},st=E,ot=se,at=Function.toString;st(ot.inspectSource)||(ot.inspectSource=function(e){return at.call(e)});var ct,ut,dt,lt=ot.inspectSource,ht=E,ft=lt,pt=n.WeakMap,mt=ht(pt)&&/native code/.test(ft(pt)),_t=ee.exports,gt=pe,St=_t("keys"),vt=function(e){return St[e]||(St[e]=gt(e))},Rt={},Tt=mt,It=C,yt=it,Et=le,bt=se,Ct=vt,At=Rt,kt="Object already initialized",wt=n.WeakMap;if(Tt||bt.state){var Ot=bt.state||(bt.state=new wt),Pt=Ot.get,Mt=Ot.has,Dt=Ot.set;ct=function(e,t){if(Mt.call(Ot,e))throw new TypeError(kt);return t.facade=e,Dt.call(Ot,e,t),t},ut=function(e){return Pt.call(Ot,e)||{}},dt=function(e){return Mt.call(Ot,e)}}else{var xt=Ct("state");At[xt]=!0,ct=function(e,t){if(Et(e,xt))throw new TypeError(kt);return t.facade=e,yt(e,xt,t),t},ut=function(e){return Et(e,xt)?e[xt]:{}},dt=function(e){return Et(e,xt)}}var Nt={set:ct,get:ut,has:dt,enforce:function(e){return dt(e)?ut(e):ct(e,{})},getterFor:function(e){return function(t){var r;if(!It(t)||(r=ut(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}},Ut=a,Lt=le,Vt=Function.prototype,Bt=Ut&&Object.getOwnPropertyDescriptor,Yt=Lt(Vt,"name"),Ft={EXISTS:Yt,PROPER:Yt&&"something"===function(){}.name,CONFIGURABLE:Yt&&(!Ut||Ut&&Bt(Vt,"name").configurable)},jt=n,zt=E,Ht=le,Kt=it,Wt=re,Gt=lt,Jt=Ft.CONFIGURABLE,qt=Nt.get,Xt=Nt.enforce,Qt=String(String).split("String");(nt.exports=function(e,t,r,i){var n,s=!!i&&!!i.unsafe,o=!!i&&!!i.enumerable,a=!!i&&!!i.noTargetGet,c=i&&void 0!==i.name?i.name:t;zt(r)&&("Symbol("===String(c).slice(0,7)&&(c="["+String(c).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!Ht(r,"name")||Jt&&r.name!==c)&&Kt(r,"name",c),(n=Xt(r)).source||(n.source=Qt.join("string"==typeof c?c:""))),e!==jt?(s?!a&&e[t]&&(o=!0):delete e[t],o?e[t]=r:Kt(e,t,r)):o?e[t]=r:Wt(t,r)})(Function.prototype,"toString",(function(){return zt(this)&&qt(this).source||Gt(this)}));var Zt={},$t=Math.ceil,er=Math.floor,tr=function(e){var t=+e;return t!=t||0===t?0:(t>0?er:$t)(t)},rr=tr,ir=Math.max,nr=Math.min,sr=function(e,t){var r=rr(e);return r<0?ir(r+t,0):nr(r,t)},or=tr,ar=Math.min,cr=function(e){return e>0?ar(or(e),9007199254740991):0},ur=cr,dr=function(e){return ur(e.length)},lr=y,hr=sr,fr=dr,pr=function(e){return function(t,r,i){var n,s=lr(t),o=fr(s),a=hr(i,o);if(e&&r!=r){for(;o>a;)if((n=s[a++])!=n)return!0}else for(;o>a;a++)if((e||a in s)&&s[a]===r)return e||a||0;return!e&&-1}},mr={includes:pr(!0),indexOf:pr(!1)},_r=le,gr=y,Sr=mr.indexOf,vr=Rt,Rr=function(e,t){var r,i=gr(e),n=0,s=[];for(r in i)!_r(vr,r)&&_r(i,r)&&s.push(r);for(;t.length>n;)_r(i,r=t[n++])&&(~Sr(s,r)||s.push(r));return s},Tr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ir=Rr,yr=Tr.concat("length","prototype");Zt.f=Object.getOwnPropertyNames||function(e){return Ir(e,yr)};var Er={};Er.f=Object.getOwnPropertySymbols;var br=Zt,Cr=Er,Ar=qe,kr=O("Reflect","ownKeys")||function(e){var t=br.f(Ar(e)),r=Cr.f;return r?t.concat(r(e)):t},wr=le,Or=kr,Pr=s,Mr=Ge,Dr=function(e,t){for(var r=Or(t),i=Mr.f,n=Pr.f,s=0;s<r.length;s++){var o=r[s];wr(e,o)||i(e,o,n(t,o))}},xr=o,Nr=E,Ur=/#|\.prototype\./,Lr=function(e,t){var r=Br[Vr(e)];return r==Fr||r!=Yr&&(Nr(t)?xr(t):!!t)},Vr=Lr.normalize=function(e){return String(e).replace(Ur,".").toLowerCase()},Br=Lr.data={},Yr=Lr.NATIVE="N",Fr=Lr.POLYFILL="P",jr=Lr,zr=n,Hr=s.f,Kr=it,Wr=nt.exports,Gr=re,Jr=Dr,qr=jr,Xr=function(e,t){var r,i,n,s,o,a=e.target,c=e.global,u=e.stat;if(r=c?zr:u?zr[a]||Gr(a,{}):(zr[a]||{}).prototype)for(i in t){if(s=t[i],n=e.noTargetGet?(o=Hr(r,i))&&o.value:r[i],!qr(c?i:a+(u?".":"#")+i,e.forced)&&void 0!==n){if(typeof s==typeof n)continue;Jr(s,n)}(e.sham||n&&n.sham)&&Kr(s,"sham",!0),Wr(r,i,s,e)}},Qr=n.Promise,Zr=nt.exports,$r=function(e,t,r){for(var i in t)Zr(e,i,t[i],r);return e},ei=E,ti=qe,ri=function(e){if("object"==typeof e||ei(e))return e;throw TypeError("Can't set "+String(e)+" as a prototype")},ii=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(i){}return function(r,i){return ti(r),ri(i),t?e.call(r,i):r.__proto__=i,r}}():void 0),ni=Ge.f,si=le,oi=Ee("toStringTag"),ai=function(e,t,r){e&&!si(e=r?e:e.prototype,oi)&&ni(e,oi,{configurable:!0,value:t})},ci=O,ui=Ge,di=a,li=Ee("species"),hi=function(e){var t=ci(e),r=ui.f;di&&t&&!t[li]&&r(t,li,{configurable:!0,get:function(){return this}})},fi=function(e,t,r){if(e instanceof t)return e;throw TypeError("Incorrect "+(r?r+" ":"")+"invocation")},pi={},mi=pi,_i=Ee("iterator"),gi=Array.prototype,Si=function(e){return void 0!==e&&(mi.Array===e||gi[_i]===e)},vi=q,Ri=function(e,t,r){if(vi(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,i){return e.call(t,r,i)};case 3:return function(r,i,n){return e.call(t,r,i,n)}}return function(){return e.apply(t,arguments)}},Ti={};Ti[Ee("toStringTag")]="z";var Ii="[object z]"===String(Ti),yi=E,Ei=_,bi=Ee("toStringTag"),Ci="Arguments"==Ei(function(){return arguments}()),Ai=Ii?Ei:function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(r){}}(t=Object(e),bi))?r:Ci?Ei(t):"Object"==(i=Ei(t))&&yi(t.callee)?"Arguments":i},ki=Ai,wi=Q,Oi=pi,Pi=Ee("iterator"),Mi=function(e){if(null!=e)return wi(e,Pi)||wi(e,"@@iterator")||Oi[ki(e)]},Di=q,xi=qe,Ni=Mi,Ui=function(e,t){var r=arguments.length<2?Ni(e):t;if(Di(r))return xi(r.call(e));throw TypeError(String(e)+" is not iterable")},Li=qe,Vi=Q,Bi=qe,Yi=Si,Fi=dr,ji=Ri,zi=Ui,Hi=Mi,Ki=function(e,t,r){var i,n;Li(e);try{if(!(i=Vi(e,"return"))){if("throw"===t)throw r;return r}i=i.call(e)}catch(s){n=!0,i=s}if("throw"===t)throw r;if(n)throw i;return Li(i),r},Wi=function(e,t){this.stopped=e,this.result=t},Gi=function(e,t,r){var i,n,s,o,a,c,u,d=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_ITERATOR),f=!(!r||!r.INTERRUPTED),p=ji(t,d,1+l+f),m=function(e){return i&&Ki(i,"normal",e),new Wi(!0,e)},_=function(e){return l?(Bi(e),f?p(e[0],e[1],m):p(e[0],e[1])):f?p(e,m):p(e)};if(h)i=e;else{if(!(n=Hi(e)))throw TypeError(String(e)+" is not iterable");if(Yi(n)){for(s=0,o=Fi(e);o>s;s++)if((a=_(e[s]))&&a instanceof Wi)return a;return new Wi(!1)}i=zi(e,n)}for(c=i.next;!(u=c.call(i)).done;){try{a=_(u.value)}catch(g){Ki(i,"throw",g)}if("object"==typeof a&&a&&a instanceof Wi)return a}return new Wi(!1)},Ji=Ee("iterator"),qi=!1;try{var Xi=0,Qi={next:function(){return{done:!!Xi++}},return:function(){qi=!0}};Qi[Ji]=function(){return this},Array.from(Qi,(function(){throw 2}))}catch(tb){}var Zi,$i,en,tn,rn=function(e,t){if(!t&&!qi)return!1;var r=!1;try{var i={};i[Ji]=function(){return{next:function(){return{done:r=!0}}}},e(i)}catch(tb){}return r},nn=o,sn=E,on=Ai,an=lt,cn=[],un=O("Reflect","construct"),dn=/^\s*(?:class|function)\b/,ln=dn.exec,hn=!dn.exec((function(){})),fn=function(e){if(!sn(e))return!1;try{return un(Object,cn,e),!0}catch(tb){return!1}},pn=!un||nn((function(){var e;return fn(fn.call)||!fn(Object)||!fn((function(){e=!0}))||e}))?function(e){if(!sn(e))return!1;switch(on(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return hn||!!ln.call(dn,an(e))}:fn,mn=pn,_n=W,gn=function(e){if(mn(e))return e;throw TypeError(_n(e)+" is not a constructor")},Sn=qe,vn=gn,Rn=Ee("species"),Tn=function(e,t){var r,i=Sn(e).constructor;return void 0===i||null==(r=Sn(i)[Rn])?t:vn(r)},In=O("document","documentElement"),yn=/(?:ipad|iphone|ipod).*applewebkit/i.test(P),En="process"==_(n.process),bn=n,Cn=E,An=o,kn=Ri,wn=In,On=Ue,Pn=yn,Mn=En,Dn=bn.setImmediate,xn=bn.clearImmediate,Nn=bn.process,Un=bn.MessageChannel,Ln=bn.Dispatch,Vn=0,Bn={},Yn="onreadystatechange";try{Zi=bn.location}catch(tb){}var Fn=function(e){if(Bn.hasOwnProperty(e)){var t=Bn[e];delete Bn[e],t()}},jn=function(e){return function(){Fn(e)}},zn=function(e){Fn(e.data)},Hn=function(e){bn.postMessage(String(e),Zi.protocol+"//"+Zi.host)};Dn&&xn||(Dn=function(e){for(var t=[],r=arguments.length,i=1;r>i;)t.push(arguments[i++]);return Bn[++Vn]=function(){(Cn(e)?e:Function(e)).apply(void 0,t)},$i(Vn),Vn},xn=function(e){delete Bn[e]},Mn?$i=function(e){Nn.nextTick(jn(e))}:Ln&&Ln.now?$i=function(e){Ln.now(jn(e))}:Un&&!Pn?(tn=(en=new Un).port2,en.port1.onmessage=zn,$i=kn(tn.postMessage,tn,1)):bn.addEventListener&&Cn(bn.postMessage)&&!bn.importScripts&&Zi&&"file:"!==Zi.protocol&&!An(Hn)?($i=Hn,bn.addEventListener("message",zn,!1)):$i=Yn in On("script")?function(e){wn.appendChild(On("script")).onreadystatechange=function(){wn.removeChild(this),Fn(e)}}:function(e){setTimeout(jn(e),0)});var Kn,Wn,Gn,Jn,qn,Xn,Qn,Zn,$n={set:Dn,clear:xn},es=n,ts=/ipad|iphone|ipod/i.test(P)&&void 0!==es.Pebble,rs=/web0s(?!.*chrome)/i.test(P),is=n,ns=s.f,ss=$n.set,os=yn,as=ts,cs=rs,us=En,ds=is.MutationObserver||is.WebKitMutationObserver,ls=is.document,hs=is.process,fs=is.Promise,ps=ns(is,"queueMicrotask"),ms=ps&&ps.value;ms||(Kn=function(){var e,t;for(us&&(e=hs.domain)&&e.exit();Wn;){t=Wn.fn,Wn=Wn.next;try{t()}catch(tb){throw Wn?Jn():Gn=void 0,tb}}Gn=void 0,e&&e.enter()},os||us||cs||!ds||!ls?!as&&fs&&fs.resolve?((Qn=fs.resolve(void 0)).constructor=fs,Zn=Qn.then,Jn=function(){Zn.call(Qn,Kn)}):Jn=us?function(){hs.nextTick(Kn)}:function(){ss.call(is,Kn)}:(qn=!0,Xn=ls.createTextNode(""),new ds(Kn).observe(Xn,{characterData:!0}),Jn=function(){Xn.data=qn=!qn}));var _s=ms||function(e){var t={fn:e,next:void 0};Gn&&(Gn.next=t),Wn||(Wn=t,Jn()),Gn=t},gs={},Ss=q,vs=function(e){var t,r;this.promise=new e((function(e,i){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=i})),this.resolve=Ss(t),this.reject=Ss(r)};gs.f=function(e){return new vs(e)};var Rs,Ts,Is,ys,Es=qe,bs=C,Cs=gs,As=function(e,t){if(Es(e),bs(t)&&t.constructor===e)return t;var r=Cs.f(e);return(0,r.resolve)(t),r.promise},ks=n,ws="object"==typeof window,Os=Xr,Ps=n,Ms=O,Ds=Qr,xs=nt.exports,Ns=$r,Us=ii,Ls=ai,Vs=hi,Bs=q,Ys=E,Fs=C,js=fi,zs=lt,Hs=Gi,Ks=rn,Ws=Tn,Gs=$n.set,Js=_s,qs=As,Xs=function(e,t){var r=ks.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))},Qs=gs,Zs=function(e){try{return{error:!1,value:e()}}catch(tb){return{error:!0,value:tb}}},$s=Nt,eo=jr,to=ws,ro=En,io=V,no=Ee("species"),so="Promise",oo=$s.get,ao=$s.set,co=$s.getterFor(so),uo=Ds&&Ds.prototype,lo=Ds,ho=uo,fo=Ps.TypeError,po=Ps.document,mo=Ps.process,_o=Qs.f,go=_o,So=!!(po&&po.createEvent&&Ps.dispatchEvent),vo=Ys(Ps.PromiseRejectionEvent),Ro="unhandledrejection",To=!1,Io=eo(so,(function(){var e=zs(lo),t=e!==String(lo);if(!t&&66===io)return!0;if(io>=51&&/native code/.test(e))return!1;var r=new lo((function(e){e(1)})),i=function(e){e((function(){}),(function(){}))};return(r.constructor={})[no]=i,!(To=r.then((function(){}))instanceof i)||!t&&to&&!vo})),yo=Io||!Ks((function(e){lo.all(e).catch((function(){}))})),Eo=function(e){var t;return!(!Fs(e)||!Ys(t=e.then))&&t},bo=function(e,t){if(!e.notified){e.notified=!0;var r=e.reactions;Js((function(){for(var i=e.value,n=1==e.state,s=0;r.length>s;){var o,a,c,u=r[s++],d=n?u.ok:u.fail,l=u.resolve,h=u.reject,f=u.domain;try{d?(n||(2===e.rejection&&wo(e),e.rejection=1),!0===d?o=i:(f&&f.enter(),o=d(i),f&&(f.exit(),c=!0)),o===u.promise?h(fo("Promise-chain cycle")):(a=Eo(o))?a.call(o,l,h):l(o)):h(i)}catch(tb){f&&!c&&f.exit(),h(tb)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&Ao(e)}))}},Co=function(e,t,r){var i,n;So?((i=po.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),Ps.dispatchEvent(i)):i={promise:t,reason:r},!vo&&(n=Ps["on"+e])?n(i):e===Ro&&Xs("Unhandled promise rejection",r)},Ao=function(e){Gs.call(Ps,(function(){var t,r=e.facade,i=e.value;if(ko(e)&&(t=Zs((function(){ro?mo.emit("unhandledRejection",i,r):Co(Ro,r,i)})),e.rejection=ro||ko(e)?2:1,t.error))throw t.value}))},ko=function(e){return 1!==e.rejection&&!e.parent},wo=function(e){Gs.call(Ps,(function(){var t=e.facade;ro?mo.emit("rejectionHandled",t):Co("rejectionhandled",t,e.value)}))},Oo=function(e,t,r){return function(i){e(t,i,r)}},Po=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,bo(e,!0))},Mo=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw fo("Promise can't be resolved itself");var i=Eo(t);i?Js((function(){var r={done:!1};try{i.call(t,Oo(Mo,r,e),Oo(Po,r,e))}catch(tb){Po(r,tb,e)}})):(e.value=t,e.state=1,bo(e,!1))}catch(tb){Po({done:!1},tb,e)}}};if(Io&&(ho=(lo=function(e){js(this,lo,so),Bs(e),Rs.call(this);var t=oo(this);try{e(Oo(Mo,t),Oo(Po,t))}catch(tb){Po(t,tb)}}).prototype,(Rs=function(e){ao(this,{type:so,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=Ns(ho,{then:function(e,t){var r=co(this),i=_o(Ws(this,lo));return i.ok=!Ys(e)||e,i.fail=Ys(t)&&t,i.domain=ro?mo.domain:void 0,r.parent=!0,r.reactions.push(i),0!=r.state&&bo(r,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),Ts=function(){var e=new Rs,t=oo(e);this.promise=e,this.resolve=Oo(Mo,t),this.reject=Oo(Po,t)},Qs.f=_o=function(e){return e===lo||e===Is?new Ts(e):go(e)},Ys(Ds)&&uo!==Object.prototype)){ys=uo.then,To||(xs(uo,"then",(function(e,t){var r=this;return new lo((function(e,t){ys.call(r,e,t)})).then(e,t)}),{unsafe:!0}),xs(uo,"catch",ho.catch,{unsafe:!0}));try{delete uo.constructor}catch(tb){}Us&&Us(uo,ho)}Os({global:!0,wrap:!0,forced:Io},{Promise:lo}),Ls(lo,so,!1),Vs(so),Is=Ms(so),Os({target:so,stat:!0,forced:Io},{reject:function(e){var t=_o(this);return t.reject.call(void 0,e),t.promise}}),Os({target:so,stat:!0,forced:Io},{resolve:function(e){return qs(this,e)}}),Os({target:so,stat:!0,forced:yo},{all:function(e){var t=this,r=_o(t),i=r.resolve,n=r.reject,s=Zs((function(){var r=Bs(t.resolve),s=[],o=0,a=1;Hs(e,(function(e){var c=o++,u=!1;s.push(void 0),a++,r.call(t,e).then((function(e){u||(u=!0,s[c]=e,--a||i(s))}),n)})),--a||i(s)}));return s.error&&n(s.value),r.promise},race:function(e){var t=this,r=_o(t),i=r.reject,n=Zs((function(){var n=Bs(t.resolve);Hs(e,(function(e){n.call(t,e).then(r.resolve,i)}))}));return n.error&&i(n.value),r.promise}});var Do,xo=Rr,No=Tr,Uo=Object.keys||function(e){return xo(e,No)},Lo=Ge,Vo=qe,Bo=Uo,Yo=a?Object.defineProperties:function(e,t){Vo(e);for(var r,i=Bo(t),n=i.length,s=0;n>s;)Lo.f(e,r=i[s++],t[r]);return e},Fo=qe,jo=Yo,zo=Tr,Ho=Rt,Ko=In,Wo=Ue,Go=vt("IE_PROTO"),Jo=function(){},qo=function(e){return"<script>"+e+"</"+"script>"},Xo=function(e){e.write(qo("")),e.close();var t=e.parentWindow.Object;return e=null,t},Qo=function(){try{Do=new ActiveXObject("htmlfile")}catch(tb){}var e,t;Qo="undefined"!=typeof document?document.domain&&Do?Xo(Do):((t=Wo("iframe")).style.display="none",Ko.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(qo("document.F=Object")),e.close(),e.F):Xo(Do);for(var r=zo.length;r--;)delete Qo.prototype[zo[r]];return Qo()};Ho[Go]=!0;var Zo=Object.create||function(e,t){var r;return null!==e?(Jo.prototype=Fo(e),r=new Jo,Jo.prototype=null,r[Go]=e):r=Qo(),void 0===t?r:jo(r,t)},$o=Zo,ea=Ge,ta=Ee("unscopables"),ra=Array.prototype;null==ra[ta]&&ea.f(ra,ta,{configurable:!0,value:$o(null)});var ia,na,sa,oa=!o((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),aa=le,ca=E,ua=ce,da=oa,la=vt("IE_PROTO"),ha=Object.prototype,fa=da?Object.getPrototypeOf:function(e){var t=ua(e);if(aa(t,la))return t[la];var r=t.constructor;return ca(r)&&t instanceof r?r.prototype:t instanceof Object?ha:null},pa=o,ma=E,_a=fa,ga=nt.exports,Sa=Ee("iterator"),va=!1;[].keys&&("next"in(sa=[].keys())?(na=_a(_a(sa)))!==Object.prototype&&(ia=na):va=!0);var Ra=null==ia||pa((function(){var e={};return ia[Sa].call(e)!==e}));Ra&&(ia={}),ma(ia[Sa])||ga(ia,Sa,(function(){return this}));var Ta={IteratorPrototype:ia,BUGGY_SAFARI_ITERATORS:va},Ia=Ta.IteratorPrototype,ya=Zo,Ea=p,ba=ai,Ca=pi,Aa=function(){return this},ka=Xr,wa=Ft,Oa=E,Pa=function(e,t,r){var i=t+" Iterator";return e.prototype=ya(Ia,{next:Ea(1,r)}),ba(e,i,!1),Ca[i]=Aa,e},Ma=fa,Da=ii,xa=ai,Na=it,Ua=nt.exports,La=pi,Va=wa.PROPER,Ba=wa.CONFIGURABLE,Ya=Ta.IteratorPrototype,Fa=Ta.BUGGY_SAFARI_ITERATORS,ja=Ee("iterator"),za="keys",Ha="values",Ka="entries",Wa=function(){return this},Ga=y,Ja=function(e){ra[ta][e]=!0},qa=pi,Xa=Nt,Qa=function(e,t,r,i,n,s,o){Pa(r,t,i);var a,c,u,d=function(e){if(e===n&&m)return m;if(!Fa&&e in f)return f[e];switch(e){case za:case Ha:case Ka:return function(){return new r(this,e)}}return function(){return new r(this)}},l=t+" Iterator",h=!1,f=e.prototype,p=f[ja]||f["@@iterator"]||n&&f[n],m=!Fa&&p||d(n),_="Array"==t&&f.entries||p;if(_&&(a=Ma(_.call(new e)))!==Object.prototype&&a.next&&(Ma(a)!==Ya&&(Da?Da(a,Ya):Oa(a[ja])||Ua(a,ja,Wa)),xa(a,l,!0)),Va&&n==Ha&&p&&p.name!==Ha&&(Ba?Na(f,"name",Ha):(h=!0,m=function(){return p.call(this)})),n)if(c={values:d(Ha),keys:s?m:d(za),entries:d(Ka)},o)for(u in c)(Fa||h||!(u in f))&&Ua(f,u,c[u]);else ka({target:t,proto:!0,forced:Fa||h},c);return f[ja]!==m&&Ua(f,ja,m,{name:n}),La[t]=m,c},Za="Array Iterator",$a=Xa.set,ec=Xa.getterFor(Za),tc=Qa(Array,"Array",(function(e,t){$a(this,{type:Za,target:Ga(e),index:0,kind:t})}),(function(){var e=ec(this),t=e.target,r=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:i,done:!1}:"values"==r?{value:t[i],done:!1}:{value:[i,t[i]],done:!1}}),"values");qa.Arguments=qa.Array,Ja("keys"),Ja("values"),Ja("entries");var rc=q,ic=qe,nc=function(){for(var e,t=ic(this),r=rc(t.delete),i=!0,n=0,s=arguments.length;n<s;n++)e=r.call(t,arguments[n]),i=i&&e;return!!i},sc=nc;Xr({target:"Map",proto:!0,real:!0,forced:false},{deleteAll:function(){return sc.apply(this,arguments)}});var oc=function(e){return Map.prototype.entries.call(e)},ac=qe,cc=Ri,uc=oc,dc=Gi;Xr({target:"Map",proto:!0,real:!0,forced:false},{every:function(e){var t=ac(this),r=uc(t),i=cc(e,arguments.length>1?arguments[1]:void 0,3);return!dc(r,(function(e,r,n){if(!i(r,e,t))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var lc=O,hc=q,fc=qe,pc=Ri,mc=Tn,_c=oc,gc=Gi;Xr({target:"Map",proto:!0,real:!0,forced:false},{filter:function(e){var t=fc(this),r=_c(t),i=pc(e,arguments.length>1?arguments[1]:void 0,3),n=new(mc(t,lc("Map"))),s=hc(n.set);return gc(r,(function(e,r){i(r,e,t)&&s.call(n,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n}});var Sc=qe,vc=Ri,Rc=oc,Tc=Gi;Xr({target:"Map",proto:!0,real:!0,forced:false},{find:function(e){var t=Sc(this),r=Rc(t),i=vc(e,arguments.length>1?arguments[1]:void 0,3);return Tc(r,(function(e,r,n){if(i(r,e,t))return n(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Ic=qe,yc=Ri,Ec=oc,bc=Gi;Xr({target:"Map",proto:!0,real:!0,forced:false},{findKey:function(e){var t=Ic(this),r=Ec(t),i=yc(e,arguments.length>1?arguments[1]:void 0,3);return bc(r,(function(e,r,n){if(i(r,e,t))return n(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Cc=qe,Ac=oc,kc=function(e,t){return e===t||e!=e&&t!=t},wc=Gi;Xr({target:"Map",proto:!0,real:!0,forced:false},{includes:function(e){return wc(Ac(Cc(this)),(function(t,r,i){if(kc(r,e))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Oc=qe,Pc=oc,Mc=Gi;Xr({target:"Map",proto:!0,real:!0,forced:false},{keyOf:function(e){return Mc(Pc(Oc(this)),(function(t,r,i){if(r===e)return i(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Dc=O,xc=q,Nc=qe,Uc=Ri,Lc=Tn,Vc=oc,Bc=Gi;Xr({target:"Map",proto:!0,real:!0,forced:false},{mapKeys:function(e){var t=Nc(this),r=Vc(t),i=Uc(e,arguments.length>1?arguments[1]:void 0,3),n=new(Lc(t,Dc("Map"))),s=xc(n.set);return Bc(r,(function(e,r){s.call(n,i(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n}});var Yc=O,Fc=q,jc=qe,zc=Ri,Hc=Tn,Kc=oc,Wc=Gi;Xr({target:"Map",proto:!0,real:!0,forced:false},{mapValues:function(e){var t=jc(this),r=Kc(t),i=zc(e,arguments.length>1?arguments[1]:void 0,3),n=new(Hc(t,Yc("Map"))),s=Fc(n.set);return Wc(r,(function(e,r){s.call(n,e,i(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n}});var Gc=q,Jc=qe,qc=Gi;Xr({target:"Map",proto:!0,real:!0,forced:false},{merge:function(e){for(var t=Jc(this),r=Gc(t.set),i=arguments.length,n=0;n<i;)qc(arguments[n++],r,{that:t,AS_ENTRIES:!0});return t}});var Xc=qe,Qc=q,Zc=oc,$c=Gi;Xr({target:"Map",proto:!0,real:!0,forced:false},{reduce:function(e){var t=Xc(this),r=Zc(t),i=arguments.length<2,n=i?void 0:arguments[1];if(Qc(e),$c(r,(function(r,s){i?(i=!1,n=s):n=e(n,s,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i)throw TypeError("Reduce of empty map with no initial value");return n}});var eu=qe,tu=Ri,ru=oc,iu=Gi;Xr({target:"Map",proto:!0,real:!0,forced:false},{some:function(e){var t=eu(this),r=ru(t),i=tu(e,arguments.length>1?arguments[1]:void 0,3);return iu(r,(function(e,r,n){if(i(r,e,t))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var nu=qe,su=q;Xr({target:"Map",proto:!0,real:!0,forced:false},{update:function(e,t){var r=nu(this),i=arguments.length;su(t);var n=r.has(e);if(!n&&i<3)throw TypeError("Updating absent value");var s=n?r.get(e):su(i>2?arguments[2]:void 0)(e,r);return r.set(e,t(s,e,r)),r}});var ou,au={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},cu=Ue("span").classList,uu=cu&&cu.constructor&&cu.constructor.prototype,du=uu===Object.prototype?void 0:uu,lu=n,hu=au,fu=du,pu=tc,mu=it,_u=Ee,gu=_u("iterator"),Su=_u("toStringTag"),vu=pu.values,Ru=function(e,t){if(e){if(e[gu]!==vu)try{mu(e,gu,vu)}catch(tb){e[gu]=vu}if(e[Su]||mu(e,Su,t),hu[t])for(var r in pu)if(e[r]!==pu[r])try{mu(e,r,pu[r])}catch(tb){e[r]=pu[r]}}};for(var Tu in hu)Ru(lu[Tu]&&lu[Tu].prototype,Tu);Ru(fu,"DOMTokenList"),function(e){e[e.RTC_ERR_CODE_SUCCESS=0]="RTC_ERR_CODE_SUCCESS",e[e.RTC_ERR_CODE_RTC_SDK_ERROR=90000001]="RTC_ERR_CODE_RTC_SDK_ERROR",e[e.RTC_ERR_CODE_WAIT_RSP_TIMEOUT=90000004]="RTC_ERR_CODE_WAIT_RSP_TIMEOUT",e[e.RTC_ERR_CODE_INVALID_PARAMETER=90000005]="RTC_ERR_CODE_INVALID_PARAMETER",e[e.RTC_ERR_CODE_INVALID_OPERATION=90100001]="RTC_ERR_CODE_INVALID_OPERATION",e[e.RTC_ERR_CODE_NOT_SUPPORT_MEDIA_DEVICES=90100002]="RTC_ERR_CODE_NOT_SUPPORT_MEDIA_DEVICES",e[e.RTC_ERR_CODE_NO_AVAILABLE_DEVICES=90100003]="RTC_ERR_CODE_NO_AVAILABLE_DEVICES",e[e.RTC_ERR_CODE_NO_AVAILABLE_VIDEO_INPUT_DEVICES=90100004]="RTC_ERR_CODE_NO_AVAILABLE_VIDEO_INPUT_DEVICES",e[e.RTC_ERR_CODE_NO_AVAILABLE_AUDIO_INPUT_DEVICES=90100005]="RTC_ERR_CODE_NO_AVAILABLE_AUDIO_INPUT_DEVICES",e[e.RTC_ERR_CODE_NO_AVAILABLE_AUDIO_OUTPUT_DEVICES=90100006]="RTC_ERR_CODE_NO_AVAILABLE_AUDIO_OUTPUT_DEVICES",e[e.RTC_ERR_CODE_STATUS_ERROR=90100007]="RTC_ERR_CODE_STATUS_ERROR",e[e.RTC_ERR_CODE_WEBSOCKET_NOT_CONNECTED=90100008]="RTC_ERR_CODE_WEBSOCKET_NOT_CONNECTED",e[e.RTC_ERR_CODE_WAIT_CONFIG_FAIL=90100009]="RTC_ERR_CODE_WAIT_CONFIG_FAIL",e[e.RTC_ERR_CODE_PUBLISH_RESPONSE_FAIL=90100010]="RTC_ERR_CODE_PUBLISH_RESPONSE_FAIL",e[e.RTC_ERR_CODE_REGION_NOT_COVERED=90100011]="RTC_ERR_CODE_REGION_NOT_COVERED",e[e.RTC_ERR_CODE_WEBSOCKET_CONNECT_TIMEOUT=90100012]="RTC_ERR_CODE_WEBSOCKET_CONNECT_TIMEOUT",e[e.RTC_ERR_CODE_WEBSOCKET_RECONNECT_TIMEOUT=90100013]="RTC_ERR_CODE_WEBSOCKET_RECONNECT_TIMEOUT",e[e.RTC_ERR_CODE_WEBSOCKET_NOT_OPEN=90100014]="RTC_ERR_CODE_WEBSOCKET_NOT_OPEN",e[e.RTC_ERR_CODE_WEBSOCKET_INTERRUPTED=90100015]="RTC_ERR_CODE_WEBSOCKET_INTERRUPTED",e[e.RTC_ERR_CODE_WEBSOCKET_CONNECT_ERROR=90100016]="RTC_ERR_CODE_WEBSOCKET_CONNECT_ERROR",e[e.RTC_ERR_CODE_CAPTURE_PERMISSION_DENIED=90100017]="RTC_ERR_CODE_CAPTURE_PERMISSION_DENIED",e[e.RTC_ERR_CODE_CAPTURE_OVER_CONSTRAINED=90100018]="RTC_ERR_CODE_CAPTURE_OVER_CONSTRAINED",e[e.RTC_ERR_CODE_CAPTURE_DEVICE_NOT_FOUND=90100019]="RTC_ERR_CODE_CAPTURE_DEVICE_NOT_FOUND",e[e.RTC_ERR_CODE_CAPTURE_DEVICE_NOT_READABLE=90100020]="RTC_ERR_CODE_CAPTURE_DEVICE_NOT_READABLE",e[e.RTC_ERR_CODE_PLAY_NOT_ALLOW=90100021]="RTC_ERR_CODE_PLAY_NOT_ALLOW",e[e.RTC_ERR_CODE_ROLE_NO_PERMISSION=90100022]="RTC_ERR_CODE_ROLE_NO_PERMISSION",e[e.RTC_ERR_CODE_ANSWER_SDP_INVALID=90100023]="RTC_ERR_CODE_ANSWER_SDP_INVALID",e[e.RTC_ERR_CODE_MEDIA_UPSTREAM_UNSUPPORTED=90100024]="RTC_ERR_CODE_MEDIA_UPSTREAM_UNSUPPORTED",e[e.RTC_ERR_CODE_WEBRTC_UNSUPPORTED=90100025]="RTC_ERR_CODE_WEBRTC_UNSUPPORTED",e[e.RTC_ERR_CODE_AUTHORIZATION_FAIL=90100101]="RTC_ERR_CODE_AUTHORIZATION_FAIL",e[e.RTC_ERR_CODE_INVALID_REQ_PARAMETER=90100102]="RTC_ERR_CODE_INVALID_REQ_PARAMETER",e[e.RTC_ERR_CODE_CONNECTION_IDLE=90100103]="RTC_ERR_CODE_CONNECTION_IDLE",e[e.RTC_ERR_CODE_INTERNAL_EXCEPTION=90100104]="RTC_ERR_CODE_INTERNAL_EXCEPTION",e[e.RTC_ERR_CODE_SEND_TO_RTCCTRL_FAIL=90100105]="RTC_ERR_CODE_SEND_TO_RTCCTRL_FAIL",e[e.RTC_ERR_CODE_RTCCTRL_EXCEPTION=90100106]="RTC_ERR_CODE_RTCCTRL_EXCEPTION",e[e.RTC_ERR_CODE_WS_NOT_SUPPORTED=90100107]="RTC_ERR_CODE_WS_NOT_SUPPORTED",e[e.RTC_ERR_CODE_REQUEST_FREQUENTLY=90100108]="RTC_ERR_CODE_REQUEST_FREQUENTLY",e[e.RTC_ERR_CODE_INVALID_REQUEST_BODY=90100109]="RTC_ERR_CODE_INVALID_REQUEST_BODY",e[e.RTC_ERR_CODE_INVALID_RESPONSE=90100110]="RTC_ERR_CODE_INVALID_RESPONSE",e[e.RTC_ERR_CODE_INTERNAL_ERROR=90100199]="RTC_ERR_CODE_INTERNAL_ERROR",e[e.RTC_ERR_CODE_INVALID_CTRL_PARAMETER=90100201]="RTC_ERR_CODE_INVALID_CTRL_PARAMETER",e[e.RTC_ERR_CODE_INVALID_REQUEST=90100202]="RTC_ERR_CODE_INVALID_REQUEST",e[e.RTC_ERR_CODE_JOIN_ROOM_FAIL=90100203]="RTC_ERR_CODE_JOIN_ROOM_FAIL",e[e.RTC_ERR_CODE_ALREADY_JOINED=90100204]="RTC_ERR_CODE_ALREADY_JOINED",e[e.RTC_ERR_CODE_NO_SFU_RESOURCE=90100205]="RTC_ERR_CODE_NO_SFU_RESOURCE",e[e.RTC_ERR_CODE_INVALID_SSRC=90100206]="RTC_ERR_CODE_INVALID_SSRC",e[e.RTC_ERR_CODE_STREAM_ALREADY_PUSHED=90100207]="RTC_ERR_CODE_STREAM_ALREADY_PUSHED",e[e.RTC_ERR_CODE_SAVE_USER_ERROR=90100208]="RTC_ERR_CODE_SAVE_USER_ERROR",e[e.RTC_ERR_CODE_UPDATE_USER_ERROR=90100209]="RTC_ERR_CODE_UPDATE_USER_ERROR",e[e.RTC_ERR_CODE_FETCH_USER_ERROR=90100210]="RTC_ERR_CODE_FETCH_USER_ERROR",e[e.RTC_ERR_CODE_SAVE_ROOM_ERROR=90100211]="RTC_ERR_CODE_SAVE_ROOM_ERROR",e[e.RTC_ERR_CODE_UPDATE_ROOM_ERROR=90100212]="RTC_ERR_CODE_UPDATE_ROOM_ERROR",e[e.RTC_ERR_CODE_INVALID_SUBSCRIBED_INFO=90100213]="RTC_ERR_CODE_INVALID_SUBSCRIBED_INFO",e[e.RTC_ERR_CODE_INVALID_PUSHED=90100214]="RTC_ERR_CODE_INVALID_PUSHED",e[e.RTC_ERR_CODE_SFU_FAIL=90100215]="RTC_ERR_CODE_SFU_FAIL",e[e.RTC_ERR_CODE_REQUEST_SFU_FAIL=90100216]="RTC_ERR_CODE_REQUEST_SFU_FAIL",e[e.RTC_ERR_CODE_OVERLOAD_ROOM_CAPACITY=90100217]="RTC_ERR_CODE_OVERLOAD_ROOM_CAPACITY",e[e.RTC_ERR_CODE_INVALID_ENCODING=90100218]="RTC_ERR_CODE_INVALID_ENCODING",e[e.RTC_ERR_CODE_APPLY_SSRC_FAIL=90100220]="RTC_ERR_CODE_APPLY_SSRC_FAIL",e[e.RTC_ERR_CODE_CTRL_TO_ACS_FAIL=90100221]="RTC_ERR_CODE_CTRL_TO_ACS_FAIL",e[e.RTC_ERR_CODE_KICK_USER_FAIL=90100222]="RTC_ERR_CODE_KICK_USER_FAIL",e[e.RTC_ERR_CODE_APPLY_TO_PUSH_STREAM_FAIL=90100223]="RTC_ERR_CODE_APPLY_TO_PUSH_STREAM_FAIL",e[e.RTC_ERR_CODE_ROOM_IDLE=90100224]="RTC_ERR_CODE_ROOM_IDLE",e[e.RTC_ERR_CODE_KICKED_USER=90100225]="RTC_ERR_CODE_KICKED_USER",e[e.RTC_ERR_CODE_SUBSCRIBED_USER_CONNECT_ERROR=90100226]="RTC_ERR_CODE_SUBSCRIBED_USER_CONNECT_ERROR",e[e.RTC_ERR_CODE_ROOM_NOT_EXIST=90100227]="RTC_ERR_CODE_ROOM_NOT_EXIST",e[e.RTC_ERR_CODE_MCU_FAIL=90100228]="RTC_ERR_CODE_MCU_FAIL",e[e.RTC_ERR_CODE_ROLE_CHANGED_FAIL=90100229]="RTC_ERR_CODE_ROLE_CHANGED_FAIL",e[e.RTC_ERR_CODE_NO_MCU_RESOURCE=90100230]="RTC_ERR_CODE_NO_MCU_RESOURCE",e[e.RTC_ERR_CODE_CREATE_PUSH_TASK_FAIL=90100231]="RTC_ERR_CODE_CREATE_PUSH_TASK_FAIL",e[e.RTC_ERR_CODE_MIX_TASK_EXISTS=90100232]="RTC_ERR_CODE_MIX_TASK_EXISTS",e[e.RTC_ERR_CODE_MIX_TASK_NOT_EXISTS=90100233]="RTC_ERR_CODE_MIX_TASK_NOT_EXISTS",e[e.RTC_ERR_CODE_MIX_USER_EMPTY=90100234]="RTC_ERR_CODE_MIX_USER_EMPTY",e[e.RTC_ERR_CODE_STOP_AUDIO_FAIL=90100235]="RTC_ERR_CODE_STOP_AUDIO_FAIL",e[e.RTC_ERR_CODE_STOP_VIDEO_FAIL=90100236]="RTC_ERR_CODE_STOP_VIDEO_FAIL",e[e.RTC_ERR_CODE_ROOM_TYPE_NOT_MATCH=90100237]="RTC_ERR_CODE_ROOM_TYPE_NOT_MATCH",e[e.RTC_ERR_CODE_AUDIO_LEVEL_NOT_MATCH=90100238]="RTC_ERR_CODE_AUDIO_LEVEL_NOT_MATCH",e[e.RTC_ERR_CODE_NOT_SUPPORT_MIX=90100239]="RTC_ERR_CODE_NOT_SUPPORT_MIX",e[e.RTC_ERR_CODE_VERSION_NOT_COMPLICATE=90100240]="RTC_ERR_CODE_VERSION_NOT_COMPLICATE",e[e.RTC_ERR_CODE_NOT_SUPPORT_SWITCH_ROLE=90100241]="RTC_ERR_CODE_NOT_SUPPORT_SWITCH_ROLE",e[e.RTC_ERR_CODE_SEND_TO_MCU_FAIL=90100242]="RTC_ERR_CODE_SEND_TO_MCU_FAIL",e[e.RTC_ERR_CODE_REDIRECT_MODE_NOT_MATCH=90100243]="RTC_ERR_CODE_REDIRECT_MODE_NOT_MATCH",e[e.RTC_ERR_CODE_ANCHOR_NUMBER_OUT_OF_RANGE=90100246]="RTC_ERR_CODE_ANCHOR_NUMBER_OUT_OF_RANGE",e[e.RTC_ERR_CODE_TOPN_SUB_MODE_FAULT=90100247]="RTC_ERR_CODE_TOPN_SUB_MODE_FAULT",e[e.RTC_ERR_CODE_NO_EFFECT_RESPONSE=90100248]="RTC_ERR_CODE_NO_EFFECT_RESPONSE",e[e.RTC_ERR_CODE_SFU_CTRL_EXCEPTION=90100249]="RTC_ERR_CODE_SFU_CTRL_EXCEPTION",e[e.RTC_ERR_CODE_DESKTOP_NUMBER_OUT_OF_RANGE=90100250]="RTC_ERR_CODE_DESKTOP_NUMBER_OUT_OF_RANGE",e[e.RTC_ERR_CODE_CLOUD_INTERNAL_ERROR=90100299]="RTC_ERR_CODE_CLOUD_INTERNAL_ERROR"}(ou||(ou={}));const Iu={[ou.RTC_ERR_CODE_SUCCESS]:"success",[ou.RTC_ERR_CODE_RTC_SDK_ERROR]:"sdk internal error",[ou.RTC_ERR_CODE_NOT_SUPPORT_MEDIA_DEVICES]:"not support enumerate devices",[ou.RTC_ERR_CODE_NO_AVAILABLE_DEVICES]:"no available devices",[ou.RTC_ERR_CODE_NO_AVAILABLE_VIDEO_INPUT_DEVICES]:"no available video input devices",[ou.RTC_ERR_CODE_NO_AVAILABLE_AUDIO_INPUT_DEVICES]:"no available audio input devices",[ou.RTC_ERR_CODE_NO_AVAILABLE_AUDIO_OUTPUT_DEVICES]:"no available audio output devices",[ou.RTC_ERR_CODE_STATUS_ERROR]:"room status error",[ou.RTC_ERR_CODE_INVALID_PARAMETER]:"invalid parameter",[ou.RTC_ERR_CODE_WEBSOCKET_NOT_CONNECTED]:'websocket connection state is not "CONNECTED"',[ou.RTC_ERR_CODE_WEBSOCKET_NOT_OPEN]:"websocket is not open",[ou.RTC_ERR_CODE_WAIT_CONFIG_FAIL]:"wait server config fail",[ou.RTC_ERR_CODE_WAIT_RSP_TIMEOUT]:"message response timeout",[ou.RTC_ERR_CODE_PUBLISH_RESPONSE_FAIL]:"publish response fail",[ou.RTC_ERR_CODE_REGION_NOT_COVERED]:"current region is not covered, service unavailable",[ou.RTC_ERR_CODE_WEBSOCKET_CONNECT_TIMEOUT]:"websocket connect timeout",[ou.RTC_ERR_CODE_WEBSOCKET_RECONNECT_TIMEOUT]:"websocket reconnect timeout",[ou.RTC_ERR_CODE_WEBSOCKET_INTERRUPTED]:"websocket connection state is idle, interrupt operation",[ou.RTC_ERR_CODE_CAPTURE_PERMISSION_DENIED]:"capture failed, permission denied",[ou.RTC_ERR_CODE_CAPTURE_OVER_CONSTRAINED]:"capture failed, Constraint parameter invalid",[ou.RTC_ERR_CODE_CAPTURE_DEVICE_NOT_FOUND]:"capture failed, requested device not found",[ou.RTC_ERR_CODE_CAPTURE_DEVICE_NOT_READABLE]:"capture failed, maybe device is occupied by other application",[ou.RTC_ERR_CODE_PLAY_NOT_ALLOW]:"the user didn't interact with the document first, please trigger by gesture",[ou.RTC_ERR_CODE_ROLE_NO_PERMISSION]:"the user role have no permission to operate",[ou.RTC_ERR_CODE_ANSWER_SDP_INVALID]:"the answer sdp is  invalid",[ou.RTC_ERR_CODE_MEDIA_UPSTREAM_UNSUPPORTED]:"the upstream media is not supported",[ou.RTC_ERR_CODE_WEBRTC_UNSUPPORTED]:"the browser does not support",[ou.RTC_ERR_CODE_AUTHORIZATION_FAIL]:"token is invalid,authorization failed",[ou.RTC_ERR_CODE_INVALID_REQ_PARAMETER]:"request parameter is invalid",[ou.RTC_ERR_CODE_CONNECTION_IDLE]:"connection is not exist",[ou.RTC_ERR_CODE_INTERNAL_EXCEPTION]:"server internal exception",[ou.RTC_ERR_CODE_SEND_TO_RTCCTRL_FAIL]:"server internal exception",[ou.RTC_ERR_CODE_RTCCTRL_EXCEPTION]:"server internal exception",[ou.RTC_ERR_CODE_WS_NOT_SUPPORTED]:"websocket is unsupported",[ou.RTC_ERR_CODE_REQUEST_FREQUENTLY]:"request too frequently",[ou.RTC_ERR_CODE_INVALID_REQUEST_BODY]:"server internal exception",[ou.RTC_ERR_CODE_INVALID_RESPONSE]:"server internal exception",[ou.RTC_ERR_CODE_INTERNAL_ERROR]:"server internal exception",[ou.RTC_ERR_CODE_INVALID_CTRL_PARAMETER]:"request parameter is invalid",[ou.RTC_ERR_CODE_INVALID_REQUEST]:"server internal exception",[ou.RTC_ERR_CODE_JOIN_ROOM_FAIL]:"join room fail",[ou.RTC_ERR_CODE_ALREADY_JOINED]:"joined already",[ou.RTC_ERR_CODE_NO_SFU_RESOURCE]:"server internal exception",[ou.RTC_ERR_CODE_INVALID_SSRC]:"invalid ssrc",[ou.RTC_ERR_CODE_STREAM_ALREADY_PUSHED]:"stream is pushed already",[ou.RTC_ERR_CODE_SAVE_USER_ERROR]:"save user fail",[ou.RTC_ERR_CODE_UPDATE_USER_ERROR]:"update user fail",[ou.RTC_ERR_CODE_FETCH_USER_ERROR]:"fetch user fail",[ou.RTC_ERR_CODE_SAVE_ROOM_ERROR]:"save room fail",[ou.RTC_ERR_CODE_UPDATE_ROOM_ERROR]:"update room fail",[ou.RTC_ERR_CODE_INVALID_SUBSCRIBED_INFO]:"invalid subscribe info",[ou.RTC_ERR_CODE_INVALID_PUSHED]:"invalid push stream",[ou.RTC_ERR_CODE_SFU_FAIL]:"server internal exception",[ou.RTC_ERR_CODE_REQUEST_SFU_FAIL]:"server internal exception",[ou.RTC_ERR_CODE_OVERLOAD_ROOM_CAPACITY]:"overload room capacity",[ou.RTC_ERR_CODE_INVALID_ENCODING]:"invalid encoding",[ou.RTC_ERR_CODE_APPLY_SSRC_FAIL]:"apply ssrc fail",[ou.RTC_ERR_CODE_CTRL_TO_ACS_FAIL]:"server internal exception",[ou.RTC_ERR_CODE_KICK_USER_FAIL]:"kick user fail",[ou.RTC_ERR_CODE_APPLY_TO_PUSH_STREAM_FAIL]:"apply to push stream fail",[ou.RTC_ERR_CODE_ROOM_IDLE]:"room is released",[ou.RTC_ERR_CODE_KICKED_USER]:"user has been kicked out",[ou.RTC_ERR_CODE_SUBSCRIBED_USER_CONNECT_ERROR]:"subscribed user connected error",[ou.RTC_ERR_CODE_ROOM_NOT_EXIST]:"room is not exist",[ou.RTC_ERR_CODE_MCU_FAIL]:"server internal exception",[ou.RTC_ERR_CODE_ROLE_CHANGED_FAIL]:"role is unchanged",[ou.RTC_ERR_CODE_NO_MCU_RESOURCE]:"no avaliable resources",[ou.RTC_ERR_CODE_CREATE_PUSH_TASK_FAIL]:"server internal exception",[ou.RTC_ERR_CODE_MIX_TASK_EXISTS]:"the task is exist",[ou.RTC_ERR_CODE_MIX_TASK_NOT_EXISTS]:"the task is not exist",[ou.RTC_ERR_CODE_MIX_USER_EMPTY]:"no avaliable users",[ou.RTC_ERR_CODE_STOP_AUDIO_FAIL]:"stop audio fail",[ou.RTC_ERR_CODE_STOP_VIDEO_FAIL]:"stop video fail",[ou.RTC_ERR_CODE_ROOM_TYPE_NOT_MATCH]:"room mode is not matched",[ou.RTC_ERR_CODE_AUDIO_LEVEL_NOT_MATCH]:"audio level is not matched",[ou.RTC_ERR_CODE_NOT_SUPPORT_MIX]:"unsupported operation",[ou.RTC_ERR_CODE_VERSION_NOT_COMPLICATE]:"not matched",[ou.RTC_ERR_CODE_NOT_SUPPORT_SWITCH_ROLE]:"switch role is unsupported",[ou.RTC_ERR_CODE_SEND_TO_MCU_FAIL]:"server internal exception",[ou.RTC_ERR_CODE_REDIRECT_MODE_NOT_MATCH]:"unsupported operation",[ou.RTC_ERR_CODE_ANCHOR_NUMBER_OUT_OF_RANGE]:"the number of anchors has reached the maximum",[ou.RTC_ERR_CODE_TOPN_SUB_MODE_FAULT]:"topn invalid parameters",[ou.RTC_ERR_CODE_NO_EFFECT_RESPONSE]:"server internal exception",[ou.RTC_ERR_CODE_SFU_CTRL_EXCEPTION]:"server internal exception",[ou.RTC_ERR_CODE_DESKTOP_NUMBER_OUT_OF_RANGE]:"the number of desktop streams has reached the maximum",[ou.RTC_ERR_CODE_CLOUD_INTERNAL_ERROR]:"server internal error"},yu=new Map;for(let rb=1;rb<=10;rb++)yu.set(1e5+rb,90100100+rb);yu.set(100999,90100199);for(let rb=1;rb<=43;rb++)yu.set(2e5+rb,90100200+rb);for(let rb=44;rb<=50;rb++)yu.set(2e4+rb,90100200+rb);yu.set(200999,90100299);class Eu extends Error{constructor(e,t){const r=yu.get(e)||e;let i="";i=t&&r<90100100?t:r in ou?Iu[r]:"unknow error",super(t),this.code=r,this.message=i}getCode(){return this.code}getMsg(){return this.message}toString(){return'["code": '.concat(this.code,', "message": "').concat(this.message,'"]')}}function bu(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Cu=Xr,Au=a,ku=n,wu=le,Ou=E,Pu=C,Mu=Ge.f,Du=Dr,xu=ku.Symbol;if(Au&&Ou(xu)&&(!("description"in xu.prototype)||void 0!==xu().description)){var Nu={},Uu=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Uu?new xu(e):void 0===e?xu():xu(e);return""===e&&(Nu[t]=!0),t};Du(Uu,xu);var Lu=Uu.prototype=xu.prototype;Lu.constructor=Uu;var Vu=Lu.toString,Bu="Symbol(test)"==String(xu("test")),Yu=/^Symbol\((.*)\)[^)]+$/;Mu(Lu,"description",{configurable:!0,get:function(){var e=Pu(this)?this.valueOf():this,t=Vu.call(e);if(wu(Nu,e))return"";var r=Bu?t.slice(7,-1):t.replace(Yu,"$1");return""===r?void 0:r}}),Cu({global:!0,forced:!0},{Symbol:Uu})}var Fu=_,ju=Array.isArray||function(e){return"Array"==Fu(e)},zu=pn,Hu=C,Ku=Ee("species"),Wu=function(e){var t;return ju(e)&&(t=e.constructor,(zu(t)&&(t===Array||ju(t.prototype))||Hu(t)&&null===(t=t[Ku]))&&(t=void 0)),void 0===t?Array:t},Gu=Ri,Ju=v,qu=ce,Xu=dr,Qu=function(e,t){return new(Wu(e))(0===t?0:t)},Zu=[].push,$u=function(e){var t=1==e,r=2==e,i=3==e,n=4==e,s=6==e,o=7==e,a=5==e||s;return function(c,u,d,l){for(var h,f,p=qu(c),m=Ju(p),_=Gu(u,d,3),g=Xu(m),S=0,v=l||Qu,R=t?v(c,g):r||o?v(c,0):void 0;g>S;S++)if((a||S in m)&&(f=_(h=m[S],S,p),e))if(t)R[S]=f;else if(f)switch(e){case 3:return!0;case 5:return h;case 6:return S;case 2:Zu.call(R,h)}else switch(e){case 4:return!1;case 7:Zu.call(R,h)}return s?-1:i||n?n:R}},ed={forEach:$u(0),map:$u(1),filter:$u(2),some:$u(3),every:$u(4),find:$u(5),findIndex:$u(6),filterReject:$u(7)},td=o,rd=function(e,t){var r=[][e];return!!r&&td((function(){r.call(null,t||function(){throw 1},1)}))},id=ed.forEach,nd=rd("forEach")?[].forEach:function(e){return id(this,e,arguments.length>1?arguments[1]:void 0)},sd=n,od=au,ad=du,cd=nd,ud=it,dd=function(e){if(e&&e.forEach!==cd)try{ud(e,"forEach",cd)}catch(tb){e.forEach=cd}};for(var ld in od)od[ld]&&dd(sd[ld]&&sd[ld].prototype);dd(ad);var hd=Ai,fd=function(e){if("Symbol"===hd(e))throw TypeError("Cannot convert a Symbol value to a string");return String(e)},pd=qe,md=function(){var e=pd(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},_d={},gd=o,Sd=n.RegExp;_d.UNSUPPORTED_Y=gd((function(){var e=Sd("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),_d.BROKEN_CARET=gd((function(){var e=Sd("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));var vd=o,Rd=n.RegExp,Td=vd((function(){var e=Rd(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),Id=o,yd=n.RegExp,Ed=Id((function(){var e=yd("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),bd=fd,Cd=md,Ad=_d,kd=ee.exports,wd=Zo,Od=Nt.get,Pd=Td,Md=Ed,Dd=RegExp.prototype.exec,xd=kd("native-string-replace",String.prototype.replace),Nd=Dd,Ud=function(){var e=/a/,t=/b*/g;return Dd.call(e,"a"),Dd.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),Ld=Ad.UNSUPPORTED_Y||Ad.BROKEN_CARET,Vd=void 0!==/()??/.exec("")[1];(Ud||Vd||Ld||Pd||Md)&&(Nd=function(e){var t,r,i,n,s,o,a,c=this,u=Od(c),d=bd(e),l=u.raw;if(l)return l.lastIndex=c.lastIndex,t=Nd.call(l,d),c.lastIndex=l.lastIndex,t;var h=u.groups,f=Ld&&c.sticky,p=Cd.call(c),m=c.source,_=0,g=d;if(f&&(-1===(p=p.replace("y","")).indexOf("g")&&(p+="g"),g=d.slice(c.lastIndex),c.lastIndex>0&&(!c.multiline||c.multiline&&"\n"!==d.charAt(c.lastIndex-1))&&(m="(?: "+m+")",g=" "+g,_++),r=new RegExp("^(?:"+m+")",p)),Vd&&(r=new RegExp("^"+m+"$(?!\\s)",p)),Ud&&(i=c.lastIndex),n=Dd.call(f?r:c,g),f?n?(n.input=n.input.slice(_),n[0]=n[0].slice(_),n.index=c.lastIndex,c.lastIndex+=n[0].length):c.lastIndex=0:Ud&&n&&(c.lastIndex=c.global?n.index+n[0].length:i),Vd&&n&&n.length>1&&xd.call(n[0],r,(function(){for(s=1;s<arguments.length-2;s++)void 0===arguments[s]&&(n[s]=void 0)})),n&&h)for(n.groups=o=wd(null),s=0;s<h.length;s++)o[(a=h[s])[0]]=n[a[1]];return n});var Bd=Nd;Xr({target:"RegExp",proto:!0,forced:/./.exec!==Bd},{exec:Bd});var Yd=nt.exports,Fd=Bd,jd=o,zd=Ee,Hd=it,Kd=zd("species"),Wd=RegExp.prototype,Gd=tr,Jd=fd,qd=R,Xd=function(e){return function(t,r){var i,n,s=Jd(qd(t)),o=Gd(r),a=s.length;return o<0||o>=a?e?"":void 0:(i=s.charCodeAt(o))<55296||i>56319||o+1===a||(n=s.charCodeAt(o+1))<56320||n>57343?e?s.charAt(o):i:e?s.slice(o,o+2):n-56320+(i-55296<<10)+65536}},Qd={codeAt:Xd(!1),charAt:Xd(!0)}.charAt,Zd=ce,$d=Math.floor,el="".replace,tl=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,rl=/\$([$&'`]|\d{1,2})/g,il=qe,nl=E,sl=_,ol=Bd,al=function(e,t,r,i){var n=zd(e),s=!jd((function(){var t={};return t[n]=function(){return 7},7!=""[e](t)})),o=s&&!jd((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[Kd]=function(){return r},r.flags="",r[n]=/./[n]),r.exec=function(){return t=!0,null},r[n](""),!t}));if(!s||!o||r){var a=/./[n],c=t(n,""[e],(function(e,t,r,i,n){var o=t.exec;return o===Fd||o===Wd.exec?s&&!n?{done:!0,value:a.call(t,r,i)}:{done:!0,value:e.call(r,t,i)}:{done:!1}}));Yd(String.prototype,e,c[0]),Yd(Wd,n,c[1])}i&&Hd(Wd[n],"sham",!0)},cl=o,ul=qe,dl=E,ll=tr,hl=cr,fl=fd,pl=R,ml=function(e,t,r){return t+(r?Qd(e,t).length:1)},_l=Q,gl=function(e,t,r,i,n,s){var o=r+e.length,a=i.length,c=rl;return void 0!==n&&(n=Zd(n),c=tl),el.call(s,c,(function(s,c){var u;switch(c.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(o);case"<":u=n[c.slice(1,-1)];break;default:var d=+c;if(0===d)return s;if(d>a){var l=$d(d/10);return 0===l?s:l<=a?void 0===i[l-1]?c.charAt(1):i[l-1]+c.charAt(1):s}u=i[d-1]}return void 0===u?"":u}))},Sl=function(e,t){var r=e.exec;if(nl(r)){var i=r.call(e,t);return null!==i&&il(i),i}if("RegExp"===sl(e))return ol.call(e,t);throw TypeError("RegExp#exec called on incompatible receiver")},vl=Ee("replace"),Rl=Math.max,Tl=Math.min,Il="$0"==="a".replace(/./,"$0"),yl=!!/./[vl]&&""===/./[vl]("a","$0");al("replace",(function(e,t,r){var i=yl?"$":"$0";return[function(e,r){var i=pl(this),n=null==e?void 0:_l(e,vl);return n?n.call(e,i,r):t.call(fl(i),e,r)},function(e,n){var s=ul(this),o=fl(e);if("string"==typeof n&&-1===n.indexOf(i)&&-1===n.indexOf("$<")){var a=r(t,s,o,n);if(a.done)return a.value}var c=dl(n);c||(n=fl(n));var u=s.global;if(u){var d=s.unicode;s.lastIndex=0}for(var l=[];;){var h=Sl(s,o);if(null===h)break;if(l.push(h),!u)break;""===fl(h[0])&&(s.lastIndex=ml(o,hl(s.lastIndex),d))}for(var f,p="",m=0,_=0;_<l.length;_++){h=l[_];for(var g=fl(h[0]),S=Rl(Tl(ll(h.index),o.length),0),v=[],R=1;R<h.length;R++)v.push(void 0===(f=h[R])?f:String(f));var T=h.groups;if(c){var I=[g].concat(v,S,o);void 0!==T&&I.push(T);var y=fl(n.apply(void 0,I))}else y=gl(g,o,S,v,T,n);S>=m&&(p+=o.slice(m,S)+y,m=S+g.length)}return p+o.slice(m)}]}),!!cl((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!Il||yl);var El=E,bl=C,Cl=ii,Al=function(e,t,r){var i,n;return Cl&&El(i=t.constructor)&&i!==r&&bl(n=i.prototype)&&n!==r.prototype&&Cl(e,n),e},kl=C,wl=_,Ol=Ee("match"),Pl=a,Ml=n,Dl=jr,xl=Al,Nl=it,Ul=Ge.f,Ll=Zt.f,Vl=function(e){var t;return kl(e)&&(void 0!==(t=e[Ol])?!!t:"RegExp"==wl(e))},Bl=fd,Yl=md,Fl=_d,jl=nt.exports,zl=o,Hl=le,Kl=Nt.enforce,Wl=hi,Gl=Td,Jl=Ed,ql=Ee("match"),Xl=Ml.RegExp,Ql=Xl.prototype,Zl=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,$l=/a/g,eh=/a/g,th=new Xl($l)!==$l,rh=Fl.UNSUPPORTED_Y,ih=Pl&&(!th||rh||Gl||Jl||zl((function(){return eh[ql]=!1,Xl($l)!=$l||Xl(eh)==eh||"/a/i"!=Xl($l,"i")})));if(Dl("RegExp",ih)){for(var nh=function(e,t){var r,i,n,s,o,a,c=this instanceof nh,u=Vl(e),d=void 0===t,l=[],h=e;if(!c&&u&&d&&e.constructor===nh)return e;if((u||e instanceof nh)&&(e=e.source,d&&(t="flags"in h?h.flags:Yl.call(h))),e=void 0===e?"":Bl(e),t=void 0===t?"":Bl(t),h=e,Gl&&"dotAll"in $l&&(i=!!t&&t.indexOf("s")>-1)&&(t=t.replace(/s/g,"")),r=t,rh&&"sticky"in $l&&(n=!!t&&t.indexOf("y")>-1)&&(t=t.replace(/y/g,"")),Jl&&(s=function(e){for(var t,r=e.length,i=0,n="",s=[],o={},a=!1,c=!1,u=0,d="";i<=r;i++){if("\\"===(t=e.charAt(i)))t+=e.charAt(++i);else if("]"===t)a=!1;else if(!a)switch(!0){case"["===t:a=!0;break;case"("===t:Zl.test(e.slice(i+1))&&(i+=2,c=!0),n+=t,u++;continue;case">"===t&&c:if(""===d||Hl(o,d))throw new SyntaxError("Invalid capture group name");o[d]=!0,s.push([d,u]),c=!1,d="";continue}c?d+=t:n+=t}return[n,s]}(e),e=s[0],l=s[1]),o=xl(Xl(e,t),c?this:Ql,nh),(i||n||l.length)&&(a=Kl(o),i&&(a.dotAll=!0,a.raw=nh(function(e){for(var t,r=e.length,i=0,n="",s=!1;i<=r;i++)"\\"!==(t=e.charAt(i))?s||"."!==t?("["===t?s=!0:"]"===t&&(s=!1),n+=t):n+="[\\s\\S]":n+=t+e.charAt(++i);return n}(e),r)),n&&(a.sticky=!0),l.length&&(a.groups=l)),e!==h)try{Nl(o,"source",""===h?"(?:)":h)}catch(tb){}return o},sh=function(e){e in nh||Ul(nh,e,{configurable:!0,get:function(){return Xl[e]},set:function(t){Xl[e]=t}})},oh=Ll(Xl),ah=0;oh.length>ah;)sh(oh[ah++]);Ql.constructor=nh,nh.prototype=Ql,jl(Ml,"RegExp",nh)}Wl("RegExp");const ch=["none","error","warn","info","debug"];var uh="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},dh=[],lh=[],hh="undefined"!=typeof Uint8Array?Uint8Array:Array,fh=!1;function ph(){fh=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,r=e.length;t<r;++t)dh[t]=e[t],lh[e.charCodeAt(t)]=t;lh["-".charCodeAt(0)]=62,lh["_".charCodeAt(0)]=63}function mh(e,t,r){for(var i,n,s=[],o=t;o<r;o+=3)i=(e[o]<<16)+(e[o+1]<<8)+e[o+2],s.push(dh[(n=i)>>18&63]+dh[n>>12&63]+dh[n>>6&63]+dh[63&n]);return s.join("")}function _h(e){var t;fh||ph();for(var r=e.length,i=r%3,n="",s=[],o=16383,a=0,c=r-i;a<c;a+=o)s.push(mh(e,a,a+o>c?c:a+o));return 1===i?(t=e[r-1],n+=dh[t>>2],n+=dh[t<<4&63],n+="=="):2===i&&(t=(e[r-2]<<8)+e[r-1],n+=dh[t>>10],n+=dh[t>>4&63],n+=dh[t<<2&63],n+="="),s.push(n),s.join("")}function gh(e,t,r,i,n){var s,o,a=8*n-i-1,c=(1<<a)-1,u=c>>1,d=-7,l=r?n-1:0,h=r?-1:1,f=e[t+l];for(l+=h,s=f&(1<<-d)-1,f>>=-d,d+=a;d>0;s=256*s+e[t+l],l+=h,d-=8);for(o=s&(1<<-d)-1,s>>=-d,d+=i;d>0;o=256*o+e[t+l],l+=h,d-=8);if(0===s)s=1-u;else{if(s===c)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),s-=u}return(f?-1:1)*o*Math.pow(2,s-i)}function Sh(e,t,r,i,n,s){var o,a,c,u=8*s-n-1,d=(1<<u)-1,l=d>>1,h=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:s-1,p=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=d):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+l>=1?h/c:h*Math.pow(2,1-l))*c>=2&&(o++,c/=2),o+l>=d?(a=0,o=d):o+l>=1?(a=(t*c-1)*Math.pow(2,n),o+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,n),o=0));n>=8;e[r+f]=255&a,f+=p,a/=256,n-=8);for(o=o<<n|a,u+=n;u>0;e[r+f]=255&o,f+=p,o/=256,u-=8);e[r+f-p]|=128*m}var vh={}.toString,Rh=Array.isArray||function(e){return"[object Array]"==vh.call(e)};function Th(){return yh.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Ih(e,t){if(Th()<t)throw new RangeError("Invalid typed array length");return yh.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=yh.prototype:(null===e&&(e=new yh(t)),e.length=t),e}function yh(e,t,r){if(!(yh.TYPED_ARRAY_SUPPORT||this instanceof yh))return new yh(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return Ch(this,e)}return Eh(this,e,t,r)}function Eh(e,t,r,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,i){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(i||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,r):new Uint8Array(t,r,i);yh.TYPED_ARRAY_SUPPORT?(e=t).__proto__=yh.prototype:e=Ah(e,t);return e}(e,t,r,i):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!yh.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var i=0|Oh(t,r),n=(e=Ih(e,i)).write(t,r);n!==i&&(e=e.slice(0,n));return e}(e,t,r):function(e,t){if(wh(t)){var r=0|kh(t.length);return 0===(e=Ih(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?Ih(e,0):Ah(e,t);if("Buffer"===t.type&&Rh(t.data))return Ah(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function bh(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function Ch(e,t){if(bh(t),e=Ih(e,t<0?0:0|kh(t)),!yh.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function Ah(e,t){var r=t.length<0?0:0|kh(t.length);e=Ih(e,r);for(var i=0;i<r;i+=1)e[i]=255&t[i];return e}function kh(e){if(e>=Th())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Th().toString(16)+" bytes");return 0|e}function wh(e){return!(null==e||!e._isBuffer)}function Oh(e,t){if(wh(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return nf(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return sf(e).length;default:if(i)return nf(e).length;t=(""+t).toLowerCase(),i=!0}}function Ph(e,t,r){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Wh(this,t,r);case"utf8":case"utf-8":return jh(this,t,r);case"ascii":return Hh(this,t,r);case"latin1":case"binary":return Kh(this,t,r);case"base64":return Fh(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Gh(this,t,r);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function Mh(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function Dh(e,t,r,i,n){if(0===e.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(n)return-1;r=e.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof t&&(t=yh.from(t,i)),wh(t))return 0===t.length?-1:xh(e,t,r,i,n);if("number"==typeof t)return t&=255,yh.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):xh(e,[t],r,i,n);throw new TypeError("val must be string, number or Buffer")}function xh(e,t,r,i,n){var s,o=1,a=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,r/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(n){var d=-1;for(s=r;s<a;s++)if(u(e,s)===u(t,-1===d?0:s-d)){if(-1===d&&(d=s),s-d+1===c)return d*o}else-1!==d&&(s-=s-d),d=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){for(var l=!0,h=0;h<c;h++)if(u(e,s+h)!==u(t,h)){l=!1;break}if(l)return s}return-1}function Nh(e,t,r,i){r=Number(r)||0;var n=e.length-r;i?(i=Number(i))>n&&(i=n):i=n;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");i>s/2&&(i=s/2);for(var o=0;o<i;++o){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))return o;e[r+o]=a}return o}function Uh(e,t,r,i){return of(nf(t,e.length-r),e,r,i)}function Lh(e,t,r,i){return of(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,i)}function Vh(e,t,r,i){return Lh(e,t,r,i)}function Bh(e,t,r,i){return of(sf(t),e,r,i)}function Yh(e,t,r,i){return of(function(e,t){for(var r,i,n,s=[],o=0;o<e.length&&!((t-=2)<0);++o)i=(r=e.charCodeAt(o))>>8,n=r%256,s.push(n),s.push(i);return s}(t,e.length-r),e,r,i)}function Fh(e,t,r){return 0===t&&r===e.length?_h(e):_h(e.slice(t,r))}function jh(e,t,r){r=Math.min(e.length,r);for(var i=[],n=t;n<r;){var s,o,a,c,u=e[n],d=null,l=u>239?4:u>223?3:u>191?2:1;if(n+l<=r)switch(l){case 1:u<128&&(d=u);break;case 2:128==(192&(s=e[n+1]))&&(c=(31&u)<<6|63&s)>127&&(d=c);break;case 3:s=e[n+1],o=e[n+2],128==(192&s)&&128==(192&o)&&(c=(15&u)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(d=c);break;case 4:s=e[n+1],o=e[n+2],a=e[n+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(d=c)}null===d?(d=65533,l=1):d>65535&&(d-=65536,i.push(d>>>10&1023|55296),d=56320|1023&d),i.push(d),n+=l}return function(e){var t=e.length;if(t<=zh)return String.fromCharCode.apply(String,e);var r="",i=0;for(;i<t;)r+=String.fromCharCode.apply(String,e.slice(i,i+=zh));return r}(i)}yh.TYPED_ARRAY_SUPPORT=void 0===uh.TYPED_ARRAY_SUPPORT||uh.TYPED_ARRAY_SUPPORT,yh.poolSize=8192,yh._augment=function(e){return e.__proto__=yh.prototype,e},yh.from=function(e,t,r){return Eh(null,e,t,r)},yh.TYPED_ARRAY_SUPPORT&&(yh.prototype.__proto__=Uint8Array.prototype,yh.__proto__=Uint8Array),yh.alloc=function(e,t,r){return function(e,t,r,i){return bh(t),t<=0?Ih(e,t):void 0!==r?"string"==typeof i?Ih(e,t).fill(r,i):Ih(e,t).fill(r):Ih(e,t)}(null,e,t,r)},yh.allocUnsafe=function(e){return Ch(null,e)},yh.allocUnsafeSlow=function(e){return Ch(null,e)},yh.isBuffer=af,yh.compare=function(e,t){if(!wh(e)||!wh(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,i=t.length,n=0,s=Math.min(r,i);n<s;++n)if(e[n]!==t[n]){r=e[n],i=t[n];break}return r<i?-1:i<r?1:0},yh.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},yh.concat=function(e,t){if(!Rh(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return yh.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var i=yh.allocUnsafe(t),n=0;for(r=0;r<e.length;++r){var s=e[r];if(!wh(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,n),n+=s.length}return i},yh.byteLength=Oh,yh.prototype._isBuffer=!0,yh.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Mh(this,t,t+1);return this},yh.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Mh(this,t,t+3),Mh(this,t+1,t+2);return this},yh.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Mh(this,t,t+7),Mh(this,t+1,t+6),Mh(this,t+2,t+5),Mh(this,t+3,t+4);return this},yh.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?jh(this,0,e):Ph.apply(this,arguments)},yh.prototype.equals=function(e){if(!wh(e))throw new TypeError("Argument must be a Buffer");return this===e||0===yh.compare(this,e)},yh.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},yh.prototype.compare=function(e,t,r,i,n){if(!wh(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),t<0||r>e.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&t>=r)return 0;if(i>=n)return-1;if(t>=r)return 1;if(this===e)return 0;for(var s=(n>>>=0)-(i>>>=0),o=(r>>>=0)-(t>>>=0),a=Math.min(s,o),c=this.slice(i,n),u=e.slice(t,r),d=0;d<a;++d)if(c[d]!==u[d]){s=c[d],o=u[d];break}return s<o?-1:o<s?1:0},yh.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},yh.prototype.indexOf=function(e,t,r){return Dh(this,e,t,r,!0)},yh.prototype.lastIndexOf=function(e,t,r){return Dh(this,e,t,r,!1)},yh.prototype.write=function(e,t,r,i){if(void 0===t)i="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)i=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-t;if((void 0===r||r>n)&&(r=n),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return Nh(this,e,t,r);case"utf8":case"utf-8":return Uh(this,e,t,r);case"ascii":return Lh(this,e,t,r);case"latin1":case"binary":return Vh(this,e,t,r);case"base64":return Bh(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Yh(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},yh.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var zh=4096;function Hh(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(127&e[n]);return i}function Kh(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(e[n]);return i}function Wh(e,t,r){var i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);for(var n="",s=t;s<r;++s)n+=rf(e[s]);return n}function Gh(e,t,r){for(var i=e.slice(t,r),n="",s=0;s<i.length;s+=2)n+=String.fromCharCode(i[s]+256*i[s+1]);return n}function Jh(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function qh(e,t,r,i,n,s){if(!wh(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<s)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}function Xh(e,t,r,i){t<0&&(t=65535+t+1);for(var n=0,s=Math.min(e.length-r,2);n<s;++n)e[r+n]=(t&255<<8*(i?n:1-n))>>>8*(i?n:1-n)}function Qh(e,t,r,i){t<0&&(t=4294967295+t+1);for(var n=0,s=Math.min(e.length-r,4);n<s;++n)e[r+n]=t>>>8*(i?n:3-n)&255}function Zh(e,t,r,i,n,s){if(r+i>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function $h(e,t,r,i,n){return n||Zh(e,0,r,4),Sh(e,t,r,i,23,4),r+4}function ef(e,t,r,i,n){return n||Zh(e,0,r,8),Sh(e,t,r,i,52,8),r+8}yh.prototype.slice=function(e,t){var r,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),yh.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=yh.prototype;else{var n=t-e;r=new yh(n,void 0);for(var s=0;s<n;++s)r[s]=this[s+e]}return r},yh.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||Jh(e,t,this.length);for(var i=this[e],n=1,s=0;++s<t&&(n*=256);)i+=this[e+s]*n;return i},yh.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||Jh(e,t,this.length);for(var i=this[e+--t],n=1;t>0&&(n*=256);)i+=this[e+--t]*n;return i},yh.prototype.readUInt8=function(e,t){return t||Jh(e,1,this.length),this[e]},yh.prototype.readUInt16LE=function(e,t){return t||Jh(e,2,this.length),this[e]|this[e+1]<<8},yh.prototype.readUInt16BE=function(e,t){return t||Jh(e,2,this.length),this[e]<<8|this[e+1]},yh.prototype.readUInt32LE=function(e,t){return t||Jh(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},yh.prototype.readUInt32BE=function(e,t){return t||Jh(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},yh.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||Jh(e,t,this.length);for(var i=this[e],n=1,s=0;++s<t&&(n*=256);)i+=this[e+s]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},yh.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||Jh(e,t,this.length);for(var i=t,n=1,s=this[e+--i];i>0&&(n*=256);)s+=this[e+--i]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*t)),s},yh.prototype.readInt8=function(e,t){return t||Jh(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},yh.prototype.readInt16LE=function(e,t){t||Jh(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},yh.prototype.readInt16BE=function(e,t){t||Jh(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},yh.prototype.readInt32LE=function(e,t){return t||Jh(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},yh.prototype.readInt32BE=function(e,t){return t||Jh(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},yh.prototype.readFloatLE=function(e,t){return t||Jh(e,4,this.length),gh(this,e,!0,23,4)},yh.prototype.readFloatBE=function(e,t){return t||Jh(e,4,this.length),gh(this,e,!1,23,4)},yh.prototype.readDoubleLE=function(e,t){return t||Jh(e,8,this.length),gh(this,e,!0,52,8)},yh.prototype.readDoubleBE=function(e,t){return t||Jh(e,8,this.length),gh(this,e,!1,52,8)},yh.prototype.writeUIntLE=function(e,t,r,i){(e=+e,t|=0,r|=0,i)||qh(this,e,t,r,Math.pow(2,8*r)-1,0);var n=1,s=0;for(this[t]=255&e;++s<r&&(n*=256);)this[t+s]=e/n&255;return t+r},yh.prototype.writeUIntBE=function(e,t,r,i){(e=+e,t|=0,r|=0,i)||qh(this,e,t,r,Math.pow(2,8*r)-1,0);var n=r-1,s=1;for(this[t+n]=255&e;--n>=0&&(s*=256);)this[t+n]=e/s&255;return t+r},yh.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||qh(this,e,t,1,255,0),yh.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},yh.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||qh(this,e,t,2,65535,0),yh.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Xh(this,e,t,!0),t+2},yh.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||qh(this,e,t,2,65535,0),yh.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Xh(this,e,t,!1),t+2},yh.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||qh(this,e,t,4,4294967295,0),yh.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Qh(this,e,t,!0),t+4},yh.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||qh(this,e,t,4,4294967295,0),yh.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Qh(this,e,t,!1),t+4},yh.prototype.writeIntLE=function(e,t,r,i){if(e=+e,t|=0,!i){var n=Math.pow(2,8*r-1);qh(this,e,t,r,n-1,-n)}var s=0,o=1,a=0;for(this[t]=255&e;++s<r&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},yh.prototype.writeIntBE=function(e,t,r,i){if(e=+e,t|=0,!i){var n=Math.pow(2,8*r-1);qh(this,e,t,r,n-1,-n)}var s=r-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},yh.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||qh(this,e,t,1,127,-128),yh.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},yh.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||qh(this,e,t,2,32767,-32768),yh.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Xh(this,e,t,!0),t+2},yh.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||qh(this,e,t,2,32767,-32768),yh.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Xh(this,e,t,!1),t+2},yh.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||qh(this,e,t,4,2147483647,-2147483648),yh.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Qh(this,e,t,!0),t+4},yh.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||qh(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),yh.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Qh(this,e,t,!1),t+4},yh.prototype.writeFloatLE=function(e,t,r){return $h(this,e,t,!0,r)},yh.prototype.writeFloatBE=function(e,t,r){return $h(this,e,t,!1,r)},yh.prototype.writeDoubleLE=function(e,t,r){return ef(this,e,t,!0,r)},yh.prototype.writeDoubleBE=function(e,t,r){return ef(this,e,t,!1,r)},yh.prototype.copy=function(e,t,r,i){if(r||(r=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);var n,s=i-r;if(this===e&&r<t&&t<i)for(n=s-1;n>=0;--n)e[n+t]=this[n+r];else if(s<1e3||!yh.TYPED_ARRAY_SUPPORT)for(n=0;n<s;++n)e[n+t]=this[n+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+s),t);return s},yh.prototype.fill=function(e,t,r,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),1===e.length){var n=e.charCodeAt(0);n<256&&(e=n)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!yh.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var o=wh(e)?e:nf(new yh(e,i).toString()),a=o.length;for(s=0;s<r-t;++s)this[s+t]=o[s%a]}return this};var tf=/[^+\/0-9A-Za-z-_]/g;function rf(e){return e<16?"0"+e.toString(16):e.toString(16)}function nf(e,t){var r;t=t||1/0;for(var i=e.length,n=null,s=[],o=0;o<i;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!n){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===i){(t-=3)>-1&&s.push(239,191,189);continue}n=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(t-=3)>-1&&s.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function sf(e){return function(e){var t,r,i,n,s,o;fh||ph();var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s="="===e[a-2]?2:"="===e[a-1]?1:0,o=new hh(3*a/4-s),i=s>0?a-4:a;var c=0;for(t=0,r=0;t<i;t+=4,r+=3)n=lh[e.charCodeAt(t)]<<18|lh[e.charCodeAt(t+1)]<<12|lh[e.charCodeAt(t+2)]<<6|lh[e.charCodeAt(t+3)],o[c++]=n>>16&255,o[c++]=n>>8&255,o[c++]=255&n;return 2===s?(n=lh[e.charCodeAt(t)]<<2|lh[e.charCodeAt(t+1)]>>4,o[c++]=255&n):1===s&&(n=lh[e.charCodeAt(t)]<<10|lh[e.charCodeAt(t+1)]<<4|lh[e.charCodeAt(t+2)]>>2,o[c++]=n>>8&255,o[c++]=255&n),o}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(tf,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function of(e,t,r,i){for(var n=0;n<i&&!(n+r>=t.length||n>=e.length);++n)t[n+r]=e[n];return n}function af(e){return null!=e&&(!!e._isBuffer||cf(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&cf(e.slice(0,0))}(e))}function cf(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var uf={exports:{}};!function(e,i){e.exports=function e(t,i,n){function s(a,c){if(!i[a]){if(!t[a]){if(!c&&r)return r(a);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var d=i[a]={exports:{}};t[a][0].call(d.exports,(function(e){return s(t[a][1][e]||e)}),d,d.exports,e,t,i,n)}return i[a].exports}for(var o=r,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(e,t,r){var i=e("./utils"),n=e("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,n,o,a,c,u,d=[],l=0,h=e.length,f=h,p="string"!==i.getTypeOf(e);l<e.length;)f=h-l,n=p?(t=e[l++],r=l<h?e[l++]:0,l<h?e[l++]:0):(t=e.charCodeAt(l++),r=l<h?e.charCodeAt(l++):0,l<h?e.charCodeAt(l++):0),o=t>>2,a=(3&t)<<4|r>>4,c=1<f?(15&r)<<2|n>>6:64,u=2<f?63&n:64,d.push(s.charAt(o)+s.charAt(a)+s.charAt(c)+s.charAt(u));return d.join("")},r.decode=function(e){var t,r,i,o,a,c,u=0,d=0,l="data:";if(e.substr(0,l.length)===l)throw new Error("Invalid base64 input, it looks like a data url.");var h,f=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===s.charAt(64)&&f--,e.charAt(e.length-2)===s.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=n.uint8array?new Uint8Array(0|f):new Array(0|f);u<e.length;)t=s.indexOf(e.charAt(u++))<<2|(o=s.indexOf(e.charAt(u++)))>>4,r=(15&o)<<4|(a=s.indexOf(e.charAt(u++)))>>2,i=(3&a)<<6|(c=s.indexOf(e.charAt(u++))),h[d++]=t,64!==a&&(h[d++]=r),64!==c&&(h[d++]=i);return h}},{"./support":30,"./utils":32}],2:[function(e,t,r){var i=e("./external"),n=e("./stream/DataWorker"),s=e("./stream/Crc32Probe"),o=e("./stream/DataLengthProbe");function a(e,t,r,i,n){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=i,this.compressedContent=n}a.prototype={getContentWorker:function(){var e=new n(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new n(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(e,t,r){return e.pipe(new s).pipe(new o("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new o("compressedSize")).withStreamInfo("compression",t)},t.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,r){var i=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(e){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,r){var i=e("./utils"),n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==i.getTypeOf(e)?function(e,t,r,i){var s=n,o=i+r;e^=-1;for(var a=i;a<o;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}(0|t,e,e.length,0):function(e,t,r,i){var s=n,o=i+r;e^=-1;for(var a=i;a<o;a++)e=e>>>8^s[255&(e^t.charCodeAt(a))];return-1^e}(0|t,e,e.length,0):0}},{"./utils":32}],5:[function(e,t,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,t,r){var i=null;i="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:i}},{lie:37}],7:[function(e,t,r){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=e("pako"),s=e("./utils"),o=e("./stream/GenericWorker"),a=i?"uint8array":"array";function c(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}r.magic="\b\0",s.inherits(c,o),c.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(a,e.data),!1)},c.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},r.compressWorker=function(e){return new c("Deflate",e)},r.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,r){function i(e,t){var r,i="";for(r=0;r<t;r++)i+=String.fromCharCode(255&e),e>>>=8;return i}function n(e,t,r,n,o,d){var l,h,f=e.file,p=e.compression,m=d!==a.utf8encode,_=s.transformTo("string",d(f.name)),g=s.transformTo("string",a.utf8encode(f.name)),S=f.comment,v=s.transformTo("string",d(S)),R=s.transformTo("string",a.utf8encode(S)),T=g.length!==f.name.length,I=R.length!==S.length,y="",E="",b="",C=f.dir,A=f.date,k={crc32:0,compressedSize:0,uncompressedSize:0};t&&!r||(k.crc32=e.crc32,k.compressedSize=e.compressedSize,k.uncompressedSize=e.uncompressedSize);var w=0;t&&(w|=8),m||!T&&!I||(w|=2048);var O=0,P=0;C&&(O|=16),"UNIX"===o?(P=798,O|=function(e,t){var r=e;return e||(r=t?16893:33204),(65535&r)<<16}(f.unixPermissions,C)):(P=20,O|=function(e){return 63&(e||0)}(f.dosPermissions)),l=A.getUTCHours(),l<<=6,l|=A.getUTCMinutes(),l<<=5,l|=A.getUTCSeconds()/2,h=A.getUTCFullYear()-1980,h<<=4,h|=A.getUTCMonth()+1,h<<=5,h|=A.getUTCDate(),T&&(E=i(1,1)+i(c(_),4)+g,y+="up"+i(E.length,2)+E),I&&(b=i(1,1)+i(c(v),4)+R,y+="uc"+i(b.length,2)+b);var M="";return M+="\n\0",M+=i(w,2),M+=p.magic,M+=i(l,2),M+=i(h,2),M+=i(k.crc32,4),M+=i(k.compressedSize,4),M+=i(k.uncompressedSize,4),M+=i(_.length,2),M+=i(y.length,2),{fileRecord:u.LOCAL_FILE_HEADER+M+_+y,dirRecord:u.CENTRAL_FILE_HEADER+i(P,2)+M+i(v.length,2)+"\0\0\0\0"+i(O,4)+i(n,4)+_+y+v}}var s=e("../utils"),o=e("../stream/GenericWorker"),a=e("../utf8"),c=e("../crc32"),u=e("../signature");function d(e,t,r,i){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(d,o),d.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,o.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-i-1))/r:100}}))},d.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=n(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=n(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:function(e){return u.DATA_DESCRIPTOR+i(e.crc32,4)+i(e.compressedSize,4)+i(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,n=function(e,t,r,n,o){var a=s.transformTo("string",o(n));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(e,2)+i(e,2)+i(t,4)+i(r,4)+i(a.length,2)+a}(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:n,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},d.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(e){var t=this._sources;if(!o.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(e){}return!0},d.prototype.lock=function(){o.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,r){var i=e("../compressions"),n=e("./ZipFileWorker");r.generateWorker=function(e,t,r){var s=new n(t.streamFiles,r,t.platform,t.encodeFileName),o=0;try{e.forEach((function(e,r){o++;var n=function(e,t){var r=e||t,n=i[r];if(!n)throw new Error(r+" is not a valid compression method !");return n}(r.options.compression,t.compression),a=r.options.compressionOptions||t.compressionOptions||{},c=r.dir,u=r.date;r._compressWorker(n,a).withStreamInfo("file",{name:e,dir:c,date:u,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(s)})),s.entriesCount=o}catch(e){s.error(e)}return s}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,r){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new i;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.7.1",i.loadAsync=function(e,t){return(new i).loadAsync(e,t)},i.external=e("./external"),t.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,r){var i=e("./utils"),n=e("./external"),s=e("./utf8"),o=e("./zipEntries"),a=e("./stream/Crc32Probe"),c=e("./nodejsUtils");function u(e){return new n.Promise((function(t,r){var i=e.decompressed.getContentWorker().pipe(new a);i.on("error",(function(e){r(e)})).on("end",(function(){i.streamInfo.crc32!==e.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}t.exports=function(e,t){var r=this;return t=i.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),c.isNode&&c.isStream(e)?n.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var r=new o(t);return r.load(e),r})).then((function(e){var r=[n.Promise.resolve(e)],i=e.files;if(t.checkCRC32)for(var s=0;s<i.length;s++)r.push(u(i[s]));return n.Promise.all(r)})).then((function(e){for(var i=e.shift(),n=i.files,s=0;s<n.length;s++){var o=n[s];r.file(o.fileNameStr,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:t.createFolders})}return i.zipComment.length&&(r.comment=i.zipComment),r}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,r){var i=e("../utils"),n=e("../stream/GenericWorker");function s(e,t){n.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}i.inherits(s,n),s.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},s.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,r){var i=e("readable-stream").Readable;function n(e,t,r){i.call(this,t),this._helper=e;var n=this;e.on("data",(function(e,t){n.push(e)||n._helper.pause(),r&&r(t)})).on("error",(function(e){n.emit("error",e)})).on("end",(function(){n.push(null)}))}e("../utils").inherits(n,i),n.prototype._read=function(){this._helper.resume()},t.exports=n},{"../utils":32,"readable-stream":16}],14:[function(e,t,r){t.exports={isNode:!0,newBufferFrom:function(e,t){if(yh.from&&yh.from!==Uint8Array.from)return yh.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new yh(e,t)},allocBuffer:function(e){if(yh.alloc)return yh.alloc(e);var t=new yh(e);return t.fill(0),t},isBuffer:function(e){return af(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,r){function i(e,t,r){var i,n=s.getTypeOf(t),a=s.extend(r||{},c);a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),"string"==typeof a.unixPermissions&&(a.unixPermissions=parseInt(a.unixPermissions,8)),a.unixPermissions&&16384&a.unixPermissions&&(a.dir=!0),a.dosPermissions&&16&a.dosPermissions&&(a.dir=!0),a.dir&&(e=m(e)),a.createFolders&&(i=p(e))&&_.call(this,i,!0);var l="string"===n&&!1===a.binary&&!1===a.base64;r&&void 0!==r.binary||(a.binary=!l),(t instanceof u&&0===t.uncompressedSize||a.dir||!t||0===t.length)&&(a.base64=!1,a.binary=!0,t="",a.compression="STORE",n="string");var g=null;g=t instanceof u||t instanceof o?t:h.isNode&&h.isStream(t)?new f(e,t):s.prepareContent(e,t,a.binary,a.optimizedBinaryString,a.base64);var S=new d(e,g,a);this.files[e]=S}var n=e("./utf8"),s=e("./utils"),o=e("./stream/GenericWorker"),a=e("./stream/StreamHelper"),c=e("./defaults"),u=e("./compressedObject"),d=e("./zipObject"),l=e("./generate"),h=e("./nodejsUtils"),f=e("./nodejs/NodejsStreamInputAdapter"),p=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},m=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},_=function(e,t){return t=void 0!==t?t:c.createFolders,e=m(e),this.files[e]||i.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function g(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var S={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,i;for(t in this.files)i=this.files[t],(r=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(r,i)},filter:function(e){var t=[];return this.forEach((function(r,i){e(r,i)&&t.push(i)})),t},file:function(e,t,r){if(1!==arguments.length)return e=this.root+e,i.call(this,e,t,r),this;if(g(e)){var n=e;return this.filter((function(e,t){return!t.dir&&n.test(e)}))}var s=this.files[this.root+e];return s&&!s.dir?s:null},folder:function(e){if(!e)return this;if(g(e))return this.filter((function(t,r){return r.dir&&e.test(t)}));var t=this.root+e,r=_.call(this,t),i=this.clone();return i.root=r.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter((function(t,r){return r.name.slice(0,e.length)===e})),i=0;i<r.length;i++)delete this.files[r[i].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,r={};try{if((r=s.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");s.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var i=r.comment||this.comment||"";t=l.generateWorker(this,r,i)}catch(e){(t=new o("error")).error(e)}return new a(t,r.type||"string",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=S},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,r){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,r){var i=e("./DataReader");function n(e){i.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(n,i),n.prototype.byteAt=function(e){return this.data[this.zero+e]},n.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),n=e.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===t&&this.data[s+1]===r&&this.data[s+2]===i&&this.data[s+3]===n)return s-this.zero;return-1},n.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),n=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&r===s[1]&&i===s[2]&&n===s[3]},n.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./DataReader":18}],18:[function(e,t,r){var i=e("../utils");function n(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}n.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=n},{"../utils":32}],19:[function(e,t,r){var i=e("./Uint8ArrayReader");function n(e){i.call(this,e)}e("../utils").inherits(n,i),n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,r){var i=e("./DataReader");function n(e){i.call(this,e)}e("../utils").inherits(n,i),n.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},n.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},n.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./DataReader":18}],21:[function(e,t,r){var i=e("./ArrayReader");function n(e){i.call(this,e)}e("../utils").inherits(n,i),n.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,r){var i=e("../utils"),n=e("../support"),s=e("./ArrayReader"),o=e("./StringReader"),a=e("./NodeBufferReader"),c=e("./Uint8ArrayReader");t.exports=function(e){var t=i.getTypeOf(e);return i.checkSupport(t),"string"!==t||n.uint8array?"nodebuffer"===t?new a(e):n.uint8array?new c(i.transformTo("uint8array",e)):new s(i.transformTo("array",e)):new o(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,r){var i=e("./GenericWorker"),n=e("../utils");function s(e){i.call(this,"ConvertWorker to "+e),this.destType=e}n.inherits(s,i),s.prototype.processChunk=function(e){this.push({data:n.transformTo(this.destType,e.data),meta:e.meta})},t.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,r){var i=e("./GenericWorker"),n=e("../crc32");function s(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(s,i),s.prototype.processChunk=function(e){this.streamInfo.crc32=n(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,r){var i=e("../utils"),n=e("./GenericWorker");function s(e){n.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}i.inherits(s,n),s.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}n.prototype.processChunk.call(this,e)},t.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,r){var i=e("../utils"),n=e("./GenericWorker");function s(e){n.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=i.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}i.inherits(s,n),s.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,r){function i(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=i},{}],29:[function(e,t,r){var i=e("../utils"),n=e("./ConvertWorker"),s=e("./GenericWorker"),o=e("../base64"),a=e("../support"),c=e("../external"),u=null;if(a.nodestream)try{u=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function d(e,t){return new c.Promise((function(r,n){var s=[],a=e._internalType,c=e._outputType,u=e._mimeType;e.on("data",(function(e,r){s.push(e),t&&t(r)})).on("error",(function(e){s=[],n(e)})).on("end",(function(){try{var e=function(e,t,r){switch(e){case"blob":return i.newBlob(i.transformTo("arraybuffer",t),r);case"base64":return o.encode(t);default:return i.transformTo(e,t)}}(c,function(e,t){var r,i=0,n=null,s=0;for(r=0;r<t.length;r++)s+=t[r].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(n=new Uint8Array(s),r=0;r<t.length;r++)n.set(t[r],i),i+=t[r].length;return n;case"nodebuffer":return yh.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(a,s),u);r(e)}catch(e){n(e)}s=[]})).resume()}))}function l(e,t,r){var o=t;switch(t){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=t,this._mimeType=r,i.checkSupport(o),this._worker=e.pipe(new n(o)),e.lock()}catch(e){this._worker=new s("error"),this._worker.error(e)}}l.prototype={accumulate:function(e){return d(this,e)},on:function(e,t){var r=this;return"data"===e?this._worker.on(e,(function(e){t.call(r,e.data,e.meta)})):this._worker.on(e,(function(){i.delay(t,arguments,r)})),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=l},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer=!0,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=0===new Blob([i],{type:"application/zip"}).size}catch(e){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(i),r.blob=0===n.getBlob("application/zip").size}catch(e){r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch(e){r.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,r){for(var i=e("./utils"),n=e("./support"),s=e("./nodejsUtils"),o=e("./stream/GenericWorker"),a=new Array(256),c=0;c<256;c++)a[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function u(){o.call(this,"utf-8 decode"),this.leftOver=null}function d(){o.call(this,"utf-8 encode")}a[254]=a[254]=1,r.utf8encode=function(e){return n.nodebuffer?s.newBufferFrom(e,"utf-8"):function(e){var t,r,i,s,o,a=e.length,c=0;for(s=0;s<a;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(i-56320),s++),c+=r<128?1:r<2048?2:r<65536?3:4;for(t=n.uint8array?new Uint8Array(c):new Array(c),s=o=0;o<c;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(i-56320),s++),r<128?t[o++]=r:(r<2048?t[o++]=192|r>>>6:(r<65536?t[o++]=224|r>>>12:(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63),t[o++]=128|r>>>6&63),t[o++]=128|63&r);return t}(e)},r.utf8decode=function(e){return n.nodebuffer?i.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,r,n,s,o=e.length,c=new Array(2*o);for(t=r=0;t<o;)if((n=e[t++])<128)c[r++]=n;else if(4<(s=a[n]))c[r++]=65533,t+=s-1;else{for(n&=2===s?31:3===s?15:7;1<s&&t<o;)n=n<<6|63&e[t++],s--;1<s?c[r++]=65533:n<65536?c[r++]=n:(n-=65536,c[r++]=55296|n>>10&1023,c[r++]=56320|1023&n)}return c.length!==r&&(c.subarray?c=c.subarray(0,r):c.length=r),i.applyFromCharCode(c)}(e=i.transformTo(n.uint8array?"uint8array":"array",e))},i.inherits(u,o),u.prototype.processChunk=function(e){var t=i.transformTo(n.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(n.uint8array){var s=t;(t=new Uint8Array(s.length+this.leftOver.length)).set(this.leftOver,0),t.set(s,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var o=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+a[e[r]]>t?r:t}(t),c=t;o!==t.length&&(n.uint8array?(c=t.subarray(0,o),this.leftOver=t.subarray(o,t.length)):(c=t.slice(0,o),this.leftOver=t.slice(o,t.length))),this.push({data:r.utf8decode(c),meta:e.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=u,i.inherits(d,o),d.prototype.processChunk=function(e){this.push({data:r.utf8encode(e.data),meta:e.meta})},r.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,r){var i=e("./support"),n=e("./base64"),s=e("./nodejsUtils"),o=e("set-immediate-shim"),a=e("./external");function c(e){return e}function u(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}r.newBlob=function(t,i){r.checkSupport("blob");try{return new Blob([t],{type:i})}catch(e){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(t),n.getBlob(i)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(e,t,r){var i=[],n=0,s=e.length;if(s<=r)return String.fromCharCode.apply(null,e);for(;n<s;)"array"===t||"nodebuffer"===t?i.push(String.fromCharCode.apply(null,e.slice(n,Math.min(n+r,s)))):i.push(String.fromCharCode.apply(null,e.subarray(n,Math.min(n+r,s)))),n+=r;return i.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,s.allocBuffer(1)).length}catch(e){return!1}}()}};function l(e){var t=65536,i=r.getTypeOf(e),n=!0;if("uint8array"===i?n=d.applyCanBeUsed.uint8array:"nodebuffer"===i&&(n=d.applyCanBeUsed.nodebuffer),n)for(;1<t;)try{return d.stringifyByChunk(e,i,t)}catch(e){t=Math.floor(t/2)}return d.stringifyByChar(e)}function h(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}r.applyFromCharCode=l;var f={};f.string={string:c,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return f.string.uint8array(e).buffer},uint8array:function(e){return u(e,new Uint8Array(e.length))},nodebuffer:function(e){return u(e,s.allocBuffer(e.length))}},f.array={string:l,array:c,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(e)}},f.arraybuffer={string:function(e){return l(new Uint8Array(e))},array:function(e){return h(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:c,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(new Uint8Array(e))}},f.uint8array={string:l,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:c,nodebuffer:function(e){return s.newBufferFrom(e)}},f.nodebuffer={string:l,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return f.nodebuffer.uint8array(e).buffer},uint8array:function(e){return h(e,new Uint8Array(e.length))},nodebuffer:c},r.transformTo=function(e,t){if(t=t||"",!e)return t;r.checkSupport(e);var i=r.getTypeOf(t);return f[i][e](t)},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":i.nodebuffer&&s.isBuffer(e)?"nodebuffer":i.uint8array&&e instanceof Uint8Array?"uint8array":i.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){if(!i[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){var t,r,i="";for(r=0;r<(e||"").length;r++)i+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return i},r.delay=function(e,t,r){o((function(){e.apply(r||null,t||[])}))},r.inherits=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},r.extend=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},r.prepareContent=function(e,t,s,o,c){return a.Promise.resolve(t).then((function(e){return i.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new a.Promise((function(t,r){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(e){r(e.target.error)},i.readAsArrayBuffer(e)})):e})).then((function(t){var d=r.getTypeOf(t);return d?("arraybuffer"===d?t=r.transformTo("uint8array",t):"string"===d&&(c?t=n.decode(t):s&&!0!==o&&(t=function(e){return u(e,i.uint8array?new Uint8Array(e.length):new Array(e.length))}(t))),t):a.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(e,t,r){var i=e("./reader/readerFor"),n=e("./utils"),s=e("./signature"),o=e("./zipEntry"),a=(e("./utf8"),e("./support"));function c(e){this.files=[],this.loadOptions=e}c.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+n.pretty(t)+", expected "+n.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4)===t;return this.reader.setIndex(r),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=a.uint8array?"uint8array":"array",r=n.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,i=this.zip64EndOfCentralSize-44;0<i;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(e=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var i=t-r;if(0<i)this.isSignature(t,s.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(e){this.reader=i(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,r){var i=e("./reader/readerFor"),n=e("./utils"),s=e("./compressedObject"),o=e("./crc32"),a=e("./utf8"),c=e("./compressions"),u=e("./support");function d(e,t){this.options=e,this.loadOptions=t}d.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in c)if(c.hasOwnProperty(t)&&c[t].magic===e)return c[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=i(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,r,i,n=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<n;)t=e.readInt(2),r=e.readInt(2),i=e.readData(r),this.extraFields[t]={id:t,length:r,value:i};e.setIndex(n)},handleUTF8:function(){var e=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var r=n.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var s=n.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=i(e.value);return 1!==t.readInt(1)||o(this.fileName)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=i(e.value);return 1!==t.readInt(1)||o(this.fileComment)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null}},t.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,r){function i(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var n=e("./stream/StreamHelper"),s=e("./stream/DataWorker"),o=e("./utf8"),a=e("./compressedObject"),c=e("./stream/GenericWorker");i.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");var i="string"===(r=e.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),t=this._decompressWorker();var s=!this._dataBinary;s&&!i&&(t=t.pipe(new o.Utf8EncodeWorker)),!s&&i&&(t=t.pipe(new o.Utf8DecodeWorker))}catch(e){(t=new c("error")).error(e)}return new n(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof a&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof c?this._data:new s(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<u.length;l++)i.prototype[u[l]]=d;t.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,r,i){(function(e){var t,i,n=e.MutationObserver||e.WebKitMutationObserver;if(n){var s=0,o=new n(d),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),t=function(){a.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var c=new e.MessageChannel;c.port1.onmessage=d,t=function(){c.port2.postMessage(0)}}var u=[];function d(){var e,t;i=!0;for(var r=u.length;r;){for(t=u,u=[],e=-1;++e<r;)t[e]();r=u.length}i=!1}r.exports=function(e){1!==u.push(e)||i||t()}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,r){var i=e("immediate");function n(){}var s={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==n&&f(this,e)}function d(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function l(e,t,r){i((function(){var i;try{i=t(r)}catch(i){return s.reject(e,i)}i===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,i)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var r=!1;function i(t){r||(r=!0,s.reject(e,t))}function n(t){r||(r=!0,s.resolve(e,t))}var o=p((function(){t(n,i)}));"error"===o.status&&i(o.value)}function p(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}(t.exports=u).prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){throw r}))}))},u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var r=new this.constructor(n);return this.state!==c?l(r,this.state===a?e:t,this.outcome):this.queue.push(new d(r,e,t)),r},d.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){l(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){s.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){l(this.promise,this.onRejected,e)},s.resolve=function(e,t){var r=p(h,t);if("error"===r.status)return s.reject(e,r.value);var i=r.value;if(i)f(e,i);else{e.state=a,e.outcome=t;for(var n=-1,o=e.queue.length;++n<o;)e.queue[n].callFulfilled(t)}return e},s.reject=function(e,t){e.state=o,e.outcome=t;for(var r=-1,i=e.queue.length;++r<i;)e.queue[r].callRejected(t);return e},u.resolve=function(e){return e instanceof this?e:s.resolve(new this(n),e)},u.reject=function(e){var t=new this(n);return s.reject(t,e)},u.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=new Array(r),a=0,c=-1,u=new this(n);++c<r;)d(e[c],c);return u;function d(e,n){t.resolve(e).then((function(e){o[n]=e,++a!==r||i||(i=!0,s.resolve(u,o))}),(function(e){i||(i=!0,s.reject(u,e))}))}},u.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o,a=-1,c=new this(n);++a<r;)o=e[a],t.resolve(o).then((function(e){i||(i=!0,s.resolve(c,e))}),(function(e){i||(i=!0,s.reject(c,e))}));return c}},{immediate:36}],38:[function(e,t,r){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,r){var i=e("./zlib/deflate"),n=e("./utils/common"),s=e("./utils/strings"),o=e("./zlib/messages"),a=e("./zlib/zstream"),c=Object.prototype.toString,u=0,d=-1,l=0,h=8;function f(e){if(!(this instanceof f))return new f(e);this.options=n.assign({level:d,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:l,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var r=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==u)throw new Error(o[r]);if(t.header&&i.deflateSetHeader(this.strm,t.header),t.dictionary){var p;if(p="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=i.deflateSetDictionary(this.strm,p))!==u)throw new Error(o[r]);this._dict_set=!0}}function p(e,t){var r=new f(t);if(r.push(e,!0),r.err)throw r.msg||o[r.err];return r.result}f.prototype.push=function(e,t){var r,o,a=this.strm,d=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?a.input=s.string2buf(e):"[object ArrayBuffer]"===c.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new n.Buf8(d),a.next_out=0,a.avail_out=d),1!==(r=i.deflate(a,o))&&r!==u)return this.onEnd(r),!(this.ended=!0);0!==a.avail_out&&(0!==a.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(s.buf2binstring(n.shrinkBuf(a.output,a.next_out))):this.onData(n.shrinkBuf(a.output,a.next_out)))}while((0<a.avail_in||0===a.avail_out)&&1!==r);return 4===o?(r=i.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===u):2!==o||(this.onEnd(u),!(a.avail_out=0))},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===u&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=f,r.deflate=p,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,p(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,r){var i=e("./zlib/inflate"),n=e("./utils/common"),s=e("./utils/strings"),o=e("./zlib/constants"),a=e("./zlib/messages"),c=e("./zlib/zstream"),u=e("./zlib/gzheader"),d=Object.prototype.toString;function l(e){if(!(this instanceof l))return new l(e);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var r=i.inflateInit2(this.strm,t.windowBits);if(r!==o.Z_OK)throw new Error(a[r]);this.header=new u,i.inflateGetHeader(this.strm,this.header)}function h(e,t){var r=new l(t);if(r.push(e,!0),r.err)throw r.msg||a[r.err];return r.result}l.prototype.push=function(e,t){var r,a,c,u,l,h,f=this.strm,p=this.options.chunkSize,m=this.options.dictionary,_=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?f.input=s.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?f.input=new Uint8Array(e):f.input=e,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new n.Buf8(p),f.next_out=0,f.avail_out=p),(r=i.inflate(f,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&m&&(h="string"==typeof m?s.string2buf(m):"[object ArrayBuffer]"===d.call(m)?new Uint8Array(m):m,r=i.inflateSetDictionary(this.strm,h)),r===o.Z_BUF_ERROR&&!0===_&&(r=o.Z_OK,_=!1),r!==o.Z_STREAM_END&&r!==o.Z_OK)return this.onEnd(r),!(this.ended=!0);f.next_out&&(0!==f.avail_out&&r!==o.Z_STREAM_END&&(0!==f.avail_in||a!==o.Z_FINISH&&a!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(c=s.utf8border(f.output,f.next_out),u=f.next_out-c,l=s.buf2string(f.output,c),f.next_out=u,f.avail_out=p-u,u&&n.arraySet(f.output,f.output,c,u,0),this.onData(l)):this.onData(n.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(_=!0)}while((0<f.avail_in||0===f.avail_out)&&r!==o.Z_STREAM_END);return r===o.Z_STREAM_END&&(a=o.Z_FINISH),a===o.Z_FINISH?(r=i.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===o.Z_OK):a!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(f.avail_out=0))},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=l,r.inflate=h,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},r.ungzip=h},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,r){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,r,i,n){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+i),n);else for(var s=0;s<i;s++)e[n+s]=t[r+s]},flattenChunks:function(e){var t,r,i,n,s,o;for(t=i=0,r=e.length;t<r;t++)i+=e[t].length;for(o=new Uint8Array(i),t=n=0,r=e.length;t<r;t++)s=e[t],o.set(s,n),n+=s.length;return o}},s={arraySet:function(e,t,r,i,n){for(var s=0;s<i;s++)e[n+s]=t[r+s]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,n)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(i)},{}],42:[function(e,t,r){var i=e("./common"),n=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var o=new i.Buf8(256),a=0;a<256;a++)o[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function c(e,t){if(t<65537&&(e.subarray&&s||!e.subarray&&n))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var r="",o=0;o<t;o++)r+=String.fromCharCode(e[o]);return r}o[254]=o[254]=1,r.string2buf=function(e){var t,r,n,s,o,a=e.length,c=0;for(s=0;s<a;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(n=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(n-56320),s++),c+=r<128?1:r<2048?2:r<65536?3:4;for(t=new i.Buf8(c),s=o=0;o<c;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(n=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(n-56320),s++),r<128?t[o++]=r:(r<2048?t[o++]=192|r>>>6:(r<65536?t[o++]=224|r>>>12:(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63),t[o++]=128|r>>>6&63),t[o++]=128|63&r);return t},r.buf2binstring=function(e){return c(e,e.length)},r.binstring2buf=function(e){for(var t=new i.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,i,n,s,a=t||e.length,u=new Array(2*a);for(r=i=0;r<a;)if((n=e[r++])<128)u[i++]=n;else if(4<(s=o[n]))u[i++]=65533,r+=s-1;else{for(n&=2===s?31:3===s?15:7;1<s&&r<a;)n=n<<6|63&e[r++],s--;1<s?u[i++]=65533:n<65536?u[i++]=n:(n-=65536,u[i++]=55296|n>>10&1023,u[i++]=56320|1023&n)}return c(u,i)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+o[e[r]]>t?r:t}},{"./common":41}],43:[function(e,t,r){t.exports=function(e,t,r,i){for(var n=65535&e|0,s=e>>>16&65535|0,o=0;0!==r;){for(r-=o=2e3<r?2e3:r;s=s+(n=n+t[i++]|0)|0,--o;);n%=65521,s%=65521}return n|s<<16|0}},{}],44:[function(e,t,r){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,r){var i=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,n){var s=i,o=n+r;e^=-1;for(var a=n;a<o;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}},{}],46:[function(e,t,r){var i,n=e("../utils/common"),s=e("./trees"),o=e("./adler32"),a=e("./crc32"),c=e("./messages"),u=0,d=4,l=0,h=-2,f=-1,p=4,m=2,_=8,g=9,S=286,v=30,R=19,T=2*S+1,I=15,y=3,E=258,b=E+y+1,C=42,A=113,k=1,w=2,O=3,P=4;function M(e,t){return e.msg=c[t],t}function D(e){return(e<<1)-(4<e?9:0)}function x(e){for(var t=e.length;0<=--t;)e[t]=0}function N(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(n.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function U(e,t){s._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,N(e.strm)}function L(e,t){e.pending_buf[e.pending++]=t}function V(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function B(e,t){var r,i,n=e.max_chain_length,s=e.strstart,o=e.prev_length,a=e.nice_match,c=e.strstart>e.w_size-b?e.strstart-(e.w_size-b):0,u=e.window,d=e.w_mask,l=e.prev,h=e.strstart+E,f=u[s+o-1],p=u[s+o];e.prev_length>=e.good_match&&(n>>=2),a>e.lookahead&&(a=e.lookahead);do{if(u[(r=t)+o]===p&&u[r+o-1]===f&&u[r]===u[s]&&u[++r]===u[s+1]){s+=2,r++;do{}while(u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&s<h);if(i=E-(h-s),s=h-E,o<i){if(e.match_start=t,a<=(o=i))break;f=u[s+o-1],p=u[s+o]}}}while((t=l[t&d])>c&&0!=--n);return o<=e.lookahead?o:e.lookahead}function Y(e){var t,r,i,s,c,u,d,l,h,f,p=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-b)){for(n.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=r=e.hash_size;i=e.head[--t],e.head[t]=p<=i?i-p:0,--r;);for(t=r=p;i=e.prev[--t],e.prev[t]=p<=i?i-p:0,--r;);s+=p}if(0===e.strm.avail_in)break;if(u=e.strm,d=e.window,l=e.strstart+e.lookahead,f=void 0,(h=s)<(f=u.avail_in)&&(f=h),r=0===f?0:(u.avail_in-=f,n.arraySet(d,u.input,u.next_in,f,l),1===u.state.wrap?u.adler=o(u.adler,d,f,l):2===u.state.wrap&&(u.adler=a(u.adler,d,f,l)),u.next_in+=f,u.total_in+=f,f),e.lookahead+=r,e.lookahead+e.insert>=y)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+y-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<y)););}while(e.lookahead<b&&0!==e.strm.avail_in)}function F(e,t){for(var r,i;;){if(e.lookahead<b){if(Y(e),e.lookahead<b&&t===u)return k;if(0===e.lookahead)break}if(r=0,e.lookahead>=y&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+y-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-b&&(e.match_length=B(e,r)),e.match_length>=y)if(i=s._tr_tally(e,e.strstart-e.match_start,e.match_length-y),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=y){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+y-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(U(e,!1),0===e.strm.avail_out))return k}return e.insert=e.strstart<y-1?e.strstart:y-1,t===d?(U(e,!0),0===e.strm.avail_out?O:P):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?k:w}function j(e,t){for(var r,i,n;;){if(e.lookahead<b){if(Y(e),e.lookahead<b&&t===u)return k;if(0===e.lookahead)break}if(r=0,e.lookahead>=y&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+y-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=y-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-b&&(e.match_length=B(e,r),e.match_length<=5&&(1===e.strategy||e.match_length===y&&4096<e.strstart-e.match_start)&&(e.match_length=y-1)),e.prev_length>=y&&e.match_length<=e.prev_length){for(n=e.strstart+e.lookahead-y,i=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-y),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+y-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=y-1,e.strstart++,i&&(U(e,!1),0===e.strm.avail_out))return k}else if(e.match_available){if((i=s._tr_tally(e,0,e.window[e.strstart-1]))&&U(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return k}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<y-1?e.strstart:y-1,t===d?(U(e,!0),0===e.strm.avail_out?O:P):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?k:w}function z(e,t,r,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=n}function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*T),this.dyn_dtree=new n.Buf16(2*(2*v+1)),this.bl_tree=new n.Buf16(2*(2*R+1)),x(this.dyn_ltree),x(this.dyn_dtree),x(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(I+1),this.heap=new n.Buf16(2*S+1),x(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*S+1),x(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function K(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=m,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?C:A,e.adler=2===t.wrap?0:1,t.last_flush=u,s._tr_init(t),l):M(e,h)}function W(e){var t=K(e);return t===l&&function(e){e.window_size=2*e.w_size,x(e.head),e.max_lazy_match=i[e.level].max_lazy,e.good_match=i[e.level].good_length,e.nice_match=i[e.level].nice_length,e.max_chain_length=i[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=y-1,e.match_available=0,e.ins_h=0}(e.state),t}function G(e,t,r,i,s,o){if(!e)return h;var a=1;if(t===f&&(t=6),i<0?(a=0,i=-i):15<i&&(a=2,i-=16),s<1||g<s||r!==_||i<8||15<i||t<0||9<t||o<0||p<o)return M(e,h);8===i&&(i=9);var c=new H;return(e.state=c).strm=e,c.wrap=a,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=s+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+y-1)/y),c.window=new n.Buf8(2*c.w_size),c.head=new n.Buf16(c.hash_size),c.prev=new n.Buf16(c.w_size),c.lit_bufsize=1<<s+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new n.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=o,c.method=r,W(e)}i=[new z(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Y(e),0===e.lookahead&&t===u)return k;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+r;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,U(e,!1),0===e.strm.avail_out))return k;if(e.strstart-e.block_start>=e.w_size-b&&(U(e,!1),0===e.strm.avail_out))return k}return e.insert=0,t===d?(U(e,!0),0===e.strm.avail_out?O:P):(e.strstart>e.block_start&&(U(e,!1),e.strm.avail_out),k)})),new z(4,4,8,4,F),new z(4,5,16,8,F),new z(4,6,32,32,F),new z(4,4,16,16,j),new z(8,16,32,32,j),new z(8,16,128,128,j),new z(8,32,128,256,j),new z(32,128,258,1024,j),new z(32,258,258,4096,j)],r.deflateInit=function(e,t){return G(e,t,_,15,8,0)},r.deflateInit2=G,r.deflateReset=W,r.deflateResetKeep=K,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?h:(e.state.gzhead=t,l):h},r.deflate=function(e,t){var r,n,o,c;if(!e||!e.state||5<t||t<0)return e?M(e,h):h;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||666===n.status&&t!==d)return M(e,0===e.avail_out?-5:h);if(n.strm=e,r=n.last_flush,n.last_flush=t,n.status===C)if(2===n.wrap)e.adler=0,L(n,31),L(n,139),L(n,8),n.gzhead?(L(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),L(n,255&n.gzhead.time),L(n,n.gzhead.time>>8&255),L(n,n.gzhead.time>>16&255),L(n,n.gzhead.time>>24&255),L(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),L(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(L(n,255&n.gzhead.extra.length),L(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=a(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(L(n,0),L(n,0),L(n,0),L(n,0),L(n,0),L(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),L(n,3),n.status=A);else{var f=_+(n.w_bits-8<<4)<<8;f|=(2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(f|=32),f+=31-f%31,n.status=A,V(n,f),0!==n.strstart&&(V(n,e.adler>>>16),V(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(o=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>o&&(e.adler=a(e.adler,n.pending_buf,n.pending-o,o)),N(e),o=n.pending,n.pending!==n.pending_buf_size));)L(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>o&&(e.adler=a(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){o=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>o&&(e.adler=a(e.adler,n.pending_buf,n.pending-o,o)),N(e),o=n.pending,n.pending===n.pending_buf_size)){c=1;break}c=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,L(n,c)}while(0!==c);n.gzhead.hcrc&&n.pending>o&&(e.adler=a(e.adler,n.pending_buf,n.pending-o,o)),0===c&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){o=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>o&&(e.adler=a(e.adler,n.pending_buf,n.pending-o,o)),N(e),o=n.pending,n.pending===n.pending_buf_size)){c=1;break}c=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,L(n,c)}while(0!==c);n.gzhead.hcrc&&n.pending>o&&(e.adler=a(e.adler,n.pending_buf,n.pending-o,o)),0===c&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&N(e),n.pending+2<=n.pending_buf_size&&(L(n,255&e.adler),L(n,e.adler>>8&255),e.adler=0,n.status=A)):n.status=A),0!==n.pending){if(N(e),0===e.avail_out)return n.last_flush=-1,l}else if(0===e.avail_in&&D(t)<=D(r)&&t!==d)return M(e,-5);if(666===n.status&&0!==e.avail_in)return M(e,-5);if(0!==e.avail_in||0!==n.lookahead||t!==u&&666!==n.status){var p=2===n.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(Y(e),0===e.lookahead)){if(t===u)return k;break}if(e.match_length=0,r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(U(e,!1),0===e.strm.avail_out))return k}return e.insert=0,t===d?(U(e,!0),0===e.strm.avail_out?O:P):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?k:w}(n,t):3===n.strategy?function(e,t){for(var r,i,n,o,a=e.window;;){if(e.lookahead<=E){if(Y(e),e.lookahead<=E&&t===u)return k;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=y&&0<e.strstart&&(i=a[n=e.strstart-1])===a[++n]&&i===a[++n]&&i===a[++n]){o=e.strstart+E;do{}while(i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&n<o);e.match_length=E-(o-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=y?(r=s._tr_tally(e,1,e.match_length-y),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(U(e,!1),0===e.strm.avail_out))return k}return e.insert=0,t===d?(U(e,!0),0===e.strm.avail_out?O:P):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?k:w}(n,t):i[n.level].func(n,t);if(p!==O&&p!==P||(n.status=666),p===k||p===O)return 0===e.avail_out&&(n.last_flush=-1),l;if(p===w&&(1===t?s._tr_align(n):5!==t&&(s._tr_stored_block(n,0,0,!1),3===t&&(x(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),N(e),0===e.avail_out))return n.last_flush=-1,l}return t!==d?l:n.wrap<=0?1:(2===n.wrap?(L(n,255&e.adler),L(n,e.adler>>8&255),L(n,e.adler>>16&255),L(n,e.adler>>24&255),L(n,255&e.total_in),L(n,e.total_in>>8&255),L(n,e.total_in>>16&255),L(n,e.total_in>>24&255)):(V(n,e.adler>>>16),V(n,65535&e.adler)),N(e),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?l:1)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==C&&69!==t&&73!==t&&91!==t&&103!==t&&t!==A&&666!==t?M(e,h):(e.state=null,t===A?M(e,-3):l):h},r.deflateSetDictionary=function(e,t){var r,i,s,a,c,u,d,f,p=t.length;if(!e||!e.state)return h;if(2===(a=(r=e.state).wrap)||1===a&&r.status!==C||r.lookahead)return h;for(1===a&&(e.adler=o(e.adler,t,p,0)),r.wrap=0,p>=r.w_size&&(0===a&&(x(r.head),r.strstart=0,r.block_start=0,r.insert=0),f=new n.Buf8(r.w_size),n.arraySet(f,t,p-r.w_size,r.w_size,0),t=f,p=r.w_size),c=e.avail_in,u=e.next_in,d=e.input,e.avail_in=p,e.next_in=0,e.input=t,Y(r);r.lookahead>=y;){for(i=r.strstart,s=r.lookahead-(y-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+y-1])&r.hash_mask,r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++,--s;);r.strstart=i,r.lookahead=y-1,Y(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=y-1,r.match_available=0,e.next_in=u,e.input=d,e.avail_in=c,r.wrap=a,l},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,r){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,r){t.exports=function(e,t){var r,i,n,s,o,a,c,u,d,l,h,f,p,m,_,g,S,v,R,T,I,y,E,b,C;r=e.state,i=e.next_in,b=e.input,n=i+(e.avail_in-5),s=e.next_out,C=e.output,o=s-(t-e.avail_out),a=s+(e.avail_out-257),c=r.dmax,u=r.wsize,d=r.whave,l=r.wnext,h=r.window,f=r.hold,p=r.bits,m=r.lencode,_=r.distcode,g=(1<<r.lenbits)-1,S=(1<<r.distbits)-1;e:do{p<15&&(f+=b[i++]<<p,p+=8,f+=b[i++]<<p,p+=8),v=m[f&g];t:for(;;){if(f>>>=R=v>>>24,p-=R,0==(R=v>>>16&255))C[s++]=65535&v;else{if(!(16&R)){if(0==(64&R)){v=m[(65535&v)+(f&(1<<R)-1)];continue t}if(32&R){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}T=65535&v,(R&=15)&&(p<R&&(f+=b[i++]<<p,p+=8),T+=f&(1<<R)-1,f>>>=R,p-=R),p<15&&(f+=b[i++]<<p,p+=8,f+=b[i++]<<p,p+=8),v=_[f&S];r:for(;;){if(f>>>=R=v>>>24,p-=R,!(16&(R=v>>>16&255))){if(0==(64&R)){v=_[(65535&v)+(f&(1<<R)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(I=65535&v,p<(R&=15)&&(f+=b[i++]<<p,(p+=8)<R&&(f+=b[i++]<<p,p+=8)),c<(I+=f&(1<<R)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=R,p-=R,(R=s-o)<I){if(d<(R=I-R)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(E=h,(y=0)===l){if(y+=u-R,R<T){for(T-=R;C[s++]=h[y++],--R;);y=s-I,E=C}}else if(l<R){if(y+=u+l-R,(R-=l)<T){for(T-=R;C[s++]=h[y++],--R;);if(y=0,l<T){for(T-=R=l;C[s++]=h[y++],--R;);y=s-I,E=C}}}else if(y+=l-R,R<T){for(T-=R;C[s++]=h[y++],--R;);y=s-I,E=C}for(;2<T;)C[s++]=E[y++],C[s++]=E[y++],C[s++]=E[y++],T-=3;T&&(C[s++]=E[y++],1<T&&(C[s++]=E[y++]))}else{for(y=s-I;C[s++]=C[y++],C[s++]=C[y++],C[s++]=C[y++],2<(T-=3););T&&(C[s++]=C[y++],1<T&&(C[s++]=C[y++]))}break}}break}}while(i<n&&s<a);i-=T=p>>3,f&=(1<<(p-=T<<3))-1,e.next_in=i,e.next_out=s,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=s<a?a-s+257:257-(s-a),r.hold=f,r.bits=p}},{}],49:[function(e,t,r){var i=e("../utils/common"),n=e("./adler32"),s=e("./crc32"),o=e("./inffast"),a=e("./inftrees"),c=1,u=2,d=0,l=-2,h=1,f=852,p=592;function m(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function g(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=h,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(f),t.distcode=t.distdyn=new i.Buf32(p),t.sane=1,t.back=-1,d):l}function S(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,g(e)):l}function v(e,t){var r,i;return e&&e.state?(i=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?l:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,S(e))):l}function R(e,t){var r,i;return e?(i=new _,(e.state=i).window=null,(r=v(e,t))!==d&&(e.state=null),r):l}var T,I,y=!0;function E(e){if(y){var t;for(T=new i.Buf32(512),I=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(a(c,e.lens,0,288,T,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;a(u,e.lens,0,32,I,0,e.work,{bits:5}),y=!1}e.lencode=T,e.lenbits=9,e.distcode=I,e.distbits=5}function b(e,t,r,n){var s,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new i.Buf8(o.wsize)),n>=o.wsize?(i.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(n<(s=o.wsize-o.wnext)&&(s=n),i.arraySet(o.window,t,r-n,s,o.wnext),(n-=s)?(i.arraySet(o.window,t,r-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}r.inflateReset=S,r.inflateReset2=v,r.inflateResetKeep=g,r.inflateInit=function(e){return R(e,15)},r.inflateInit2=R,r.inflate=function(e,t){var r,f,p,_,g,S,v,R,T,I,y,C,A,k,w,O,P,M,D,x,N,U,L,V,B=0,Y=new i.Buf8(4),F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return l;12===(r=e.state).mode&&(r.mode=13),g=e.next_out,p=e.output,v=e.avail_out,_=e.next_in,f=e.input,S=e.avail_in,R=r.hold,T=r.bits,I=S,y=v,U=d;e:for(;;)switch(r.mode){case h:if(0===r.wrap){r.mode=13;break}for(;T<16;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}if(2&r.wrap&&35615===R){Y[r.check=0]=255&R,Y[1]=R>>>8&255,r.check=s(r.check,Y,2,0),T=R=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&R)<<8)+(R>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&R)){e.msg="unknown compression method",r.mode=30;break}if(T-=4,N=8+(15&(R>>>=4)),0===r.wbits)r.wbits=N;else if(N>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<N,e.adler=r.check=1,r.mode=512&R?10:12,T=R=0;break;case 2:for(;T<16;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}if(r.flags=R,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=R>>8&1),512&r.flags&&(Y[0]=255&R,Y[1]=R>>>8&255,r.check=s(r.check,Y,2,0)),T=R=0,r.mode=3;case 3:for(;T<32;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}r.head&&(r.head.time=R),512&r.flags&&(Y[0]=255&R,Y[1]=R>>>8&255,Y[2]=R>>>16&255,Y[3]=R>>>24&255,r.check=s(r.check,Y,4,0)),T=R=0,r.mode=4;case 4:for(;T<16;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}r.head&&(r.head.xflags=255&R,r.head.os=R>>8),512&r.flags&&(Y[0]=255&R,Y[1]=R>>>8&255,r.check=s(r.check,Y,2,0)),T=R=0,r.mode=5;case 5:if(1024&r.flags){for(;T<16;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}r.length=R,r.head&&(r.head.extra_len=R),512&r.flags&&(Y[0]=255&R,Y[1]=R>>>8&255,r.check=s(r.check,Y,2,0)),T=R=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(S<(C=r.length)&&(C=S),C&&(r.head&&(N=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),i.arraySet(r.head.extra,f,_,C,N)),512&r.flags&&(r.check=s(r.check,f,C,_)),S-=C,_+=C,r.length-=C),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===S)break e;for(C=0;N=f[_+C++],r.head&&N&&r.length<65536&&(r.head.name+=String.fromCharCode(N)),N&&C<S;);if(512&r.flags&&(r.check=s(r.check,f,C,_)),S-=C,_+=C,N)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===S)break e;for(C=0;N=f[_+C++],r.head&&N&&r.length<65536&&(r.head.comment+=String.fromCharCode(N)),N&&C<S;);if(512&r.flags&&(r.check=s(r.check,f,C,_)),S-=C,_+=C,N)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;T<16;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}if(R!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}T=R=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;T<32;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}e.adler=r.check=m(R),T=R=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=g,e.avail_out=v,e.next_in=_,e.avail_in=S,r.hold=R,r.bits=T,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){R>>>=7&T,T-=7&T,r.mode=27;break}for(;T<3;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}switch(r.last=1&R,T-=1,3&(R>>>=1)){case 0:r.mode=14;break;case 1:if(E(r),r.mode=20,6!==t)break;R>>>=2,T-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}R>>>=2,T-=2;break;case 14:for(R>>>=7&T,T-=7&T;T<32;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}if((65535&R)!=(R>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&R,T=R=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(C=r.length){if(S<C&&(C=S),v<C&&(C=v),0===C)break e;i.arraySet(p,f,_,C,g),S-=C,_+=C,v-=C,g+=C,r.length-=C;break}r.mode=12;break;case 17:for(;T<14;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}if(r.nlen=257+(31&R),R>>>=5,T-=5,r.ndist=1+(31&R),R>>>=5,T-=5,r.ncode=4+(15&R),R>>>=4,T-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;T<3;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}r.lens[F[r.have++]]=7&R,R>>>=3,T-=3}for(;r.have<19;)r.lens[F[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,L={bits:r.lenbits},U=a(0,r.lens,0,19,r.lencode,0,r.work,L),r.lenbits=L.bits,U){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;O=(B=r.lencode[R&(1<<r.lenbits)-1])>>>16&255,P=65535&B,!((w=B>>>24)<=T);){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}if(P<16)R>>>=w,T-=w,r.lens[r.have++]=P;else{if(16===P){for(V=w+2;T<V;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}if(R>>>=w,T-=w,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}N=r.lens[r.have-1],C=3+(3&R),R>>>=2,T-=2}else if(17===P){for(V=w+3;T<V;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}T-=w,N=0,C=3+(7&(R>>>=w)),R>>>=3,T-=3}else{for(V=w+7;T<V;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}T-=w,N=0,C=11+(127&(R>>>=w)),R>>>=7,T-=7}if(r.have+C>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;C--;)r.lens[r.have++]=N}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,L={bits:r.lenbits},U=a(c,r.lens,0,r.nlen,r.lencode,0,r.work,L),r.lenbits=L.bits,U){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,L={bits:r.distbits},U=a(u,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,L),r.distbits=L.bits,U){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=S&&258<=v){e.next_out=g,e.avail_out=v,e.next_in=_,e.avail_in=S,r.hold=R,r.bits=T,o(e,y),g=e.next_out,p=e.output,v=e.avail_out,_=e.next_in,f=e.input,S=e.avail_in,R=r.hold,T=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;O=(B=r.lencode[R&(1<<r.lenbits)-1])>>>16&255,P=65535&B,!((w=B>>>24)<=T);){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}if(O&&0==(240&O)){for(M=w,D=O,x=P;O=(B=r.lencode[x+((R&(1<<M+D)-1)>>M)])>>>16&255,P=65535&B,!(M+(w=B>>>24)<=T);){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}R>>>=M,T-=M,r.back+=M}if(R>>>=w,T-=w,r.back+=w,r.length=P,0===O){r.mode=26;break}if(32&O){r.back=-1,r.mode=12;break}if(64&O){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&O,r.mode=22;case 22:if(r.extra){for(V=r.extra;T<V;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}r.length+=R&(1<<r.extra)-1,R>>>=r.extra,T-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;O=(B=r.distcode[R&(1<<r.distbits)-1])>>>16&255,P=65535&B,!((w=B>>>24)<=T);){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}if(0==(240&O)){for(M=w,D=O,x=P;O=(B=r.distcode[x+((R&(1<<M+D)-1)>>M)])>>>16&255,P=65535&B,!(M+(w=B>>>24)<=T);){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}R>>>=M,T-=M,r.back+=M}if(R>>>=w,T-=w,r.back+=w,64&O){e.msg="invalid distance code",r.mode=30;break}r.offset=P,r.extra=15&O,r.mode=24;case 24:if(r.extra){for(V=r.extra;T<V;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}r.offset+=R&(1<<r.extra)-1,R>>>=r.extra,T-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===v)break e;if(C=y-v,r.offset>C){if((C=r.offset-C)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}A=C>r.wnext?(C-=r.wnext,r.wsize-C):r.wnext-C,C>r.length&&(C=r.length),k=r.window}else k=p,A=g-r.offset,C=r.length;for(v<C&&(C=v),v-=C,r.length-=C;p[g++]=k[A++],--C;);0===r.length&&(r.mode=21);break;case 26:if(0===v)break e;p[g++]=r.length,v--,r.mode=21;break;case 27:if(r.wrap){for(;T<32;){if(0===S)break e;S--,R|=f[_++]<<T,T+=8}if(y-=v,e.total_out+=y,r.total+=y,y&&(e.adler=r.check=r.flags?s(r.check,p,y,g-y):n(r.check,p,y,g-y)),y=v,(r.flags?R:m(R))!==r.check){e.msg="incorrect data check",r.mode=30;break}T=R=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;T<32;){if(0===S)break e;S--,R+=f[_++]<<T,T+=8}if(R!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}T=R=0}r.mode=29;case 29:U=1;break e;case 30:U=-3;break e;case 31:return-4;default:return l}return e.next_out=g,e.avail_out=v,e.next_in=_,e.avail_in=S,r.hold=R,r.bits=T,(r.wsize||y!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&b(e,e.output,e.next_out,y-e.avail_out)?(r.mode=31,-4):(I-=e.avail_in,y-=e.avail_out,e.total_in+=I,e.total_out+=y,r.total+=y,r.wrap&&y&&(e.adler=r.check=r.flags?s(r.check,p,y,e.next_out-y):n(r.check,p,y,e.next_out-y)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==I&&0===y||4===t)&&U===d&&(U=-5),U)},r.inflateEnd=function(e){if(!e||!e.state)return l;var t=e.state;return t.window&&(t.window=null),e.state=null,d},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?l:((r.head=t).done=!1,d):l},r.inflateSetDictionary=function(e,t){var r,i=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?l:11===r.mode&&n(1,t,i,0)!==r.check?-3:b(e,t,i,i)?(r.mode=31,-4):(r.havedict=1,d):l},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,r){var i=e("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,c,u,d,l,h){var f,p,m,_,g,S,v,R,T,I=h.bits,y=0,E=0,b=0,C=0,A=0,k=0,w=0,O=0,P=0,M=0,D=null,x=0,N=new i.Buf16(16),U=new i.Buf16(16),L=null,V=0;for(y=0;y<=15;y++)N[y]=0;for(E=0;E<c;E++)N[t[r+E]]++;for(A=I,C=15;1<=C&&0===N[C];C--);if(C<A&&(A=C),0===C)return u[d++]=20971520,u[d++]=20971520,h.bits=1,0;for(b=1;b<C&&0===N[b];b++);for(A<b&&(A=b),y=O=1;y<=15;y++)if(O<<=1,(O-=N[y])<0)return-1;if(0<O&&(0===e||1!==C))return-1;for(U[1]=0,y=1;y<15;y++)U[y+1]=U[y]+N[y];for(E=0;E<c;E++)0!==t[r+E]&&(l[U[t[r+E]]++]=E);if(S=0===e?(D=L=l,19):1===e?(D=n,x-=257,L=s,V-=257,256):(D=o,L=a,-1),y=b,g=d,w=E=M=0,m=-1,_=(P=1<<(k=A))-1,1===e&&852<P||2===e&&592<P)return 1;for(;;){for(v=y-w,T=l[E]<S?(R=0,l[E]):l[E]>S?(R=L[V+l[E]],D[x+l[E]]):(R=96,0),f=1<<y-w,b=p=1<<k;u[g+(M>>w)+(p-=f)]=v<<24|R<<16|T|0,0!==p;);for(f=1<<y-1;M&f;)f>>=1;if(0!==f?(M&=f-1,M+=f):M=0,E++,0==--N[y]){if(y===C)break;y=t[r+l[E]]}if(A<y&&(M&_)!==m){for(0===w&&(w=A),g+=b,O=1<<(k=y-w);k+w<C&&!((O-=N[k+w])<=0);)k++,O<<=1;if(P+=1<<k,1===e&&852<P||2===e&&592<P)return 1;u[m=M&_]=A<<24|k<<16|g-d|0}}return 0!==M&&(u[g+M]=y-w<<24|64<<16|0),h.bits=A,0}},{"../utils/common":41}],51:[function(e,t,r){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,r){var i=e("../utils/common"),n=0,s=1;function o(e){for(var t=e.length;0<=--t;)e[t]=0}var a=0,c=29,u=256,d=u+1+c,l=30,h=19,f=2*d+1,p=15,m=16,_=7,g=256,S=16,v=17,R=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],I=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],b=new Array(2*(d+2));o(b);var C=new Array(2*l);o(C);var A=new Array(512);o(A);var k=new Array(256);o(k);var w=new Array(c);o(w);var O,P,M,D=new Array(l);function x(e,t,r,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}function N(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function U(e){return e<256?A[e]:A[256+(e>>>7)]}function L(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function V(e,t,r){e.bi_valid>m-r?(e.bi_buf|=t<<e.bi_valid&65535,L(e,e.bi_buf),e.bi_buf=t>>m-e.bi_valid,e.bi_valid+=r-m):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function B(e,t,r){V(e,r[2*t],r[2*t+1])}function Y(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function F(e,t,r){var i,n,s=new Array(p+1),o=0;for(i=1;i<=p;i++)s[i]=o=o+r[i-1]<<1;for(n=0;n<=t;n++){var a=e[2*n+1];0!==a&&(e[2*n]=Y(s[a]++,a))}}function j(e){var t;for(t=0;t<d;t++)e.dyn_ltree[2*t]=0;for(t=0;t<l;t++)e.dyn_dtree[2*t]=0;for(t=0;t<h;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*g]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function z(e){8<e.bi_valid?L(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function H(e,t,r,i){var n=2*t,s=2*r;return e[n]<e[s]||e[n]===e[s]&&i[t]<=i[r]}function K(e,t,r){for(var i=e.heap[r],n=r<<1;n<=e.heap_len&&(n<e.heap_len&&H(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!H(t,i,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=i}function W(e,t,r){var i,n,s,o,a=0;if(0!==e.last_lit)for(;i=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],n=e.pending_buf[e.l_buf+a],a++,0===i?B(e,n,t):(B(e,(s=k[n])+u+1,t),0!==(o=T[s])&&V(e,n-=w[s],o),B(e,s=U(--i),r),0!==(o=I[s])&&V(e,i-=D[s],o)),a<e.last_lit;);B(e,g,t)}function G(e,t){var r,i,n,s=t.dyn_tree,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=f,r=0;r<c;r++)0!==s[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):s[2*r+1]=0;for(;e.heap_len<2;)s[2*(n=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[n]=0,e.opt_len--,a&&(e.static_len-=o[2*n+1]);for(t.max_code=u,r=e.heap_len>>1;1<=r;r--)K(e,s,r);for(n=c;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],K(e,s,1),i=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=i,s[2*n]=s[2*r]+s[2*i],e.depth[n]=(e.depth[r]>=e.depth[i]?e.depth[r]:e.depth[i])+1,s[2*r+1]=s[2*i+1]=n,e.heap[1]=n++,K(e,s,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,i,n,s,o,a,c=t.dyn_tree,u=t.max_code,d=t.stat_desc.static_tree,l=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,m=t.stat_desc.extra_base,_=t.stat_desc.max_length,g=0;for(s=0;s<=p;s++)e.bl_count[s]=0;for(c[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<f;r++)_<(s=c[2*c[2*(i=e.heap[r])+1]+1]+1)&&(s=_,g++),c[2*i+1]=s,u<i||(e.bl_count[s]++,o=0,m<=i&&(o=h[i-m]),a=c[2*i],e.opt_len+=a*(s+o),l&&(e.static_len+=a*(d[2*i+1]+o)));if(0!==g){do{for(s=_-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[_]--,g-=2}while(0<g);for(s=_;0!==s;s--)for(i=e.bl_count[s];0!==i;)u<(n=e.heap[--r])||(c[2*n+1]!==s&&(e.opt_len+=(s-c[2*n+1])*c[2*n],c[2*n+1]=s),i--)}}(e,t),F(s,u,e.bl_count)}function J(e,t,r){var i,n,s=-1,o=t[1],a=0,c=7,u=4;for(0===o&&(c=138,u=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)n=o,o=t[2*(i+1)+1],++a<c&&n===o||(a<u?e.bl_tree[2*n]+=a:0!==n?(n!==s&&e.bl_tree[2*n]++,e.bl_tree[2*S]++):a<=10?e.bl_tree[2*v]++:e.bl_tree[2*R]++,s=n,u=(a=0)===o?(c=138,3):n===o?(c=6,3):(c=7,4))}function q(e,t,r){var i,n,s=-1,o=t[1],a=0,c=7,u=4;for(0===o&&(c=138,u=3),i=0;i<=r;i++)if(n=o,o=t[2*(i+1)+1],!(++a<c&&n===o)){if(a<u)for(;B(e,n,e.bl_tree),0!=--a;);else 0!==n?(n!==s&&(B(e,n,e.bl_tree),a--),B(e,S,e.bl_tree),V(e,a-3,2)):a<=10?(B(e,v,e.bl_tree),V(e,a-3,3)):(B(e,R,e.bl_tree),V(e,a-11,7));s=n,u=(a=0)===o?(c=138,3):n===o?(c=6,3):(c=7,4)}}o(D);var X=!1;function Q(e,t,r,n){V(e,(a<<1)+(n?1:0),3),function(e,t,r,n){z(e),n&&(L(e,r),L(e,~r)),i.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}r._tr_init=function(e){X||(function(){var e,t,r,i,n,s=new Array(p+1);for(i=r=0;i<c-1;i++)for(w[i]=r,e=0;e<1<<T[i];e++)k[r++]=i;for(k[r-1]=i,i=n=0;i<16;i++)for(D[i]=n,e=0;e<1<<I[i];e++)A[n++]=i;for(n>>=7;i<l;i++)for(D[i]=n<<7,e=0;e<1<<I[i]-7;e++)A[256+n++]=i;for(t=0;t<=p;t++)s[t]=0;for(e=0;e<=143;)b[2*e+1]=8,e++,s[8]++;for(;e<=255;)b[2*e+1]=9,e++,s[9]++;for(;e<=279;)b[2*e+1]=7,e++,s[7]++;for(;e<=287;)b[2*e+1]=8,e++,s[8]++;for(F(b,d+1,s),e=0;e<l;e++)C[2*e+1]=5,C[2*e]=Y(e,5);O=new x(b,T,u+1,d,p),P=new x(C,I,0,l,p),M=new x(new Array(0),y,0,h,_)}(),X=!0),e.l_desc=new N(e.dyn_ltree,O),e.d_desc=new N(e.dyn_dtree,P),e.bl_desc=new N(e.bl_tree,M),e.bi_buf=0,e.bi_valid=0,j(e)},r._tr_stored_block=Q,r._tr_flush_block=function(e,t,r,i){var o,a,c=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return n;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return s;for(t=32;t<u;t++)if(0!==e.dyn_ltree[2*t])return s;return n}(e)),G(e,e.l_desc),G(e,e.d_desc),c=function(e){var t;for(J(e,e.dyn_ltree,e.l_desc.max_code),J(e,e.dyn_dtree,e.d_desc.max_code),G(e,e.bl_desc),t=h-1;3<=t&&0===e.bl_tree[2*E[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),o=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=o&&(o=a)):o=a=r+5,r+4<=o&&-1!==t?Q(e,t,r,i):4===e.strategy||a===o?(V(e,2+(i?1:0),3),W(e,b,C)):(V(e,4+(i?1:0),3),function(e,t,r,i){var n;for(V(e,t-257,5),V(e,r-1,5),V(e,i-4,4),n=0;n<i;n++)V(e,e.bl_tree[2*E[n]+1],3);q(e,e.dyn_ltree,t-1),q(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,c+1),W(e,e.dyn_ltree,e.dyn_dtree)),j(e),i&&z(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(k[r]+u+1)]++,e.dyn_dtree[2*U(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){V(e,2,3),B(e,g,b),function(e){16===e.bi_valid?(L(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,r){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,r){t.exports="function"==typeof setImmediate?setImmediate:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}},{}]},{},[10])(10)}(uf);var df=uf.exports,lf="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,hf=tr,ff=cr,pf=function(e){if(void 0===e)return 0;var t=hf(e),r=ff(t);if(t!==r)throw RangeError("Wrong length or index");return r},mf=Math.abs,_f=Math.pow,gf=Math.floor,Sf=Math.log,vf=Math.LN2,Rf={pack:function(e,t,r){var i,n,s,o=new Array(r),a=8*r-t-1,c=(1<<a)-1,u=c>>1,d=23===t?_f(2,-24)-_f(2,-77):0,l=e<0||0===e&&1/e<0?1:0,h=0;for((e=mf(e))!=e||e===1/0?(n=e!=e?1:0,i=c):(i=gf(Sf(e)/vf),e*(s=_f(2,-i))<1&&(i--,s*=2),(e+=i+u>=1?d/s:d*_f(2,1-u))*s>=2&&(i++,s/=2),i+u>=c?(n=0,i=c):i+u>=1?(n=(e*s-1)*_f(2,t),i+=u):(n=e*_f(2,u-1)*_f(2,t),i=0));t>=8;o[h++]=255&n,n/=256,t-=8);for(i=i<<t|n,a+=t;a>0;o[h++]=255&i,i/=256,a-=8);return o[--h]|=128*l,o},unpack:function(e,t){var r,i=e.length,n=8*i-t-1,s=(1<<n)-1,o=s>>1,a=n-7,c=i-1,u=e[c--],d=127&u;for(u>>=7;a>0;d=256*d+e[c],c--,a-=8);for(r=d&(1<<-a)-1,d>>=-a,a+=t;a>0;r=256*r+e[c],c--,a-=8);if(0===d)d=1-o;else{if(d===s)return r?NaN:u?-1/0:1/0;r+=_f(2,t),d-=o}return(u?-1:1)*r*_f(2,d-t)}},Tf=ce,If=sr,yf=dr,Ef=n,bf=a,Cf=lf,Af=Ft,kf=it,wf=$r,Of=o,Pf=fi,Mf=tr,Df=cr,xf=pf,Nf=Rf,Uf=fa,Lf=ii,Vf=Zt.f,Bf=Ge.f,Yf=function(e){for(var t=Tf(this),r=yf(t),i=arguments.length,n=If(i>1?arguments[1]:void 0,r),s=i>2?arguments[2]:void 0,o=void 0===s?r:If(s,r);o>n;)t[n++]=e;return t},Ff=ai,jf=Af.PROPER,zf=Af.CONFIGURABLE,Hf=Nt.get,Kf=Nt.set,Wf="ArrayBuffer",Gf="DataView",Jf="Wrong index",qf=Ef.ArrayBuffer,Xf=qf,Qf=Ef.DataView,Zf=Qf&&Qf.prototype,$f=Object.prototype,ep=Ef.RangeError,tp=Nf.pack,rp=Nf.unpack,ip=function(e){return[255&e]},np=function(e){return[255&e,e>>8&255]},sp=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},op=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},ap=function(e){return tp(e,23,4)},cp=function(e){return tp(e,52,8)},up=function(e,t){Bf(e.prototype,t,{get:function(){return Hf(this)[t]}})},dp=function(e,t,r,i){var n=xf(r),s=Hf(e);if(n+t>s.byteLength)throw ep(Jf);var o=Hf(s.buffer).bytes,a=n+s.byteOffset,c=o.slice(a,a+t);return i?c:c.reverse()},lp=function(e,t,r,i,n,s){var o=xf(r),a=Hf(e);if(o+t>a.byteLength)throw ep(Jf);for(var c=Hf(a.buffer).bytes,u=o+a.byteOffset,d=i(+n),l=0;l<t;l++)c[u+l]=d[s?l:t-l-1]};if(Cf){var hp=jf&&qf.name!==Wf;if(Of((function(){qf(1)}))&&Of((function(){new qf(-1)}))&&!Of((function(){return new qf,new qf(1.5),new qf(NaN),hp&&!zf})))hp&&zf&&kf(qf,"name",Wf);else{for(var fp,pp=(Xf=function(e){return Pf(this,Xf),new qf(xf(e))}).prototype=qf.prototype,mp=Vf(qf),_p=0;mp.length>_p;)(fp=mp[_p++])in Xf||kf(Xf,fp,qf[fp]);pp.constructor=Xf}Lf&&Uf(Zf)!==$f&&Lf(Zf,$f);var gp=new Qf(new Xf(2)),Sp=Zf.setInt8;gp.setInt8(0,2147483648),gp.setInt8(1,2147483649),!gp.getInt8(0)&&gp.getInt8(1)||wf(Zf,{setInt8:function(e,t){Sp.call(this,e,t<<24>>24)},setUint8:function(e,t){Sp.call(this,e,t<<24>>24)}},{unsafe:!0})}else Xf=function(e){Pf(this,Xf,Wf);var t=xf(e);Kf(this,{bytes:Yf.call(new Array(t),0),byteLength:t}),bf||(this.byteLength=t)},Qf=function(e,t,r){Pf(this,Qf,Gf),Pf(e,Xf,Gf);var i=Hf(e).byteLength,n=Mf(t);if(n<0||n>i)throw ep("Wrong offset");if(n+(r=void 0===r?i-n:Df(r))>i)throw ep("Wrong length");Kf(this,{buffer:e,byteLength:r,byteOffset:n}),bf||(this.buffer=e,this.byteLength=r,this.byteOffset=n)},bf&&(up(Xf,"byteLength"),up(Qf,"buffer"),up(Qf,"byteLength"),up(Qf,"byteOffset")),wf(Qf.prototype,{getInt8:function(e){return dp(this,1,e)[0]<<24>>24},getUint8:function(e){return dp(this,1,e)[0]},getInt16:function(e){var t=dp(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=dp(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return op(dp(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return op(dp(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return rp(dp(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return rp(dp(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){lp(this,1,e,ip,t)},setUint8:function(e,t){lp(this,1,e,ip,t)},setInt16:function(e,t){lp(this,2,e,np,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){lp(this,2,e,np,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){lp(this,4,e,sp,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){lp(this,4,e,sp,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){lp(this,4,e,ap,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){lp(this,8,e,cp,t,arguments.length>2?arguments[2]:void 0)}});Ff(Xf,Wf),Ff(Qf,Gf);var vp={ArrayBuffer:Xf,DataView:Qf},Rp=Xr,Tp=o,Ip=qe,yp=sr,Ep=cr,bp=Tn,Cp=vp.ArrayBuffer,Ap=vp.DataView,kp=Cp.prototype.slice;Rp({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Tp((function(){return!new Cp(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(void 0!==kp&&void 0===t)return kp.call(Ip(this),e);for(var r=Ip(this).byteLength,i=yp(e,r),n=yp(void 0===t?r:t,r),s=new(bp(this,Cp))(Ep(n-i)),o=new Ap(this),a=new Ap(s),c=0;i<n;)a.setUint8(c++,o.getUint8(i++));return s}});var wp,Op,Pp,Mp={exports:{}},Dp=lf,xp=a,Np=n,Up=E,Lp=C,Vp=le,Bp=Ai,Yp=W,Fp=it,jp=nt.exports,zp=Ge.f,Hp=fa,Kp=ii,Wp=Ee,Gp=pe,Jp=Np.Int8Array,qp=Jp&&Jp.prototype,Xp=Np.Uint8ClampedArray,Qp=Xp&&Xp.prototype,Zp=Jp&&Hp(Jp),$p=qp&&Hp(qp),em=Object.prototype,tm=em.isPrototypeOf,rm=Wp("toStringTag"),im=Gp("TYPED_ARRAY_TAG"),nm=Gp("TYPED_ARRAY_CONSTRUCTOR"),sm=Dp&&!!Kp&&"Opera"!==Bp(Np.opera),om=!1,am={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},cm={BigInt64Array:8,BigUint64Array:8},um=function(e){if(!Lp(e))return!1;var t=Bp(e);return Vp(am,t)||Vp(cm,t)};for(wp in am)(Pp=(Op=Np[wp])&&Op.prototype)?Fp(Pp,nm,Op):sm=!1;for(wp in cm)(Pp=(Op=Np[wp])&&Op.prototype)&&Fp(Pp,nm,Op);if((!sm||!Up(Zp)||Zp===Function.prototype)&&(Zp=function(){throw TypeError("Incorrect invocation")},sm))for(wp in am)Np[wp]&&Kp(Np[wp],Zp);if((!sm||!$p||$p===em)&&($p=Zp.prototype,sm))for(wp in am)Np[wp]&&Kp(Np[wp].prototype,$p);if(sm&&Hp(Qp)!==$p&&Kp(Qp,$p),xp&&!Vp($p,rm))for(wp in om=!0,zp($p,rm,{get:function(){return Lp(this)?this[im]:void 0}}),am)Np[wp]&&Fp(Np[wp],im,wp);var dm={NATIVE_ARRAY_BUFFER_VIEWS:sm,TYPED_ARRAY_CONSTRUCTOR:nm,TYPED_ARRAY_TAG:om&&im,aTypedArray:function(e){if(um(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Up(e)&&(!Kp||tm.call(Zp,e)))return e;throw TypeError(Yp(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r){if(xp){if(r)for(var i in am){var n=Np[i];if(n&&Vp(n.prototype,e))try{delete n.prototype[e]}catch(tb){}}$p[e]&&!r||jp($p,e,r?t:sm&&qp[e]||t)}},exportTypedArrayStaticMethod:function(e,t,r){var i,n;if(xp){if(Kp){if(r)for(i in am)if((n=Np[i])&&Vp(n,e))try{delete n[e]}catch(tb){}if(Zp[e]&&!r)return;try{return jp(Zp,e,r?t:sm&&Zp[e]||t)}catch(tb){}}for(i in am)!(n=Np[i])||n[e]&&!r||jp(n,e,t)}},isView:function(e){if(!Lp(e))return!1;var t=Bp(e);return"DataView"===t||Vp(am,t)||Vp(cm,t)},isTypedArray:um,TypedArray:Zp,TypedArrayPrototype:$p},lm=n,hm=o,fm=rn,pm=dm.NATIVE_ARRAY_BUFFER_VIEWS,mm=lm.ArrayBuffer,_m=lm.Int8Array,gm=!pm||!hm((function(){_m(1)}))||!hm((function(){new _m(-1)}))||!fm((function(e){new _m,new _m(null),new _m(1.5),new _m(e)}),!0)||hm((function(){return 1!==new _m(new mm(2),1,void 0).length})),Sm=C,vm=Math.floor,Rm=Number.isInteger||function(e){return!Sm(e)&&isFinite(e)&&vm(e)===e},Tm=tr,Im=function(e){var t=Tm(e);if(t<0)throw RangeError("The argument can't be less than 0");return t},ym=function(e,t){var r=Im(e);if(r%t)throw RangeError("Wrong offset");return r},Em=gn,bm=ce,Cm=dr,Am=Ui,km=Mi,wm=Si,Om=Ri,Pm=dm.aTypedArrayConstructor,Mm=Xr,Dm=n,xm=a,Nm=gm,Um=dm,Lm=vp,Vm=fi,Bm=p,Ym=it,Fm=Rm,jm=cr,zm=pf,Hm=ym,Km=Me,Wm=le,Gm=Ai,Jm=C,qm=K,Xm=Zo,Qm=ii,Zm=Zt.f,$m=function(e){var t,r,i,n,s,o,a=Em(this),c=bm(e),u=arguments.length,d=u>1?arguments[1]:void 0,l=void 0!==d,h=km(c);if(h&&!wm(h))for(o=(s=Am(c,h)).next,c=[];!(n=o.call(s)).done;)c.push(n.value);for(l&&u>2&&(d=Om(d,arguments[2],2)),r=Cm(c),i=new(Pm(a))(r),t=0;r>t;t++)i[t]=l?d(c[t],t):c[t];return i},e_=ed.forEach,t_=hi,r_=Ge,i_=s,n_=Al,s_=Nt.get,o_=Nt.set,a_=r_.f,c_=i_.f,u_=Math.round,d_=Dm.RangeError,l_=Lm.ArrayBuffer,h_=Lm.DataView,f_=Um.NATIVE_ARRAY_BUFFER_VIEWS,p_=Um.TYPED_ARRAY_CONSTRUCTOR,m_=Um.TYPED_ARRAY_TAG,__=Um.TypedArray,g_=Um.TypedArrayPrototype,S_=Um.aTypedArrayConstructor,v_=Um.isTypedArray,R_="BYTES_PER_ELEMENT",T_="Wrong length",I_=function(e,t){for(var r=0,i=t.length,n=new(S_(e))(i);i>r;)n[r]=t[r++];return n},y_=function(e,t){a_(e,t,{get:function(){return s_(this)[t]}})},E_=function(e){var t;return e instanceof l_||"ArrayBuffer"==(t=Gm(e))||"SharedArrayBuffer"==t},b_=function(e,t){return v_(e)&&!qm(t)&&t in e&&Fm(+t)&&t>=0},C_=function(e,t){return t=Km(t),b_(e,t)?Bm(2,e[t]):c_(e,t)},A_=function(e,t,r){return t=Km(t),!(b_(e,t)&&Jm(r)&&Wm(r,"value"))||Wm(r,"get")||Wm(r,"set")||r.configurable||Wm(r,"writable")&&!r.writable||Wm(r,"enumerable")&&!r.enumerable?a_(e,t,r):(e[t]=r.value,e)};xm?(f_||(i_.f=C_,r_.f=A_,y_(g_,"buffer"),y_(g_,"byteOffset"),y_(g_,"byteLength"),y_(g_,"length")),Mm({target:"Object",stat:!0,forced:!f_},{getOwnPropertyDescriptor:C_,defineProperty:A_}),Mp.exports=function(e,t,r){var i=e.match(/\d+$/)[0]/8,n=e+(r?"Clamped":"")+"Array",s="get"+e,o="set"+e,a=Dm[n],c=a,u=c&&c.prototype,d={},l=function(e,t){a_(e,t,{get:function(){return function(e,t){var r=s_(e);return r.view[s](t*i+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var s=s_(e);r&&(n=(n=u_(n))<0?0:n>255?255:255&n),s.view[o](t*i+s.byteOffset,n,!0)}(this,t,e)},enumerable:!0})};f_?Nm&&(c=t((function(e,t,r,s){return Vm(e,c,n),n_(Jm(t)?E_(t)?void 0!==s?new a(t,Hm(r,i),s):void 0!==r?new a(t,Hm(r,i)):new a(t):v_(t)?I_(c,t):$m.call(c,t):new a(zm(t)),e,c)})),Qm&&Qm(c,__),e_(Zm(a),(function(e){e in c||Ym(c,e,a[e])})),c.prototype=u):(c=t((function(e,t,r,s){Vm(e,c,n);var o,a,u,d=0,h=0;if(Jm(t)){if(!E_(t))return v_(t)?I_(c,t):$m.call(c,t);o=t,h=Hm(r,i);var f=t.byteLength;if(void 0===s){if(f%i)throw d_(T_);if((a=f-h)<0)throw d_(T_)}else if((a=jm(s)*i)+h>f)throw d_(T_);u=a/i}else u=zm(t),o=new l_(a=u*i);for(o_(e,{buffer:o,byteOffset:h,byteLength:a,length:u,view:new h_(o)});d<u;)l(e,d++)})),Qm&&Qm(c,__),u=c.prototype=Xm(g_)),u.constructor!==c&&Ym(u,"constructor",c),Ym(u,p_,c),m_&&Ym(u,m_,n),d[n]=c,Mm({global:!0,forced:c!=a,sham:!f_},d),R_ in c||Ym(c,R_,i),R_ in u||Ym(u,R_,i),t_(n)}):Mp.exports=function(){},(0,Mp.exports)("Uint8",(function(e){return function(t,r,i){return e(this,t,r,i)}}));var k_=dr,w_=ym,O_=ce,P_=dm.aTypedArray;(0,dm.exportTypedArrayMethod)("set",(function(e){P_(this);var t=w_(arguments.length>1?arguments[1]:void 0,1),r=this.length,i=O_(e),n=k_(i),s=0;if(n+t>r)throw RangeError("Wrong length");for(;s<n;)this[t+s]=i[s++]}),o((function(){new Int8Array(1).set({})})));var M_=Math.floor,D_=function(e,t){var r=e.length,i=M_(r/2);return r<8?x_(e,t):N_(D_(e.slice(0,i),t),D_(e.slice(i),t),t)},x_=function(e,t){for(var r,i,n=e.length,s=1;s<n;){for(i=s,r=e[s];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==s++&&(e[i]=r)}return e},N_=function(e,t,r){for(var i=e.length,n=t.length,s=0,o=0,a=[];s<i||o<n;)s<i&&o<n?a.push(r(e[s],t[o])<=0?e[s++]:t[o++]):a.push(s<i?e[s++]:t[o++]);return a},U_=D_,L_=P.match(/firefox\/(\d+)/i),V_=!!L_&&+L_[1],B_=/MSIE|Trident/.test(P),Y_=P.match(/AppleWebKit\/(\d+)\./),F_=!!Y_&&+Y_[1],j_=o,z_=q,H_=dr,K_=U_,W_=V_,G_=B_,J_=V,q_=F_,X_=dm.aTypedArray,Q_=dm.exportTypedArrayMethod,Z_=n.Uint16Array,$_=Z_&&Z_.prototype.sort,eg=!!$_&&!j_((function(){var e=new Z_(2);e.sort(null),e.sort({})})),tg=!!$_&&!j_((function(){if(J_)return J_<74;if(W_)return W_<67;if(G_)return!0;if(q_)return q_<602;var e,t,r=new Z_(516),i=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,i[e]=e-2*t+3;for(r.sort((function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==i[e])return!0}));Q_("sort",(function(e){var t=this;if(void 0!==e&&z_(e),tg)return $_.call(t,e);X_(t);var r,i=H_(t),n=Array(i);for(r=0;r<i;r++)n[r]=t[r];for(n=K_(t,function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}}(e)),r=0;r<i;r++)t[r]=n[r];return t}),!tg||eg);var rg={exports:{}},ig={exports:{}};!function(e,r){var i;e.exports=(i=i||function(e,r){var i;if("undefined"!=typeof window&&window.crypto&&(i=window.crypto),"undefined"!=typeof self&&self.crypto&&(i=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(i=globalThis.crypto),!i&&"undefined"!=typeof window&&window.msCrypto&&(i=window.msCrypto),!i&&void 0!==t&&t.crypto&&(i=t.crypto),!i)try{i=require("crypto")}catch(_){}var n=function(){if(i){if("function"==typeof i.getRandomValues)try{return i.getRandomValues(new Uint32Array(1))[0]}catch(_){}if("function"==typeof i.randomBytes)try{return i.randomBytes(4).readInt32LE()}catch(_){}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),o={},a=o.lib={},c=a.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=a.WordArray=c.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=t!=r?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var s=0;s<n;s++){var o=r[s>>>2]>>>24-s%4*8&255;t[i+s>>>2]|=o<<24-(i+s)%4*8}else for(var a=0;a<n;a+=4)t[i+a>>>2]=r[a>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new u.init(t,e)}}),d=o.enc={},l=d.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var s=t[n>>>2]>>>24-n%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new u.init(r,t/2)}},h=d.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var s=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(s))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new u.init(r,t)}},f=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},p=a.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,i=this._data,n=i.words,s=i.sigBytes,o=this.blockSize,a=s/(4*o),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,d=e.min(4*c,s);if(c){for(var l=0;l<c;l+=o)this._doProcessBlock(n,l);r=n.splice(0,c),i.sigBytes-=d}return new u.init(r,d)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=p.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new m.HMAC.init(e,r).finalize(t)}}});var m=o.algo={};return o}(Math),i)}(ig);var ng={exports:{}};!function(e,t){var r,i,n,s,o,a,c;e.exports=(n=(i=c=ig.exports).lib,s=n.Base,o=n.WordArray,(a=i.x64={}).Word=s.extend({init:function(e,t){this.high=e,this.low=t}}),a.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=t!=r?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],i=0;i<t;i++){var n=e[i];r.push(n.high),r.push(n.low)}return o.create(r,this.sigBytes)},clone:function(){for(var e=s.clone.call(this),t=e.words=this.words.slice(0),r=t.length,i=0;i<r;i++)t[i]=t[i].clone();return e}}),c)}(ng);var sg={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,function(){if("function"==typeof ArrayBuffer){var e=r.lib.WordArray,t=e.init,i=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var r=e.byteLength,i=[],n=0;n<r;n++)i[n>>>2]|=e[n]<<24-n%4*8;t.call(this,i,r)}else t.apply(this,arguments)};i.prototype=e}}(),r.lib.WordArray)}(sg);var og={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,function(){var e=r,t=e.lib.WordArray,i=e.enc;function n(e){return e<<8&4278255360|e>>>8&16711935}i.Utf16=i.Utf16BE={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n+=2){var s=t[n>>>2]>>>16-n%4*8&65535;i.push(String.fromCharCode(s))}return i.join("")},parse:function(e){for(var r=e.length,i=[],n=0;n<r;n++)i[n>>>1]|=e.charCodeAt(n)<<16-n%2*16;return t.create(i,2*r)}},i.Utf16LE={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],s=0;s<r;s+=2){var o=n(t[s>>>2]>>>16-s%4*8&65535);i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var r=e.length,i=[],s=0;s<r;s++)i[s>>>1]|=n(e.charCodeAt(s)<<16-s%2*16);return t.create(i,2*r)}}}(),r.enc.Utf16)}(og);var ag={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,function(){var e=r,t=e.lib.WordArray;function i(e,r,i){for(var n=[],s=0,o=0;o<r;o++)if(o%4){var a=i[e.charCodeAt(o-1)]<<o%4*2|i[e.charCodeAt(o)]>>>6-o%4*2;n[s>>>2]|=a<<24-s%4*8,s++}return t.create(n,s)}e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,i=this._map;e.clamp();for(var n=[],s=0;s<r;s+=3)for(var o=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;a<4&&s+.75*a<r;a++)n.push(i.charAt(o>>>6*(3-a)&63));var c=i.charAt(64);if(c)for(;n.length%4;)n.push(c);return n.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var s=0;s<r.length;s++)n[r.charCodeAt(s)]=s}var o=r.charAt(64);if(o){var a=e.indexOf(o);-1!==a&&(t=a)}return i(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),r.enc.Base64)}(ag);var cg={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,function(){var e=r,t=e.lib.WordArray;function i(e,r,i){for(var n=[],s=0,o=0;o<r;o++)if(o%4){var a=i[e.charCodeAt(o-1)]<<o%4*2|i[e.charCodeAt(o)]>>>6-o%4*2;n[s>>>2]|=a<<24-s%4*8,s++}return t.create(n,s)}e.enc.Base64url={stringify:function(e,t=!0){var r=e.words,i=e.sigBytes,n=t?this._safe_map:this._map;e.clamp();for(var s=[],o=0;o<i;o+=3)for(var a=(r[o>>>2]>>>24-o%4*8&255)<<16|(r[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|r[o+2>>>2]>>>24-(o+2)%4*8&255,c=0;c<4&&o+.75*c<i;c++)s.push(n.charAt(a>>>6*(3-c)&63));var u=n.charAt(64);if(u)for(;s.length%4;)s.push(u);return s.join("")},parse:function(e,t=!0){var r=e.length,n=t?this._safe_map:this._map,s=this._reverseMap;if(!s){s=this._reverseMap=[];for(var o=0;o<n.length;o++)s[n.charCodeAt(o)]=o}var a=n.charAt(64);if(a){var c=e.indexOf(a);-1!==c&&(r=c)}return i(e,r,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),r.enc.Base64url)}(cg);var ug={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,function(e){var t=r,i=t.lib,n=i.WordArray,s=i.Hasher,o=t.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=o.MD5=s.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var i=t+r,n=e[i];e[i]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var s=this._hash.words,o=e[t+0],c=e[t+1],f=e[t+2],p=e[t+3],m=e[t+4],_=e[t+5],g=e[t+6],S=e[t+7],v=e[t+8],R=e[t+9],T=e[t+10],I=e[t+11],y=e[t+12],E=e[t+13],b=e[t+14],C=e[t+15],A=s[0],k=s[1],w=s[2],O=s[3];A=u(A,k,w,O,o,7,a[0]),O=u(O,A,k,w,c,12,a[1]),w=u(w,O,A,k,f,17,a[2]),k=u(k,w,O,A,p,22,a[3]),A=u(A,k,w,O,m,7,a[4]),O=u(O,A,k,w,_,12,a[5]),w=u(w,O,A,k,g,17,a[6]),k=u(k,w,O,A,S,22,a[7]),A=u(A,k,w,O,v,7,a[8]),O=u(O,A,k,w,R,12,a[9]),w=u(w,O,A,k,T,17,a[10]),k=u(k,w,O,A,I,22,a[11]),A=u(A,k,w,O,y,7,a[12]),O=u(O,A,k,w,E,12,a[13]),w=u(w,O,A,k,b,17,a[14]),A=d(A,k=u(k,w,O,A,C,22,a[15]),w,O,c,5,a[16]),O=d(O,A,k,w,g,9,a[17]),w=d(w,O,A,k,I,14,a[18]),k=d(k,w,O,A,o,20,a[19]),A=d(A,k,w,O,_,5,a[20]),O=d(O,A,k,w,T,9,a[21]),w=d(w,O,A,k,C,14,a[22]),k=d(k,w,O,A,m,20,a[23]),A=d(A,k,w,O,R,5,a[24]),O=d(O,A,k,w,b,9,a[25]),w=d(w,O,A,k,p,14,a[26]),k=d(k,w,O,A,v,20,a[27]),A=d(A,k,w,O,E,5,a[28]),O=d(O,A,k,w,f,9,a[29]),w=d(w,O,A,k,S,14,a[30]),A=l(A,k=d(k,w,O,A,y,20,a[31]),w,O,_,4,a[32]),O=l(O,A,k,w,v,11,a[33]),w=l(w,O,A,k,I,16,a[34]),k=l(k,w,O,A,b,23,a[35]),A=l(A,k,w,O,c,4,a[36]),O=l(O,A,k,w,m,11,a[37]),w=l(w,O,A,k,S,16,a[38]),k=l(k,w,O,A,T,23,a[39]),A=l(A,k,w,O,E,4,a[40]),O=l(O,A,k,w,o,11,a[41]),w=l(w,O,A,k,p,16,a[42]),k=l(k,w,O,A,g,23,a[43]),A=l(A,k,w,O,R,4,a[44]),O=l(O,A,k,w,y,11,a[45]),w=l(w,O,A,k,C,16,a[46]),A=h(A,k=l(k,w,O,A,f,23,a[47]),w,O,o,6,a[48]),O=h(O,A,k,w,S,10,a[49]),w=h(w,O,A,k,b,15,a[50]),k=h(k,w,O,A,_,21,a[51]),A=h(A,k,w,O,y,6,a[52]),O=h(O,A,k,w,p,10,a[53]),w=h(w,O,A,k,T,15,a[54]),k=h(k,w,O,A,c,21,a[55]),A=h(A,k,w,O,v,6,a[56]),O=h(O,A,k,w,C,10,a[57]),w=h(w,O,A,k,g,15,a[58]),k=h(k,w,O,A,E,21,a[59]),A=h(A,k,w,O,m,6,a[60]),O=h(O,A,k,w,I,10,a[61]),w=h(w,O,A,k,f,15,a[62]),k=h(k,w,O,A,R,21,a[63]),s[0]=s[0]+A|0,s[1]=s[1]+k|0,s[2]=s[2]+w|0,s[3]=s[3]+O|0},_doFinalize:function(){var t=this._data,r=t.words,i=8*this._nDataBytes,n=8*t.sigBytes;r[n>>>5]|=128<<24-n%32;var s=e.floor(i/4294967296),o=i;r[15+(n+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),r[14+(n+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t.sigBytes=4*(r.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var d=c[u];c[u]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return a},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,r,i,n,s,o){var a=e+(t&r|~t&i)+n+o;return(a<<s|a>>>32-s)+t}function d(e,t,r,i,n,s,o){var a=e+(t&i|r&~i)+n+o;return(a<<s|a>>>32-s)+t}function l(e,t,r,i,n,s,o){var a=e+(t^r^i)+n+o;return(a<<s|a>>>32-s)+t}function h(e,t,r,i,n,s,o){var a=e+(r^(t|~i))+n+o;return(a<<s|a>>>32-s)+t}t.MD5=s._createHelper(c),t.HmacMD5=s._createHmacHelper(c)}(Math),r.MD5)}(ug);var dg={exports:{}};!function(e,t){var r,i,n,s,o,a,c,u;e.exports=(i=(r=u=ig.exports).lib,n=i.WordArray,s=i.Hasher,o=r.algo,a=[],c=o.SHA1=s.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,i=r[0],n=r[1],s=r[2],o=r[3],c=r[4],u=0;u<80;u++){if(u<16)a[u]=0|e[t+u];else{var d=a[u-3]^a[u-8]^a[u-14]^a[u-16];a[u]=d<<1|d>>>31}var l=(i<<5|i>>>27)+c+a[u];l+=u<20?1518500249+(n&s|~n&o):u<40?1859775393+(n^s^o):u<60?(n&s|n&o|s&o)-1894007588:(n^s^o)-899497514,c=o,o=s,s=n<<30|n>>>2,n=i,i=l}r[0]=r[0]+i|0,r[1]=r[1]+n|0,r[2]=r[2]+s|0,r[3]=r[3]+o|0,r[4]=r[4]+c|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(i+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),r.SHA1=s._createHelper(c),r.HmacSHA1=s._createHmacHelper(c),u.SHA1)}(dg);var lg={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,function(e){var t=r,i=t.lib,n=i.WordArray,s=i.Hasher,o=t.algo,a=[],c=[];!function(){function t(t){for(var r=e.sqrt(t),i=2;i<=r;i++)if(!(t%i))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var i=2,n=0;n<64;)t(i)&&(n<8&&(a[n]=r(e.pow(i,.5))),c[n]=r(e.pow(i,1/3)),n++),i++}();var u=[],d=o.SHA256=s.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,i=r[0],n=r[1],s=r[2],o=r[3],a=r[4],d=r[5],l=r[6],h=r[7],f=0;f<64;f++){if(f<16)u[f]=0|e[t+f];else{var p=u[f-15],m=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,_=u[f-2],g=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;u[f]=m+u[f-7]+g+u[f-16]}var S=i&n^i&s^n&s,v=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),R=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&d^~a&l)+c[f]+u[f];h=l,l=d,d=a,a=o+R|0,o=s,s=n,n=i,i=R+(v+S)|0}r[0]=r[0]+i|0,r[1]=r[1]+n|0,r[2]=r[2]+s|0,r[3]=r[3]+o|0,r[4]=r[4]+a|0,r[5]=r[5]+d|0,r[6]=r[6]+l|0,r[7]=r[7]+h|0},_doFinalize:function(){var t=this._data,r=t.words,i=8*this._nDataBytes,n=8*t.sigBytes;return r[n>>>5]|=128<<24-n%32,r[14+(n+64>>>9<<4)]=e.floor(i/4294967296),r[15+(n+64>>>9<<4)]=i,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=s._createHelper(d),t.HmacSHA256=s._createHmacHelper(d)}(Math),r.SHA256)}(lg);var hg={exports:{}};!function(e,t){var r,i,n,s,o,a;e.exports=(i=(r=a=ig.exports).lib.WordArray,n=r.algo,s=n.SHA256,o=n.SHA224=s.extend({_doReset:function(){this._hash=new i.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=s._doFinalize.call(this);return e.sigBytes-=4,e}}),r.SHA224=s._createHelper(o),r.HmacSHA224=s._createHmacHelper(o),a.SHA224)}(hg);var fg={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,function(){var e=r,t=e.lib.Hasher,i=e.x64,n=i.Word,s=i.WordArray,o=e.algo;function a(){return n.create.apply(n,arguments)}var c=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],u=[];!function(){for(var e=0;e<80;e++)u[e]=a()}();var d=o.SHA512=t.extend({_doReset:function(){this._hash=new s.init([new n.init(1779033703,4089235720),new n.init(3144134277,2227873595),new n.init(1013904242,4271175723),new n.init(2773480762,1595750129),new n.init(1359893119,2917565137),new n.init(2600822924,725511199),new n.init(528734635,4215389547),new n.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,i=r[0],n=r[1],s=r[2],o=r[3],a=r[4],d=r[5],l=r[6],h=r[7],f=i.high,p=i.low,m=n.high,_=n.low,g=s.high,S=s.low,v=o.high,R=o.low,T=a.high,I=a.low,y=d.high,E=d.low,b=l.high,C=l.low,A=h.high,k=h.low,w=f,O=p,P=m,M=_,D=g,x=S,N=v,U=R,L=T,V=I,B=y,Y=E,F=b,j=C,z=A,H=k,K=0;K<80;K++){var W,G,J=u[K];if(K<16)G=J.high=0|e[t+2*K],W=J.low=0|e[t+2*K+1];else{var q=u[K-15],X=q.high,Q=q.low,Z=(X>>>1|Q<<31)^(X>>>8|Q<<24)^X>>>7,$=(Q>>>1|X<<31)^(Q>>>8|X<<24)^(Q>>>7|X<<25),ee=u[K-2],te=ee.high,re=ee.low,ie=(te>>>19|re<<13)^(te<<3|re>>>29)^te>>>6,ne=(re>>>19|te<<13)^(re<<3|te>>>29)^(re>>>6|te<<26),se=u[K-7],oe=se.high,ae=se.low,ce=u[K-16],ue=ce.high,de=ce.low;G=(G=(G=Z+oe+((W=$+ae)>>>0<$>>>0?1:0))+ie+((W+=ne)>>>0<ne>>>0?1:0))+ue+((W+=de)>>>0<de>>>0?1:0),J.high=G,J.low=W}var le,he=L&B^~L&F,fe=V&Y^~V&j,pe=w&P^w&D^P&D,me=O&M^O&x^M&x,_e=(w>>>28|O<<4)^(w<<30|O>>>2)^(w<<25|O>>>7),ge=(O>>>28|w<<4)^(O<<30|w>>>2)^(O<<25|w>>>7),Se=(L>>>14|V<<18)^(L>>>18|V<<14)^(L<<23|V>>>9),ve=(V>>>14|L<<18)^(V>>>18|L<<14)^(V<<23|L>>>9),Re=c[K],Te=Re.high,Ie=Re.low,ye=z+Se+((le=H+ve)>>>0<H>>>0?1:0),Ee=ge+me;z=F,H=j,F=B,j=Y,B=L,Y=V,L=N+(ye=(ye=(ye=ye+he+((le+=fe)>>>0<fe>>>0?1:0))+Te+((le+=Ie)>>>0<Ie>>>0?1:0))+G+((le+=W)>>>0<W>>>0?1:0))+((V=U+le|0)>>>0<U>>>0?1:0)|0,N=D,U=x,D=P,x=M,P=w,M=O,w=ye+(_e+pe+(Ee>>>0<ge>>>0?1:0))+((O=le+Ee|0)>>>0<le>>>0?1:0)|0}p=i.low=p+O,i.high=f+w+(p>>>0<O>>>0?1:0),_=n.low=_+M,n.high=m+P+(_>>>0<M>>>0?1:0),S=s.low=S+x,s.high=g+D+(S>>>0<x>>>0?1:0),R=o.low=R+U,o.high=v+N+(R>>>0<U>>>0?1:0),I=a.low=I+V,a.high=T+L+(I>>>0<V>>>0?1:0),E=d.low=E+Y,d.high=y+B+(E>>>0<Y>>>0?1:0),C=l.low=C+j,l.high=b+F+(C>>>0<j>>>0?1:0),k=h.low=k+H,h.high=A+z+(k>>>0<H>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[30+(i+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(i+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(d),e.HmacSHA512=t._createHmacHelper(d)}(),r.SHA512)}(fg);var pg={exports:{}};!function(e,t){var r,i,n,s,o,a,c,u;e.exports=(i=(r=u=ig.exports).x64,n=i.Word,s=i.WordArray,o=r.algo,a=o.SHA512,c=o.SHA384=a.extend({_doReset:function(){this._hash=new s.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=16,e}}),r.SHA384=a._createHelper(c),r.HmacSHA384=a._createHmacHelper(c),u.SHA384)}(pg);var mg={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,function(e){var t=r,i=t.lib,n=i.WordArray,s=i.Hasher,o=t.x64.Word,a=t.algo,c=[],u=[],d=[];!function(){for(var e=1,t=0,r=0;r<24;r++){c[e+5*t]=(r+1)*(r+2)/2%64;var i=(2*e+3*t)%5;e=t%5,t=i}for(e=0;e<5;e++)for(t=0;t<5;t++)u[e+5*t]=t+(2*e+3*t)%5*5;for(var n=1,s=0;s<24;s++){for(var a=0,l=0,h=0;h<7;h++){if(1&n){var f=(1<<h)-1;f<32?l^=1<<f:a^=1<<f-32}128&n?n=n<<1^113:n<<=1}d[s]=o.create(a,l)}}();var l=[];!function(){for(var e=0;e<25;e++)l[e]=o.create()}();var h=a.SHA3=s.extend({cfg:s.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new o.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var r=this._state,i=this.blockSize/2,n=0;n<i;n++){var s=e[t+2*n],o=e[t+2*n+1];s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),(k=r[n]).high^=o,k.low^=s}for(var a=0;a<24;a++){for(var h=0;h<5;h++){for(var f=0,p=0,m=0;m<5;m++)f^=(k=r[h+5*m]).high,p^=k.low;var _=l[h];_.high=f,_.low=p}for(h=0;h<5;h++){var g=l[(h+4)%5],S=l[(h+1)%5],v=S.high,R=S.low;for(f=g.high^(v<<1|R>>>31),p=g.low^(R<<1|v>>>31),m=0;m<5;m++)(k=r[h+5*m]).high^=f,k.low^=p}for(var T=1;T<25;T++){var I=(k=r[T]).high,y=k.low,E=c[T];E<32?(f=I<<E|y>>>32-E,p=y<<E|I>>>32-E):(f=y<<E-32|I>>>64-E,p=I<<E-32|y>>>64-E);var b=l[u[T]];b.high=f,b.low=p}var C=l[0],A=r[0];for(C.high=A.high,C.low=A.low,h=0;h<5;h++)for(m=0;m<5;m++){var k=r[T=h+5*m],w=l[T],O=l[(h+1)%5+5*m],P=l[(h+2)%5+5*m];k.high=w.high^~O.high&P.high,k.low=w.low^~O.low&P.low}k=r[0];var M=d[a];k.high^=M.high,k.low^=M.low}},_doFinalize:function(){var t=this._data,r=t.words;this._nDataBytes;var i=8*t.sigBytes,s=32*this.blockSize;r[i>>>5]|=1<<24-i%32,r[(e.ceil((i+1)/s)*s>>>5)-1]|=128,t.sigBytes=4*r.length,this._process();for(var o=this._state,a=this.cfg.outputLength/8,c=a/8,u=[],d=0;d<c;d++){var l=o[d],h=l.high,f=l.low;h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),f=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),u.push(f),u.push(h)}return new n.init(u,a)},clone:function(){for(var e=s.clone.call(this),t=e._state=this._state.slice(0),r=0;r<25;r++)t[r]=t[r].clone();return e}});t.SHA3=s._createHelper(h),t.HmacSHA3=s._createHmacHelper(h)}(Math),r.SHA3)}(mg);var _g={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,
/** @preserve
		(c) 2012 by CÃ©dric Mesnil. All rights reserved.

		Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

		    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
		    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

		THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
		*/
function(e){var t=r,i=t.lib,n=i.WordArray,s=i.Hasher,o=t.algo,a=n.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=n.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),u=n.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),d=n.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),l=n.create([0,1518500249,1859775393,2400959708,2840853838]),h=n.create([1352829926,1548603684,1836072691,2053994217,0]),f=o.RIPEMD160=s.extend({_doReset:function(){this._hash=n.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var i=t+r,n=e[i];e[i]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var s,o,f,R,T,I,y,E,b,C,A,k=this._hash.words,w=l.words,O=h.words,P=a.words,M=c.words,D=u.words,x=d.words;for(I=s=k[0],y=o=k[1],E=f=k[2],b=R=k[3],C=T=k[4],r=0;r<80;r+=1)A=s+e[t+P[r]]|0,A+=r<16?p(o,f,R)+w[0]:r<32?m(o,f,R)+w[1]:r<48?_(o,f,R)+w[2]:r<64?g(o,f,R)+w[3]:S(o,f,R)+w[4],A=(A=v(A|=0,D[r]))+T|0,s=T,T=R,R=v(f,10),f=o,o=A,A=I+e[t+M[r]]|0,A+=r<16?S(y,E,b)+O[0]:r<32?g(y,E,b)+O[1]:r<48?_(y,E,b)+O[2]:r<64?m(y,E,b)+O[3]:p(y,E,b)+O[4],A=(A=v(A|=0,x[r]))+C|0,I=C,C=b,b=v(E,10),E=y,y=A;A=k[1]+f+b|0,k[1]=k[2]+R+C|0,k[2]=k[3]+T+I|0,k[3]=k[4]+s+y|0,k[4]=k[0]+o+E|0,k[0]=A},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,i=8*e.sigBytes;t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process();for(var n=this._hash,s=n.words,o=0;o<5;o++){var a=s[o];s[o]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return n},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function p(e,t,r){return e^t^r}function m(e,t,r){return e&t|~e&r}function _(e,t,r){return(e|~t)^r}function g(e,t,r){return e&r|t&~r}function S(e,t,r){return e^(t|~r)}function v(e,t){return e<<t|e>>>32-t}t.RIPEMD160=s._createHelper(f),t.HmacRIPEMD160=s._createHmacHelper(f)}(),r.RIPEMD160)}(_g);var gg={exports:{}};!function(e,t){var r,i,n;e.exports=(i=(r=ig.exports).lib.Base,n=r.enc.Utf8,void(r.algo.HMAC=i.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var r=e.blockSize,i=4*r;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),o=this._iKey=t.clone(),a=s.words,c=o.words,u=0;u<r;u++)a[u]^=1549556828,c[u]^=909522486;s.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))}(gg);var Sg={exports:{}};!function(e,t){var r,i,n,s,o,a,c,u,d;e.exports=(i=(r=d=ig.exports).lib,n=i.Base,s=i.WordArray,o=r.algo,a=o.SHA1,c=o.HMAC,u=o.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:a,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,i=c.create(r.hasher,e),n=s.create(),o=s.create([1]),a=n.words,u=o.words,d=r.keySize,l=r.iterations;a.length<d;){var h=i.update(t).finalize(o);i.reset();for(var f=h.words,p=f.length,m=h,_=1;_<l;_++){m=i.finalize(m),i.reset();for(var g=m.words,S=0;S<p;S++)f[S]^=g[S]}n.concat(h),u[0]++}return n.sigBytes=4*d,n}}),r.PBKDF2=function(e,t,r){return u.create(r).compute(e,t)},d.PBKDF2)}(Sg);var vg={exports:{}};!function(e,t){var r,i,n,s,o,a,c,u;e.exports=(i=(r=u=ig.exports).lib,n=i.Base,s=i.WordArray,o=r.algo,a=o.MD5,c=o.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:a,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,i=this.cfg,n=i.hasher.create(),o=s.create(),a=o.words,c=i.keySize,u=i.iterations;a.length<c;){r&&n.update(r),r=n.update(e).finalize(t),n.reset();for(var d=1;d<u;d++)r=n.finalize(r),n.reset();o.concat(r)}return o.sigBytes=4*c,o}}),r.EvpKDF=function(e,t,r){return c.create(r).compute(e,t)},u.EvpKDF)}(vg);var Rg={exports:{}};!function(e,t){var r;e.exports=void((r=ig.exports).lib.Cipher||function(e){var t=r,i=t.lib,n=i.Base,s=i.WordArray,o=i.BufferedBlockAlgorithm,a=t.enc;a.Utf8;var c=a.Base64,u=t.algo.EvpKDF,d=i.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?v:g}return function(t){return{encrypt:function(r,i,n){return e(i).encrypt(t,r,i,n)},decrypt:function(r,i,n){return e(i).decrypt(t,r,i,n)}}}}()});i.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var l=t.mode={},h=i.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),f=l.CBC=function(){var t=h.extend();function r(t,r,i){var n,s=this._iv;s?(n=s,this._iv=e):n=this._prevBlock;for(var o=0;o<i;o++)t[r+o]^=n[o]}return t.Encryptor=t.extend({processBlock:function(e,t){var i=this._cipher,n=i.blockSize;r.call(this,e,t,n),i.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),t.Decryptor=t.extend({processBlock:function(e,t){var i=this._cipher,n=i.blockSize,s=e.slice(t,t+n);i.decryptBlock(e,t),r.call(this,e,t,n),this._prevBlock=s}}),t}(),p=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,i=r-e.sigBytes%r,n=i<<24|i<<16|i<<8|i,o=[],a=0;a<i;a+=4)o.push(n);var c=s.create(o,i);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};i.BlockCipher=d.extend({cfg:d.cfg.extend({mode:f,padding:p}),reset:function(){var e;d.reset.call(this);var t=this.cfg,r=t.iv,i=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=i.createEncryptor:(e=i.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(i,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var m=i.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),_=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?s.create([1398893684,1701076831]).concat(r).concat(t):t).toString(c)},parse:function(e){var t,r=c.parse(e),i=r.words;return 1398893684==i[0]&&1701076831==i[1]&&(t=s.create(i.slice(2,4)),i.splice(0,4),r.sigBytes-=16),m.create({ciphertext:r,salt:t})}},g=i.SerializableCipher=n.extend({cfg:n.extend({format:_}),encrypt:function(e,t,r,i){i=this.cfg.extend(i);var n=e.createEncryptor(r,i),s=n.finalize(t),o=n.cfg;return m.create({ciphertext:s,key:r,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,r,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(r,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),S=(t.kdf={}).OpenSSL={execute:function(e,t,r,i){i||(i=s.random(8));var n=u.create({keySize:t+r}).compute(e,i),o=s.create(n.words.slice(t),4*r);return n.sigBytes=4*t,m.create({key:n,iv:o,salt:i})}},v=i.PasswordBasedCipher=g.extend({cfg:g.cfg.extend({kdf:S}),encrypt:function(e,t,r,i){var n=(i=this.cfg.extend(i)).kdf.execute(r,e.keySize,e.ivSize);i.iv=n.iv;var s=g.encrypt.call(this,e,t,n.key,i);return s.mixIn(n),s},decrypt:function(e,t,r,i){i=this.cfg.extend(i),t=this._parse(t,i.format);var n=i.kdf.execute(r,e.keySize,e.ivSize,t.salt);return i.iv=n.iv,g.decrypt.call(this,e,t,n.key,i)}})}())}(Rg);var Tg={exports:{}};!function(e,t){var r;e.exports=((r=ig.exports).mode.CFB=function(){var e=r.lib.BlockCipherMode.extend();function t(e,t,r,i){var n,s=this._iv;s?(n=s.slice(0),this._iv=void 0):n=this._prevBlock,i.encryptBlock(n,0);for(var o=0;o<r;o++)e[t+o]^=n[o]}return e.Encryptor=e.extend({processBlock:function(e,r){var i=this._cipher,n=i.blockSize;t.call(this,e,r,n,i),this._prevBlock=e.slice(r,r+n)}}),e.Decryptor=e.extend({processBlock:function(e,r){var i=this._cipher,n=i.blockSize,s=e.slice(r,r+n);t.call(this,e,r,n,i),this._prevBlock=s}}),e}(),r.mode.CFB)}(Tg);var Ig={exports:{}};!function(e,t){var r,i,n;e.exports=((n=ig.exports).mode.CTR=(r=n.lib.BlockCipherMode.extend(),i=r.Encryptor=r.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize,n=this._iv,s=this._counter;n&&(s=this._counter=n.slice(0),this._iv=void 0);var o=s.slice(0);r.encryptBlock(o,0),s[i-1]=s[i-1]+1|0;for(var a=0;a<i;a++)e[t+a]^=o[a]}}),r.Decryptor=i,r),n.mode.CTR)}(Ig);var yg={exports:{}};!function(e,t){var r;e.exports=(
/** @preserve
		 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
		 * derived from CryptoJS.mode.CTR
		 * Jan Hruby jhruby.web@gmail.com
		 */
(r=ig.exports).mode.CTRGladman=function(){var e=r.lib.BlockCipherMode.extend();function t(e){if(255==(e>>24&255)){var t=e>>16&255,r=e>>8&255,i=255&e;255===t?(t=0,255===r?(r=0,255===i?i=0:++i):++r):++t,e=0,e+=t<<16,e+=r<<8,e+=i}else e+=1<<24;return e}function i(e){return 0===(e[0]=t(e[0]))&&(e[1]=t(e[1])),e}var n=e.Encryptor=e.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,s=this._iv,o=this._counter;s&&(o=this._counter=s.slice(0),this._iv=void 0),i(o);var a=o.slice(0);r.encryptBlock(a,0);for(var c=0;c<n;c++)e[t+c]^=a[c]}});return e.Decryptor=n,e}(),r.mode.CTRGladman)}(yg);var Eg={exports:{}};!function(e,t){var r,i,n;e.exports=((n=ig.exports).mode.OFB=(r=n.lib.BlockCipherMode.extend(),i=r.Encryptor=r.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize,n=this._iv,s=this._keystream;n&&(s=this._keystream=n.slice(0),this._iv=void 0),r.encryptBlock(s,0);for(var o=0;o<i;o++)e[t+o]^=s[o]}}),r.Decryptor=i,r),n.mode.OFB)}(Eg);var bg={exports:{}};!function(e,t){var r,i;e.exports=((i=ig.exports).mode.ECB=((r=i.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),r.Decryptor=r.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),r),i.mode.ECB)}(bg);var Cg={exports:{}};!function(e,t){var r;e.exports=((r=ig.exports).pad.AnsiX923={pad:function(e,t){var r=e.sigBytes,i=4*t,n=i-r%i,s=r+n-1;e.clamp(),e.words[s>>>2]|=n<<24-s%4*8,e.sigBytes+=n},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},r.pad.Ansix923)}(Cg);var Ag={exports:{}};!function(e,t){var r;e.exports=((r=ig.exports).pad.Iso10126={pad:function(e,t){var i=4*t,n=i-e.sigBytes%i;e.concat(r.lib.WordArray.random(n-1)).concat(r.lib.WordArray.create([n<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},r.pad.Iso10126)}(Ag);var kg={exports:{}};!function(e,t){var r;e.exports=((r=ig.exports).pad.Iso97971={pad:function(e,t){e.concat(r.lib.WordArray.create([2147483648],1)),r.pad.ZeroPadding.pad(e,t)},unpad:function(e){r.pad.ZeroPadding.unpad(e),e.sigBytes--}},r.pad.Iso97971)}(kg);var wg={exports:{}};!function(e,t){var r;e.exports=((r=ig.exports).pad.ZeroPadding={pad:function(e,t){var r=4*t;e.clamp(),e.sigBytes+=r-(e.sigBytes%r||r)},unpad:function(e){var t=e.words,r=e.sigBytes-1;for(r=e.sigBytes-1;r>=0;r--)if(t[r>>>2]>>>24-r%4*8&255){e.sigBytes=r+1;break}}},r.pad.ZeroPadding)}(wg);var Og={exports:{}};!function(e,t){var r;e.exports=((r=ig.exports).pad.NoPadding={pad:function(){},unpad:function(){}},r.pad.NoPadding)}(Og);var Pg={exports:{}};!function(e,t){var r,i,n,s;e.exports=(i=(r=s=ig.exports).lib.CipherParams,n=r.enc.Hex,r.format.Hex={stringify:function(e){return e.ciphertext.toString(n)},parse:function(e){var t=n.parse(e);return i.create({ciphertext:t})}},s.format.Hex)}(Pg);var Mg={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,function(){var e=r,t=e.lib.BlockCipher,i=e.algo,n=[],s=[],o=[],a=[],c=[],u=[],d=[],l=[],h=[],f=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,i=0;for(t=0;t<256;t++){var p=i^i<<1^i<<2^i<<3^i<<4;p=p>>>8^255&p^99,n[r]=p,s[p]=r;var m=e[r],_=e[m],g=e[_],S=257*e[p]^16843008*p;o[r]=S<<24|S>>>8,a[r]=S<<16|S>>>16,c[r]=S<<8|S>>>24,u[r]=S,S=16843009*g^65537*_^257*m^16843008*r,d[p]=S<<24|S>>>8,l[p]=S<<16|S>>>16,h[p]=S<<8|S>>>24,f[p]=S,r?(r=m^e[e[e[g^m]]],i^=e[e[i]]):r=i=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],m=i.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,i=4*((this._nRounds=r+6)+1),s=this._keySchedule=[],o=0;o<i;o++)o<r?s[o]=t[o]:(u=s[o-1],o%r?r>6&&o%r==4&&(u=n[u>>>24]<<24|n[u>>>16&255]<<16|n[u>>>8&255]<<8|n[255&u]):(u=n[(u=u<<8|u>>>24)>>>24]<<24|n[u>>>16&255]<<16|n[u>>>8&255]<<8|n[255&u],u^=p[o/r|0]<<24),s[o]=s[o-r]^u);for(var a=this._invKeySchedule=[],c=0;c<i;c++){if(o=i-c,c%4)var u=s[o];else u=s[o-4];a[c]=c<4||o<=4?u:d[n[u>>>24]]^l[n[u>>>16&255]]^h[n[u>>>8&255]]^f[n[255&u]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,a,c,u,n)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,d,l,h,f,s),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,i,n,s,o,a){for(var c=this._nRounds,u=e[t]^r[0],d=e[t+1]^r[1],l=e[t+2]^r[2],h=e[t+3]^r[3],f=4,p=1;p<c;p++){var m=i[u>>>24]^n[d>>>16&255]^s[l>>>8&255]^o[255&h]^r[f++],_=i[d>>>24]^n[l>>>16&255]^s[h>>>8&255]^o[255&u]^r[f++],g=i[l>>>24]^n[h>>>16&255]^s[u>>>8&255]^o[255&d]^r[f++],S=i[h>>>24]^n[u>>>16&255]^s[d>>>8&255]^o[255&l]^r[f++];u=m,d=_,l=g,h=S}m=(a[u>>>24]<<24|a[d>>>16&255]<<16|a[l>>>8&255]<<8|a[255&h])^r[f++],_=(a[d>>>24]<<24|a[l>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^r[f++],g=(a[l>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&d])^r[f++],S=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[d>>>8&255]<<8|a[255&l])^r[f++],e[t]=m,e[t+1]=_,e[t+2]=g,e[t+3]=S},keySize:8});e.AES=t._createHelper(m)}(),r.AES)}(Mg);var Dg={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,function(){var e=r,t=e.lib,i=t.WordArray,n=t.BlockCipher,s=e.algo,o=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],l=s.DES=n.extend({_doReset:function(){for(var e=this._key.words,t=[],r=0;r<56;r++){var i=o[r]-1;t[r]=e[i>>>5]>>>31-i%32&1}for(var n=this._subKeys=[],s=0;s<16;s++){var u=n[s]=[],d=c[s];for(r=0;r<24;r++)u[r/6|0]|=t[(a[r]-1+d)%28]<<31-r%6,u[4+(r/6|0)]|=t[28+(a[r+24]-1+d)%28]<<31-r%6;for(u[0]=u[0]<<1|u[0]>>>31,r=1;r<7;r++)u[r]=u[r]>>>4*(r-1)+3;u[7]=u[7]<<5|u[7]>>>27}var l=this._invSubKeys=[];for(r=0;r<16;r++)l[r]=n[15-r]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,r){this._lBlock=e[t],this._rBlock=e[t+1],h.call(this,4,252645135),h.call(this,16,65535),f.call(this,2,858993459),f.call(this,8,16711935),h.call(this,1,1431655765);for(var i=0;i<16;i++){for(var n=r[i],s=this._lBlock,o=this._rBlock,a=0,c=0;c<8;c++)a|=u[c][((o^n[c])&d[c])>>>0];this._lBlock=o,this._rBlock=s^a}var l=this._lBlock;this._lBlock=this._rBlock,this._rBlock=l,h.call(this,1,1431655765),f.call(this,8,16711935),f.call(this,2,858993459),h.call(this,16,65535),h.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function h(e,t){var r=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=r,this._lBlock^=r<<e}function f(e,t){var r=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=r,this._rBlock^=r<<e}e.DES=n._createHelper(l);var p=s.TripleDES=n.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),r=e.length<4?e.slice(0,2):e.slice(2,4),n=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=l.createEncryptor(i.create(t)),this._des2=l.createEncryptor(i.create(r)),this._des3=l.createEncryptor(i.create(n))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=n._createHelper(p)}(),r.TripleDES)}(Dg);var xg={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,function(){var e=r,t=e.lib.StreamCipher,i=e.algo,n=i.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,i=this._S=[],n=0;n<256;n++)i[n]=n;n=0;for(var s=0;n<256;n++){var o=n%r,a=t[o>>>2]>>>24-o%4*8&255;s=(s+i[n]+a)%256;var c=i[n];i[n]=i[s],i[s]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=s.call(this)},keySize:8,ivSize:0});function s(){for(var e=this._S,t=this._i,r=this._j,i=0,n=0;n<4;n++){r=(r+e[t=(t+1)%256])%256;var s=e[t];e[t]=e[r],e[r]=s,i|=e[(e[t]+e[r])%256]<<24-8*n}return this._i=t,this._j=r,i}e.RC4=t._createHelper(n);var o=i.RC4Drop=n.extend({cfg:n.cfg.extend({drop:192}),_doReset:function(){n._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)s.call(this)}});e.RC4Drop=t._createHelper(o)}(),r.RC4)}(xg);var Ng={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,function(){var e=r,t=e.lib.StreamCipher,i=e.algo,n=[],s=[],o=[],a=i.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,r=0;r<4;r++)e[r]=16711935&(e[r]<<8|e[r]>>>24)|4278255360&(e[r]<<24|e[r]>>>8);var i=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],n=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,r=0;r<4;r++)c.call(this);for(r=0;r<8;r++)n[r]^=i[r+4&7];if(t){var s=t.words,o=s[0],a=s[1],u=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),d=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=u>>>16|4294901760&d,h=d<<16|65535&u;for(n[0]^=u,n[1]^=l,n[2]^=d,n[3]^=h,n[4]^=u,n[5]^=l,n[6]^=d,n[7]^=h,r=0;r<4;r++)c.call(this)}},_doProcessBlock:function(e,t){var r=this._X;c.call(this),n[0]=r[0]^r[5]>>>16^r[3]<<16,n[1]=r[2]^r[7]>>>16^r[5]<<16,n[2]=r[4]^r[1]>>>16^r[7]<<16,n[3]=r[6]^r[3]>>>16^r[1]<<16;for(var i=0;i<4;i++)n[i]=16711935&(n[i]<<8|n[i]>>>24)|4278255360&(n[i]<<24|n[i]>>>8),e[t+i]^=n[i]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,r=0;r<8;r++)s[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0,r=0;r<8;r++){var i=e[r]+t[r],n=65535&i,a=i>>>16,c=((n*n>>>17)+n*a>>>15)+a*a,u=((4294901760&i)*i|0)+((65535&i)*i|0);o[r]=c^u}e[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,e[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,e[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,e[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,e[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,e[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,e[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,e[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}e.Rabbit=t._createHelper(a)}(),r.Rabbit)}(Ng);var Ug={exports:{}};!function(e,t){var r;e.exports=(r=ig.exports,function(){var e=r,t=e.lib.StreamCipher,i=e.algo,n=[],s=[],o=[],a=i.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)i[n]^=r[n+4&7];if(t){var s=t.words,o=s[0],a=s[1],u=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),d=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=u>>>16|4294901760&d,h=d<<16|65535&u;for(i[0]^=u,i[1]^=l,i[2]^=d,i[3]^=h,i[4]^=u,i[5]^=l,i[6]^=d,i[7]^=h,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(e,t){var r=this._X;c.call(this),n[0]=r[0]^r[5]>>>16^r[3]<<16,n[1]=r[2]^r[7]>>>16^r[5]<<16,n[2]=r[4]^r[1]>>>16^r[7]<<16,n[3]=r[6]^r[3]>>>16^r[1]<<16;for(var i=0;i<4;i++)n[i]=16711935&(n[i]<<8|n[i]>>>24)|4278255360&(n[i]<<24|n[i]>>>8),e[t+i]^=n[i]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,r=0;r<8;r++)s[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0,r=0;r<8;r++){var i=e[r]+t[r],n=65535&i,a=i>>>16,c=((n*n>>>17)+n*a>>>15)+a*a,u=((4294901760&i)*i|0)+((65535&i)*i|0);o[r]=c^u}e[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,e[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,e[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,e[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,e[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,e[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,e[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,e[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}e.RabbitLegacy=t._createHelper(a)}(),r.RabbitLegacy)}(Ug),function(e,t){e.exports=ig.exports}(rg);var Lg=rg.exports;window.crypto=window.crypto||window.webkitCrypto||window.mozCrypto||window.oCrypto||window.msCrypto;const Vg={Mac:/(mac os x)\s+([\w_]+)/,Windows:/(windows nt)\s+([\w.]+)/,Ios:/(i(?:pad|phone|pod)).*cpu(?: i(?:pad|phone|pod))? os (\d+(?:[.|_]\d+)+)/,Android:/(android)\s+([\d.]+)/,Ipad:/(ipad).*os\s([\d_]+)/,Iphone:/(iphone\sos)\s([\d_]+)/},Bg=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","_"];let Yg,Fg;const jg="CommonUtil";class zg{constructor(){this.uuidCount=0,this.timeDiff=0,this.platform=(()=>{const e=navigator.userAgent.toLowerCase(),t=e.match(/(micromessenger)\/([\w.()]+)/i),r=t?"-WeChat".concat(t[2]):"";for(const i in Vg)if(Object.prototype.hasOwnProperty.call(Vg,i)){const t=e.match(Vg[i]);if(t)return Fg="Ios"===i?t[2].replace(/_/g,"."):t[2],Yg=["Ios","Ipad","Iphone"].includes(i)?"IOS":i,i+Fg+r}return"unknown"})(),this.userAgent=(()=>{const e=navigator.userAgent.match(/(chrome|safari|firefox)\/(\d+(\.\d+)*)/i);return e?"".concat(e[1],"-").concat(e[2]):""})()}async sleep(e){return new Promise((t=>{const r=setTimeout((()=>{clearTimeout(r),t()}),e)}))}getDeviceID(){return this.deviceID||(this.deviceID=this.generateStandardUuid()),this.deviceID}generateStandardUuid(){let e;if(window.crypto&&(e="function"==typeof window.crypto.randomUUID?window.crypto.randomUUID():""),!e){let t=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(t+=performance.now()),e="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/[x]/g,(()=>{const e=(t+16*this.getRandom())%16|0;return t=Math.floor(t/16),e.toString(16)}))}return e}static getRandomArray(e){const t=new Uint8Array(e);return window.crypto&&window.crypto.getRandomValues(t),t}getRandom(){return zg.getRandomArray(1)[0]/256}generateUuid(e){let t="";const r=zg.getRandomArray(33),i=e?22:33;for(let o=0;o<i;o++)t+=Bg[Math.round(r[o]%64)];let n="";for(let o=0;o<33-i;o++)n+=Bg[63&e],e>>=6;let s=this.uuidCount.toString(16);for(let o=3-s.length;o>0;o--)s="0"+s;return this.uuidCount>4094?this.uuidCount=0:this.uuidCount++,"".concat(t).concat(n).concat(s)}generateRandomId(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:62,r="";const i=zg.getRandomArray(e);for(let n=0;n<e;n++)r+=Bg[Math.round(i[n]%t)];return r}getPlatform(){return this.platform}getSystemType(){return Yg}getRomVersion(){return Fg}getUserAgent(){return this.userAgent}getNetworkType(){const e=navigator.userAgent.match(/NetType\/\w+/),t=e?e[0].toLowerCase().replace("nettype/",""):"";return["wifi","4g","3g","3gnet","2g"].includes(t)?t.toUpperCase():"other"}syncLocalTime(e){try{if(e){console.debug(jg,"syncLocalTime, serverTime: ".concat(e));const t=new Date(e).getTime();this.timeDiff=(new Date).getTime()-t,console.debug(jg,"syncLocalTime, timeDiff: ".concat(this.timeDiff))}}catch(tb){console.error(jg,"syncLocalTime error: ".concat(tb))}}getCurrentTimestamp(){return(new Date).getTime()-this.timeDiff}getCurrentTime(){const e=new Date(this.getCurrentTimestamp()),t=e.getFullYear(),r=e.getMonth()+1,i=r<10?"0".concat(r):r,n=e.getDate(),s=n<10?"0".concat(n):n,o=e.getHours(),a=o<10?"0".concat(o):o,c=e.getMinutes(),u=c<10?"0".concat(c):c,d=e.getSeconds(),l=d<10?"0".concat(d):d,h=e.getMilliseconds(),f="".concat(h+1e3).substring(1),p=e.getTimezoneOffset()/60,m=p>=0?p:-p,_=(p<=0?"+":"-")+(m<10?"0".concat(m):"".concat(m))+":00";return{year:"".concat(t),month:"".concat(i),day:"".concat(s),hour:"".concat(a),min:"".concat(u),sec:"".concat(l),millsec:f,zoneOff:_}}adjustTimeByOffset(e){return e-this.timeDiff}convertString2Timestamp(e){return new Date(e).getTime()}generateStreamId(){return"2xxxxxxx-8xxx-xxxx-yxxx-xxxx".replace(/[xy]/g,(e=>{const t=16*this.getRandom()|0;return("x"==e?t:3&t|8).toString(16)}))}isWKWebview(){return/I.*-WeChat.*/gi.test(this.platform)}isAppleDevice(){return/^(Mac|I).*/gi.test(this.platform)}isMobileDevice(){return!/^(Mac|Windows).*/gi.test(this.platform)}isMobileWeChatBrowser(){return this.isMobileDevice()&&/.*MicroMessenger.*/gi.test(navigator.userAgent)}isSupportConstraints(e){var t;return!!(null===(t=navigator.mediaDevices)||void 0===t?void 0:t.getSupportedConstraints())[e]}async calculateSha256(e){return new Promise((t=>{const r=new FileReader;r.onloadend=e=>{if(e.target.readyState==FileReader.DONE){const r=Lg.lib.WordArray.create(e.target.result),i=Lg.SHA256(r).toString();t(i)}},r.readAsArrayBuffer(e)}))}getValue(e,t){return e||t}}const Hg=new zg;function Kg(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function Wg(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Kg(Object(r),!0).forEach((function(t){bu(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kg(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const Gg=Symbol("hrtc_".concat(Hg.getCurrentTimestamp())),Jg=new Map,qg=new Map;class Xg{constructor(e){bu(this,"logBuffer",[]),bu(this,"logBufferSize",5e3),this.provider=e}error(e,t,r){this.log("error",e,t,r)}warn(e,t,r){this.log("warn",e,t,r)}info(e,t,r){this.log("info",e,t,r)}debug(e,t,r){this.log("debug",e,t,r)}log(e,t,r,i){qg.forEach(((e,t)=>{r.includes(t)&&(r=r.replace(e.pattern,e.newString))}));const n=Hg.getCurrentTime(),s=["".concat(n.year,"-").concat(n.month,"-").concat(n.day," ").concat(n.hour,":").concat(n.min,":").concat(n.sec,".").concat(n.millsec),e];Object.entries(Wg(Wg({},i),{},{tag:t,msg:r})).forEach((e=>{let[t,r]=e;"string"==typeof r&&s.push("[".concat(t,": ").concat(r,"]"))}));const o=s.join(" ");for(this.logBuffer.push(o);this.logBuffer.length>=this.logBufferSize;)this.logBuffer.shift();const a=["".concat(n.year,"-").concat(n.month,"-").concat(n.day," ").concat(n.hour,":").concat(n.min,":").concat(n.sec,".").concat(n.millsec)];ch.indexOf(Qg.logLevel)>=ch.indexOf(e)&&console[e](a+" [HRTC] "+"[".concat(e,"] [").concat(t,"] [").concat(r,"]"))}setTag(e){this.tag=e}clearLogs(){this.logBuffer=[]}setlogBufferSize(e){this.logBufferSize=e}getlogBufferSize(){return this.logBufferSize}getProvider(){return this.provider}getLogBuffer(){return this.logBuffer}}class Qg{static getLogger(e){const t=e?e.getSymbol():Gg;if(!Jg.has(t)){const r=new Xg(e);return Jg.set(t,r),r}return Jg.get(t)}static setAllLogLevel(e){if(!(ch.indexOf(e)>=0))throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"log level is invalid");Qg.logLevel=e}static addPrivacyString(e){if(!e)return;if(qg.has(e))return;const t=Qg.secretString(e);if(!t)return;const r={pattern:new RegExp("\\b"+e+"\\b","g"),newString:t};qg.set(e,r)}static shieldIpAddress(e){return e?e.replace(/\b(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\.(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\.(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\b/g,"$1.*.*.$2"):null}static shieldUrlParameters(e){if(!e)return e;const t=e.match(/([^?|=|&]+)=([^&]+)/g);return t&&t.forEach((t=>{const r=/([^=]*)=(.*)/g.exec(t);e=e.replace(t,"".concat(r[1],"=").concat(Qg.secretString(r[2])))})),e}static secretString(e){if(!e)return null;const t="********",r=Math.ceil(e.length/3),i=Math.ceil((e.length-r)/2);return 0===i?"".concat(e.substr(0,r)).concat(t):"".concat(e.substr(0,r)).concat(t).concat(e.substr(-i,i))}static async getLogFile(e,t){const r=e.getProvider();if(null==r)throw new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR,"no available log provider");const i=Hg.getCurrentTime(),n="".concat(i.year,"-").concat(i.month,"-").concat(i.day,"T").concat(i.hour,":").concat(i.min,":").concat(i.sec).concat(i.zoneOff),s="".concat(i.year,"-").concat(i.month,"-").concat(i.day,"T").concat(i.hour,".").concat(i.min,".").concat(i.sec).concat(i.zoneOff.replace(":",".")),o=Qg.getLogger(),a=e.getLogBuffer(),c=o.getLogBuffer();if(0===a.length&&0===c.length)return null;const u=r.getInfo(),d="".concat(u.userName,"_").concat(u.userId,"##").concat(u.domain,"##").concat(u.appId,"##").concat(s),l=Hg.getDeviceID(),h=encodeURIComponent("".concat(t,"##").concat(l,"##").concat(u.appId,"##").concat(n)),f=new df,p=f.folder("".concat(u.userName,"_").concat(u.userId,"##").concat(u.roomId,"##").concat(u.domain,"##").concat(u.appId));p.file("".concat(d,".log"),"".concat(a.join("\n"))),p.file("hrtc##".concat(n,".log"),"".concat(c.join("\n")));const m=await f.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}});return{sha256:await Hg.calculateSha256(m),length:m.size,content:m,urlFileNameEncode:h}}}bu(Qg,"logLevel",ch[3]);var Zg=Xr,$g=Qr,eS=o,tS=O,rS=E,iS=Tn,nS=As,sS=nt.exports;if(Zg({target:"Promise",proto:!0,real:!0,forced:!!$g&&eS((function(){$g.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=iS(this,tS("Promise")),r=rS(e);return this.then(r?function(r){return nS(t,e()).then((function(){return r}))}:e,r?function(r){return nS(t,e()).then((function(){throw r}))}:e)}}),rS($g)){var oS=tS("Promise").prototype.finally;$g.prototype.finally!==oS&&sS($g.prototype,"finally",oS,{unsafe:!0})}var aS=q,cS=qe,uS=function(){for(var e=cS(this),t=aS(e.add),r=0,i=arguments.length;r<i;r++)t.call(e,arguments[r]);return e},dS=uS;Xr({target:"Set",proto:!0,real:!0,forced:false},{addAll:function(){return dS.apply(this,arguments)}});var lS=nc;Xr({target:"Set",proto:!0,real:!0,forced:false},{deleteAll:function(){return lS.apply(this,arguments)}});var hS=O,fS=q,pS=qe,mS=Tn,_S=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{difference:function(e){var t=pS(this),r=new(mS(t,hS("Set")))(t),i=fS(r.delete);return _S(e,(function(e){i.call(r,e)})),r}});var gS=function(e){return Set.prototype.values.call(e)},SS=qe,vS=Ri,RS=gS,TS=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{every:function(e){var t=SS(this),r=RS(t),i=vS(e,arguments.length>1?arguments[1]:void 0,3);return!TS(r,(function(e,r){if(!i(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var IS=O,yS=q,ES=qe,bS=Ri,CS=Tn,AS=gS,kS=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{filter:function(e){var t=ES(this),r=AS(t),i=bS(e,arguments.length>1?arguments[1]:void 0,3),n=new(CS(t,IS("Set"))),s=yS(n.add);return kS(r,(function(e){i(e,e,t)&&s.call(n,e)}),{IS_ITERATOR:!0}),n}});var wS=qe,OS=Ri,PS=gS,MS=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{find:function(e){var t=wS(this),r=PS(t),i=OS(e,arguments.length>1?arguments[1]:void 0,3);return MS(r,(function(e,r){if(i(e,e,t))return r(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var DS=O,xS=q,NS=qe,US=Tn,LS=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{intersection:function(e){var t=NS(this),r=new(US(t,DS("Set"))),i=xS(t.has),n=xS(r.add);return LS(e,(function(e){i.call(t,e)&&n.call(r,e)})),r}});var VS=q,BS=qe,YS=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{isDisjointFrom:function(e){var t=BS(this),r=VS(t.has);return!YS(e,(function(e,i){if(!0===r.call(t,e))return i()}),{INTERRUPTED:!0}).stopped}});var FS=O,jS=q,zS=E,HS=qe,KS=Ui,WS=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{isSubsetOf:function(e){var t=KS(this),r=HS(e),i=r.has;return zS(i)||(r=new(FS("Set"))(e),i=jS(r.has)),!WS(t,(function(e,t){if(!1===i.call(r,e))return t()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var GS=q,JS=qe,qS=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{isSupersetOf:function(e){var t=JS(this),r=GS(t.has);return!qS(e,(function(e,i){if(!1===r.call(t,e))return i()}),{INTERRUPTED:!0}).stopped}});var XS=qe,QS=gS,ZS=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{join:function(e){var t=XS(this),r=QS(t),i=void 0===e?",":String(e),n=[];return ZS(r,n.push,{that:n,IS_ITERATOR:!0}),n.join(i)}});var $S=O,ev=q,tv=qe,rv=Ri,iv=Tn,nv=gS,sv=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{map:function(e){var t=tv(this),r=nv(t),i=rv(e,arguments.length>1?arguments[1]:void 0,3),n=new(iv(t,$S("Set"))),s=ev(n.add);return sv(r,(function(e){s.call(n,i(e,e,t))}),{IS_ITERATOR:!0}),n}});var ov=q,av=qe,cv=gS,uv=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{reduce:function(e){var t=av(this),r=cv(t),i=arguments.length<2,n=i?void 0:arguments[1];if(ov(e),uv(r,(function(r){i?(i=!1,n=r):n=e(n,r,r,t)}),{IS_ITERATOR:!0}),i)throw TypeError("Reduce of empty set with no initial value");return n}});var dv=qe,lv=Ri,hv=gS,fv=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{some:function(e){var t=dv(this),r=hv(t),i=lv(e,arguments.length>1?arguments[1]:void 0,3);return fv(r,(function(e,r){if(i(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var pv=O,mv=q,_v=qe,gv=Tn,Sv=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{symmetricDifference:function(e){var t=_v(this),r=new(gv(t,pv("Set")))(t),i=mv(r.delete),n=mv(r.add);return Sv(e,(function(e){i.call(r,e)||n.call(r,e)})),r}});var vv=O,Rv=q,Tv=qe,Iv=Tn,yv=Gi;Xr({target:"Set",proto:!0,real:!0,forced:false},{union:function(e){var t=Tv(this),r=new(Iv(t,vv("Set")))(t);return yv(e,Rv(r.add),{that:r}),r}});var Ev=q,bv=ce,Cv=v,Av=dr,kv=function(e){return function(t,r,i,n){Ev(r);var s=bv(t),o=Cv(s),a=Av(s),c=e?a-1:0,u=e?-1:1;if(i<2)for(;;){if(c in o){n=o[c],c+=u;break}if(c+=u,e?c<0:a<=c)throw TypeError("Reduce of empty array with no initial value")}for(;e?c>=0:a>c;c+=u)c in o&&(n=r(n,o[c],c,s));return n}},wv={left:kv(!1),right:kv(!0)}.left,Ov=V,Pv=En;
/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */
function Mv(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function Dv(){}function xv(){xv.init.call(this)}function Nv(e){return void 0===e._maxListeners?xv.defaultMaxListeners:e._maxListeners}function Uv(e,t,r){if(t)e.call(r);else for(var i=e.length,n=Hv(e,i),s=0;s<i;++s)n[s].call(r)}function Lv(e,t,r,i){if(t)e.call(r,i);else for(var n=e.length,s=Hv(e,n),o=0;o<n;++o)s[o].call(r,i)}function Vv(e,t,r,i,n){if(t)e.call(r,i,n);else for(var s=e.length,o=Hv(e,s),a=0;a<s;++a)o[a].call(r,i,n)}function Bv(e,t,r,i,n,s){if(t)e.call(r,i,n,s);else for(var o=e.length,a=Hv(e,o),c=0;c<o;++c)a[c].call(r,i,n,s)}function Yv(e,t,r,i){if(t)e.apply(r,i);else for(var n=e.length,s=Hv(e,n),o=0;o<n;++o)s[o].apply(r,i)}function Fv(e,t,r,i){var n,s,o,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]):(s=e._events=new Dv,e._eventsCount=0),o){if("function"==typeof o?o=s[t]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),!o.warned&&(n=Nv(e))&&n>0&&o.length>n){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,a=c,"function"==typeof console.warn?console.warn(a):console.log(a)}}else o=s[t]=r,++e._eventsCount;return e}function jv(e,t,r){var i=!1;function n(){e.removeListener(t,n),i||(i=!0,r.apply(e,arguments))}return n.listener=r,n}function zv(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function Hv(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}Xr({target:"Array",proto:!0,forced:!rd("reduce")||!Pv&&Ov>79&&Ov<83},{reduce:function(e){return wv(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}}),Dv.prototype=Object.create(null),xv.EventEmitter=xv,xv.usingDomains=!1,xv.prototype.domain=void 0,xv.prototype._events=void 0,xv.prototype._maxListeners=void 0,xv.defaultMaxListeners=10,xv.init=function(){this.domain=null,xv.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Dv,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},xv.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},xv.prototype.getMaxListeners=function(){return Nv(this)},xv.prototype.emit=function(e){var t,r,i,n,s,o,a,c="error"===e;if(o=this._events)c=c&&null==o.error;else if(!c)return!1;if(a=this.domain,c){if(t=arguments[1],!a){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(r=o[e]))return!1;var d="function"==typeof r;switch(i=arguments.length){case 1:Uv(r,d,this);break;case 2:Lv(r,d,this,arguments[1]);break;case 3:Vv(r,d,this,arguments[1],arguments[2]);break;case 4:Bv(r,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(i-1),s=1;s<i;s++)n[s-1]=arguments[s];Yv(r,d,this,n)}return!0},xv.prototype.addListener=function(e,t){return Fv(this,e,t,!1)},xv.prototype.on=xv.prototype.addListener,xv.prototype.prependListener=function(e,t){return Fv(this,e,t,!0)},xv.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,jv(this,e,t)),this},xv.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,jv(this,e,t)),this},xv.prototype.removeListener=function(e,t){var r,i,n,s,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new Dv:(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=r[s].listener,n=s;break}if(n<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new Dv,this;delete i[e]}else!function(e,t){for(var r=t,i=r+1,n=e.length;i<n;r+=1,i+=1)e[r]=e[i];e.pop()}(r,n);i.removeListener&&this.emit("removeListener",e,o||t)}return this},xv.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new Dv,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new Dv:delete r[e]),this;if(0===arguments.length){for(var i,n=Object.keys(r),s=0;s<n.length;++s)"removeListener"!==(i=n[s])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new Dv,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},xv.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},xv.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):zv.call(e,t)},xv.prototype.listenerCount=zv,xv.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};const Kv="2.0.3.300",Wv="7c671df",Gv="v3",Jv=5e3,qv=1e4,Xv=5,Qv=6,Zv=120,$v="https://rtc-sdk.obs.cn-north-4.myhuaweicloud.com:443/WebRTCSDK-Release/whitelist/browserSupportWhiteList.conf?AccessKeyId=J8YMIPY8O5U8D7REC0IM&Expires=1662640190&Signature=X7FZt7ChrCbBVyJWqP4w%2BZUJ4/s%3D",eR="https://logservice.hicloud.com:443",tR="1090";class rR{static checkStringParameter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;if(!e&&0===r)return;if("string"!=typeof e)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"invalid type: ".concat(e));const n=this.getStringBytes(e);if(n>t||n<r)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"invalid length: ".concat(e));if(i){if(!new RegExp(i).test(e))throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"invalid format: ".concat(e))}}static checkAppid(e){this.checkStringParameter(e,128,1,"^[a-zA-Z0-9!$%()+-:;=@[\\]_~,]{1,128}$")}static checkCountryCode(e){if(!e)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"countryCode is empty");this.checkStringParameter(e,2,2,"^[A-Z]{2}$")}static checkDomain(e){this.checkStringParameter(e,128,1,"^[a-zA-Z0-9-:;<=.>?@[\\]^_{}|~,]{1,128}$")}static checkRoomId(e){this.checkStringParameter(e,64,1,"^[a-zA-Z0-9-_]{1,64}$")}static checkUserId(e){this.checkStringParameter(e,64,1,"^[a-zA-Z0-9-_]{1,64}$")}static checkUserName(e){this.checkStringParameter(e,256,0)}static checkUserRole(e){if("number"!=typeof e)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"invalid parameter: ".concat(e));this.checkStringParameter("".concat(e),1,1,"^[0-2]$")}static checkAccessResourceType(e){if(null!=e){if("number"!=typeof e)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"invalid paramter: ".concat(e));this.checkStringParameter("".concat(e),1,1,"^[0|1|2|3]$")}}static checkUserInfo(e){if("object"!=typeof e)throw this.logger.error("ParameterValidator","userInfo type invalid "),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"userInfo type invalid");this.checkUserId(e.userId),this.checkUserName(e.userName),this.checkUserRole(e.role),this.checkUserOptionInfo(e.optionInfo)}static checkJoinParams(e,t){this.checkRoomId(e),this.checkUserInfo(t)}static getStringBytes(e){if(!e)return 0;let t=0;if(window.TextEncoder){return t=(new TextEncoder).encode(e).length,t}const r=e.length;for(let i=0;i<r;i++)e.charCodeAt(i)>255?t+=2:t++;return t}static checkUserOptionInfo(e){if(e&&![!0,!1,null,void 0].includes(e.recordPlaceholder))throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"invalid parameter: ".concat(e.recordPlaceholder))}}bu(rR,"logger",Qg.getLogger());var iR=new class{setPorxyServer(e){rR.checkStringParameter(e,256,1);const t=/(.*:\/\/)?([^:]+):?(.*)?/.exec(e);let r=e;/^((\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))(\.|$)){4}$/.test(t[2])?t[1]||(r="http://".concat(t[2]).concat(t[3]?":":"").concat(t[3]||"")):t[1]||(r="https://".concat(t[2]).concat(t[3]?":":"").concat(t[3]||"")),this.proxyServer=r}getProxyServer(){return this.proxyServer}};function nR(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function sR(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?nR(Object(r),!0).forEach((function(t){bu(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nR(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const oR="httpRequest";const aR=new class{constructor(){this.defaultRequestOption={method:"GET",mode:"cors",cache:"default"},this.logger=Qg.getLogger()}getFetchUrl(e){const t=iR.getProxyServer();let r;if(t){const i=/http(?:s)?:\/\/([^/]+)(.*)/.exec(e);if(i&&3===i.length){const n=i[1].split(":");r=n[1]||(/^http:.*/gi.test(e)?"80":"443"),e="".concat(t).concat(i[2]).concat(i[2].indexOf("?")<0?"?":"&","org_domain=").concat(n[0],"&org_port=").concat(r)}return e}return e}async fetch(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e4,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0,a=0;for(;a<s+1;){const c={};t=Hg.generateRandomId(16,10);try{this.logger.debug(oR,"[HTTP_ID:".concat(t,"] fetch request start: ").concat(Qg.shieldUrlParameters(e))),this.extendInfosHandle(e,"start",c,o);const u=await this.doFetch(e,r,i,n,t);return a=s+1,this.extendInfosHandle(e,"end",c,o,u),this.logger.debug(oR,"[HTTP_ID:".concat(t,"] fetch request success")),u}catch(tb){if(this.logger.error(oR,"[HTTP_ID:".concat(t,"], requestUrl: ").concat(Qg.shieldUrlParameters(e),", fetch request failed")),this.extendInfosHandle(e,"end",c,o,tb),tb instanceof Eu&&tb.getCode()===ou.RTC_ERR_CODE_REGION_NOT_COVERED)throw a=s+1,tb;if(!(a<s))throw tb;await Hg.sleep(500*Hg.getRandom()+500),a++}}}doFetch(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;const o=new Promise(((e,r)=>{t=setTimeout((()=>{clearTimeout(t),r(new Eu(ou.RTC_ERR_CODE_WAIT_RSP_TIMEOUT))}),n)})),a=new Promise(((n,o)=>{fetch(this.getFetchUrl(e),sR(sR(sR({},this.defaultRequestOption),r),{headers:i})).then((t=>{if(Hg.syncLocalTime(t.headers.get("Date")),!t.ok)return 504===t.status?this.logger.error(oR,"[HTTP_ID:".concat(s,"] doFetch failed: 504")):0===t.status?this.logger.error(oR,"[HTTP_ID:".concat(s,"] doFetch failed: 0")):this.logger.error(oR,"[HTTP_ID:".concat(s,"] doFetch failed: ").concat(t.status)),void o(new Eu(t.status,"network error"));let r;const a=t.headers.get("Content-Type")||i["Content-Type"];r=/.*application\/json.*/.test(a)?t.json():/^text.*/.test(a)?t.text():t.arrayBuffer(),r.then((e=>{n({httpCode:t.status,data:e})})).catch((t=>{this.logger.error(oR,"[HTTP_ID:".concat(s,"], requestUrl: ").concat(Qg.shieldUrlParameters(e),", doFetch get response failed: ").concat(t)),o(new Eu(null==t?void 0:t.name,null==t?void 0:t.message))}))})).catch((t=>{this.logger.error(oR,"[HTTP_ID:".concat(s,"], requestUrl: ").concat(Qg.shieldUrlParameters(e),", doFetch failed for exception: ").concat(t)),o(new Eu(null==t?void 0:t.name,null==t?void 0:t.message))})).finally((()=>{clearTimeout(t)}))}));return Promise.race([o,a])}extendInfosHandle(e,t,r,i,n){i&&("start"===t?Object.assign(r,{id:i.length+1,domain:e,start_ms:Hg.getCurrentTimestamp(),delay_ms:0,stepName:"dispatch",rspCode:"",errMsg:""}):"end"===t?((/v1\/dns/.test(e)||/global\.talk-cloud\.net/.test(e))&&(r.start_ms=Hg.adjustTimeByOffset(r.start_ms)),n instanceof Eu?(r.delay_ms=Hg.getCurrentTimestamp()-r.start_ms,r.rspCode="".concat(n.getCode()),r.errMsg=n.getMsg()):(r.delay_ms=Hg.getCurrentTimestamp()-r.start_ms,r.rspCode=n.httpCode||"200"),i.push(r)):this.logger.info(oR,"cannot handle"))}};let cR=!0,uR=!0;function dR(e,t,r){const i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}function lR(e,t,r){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,n=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return n.apply(this,arguments);const s=e=>{const t=r(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,s),n.apply(this,[e,s])};const s=i.removeEventListener;i.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(r))return s.apply(this,arguments);const i=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function hR(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(cR=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function fR(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(uR=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function pR(){if("object"==typeof window){if(cR)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function mR(e,t){uR&&console.warn(e+" is deprecated, please use "+t+" instead.")}function _R(e){return"[object Object]"===Object.prototype.toString.call(e)}function gR(e){return _R(e)?Object.keys(e).reduce((function(t,r){const i=_R(e[r]),n=i?gR(e[r]):e[r],s=i&&!Object.keys(n).length;return void 0===n||s?t:Object.assign(t,{[r]:n})}),{}):e}function SR(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?SR(e,e.get(t[i]),r):i.endsWith("Ids")&&t[i].forEach((t=>{SR(e,e.get(t),r)}))})))}function vR(e,t,r){const i=r?"outbound-rtp":"inbound-rtp",n=new Map;if(null===t)return n;const s=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)})),s.forEach((t=>{e.forEach((r=>{r.type===i&&r.trackId===t.id&&SR(e,r,n)}))})),n}const RR=pR;function TR(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((r=>{if("require"===r||"advanced"===r||"mediaSource"===r)return;const i="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[n("min",r)]=i.ideal,t.optional.push(e),e={},e[n("max",r)]=i.ideal,t.optional.push(e)):(e[n("",r)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[n("",r)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,r)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},n=function(e,n){if(t.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});const o=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||o)){let t;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?t=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(t=["front"]),t)return r.mediaDevices.enumerateDevices().then((r=>{let o=(r=r.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!o&&r.length&&t.includes("back")&&(o=r[r.length-1]),o&&(e.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=i(e.video),RR("chrome: "+JSON.stringify(e)),n(e)}))}e.video=i(e.video)}return RR("chrome: "+JSON.stringify(e)),n(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,i){n(e,(e=>{r.webkitGetUserMedia(e,t,(e=>{i&&i(s(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){const e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return n(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(s(e))))))}}}function IR(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function yR(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.track.id)):{track:r.track};const n=new Event("track");n.track=r.track,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],this.dispatchEvent(n)})),t.stream.getTracks().forEach((r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.id)):{track:r};const n=new Event("track");n.track=r,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],this.dispatchEvent(n)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else lR(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function ER(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let n=r.apply(this,arguments);return n||(n=t(this,e),this._senders.push(n)),n};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function bR(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const n=function(e){const t={};return e.result().forEach((e=>{const r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{r[t]=e.stat(t)})),t[r.id]=r})),t},s=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const i=function(e){r(s(n(e)))};return t.apply(this,[i,e])}return new Promise(((e,r)=>{t.apply(this,[function(t){e(s(n(t)))},r])})).then(r,i)}}function CR(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>vR(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),lR(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>vR(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,r,i;return this.getSenders().forEach((r=>{r.track===e&&(t?i=!0:t=r)})),this.getReceivers().forEach((t=>(t.track===e&&(r?i=!0:r=t),t.track===e))),i||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function AR(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(i)&&this._shimmedLocalStreams[r.id].push(i):this._shimmedLocalStreams[r.id]=[r,i],i};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();r.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),n.apply(this,arguments)}}function kR(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return AR(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}i.apply(this,[t])};const n=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(new RegExp(n.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})}function o(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(new RegExp(i.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const n=this.getSenders().find((e=>e.track===t));if(n)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const s=this._streams[r.id];if(s)s.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[r.id]=i,this._reverseStreams[i.id]=r,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[t=>{const r=s(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then((e=>s(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=o(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((r=>{this._streams[r].getTracks().find((t=>e.track===t))&&(t=this._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function wR(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function OR(e,t){lR(e,"negotiationneeded",(e=>{const r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}var PR=Object.freeze({__proto__:null,shimMediaStream:IR,shimOnTrack:yR,shimGetSendersWithDtmf:ER,shimGetStats:bR,shimSenderReceiverGetStats:CR,shimAddTrackRemoveTrackWithNative:AR,shimAddTrackRemoveTrack:kR,shimPeerConnection:wR,fixNegotiationNeeded:OR,shimGetUserMedia:TR,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((t=>{const i=r.video&&r.video.width,n=r.video&&r.video.height,s=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},i&&(r.video.mandatory.maxWidth=i),n&&(r.video.mandatory.maxHeight=n),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function MR(e,t){const r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,i){mR("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return"object"==typeof r&&"object"==typeof r.audio&&(r=JSON.parse(JSON.stringify(r)),e(r.audio,"autoGainControl","mozAutoGainControl"),e(r.audio,"noiseSuppression","mozNoiseSuppression")),t(r)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const r=t.apply(this,arguments);return e(r,"mozAutoGainControl","autoGainControl"),e(r,"mozNoiseSuppression","noiseSuppression"),r}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(r){return"audio"===this.kind&&"object"==typeof r&&(r=JSON.parse(JSON.stringify(r)),e(r,"autoGainControl","mozAutoGainControl"),e(r,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[r])}}}}function DR(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function xR(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,s]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!n)try{e.forEach((e=>{e.type=r[e.type]||e.type}))}catch(i){if("TypeError"!==i.name)throw i;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:r[t.type]||t.type}))}))}return e})).then(n,s)}}function NR(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function UR(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),lR(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function LR(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){mR("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function VR(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function BR(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],r=e&&"sendEncodings"in e;r&&e.sendEncodings.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(r){const{sender:t}=i,r=t.getParameters();(!("encodings"in r)||1===r.encodings.length&&0===Object.keys(r.encodings[0]).length)&&(r.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(r).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function YR(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function FR(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function jR(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var zR=Object.freeze({__proto__:null,shimOnTrack:DR,shimPeerConnection:xR,shimSenderGetStats:NR,shimReceiverGetStats:UR,shimRemoveStream:LR,shimRTCDataChannel:VR,shimAddTransceiver:BR,shimGetParameters:YR,shimCreateOffer:FR,shimCreateAnswer:jR,shimGetUserMedia:MR,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}});function HR(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((r=>t.call(this,r,e))),e.getVideoTracks().forEach((r=>t.call(this,r,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...r){return r&&r.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const r=e.getTracks();this.getSenders().forEach((e=>{r.includes(e.track)&&this.removeTrack(e)}))})}}function KR(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}))}),t.apply(e,arguments)}}}function WR(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,n=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],n=r.apply(this,[i]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n};let a=function(e,t,r){const i=n.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i};t.setLocalDescription=a,a=function(e,t,r){const i=s.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.setRemoteDescription=a,a=function(e,t,r){const i=o.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.addIceCandidate=a}function GR(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r(JR(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,i){t.mediaDevices.getUserMedia(e).then(r,i)}.bind(t))}function JR(e){return e&&void 0!==e.video?Object.assign({},e,{video:gR(e.video)}):e}function qR(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){const t=[];for(let r=0;r<e.iceServers.length;r++){let i=e.iceServers[r];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(mR("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function XR(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function QR(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const r=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video")}return t.apply(this,arguments)}}function ZR(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var $R=Object.freeze({__proto__:null,shimLocalStreamsAPI:HR,shimRemoteStreamsAPI:KR,shimCallbacksAPI:WR,shimGetUserMedia:GR,shimConstraints:JR,shimRTCIceServerUrls:qR,shimTrackEventTransceiver:XR,shimCreateOfferLegacy:QR,shimAudioContext:ZR}),eT={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){const r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter((e=>0===e.indexOf(r)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const r={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let i=8;i<t.length;i+=2)switch(t[i]){case"raddr":r.relatedAddress=t[i+1];break;case"rport":r.relatedPort=parseInt(t[i+1],10);break;case"tcptype":r.tcpType=t[i+1];break;case"ufrag":r.ufrag=t[i+1],r.usernameFragment=t[i+1];break;default:void 0===r[t[i]]&&(r[t[i]]=t[i+1])}return r},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){let t=e.substr(9).split(" ");const r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){const t={};let r;const i=e.substr(e.indexOf(" ")+1).split(";");for(let n=0;n<i.length;n++)r=i[n].trim().split("="),t[r[0].trim()]=r[1];return t},t.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+r+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(r.attribute=e.substr(t+1,i-t-1),r.value=e.substr(i+1)):r.attribute=e.substr(t+1),r},t.parseSsrcGroup=function(e){const t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(e){const t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},t.parseCryptoLine=function(e){const t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){const i=t.matchPrefix(e+r,"a=ice-ufrag:")[0],n=t.matchPrefix(e+r,"a=ice-pwd:")[0];return i&&n?{usernameFragment:i.substr(12),password:n.substr(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");for(let n=3;n<i.length;n++){const s=i[n],o=t.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(o){const i=t.parseRtpMap(o),n=t.matchPrefix(e,"a=fmtp:"+s+" ");switch(i.parameters=n.length?t.parseFmtp(n[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(t.parseRtcpFb),r.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(i.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((e=>{r.headerExtensions.push(t.parseExtmap(e))})),r},t.writeRtpDescription=function(e,r){let i="";i+="m="+e+" ",i+=r.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=r.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach((e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));let n=0;return r.codecs.forEach((e=>{e.maxptime>n&&(n=e.maxptime)})),n>0&&(i+="a=maxptime:"+n+"\r\n"),r.headerExtensions&&r.headerExtensions.forEach((e=>{i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){const r=[],i=t.parseRtpParameters(e),n=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=o.length>0&&o[0].ssrc;let c;const u=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substr(17).split(" ").map((e=>parseInt(e,10)))));u.length>0&&u[0].length>1&&u[0][0]===a&&(c=u[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(t.rtx={ssrc:c}),r.push(t),n&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&a&&r.push({ssrc:a});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,r.forEach((e=>{e.maxBitrate=d}))),r},t.parseRtcpParameters=function(e){const r={},i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const n=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=n.length>0,r.compound=0===n.length;const s=t.matchPrefix(e,"a=rtcp-mux");return r.mux=s.length>0,r},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let r;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return r=i[0].substr(7).split(" "),{stream:r[0],track:r[1]};const n=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return n.length>0?(r=n[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(e){const r=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let n;i.length>0&&(n=parseInt(i[0].substr(19),10)),isNaN(n)&&(n=65536);const s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:r.fmt,maxMessageSize:n};const o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){const e=o[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,r,i){let n;const s=void 0!==r?r:2;n=e||t.generateSessionId();return"v=0\r\no="+(i||"thisisadapterortc")+" "+n+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,r){const i=t.splitLines(e);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const r=t.splitLines(e)[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){const r=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const r=t.splitLines(e);for(let t=0;t<r.length;t++)if(r[t].length<2||"="!==r[t].charAt(1))return!1;return!0},e.exports=t}(eT);var tT=eT.exports,rT=Object.freeze(e({__proto__:null,default:tT},[eT.exports]));function iT(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const r=new t(e),i=tT.parseCandidate(e.candidate),n=Object.assign(r,i);return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,lR(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function nT(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const r=function(e){if(!e||!e.sdp)return!1;const t=tT.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=tT.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},i=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const r=parseInt(t[1],10);return r!=r?-1:r},n=function(e){let r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},s=function(e,r){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const n=tT.matchPrefix(e.sdp,"a=max-message-size:");return n.length>0?i=parseInt(n[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(i=2147483637),i},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const e=i(arguments[0]),t=n(e),r=s(arguments[0],e);let o;o=0===t&&0===r?Number.POSITIVE_INFINITY:0===t||0===r?Math.max(t,r):Math.min(t,r);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>o}),this._sctp=a}return o.apply(this,arguments)}}function sT(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const r=e.send;e.send=function(){const i=arguments[0],n=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&n>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=r.apply(this,arguments);return t(e,this),e},lR(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function oT(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}function aT(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const r=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function cT(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function uT(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return r.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return r.apply(this,[e]);const t="offer"===e.type?this.createOffer:this.createAnswer;return t.apply(this).then((e=>r.apply(this,[e])))})}var dT=Object.freeze({__proto__:null,shimRTCIceCandidate:iT,shimMaxMessageSize:nT,shimSendThrowTypeError:sT,shimConnectionState:oT,removeExtmapAllowMixed:aT,shimAddIceCandidateNullOrEmpty:cT,shimParameterlessSetLocalDescription:uT});const lT=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=pR,i=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:r}=e;if(r.mozGetUserMedia)t.browser="firefox",t.version=dR(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=dR(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=dR(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),n={browserDetails:i,commonShim:dT,extractVersion:dR,disableLog:hR,disableWarnings:fR,sdp:rT};switch(i.browser){case"chrome":if(!PR||!wR||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),n;if(null===i.version)return r("Chrome shim can not determine version, not shimming."),n;r("adapter.js shimming chrome."),n.browserShim=PR,cT(e,i),uT(e),TR(e,i),IR(e),wR(e,i),yR(e),kR(e,i),ER(e),bR(e),CR(e),OR(e,i),iT(e),oT(e),nT(e,i),sT(e),aT(e,i);break;case"firefox":if(!zR||!xR||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),n;r("adapter.js shimming firefox."),n.browserShim=zR,cT(e,i),uT(e),MR(e,i),xR(e,i),DR(e),LR(e),NR(e),UR(e),VR(e),BR(e),YR(e),FR(e),jR(e),iT(e),oT(e),nT(e,i),sT(e);break;case"safari":if(!$R||!t.shimSafari)return r("Safari shim is not included in this adapter release."),n;r("adapter.js shimming safari."),n.browserShim=$R,cT(e,i),uT(e),qR(e),QR(e),WR(e),HR(e),KR(e),XR(e),GR(e),ZR(e),iT(e),nT(e,i),sT(e),aT(e,i);break;default:r("Unsupported browser!")}return n}({window:"undefined"==typeof window?void 0:window});window.AudioContext=window.AudioContext||window.webkitAudioContext,window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;class hT{static async checkSystemRequirements(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!window||!navigator)throw new Eu(ou.RTC_ERR_CODE_WEBRTC_UNSUPPORTED,"window or navigator error");if("chrome"===lT.browserDetails.browser&&hT.getBrowserVersion()<67)throw new Eu(ou.RTC_ERR_CODE_WEBRTC_UNSUPPORTED,"browser not support: ".concat(navigator.userAgent));if(!("WebSocket"in window))throw new Eu(ou.RTC_ERR_CODE_WEBRTC_UNSUPPORTED,"WebSocket error");if(!window.RTCPeerConnection)throw new Eu(ou.RTC_ERR_CODE_WEBRTC_UNSUPPORTED,"RTCPeerConnection Object not exist");try{(new RTCPeerConnection).close()}catch(tb){throw new Eu(ou.RTC_ERR_CODE_WEBRTC_UNSUPPORTED,"RTCPeerConnection construct error: ".concat(tb.message))}if(!("mediaDevices"in navigator))throw new Eu(ou.RTC_ERR_CODE_MEDIA_UPSTREAM_UNSUPPORTED,"navigator.mediaDevices is not supported");return!Hg.isMobileWeChatBrowser()||!e||await hT.checkwWeChatSupported()}static async checkwWeChatSupported(){let e=[".*(iphone|ipad).*OSs1[4-9]_.*MicroMessenger.*",".*huawei.*(TBS|XWEB).*MicroMessenger.*",".*honor.*(TBS|XWEB).*MicroMessenger.*"];if(localStorage){const r=JSON.parse(localStorage.getItem("supportDeviceWhiteList")||"{}");var t;if(Hg.getCurrentTimestamp()-parseInt(r.expire||"0")<=3e4)e=r.rules;else null===(t=localStorage)||void 0===t||t.removeItem("supportDeviceWhiteList")}if(hT.checkSupportByRegexRules(e))return!0;try{const e=await aR.fetch($v,{},{"Cache-Control":"no-cache"},2e3);if(e.data){var r;const t=e.data;if(t.expire=Hg.getCurrentTimestamp(),null===(r=localStorage)||void 0===r||r.setItem("supportDeviceWhiteList",JSON.stringify(t)),hT.checkSupportByRegexRules(t.rules))return!0}else{var i;null===(i=localStorage)||void 0===i||i.removeItem("supportDeviceWhiteList")}throw new Error("browser not support")}catch(tb){throw new Eu(ou.RTC_ERR_CODE_WEBRTC_UNSUPPORTED,"browser not support: ".concat(navigator.userAgent))}}static checkSupportByRegexRules(e){const t=navigator.userAgent;let r=!1;for(const i of e){if(new RegExp(i,"ig").test(t)){r=!0;break}}return r}static isRTCScreenShareSupported(){return"mediaDevices"in navigator&&"getDisplayMedia"in navigator.mediaDevices}static isChrome(){return"chrome"===lT.browserDetails.browser}static isFirefox(){return"firefox"===lT.browserDetails.browser}static getBrowserVersion(){if("safari"===lT.browserDetails.browser){const e=/.*Version\/(\d+).*/gi.exec(navigator.userAgent);if(e&&2===e.length)return parseInt(e[1])}return"chrome"===lT.browserDetails.browser?lT.browserDetails.version||91:lT.browserDetails.version}static isOnlySupportUnfiedPlan(){let e=!0;if("chrome"===lT.browserDetails.browser){e=hT.getBrowserVersion()>90}else"safari"===lT.browserDetails.browser&&(e=lT.browserDetails.supportsUnifiedPlan);return e}}const fT="player-state-change",pT="screen-sharing-stopped",mT="audio-mixing-finished",_T="audio-mixing-played",gT="player-state-trace",ST=["camera-capture"],vT={CameraCapture:ST[0]};var RT;!function(e){e[e.encode=0]="encode",e[e.decode=1]="decode",e[e.codec=2]="codec"}(RT||(RT={}));const TT={low:{sampleRate:16e3,channelCount:1,bitrate:24e3},standard:{sampleRate:48e3,channelCount:1,bitrate:4e4},high:{sampleRate:48e3,channelCount:1,bitrate:128e3}},IT=["low","standard","high"],yT={"90p_1":{width:160,height:90,frameRate:15,minBitrate:64e3,maxBitrate:11e4},"90p_2":{width:120,height:90,frameRate:15,minBitrate:64e3,maxBitrate:11e4},"120p_1":{width:160,height:120,frameRate:15,minBitrate:64e3,maxBitrate:12e4},"120p_2":{width:120,height:120,frameRate:15,minBitrate:64e3,maxBitrate:11e4},"180p_1":{width:320,height:180,frameRate:15,minBitrate:8e4,maxBitrate:32e4},"180p_2":{width:240,height:180,frameRate:15,minBitrate:8e4,maxBitrate:17e4},"180p_3":{width:180,height:180,frameRate:15,minBitrate:64e3,maxBitrate:13e4},"240p_1":{width:320,height:240,frameRate:15,minBitrate:1e5,maxBitrate:4e5},"240p_2":{width:240,height:240,frameRate:15,minBitrate:8e4,maxBitrate:32e4},"270p_1":{width:480,height:270,frameRate:15,minBitrate:16e4,maxBitrate:6e5},"300p_1":{width:400,height:300,frameRate:15,minBitrate:2e5,maxBitrate:5e5},"360p_1":{width:640,height:360,frameRate:15,minBitrate:2e5,maxBitrate:8e5},"360p_2":{width:480,height:360,frameRate:15,minBitrate:2e5,maxBitrate:7e5},"360p_3":{width:360,height:360,frameRate:15,minBitrate:15e4,maxBitrate:6e5},"450p_1":{width:800,height:450,frameRate:15,minBitrate:3e5,maxBitrate:95e4},"480p_1":{width:640,height:480,frameRate:15,minBitrate:25e4,maxBitrate:9e5},"480p_2":{width:480,height:480,frameRate:15,minBitrate:2e5,maxBitrate:8e5},"540p_1":{width:960,height:540,frameRate:15,minBitrate:4e5,maxBitrate:1e6},"630p_1":{width:1120,height:630,frameRate:15,minBitrate:45e4,maxBitrate:115e4},"720p_1":{width:1280,height:720,frameRate:15,minBitrate:5e5,maxBitrate:15e5},"720p_2":{width:960,height:720,frameRate:15,minBitrate:45e4,maxBitrate:11e5},"1080p_1":{width:1920,height:1080,frameRate:15,minBitrate:6e5,maxBitrate:2e6},"1080p_2":{width:1440,height:1080,frameRate:15,minBitrate:55e4,maxBitrate:17e5}},ET=["90p_1","90p_2","120p_1","120p_2","180p_1","180p_2","180p_3","240p_1","240p_2","270p_1","300p_1","360p_1","360p_2","360p_3","450p_1","480p_1","480p_2","540p_1","630p_1","720p_1","720p_2","1080p_1","1080p_2"],bT={"720p":{width:1280,height:720,frameRate:15,bitrate:12e5},"1080p":{width:1920,height:1080,frameRate:15,bitrate:2e6}},CT=["720p","1080p"],AT={InboundRTPAudio:"".concat(hT.isFirefox()?"inbound-rtp-audio":"RTCInboundRTPAudioStream"),InboundRTPVideo:"".concat(hT.isFirefox()?"inbound-rtp-video":"RTCInboundRTPVideoStream"),OutboundRTPAudio:"".concat(hT.isFirefox()?"outbound-rtp-audio":"RTCOutboundRTPAudioStream"),OutboundRTPVideo:"".concat(hT.isFirefox()?"outbound-rtp-video":"RTCOutboundRTPVideoStream"),RemoteInboundRtpAudio:"".concat(hT.isFirefox()?"remote-inbound-rtp-audio":"RTCRemoteInboundRtpAudioStream"),RemoteInboundRtpVideo:"".concat(hT.isFirefox()?"remote-inbound-rtp-video":"RTCRemoteInboundRtpVideoStream")};var kT,wT,OT,PT,MT,DT,xT,NT;!function(e){e[e.IDLE=0]="IDLE",e[e.INIT=1]="INIT",e[e.PLAY=2]="PLAY",e[e.PAUSE=3]="PAUSE"}(kT||(kT={})),function(e){e[e.NET_OR_SERVERIP_ERROR=1]="NET_OR_SERVERIP_ERROR",e[e.ROOM_NOT_AVAILABLE=2]="ROOM_NOT_AVAILABLE",e[e.SERVER_ERROR=3]="SERVER_ERROR",e[e.SERVER_NO_RESPONSE=4]="SERVER_NO_RESPONSE",e[e.AUTHENTICATION_FAILED=5]="AUTHENTICATION_FAILED",e[e.RETRY_AUTHENTICATION=6]="RETRY_AUTHENTICATION",e[e.SYNCHRONIZE_FAILED=7]="SYNCHRONIZE_FAILED",e[e.TERMINAL_ERROR=8]="TERMINAL_ERROR",e[e.PARAM_INVALID=9]="PARAM_INVALID"}(wT||(wT={})),function(e){e[e.LEAVE_ROOM_SUCCESS=0]="LEAVE_ROOM_SUCCESS",e[e.LEAVE_ROOM_ERROR=1]="LEAVE_ROOM_ERROR"}(OT||(OT={})),function(e){e[e.ACTION_START=0]="ACTION_START",e[e.ACTION_STOP=1]="ACTION_STOP"}(PT||(PT={})),function(e){e[e.RESULT_SUCCESS=0]="RESULT_SUCCESS",e[e.RESULT_ERROR=1]="RESULT_ERROR"}(MT||(MT={})),function(e){e[e.OUTPUT_AUDIO=0]="OUTPUT_AUDIO",e[e.INPUT_AUDIO=1]="INPUT_AUDIO",e[e.INPUT_VIDEO=2]="INPUT_VIDEO"}(DT||(DT={})),function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.AUX=2]="AUX"}(xT||(xT={})),function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAIL=1]="FAIL"}(NT||(NT={}));const UT=0,LT=1;var VT,BT,YT,FT,jT,zT,HT,KT,WT;!function(e){e[e.EVENT_JOIN_ROOM=1]="EVENT_JOIN_ROOM",e[e.EVENT_LEAVE_ROOM=2]="EVENT_LEAVE_ROOM",e[e.EVENT_WATCH=3]="EVENT_WATCH",e[e.EVENT_OPT_AUDIO=5]="EVENT_OPT_AUDIO",e[e.EVENT_SWITCH_NET=6]="EVENT_SWITCH_NET",e[e.EVENT_OPT_VIDEO=7]="EVENT_OPT_VIDEO",e[e.EVENT_SWITCH_DEVICE=9]="EVENT_SWITCH_DEVICE",e[e.EVENT_DNS_TIME=10]="EVENT_DNS_TIME",e[e.EVENT_SWITCH_ROLE=11]="EVENT_SWITCH_ROLE",e[e.EVENT_SEND_MEDIA=12]="EVENT_SEND_MEDIA",e[e.EVENT_START_MEDIA=13]="EVENT_START_MEDIA",e[e.EVENT_SEND_AUX_STREAM=14]="EVENT_SEND_AUX_STREAM",e[e.EVENT_SUBSCIBE=16]="EVENT_SUBSCIBE",e[e.EVENT_CONNECT_OTHER_ROOM=17]="EVENT_CONNECT_OTHER_ROOM",e[e.EVENT_CONNECTION_CHANNEL_STATUS=18]="EVENT_CONNECTION_CHANNEL_STATUS",e[e.EVENT_SET_UP_STREAM=19]="EVENT_SET_UP_STREAM",e[e.EVENT_SET_AUDIO_POLICY=20]="EVENT_SET_AUDIO_POLICY"}(VT||(VT={})),function(e){e[e.QoS_UP_STREAM_VIDEO=1001]="QoS_UP_STREAM_VIDEO",e[e.QoS_DOWN_STREAM_VIDEO=1002]="QoS_DOWN_STREAM_VIDEO",e[e.QoS_UP_STREAM_AUDIO=1003]="QoS_UP_STREAM_AUDIO",e[e.QoS_DOWN_STREAM_AUDIO=1004]="QoS_DOWN_STREAM_AUDIO",e[e.QoS_AUX_UP_STREAM_VIDEO=1005]="QoS_AUX_UP_STREAM_VIDEO",e[e.QoS_AUX_DOWN_STREAM_VIDEO=1006]="QoS_AUX_DOWN_STREAM_VIDEO",e[e.QoS_DOWN_STREAM_AUDIO_STAT=1007]="QoS_DOWN_STREAM_AUDIO_STAT",e[e.QoS_UP_STREAM_VIDEO_SUM=1011]="QoS_UP_STREAM_VIDEO_SUM",e[e.QoS_DOWN_STREAM_VIDEO_SUM=1012]="QoS_DOWN_STREAM_VIDEO_SUM",e[e.QoS_UP_STREAM_AUDIO_SUM=1013]="QoS_UP_STREAM_AUDIO_SUM",e[e.QoS_DOWN_STREAM_AUDIO_SUM=1014]="QoS_DOWN_STREAM_AUDIO_SUM"}(BT||(BT={})),function(e){e[e.DEVICE_RT_SYSTEM=2001]="DEVICE_RT_SYSTEM",e[e.DEVICE_RT_CAMERA=2002]="DEVICE_RT_CAMERA",e[e.DEVICE_RT_SPEAKER=2003]="DEVICE_RT_SPEAKER",e[e.DEVICE_RT_MICROPHONE=2004]="DEVICE_RT_MICROPHONE"}(YT||(YT={})),function(e){e[e.DEVICE_STATUS_SPEAKER=3001]="DEVICE_STATUS_SPEAKER",e[e.DEVICE_STATUS_CAMERA=3002]="DEVICE_STATUS_CAMERA",e[e.DEVICE_STATUS_MICROPHONE=3003]="DEVICE_STATUS_MICROPHONE",e[e.DEVICE_STATUS_DEVICE_CHANGE=3004]="DEVICE_STATUS_DEVICE_CHANGE",e[e.DEVICE_STATUS_ERROR=3005]="DEVICE_STATUS_ERROR",e[e.DEVICE_STATUS_MEDIA_QUALITY=3006]="DEVICE_STATUS_MEDIA_QUALITY",e[e.DEVICE_STATUS_USERAGENT=3007]="DEVICE_STATUS_USERAGENT"}(FT||(FT={})),function(e){e[e.SIGNAL_REQUEST=401]="SIGNAL_REQUEST",e[e.SIGNAL_RESPONSE=402]="SIGNAL_RESPONSE"}(jT||(jT={})),function(e){e[e.API_CALL=501]="API_CALL",e[e.CALLBACK_API=502]="CALLBACK_API"}(zT||(zT={})),function(e){e[e.FirstFrame=606]="FirstFrame"}(HT||(HT={})),function(e){e[e.TraceNuwa=2998]="TraceNuwa"}(KT||(KT={})),function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAIL=1]="FAIL"}(WT||(WT={}));const GT=["watch","batch_watch","cancel_watch"];async function JT(){return new Promise(((e,t)=>{navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices||t(new Eu(ou.RTC_ERR_CODE_NOT_SUPPORT_MEDIA_DEVICES)),navigator.mediaDevices.enumerateDevices().then((r=>{r&&0!==r.length?e(r):t(new Eu(ou.RTC_ERR_CODE_NO_AVAILABLE_DEVICES))})).catch((e=>{t(e)}))}))}var qT={exports:{}};!function(e,t){e.exports=function(){var e=function(e){return"object"==typeof e?null!==e:"function"==typeof e},t=Object.freeze({__proto__:null,default:e,__moduleExports:e}),r=t&&e||t,i=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e},n=Object.freeze({__proto__:null,default:i,__moduleExports:i}),s=Math.ceil,o=Math.floor,a=function(e){return isNaN(e=+e)?0:(e>0?o:s)(e)},c=Object.freeze({__proto__:null,default:a,__moduleExports:a}),u=c&&a||c,d=Math.min,l=function(e){return e>0?d(u(e),9007199254740991):0},h=Object.freeze({__proto__:null,default:l,__moduleExports:l}),f=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e},p=Object.freeze({__proto__:null,default:f,__moduleExports:f}),m=p&&f||p,_=function(e){return function(t,r){var i,n,s=String(m(t)),o=u(r),a=s.length;return o<0||o>=a?e?"":void 0:(i=s.charCodeAt(o))<55296||i>56319||o+1===a||(n=s.charCodeAt(o+1))<56320||n>57343?e?s.charAt(o):i:e?s.slice(o,o+2):n-56320+(i-55296<<10)+65536}},g=Object.freeze({__proto__:null,default:_,__moduleExports:_}),S=g&&_||g,v=S(!0),R=function(e,t,r){return t+(r?v(e,t).length:1)},T=Object.freeze({__proto__:null,default:R,__moduleExports:R}),I={}.toString,y=function(e){return I.call(e).slice(8,-1)},E=Object.freeze({__proto__:null,default:y,__moduleExports:y});function b(e,t){return e(t={exports:{}},t.exports),t.exports}var C=b((function(e){var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)})),A=C.version,k=Object.freeze({__proto__:null,default:C,__moduleExports:C,version:A}),w=b((function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)})),O=Object.freeze({__proto__:null,default:w,__moduleExports:w}),P=!1,M=Object.freeze({__proto__:null,default:P,__moduleExports:P}),D=k&&C||k,x=O&&w||O,N=M&&P||M,U=b((function(e){var t="__core-js_shared__",r=x[t]||(x[t]={});(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:D.version,mode:N?"pure":"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})})),L=Object.freeze({__proto__:null,default:U,__moduleExports:U}),V=0,B=Math.random(),Y=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++V+B).toString(36))},F=Object.freeze({__proto__:null,default:Y,__moduleExports:Y}),j=L&&U||L,z=F&&Y||F,H=b((function(e){var t=j("wks"),r=x.Symbol,i="function"==typeof r;(e.exports=function(e){return t[e]||(t[e]=i&&r[e]||(i?r:z)("Symbol."+e))}).store=t})),K=Object.freeze({__proto__:null,default:H,__moduleExports:H}),W=E&&y||E,G=K&&H||K,J=G("toStringTag"),q="Arguments"==W(function(){return arguments}()),X=function(e,t){try{return e[t]}catch(r){}},Q=function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=X(t=Object(e),J))?r:q?W(t):"Object"==(i=W(t))&&"function"==typeof t.callee?"Arguments":i},Z=Object.freeze({__proto__:null,default:Q,__moduleExports:Q}),$=Z&&Q||Z,ee=RegExp.prototype.exec,te=function(e,t){var r=e.exec;if("function"==typeof r){var i=r.call(e,t);if("object"!=typeof i)throw new TypeError("RegExp exec method returned something other than an Object or null");return i}if("RegExp"!==$(e))throw new TypeError("RegExp#exec called on incompatible receiver");return ee.call(e,t)},re=Object.freeze({__proto__:null,default:te,__moduleExports:te}),ie=n&&i||n,ne=function(){var e=ie(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},se=Object.freeze({__proto__:null,default:ne,__moduleExports:ne}),oe=se&&ne||se,ae=RegExp.prototype.exec,ce=String.prototype.replace,ue=ae,de="lastIndex",le=function(){var e=/a/,t=/b*/g;return ae.call(e,"a"),ae.call(t,"a"),0!==e[de]||0!==t[de]}(),he=void 0!==/()??/.exec("")[1];(le||he)&&(ue=function(e){var t,r,i,n,s=this;return he&&(r=new RegExp("^"+s.source+"$(?!\\s)",oe.call(s))),le&&(t=s[de]),i=ae.call(s,e),le&&i&&(s[de]=s.global?i.index+i[0].length:t),he&&i&&i.length>1&&ce.call(i[0],r,(function(){for(n=1;n<arguments.length-2;n++)void 0===arguments[n]&&(i[n]=void 0)})),i});var fe=ue,pe=Object.freeze({__proto__:null,default:fe,__moduleExports:fe}),me=function(e){try{return!!e()}catch(t){return!0}},_e=Object.freeze({__proto__:null,default:me,__moduleExports:me}),ge=_e&&me||_e,Se=!ge((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),ve=Object.freeze({__proto__:null,default:Se,__moduleExports:Se}),Re=x.document,Te=r(Re)&&r(Re.createElement),Ie=function(e){return Te?Re.createElement(e):{}},ye=Object.freeze({__proto__:null,default:Ie,__moduleExports:Ie}),Ee=ve&&Se||ve,be=ye&&Ie||ye,Ce=!Ee&&!ge((function(){return 7!=Object.defineProperty(be("div"),"a",{get:function(){return 7}}).a})),Ae=Object.freeze({__proto__:null,default:Ce,__moduleExports:Ce}),ke=function(e,t){if(!r(e))return e;var i,n;if(t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;if("function"==typeof(i=e.valueOf)&&!r(n=i.call(e)))return n;if(!t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;throw TypeError("Can't convert object to primitive value")},we=Object.freeze({__proto__:null,default:ke,__moduleExports:ke}),Oe=Ae&&Ce||Ae,Pe=we&&ke||we,Me=Object.defineProperty,De=Ee?Object.defineProperty:function(e,t,r){if(ie(e),t=Pe(t,!0),ie(r),Oe)try{return Me(e,t,r)}catch(i){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e},xe={f:De},Ne=Object.freeze({__proto__:null,default:xe,__moduleExports:xe,f:De}),Ue=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Le=Object.freeze({__proto__:null,default:Ue,__moduleExports:Ue}),Ve=Ne&&xe||Ne,Be=Le&&Ue||Le,Ye=Ee?function(e,t,r){return Ve.f(e,t,Be(1,r))}:function(e,t,r){return e[t]=r,e},Fe=Object.freeze({__proto__:null,default:Ye,__moduleExports:Ye}),je={}.hasOwnProperty,ze=function(e,t){return je.call(e,t)},He=Object.freeze({__proto__:null,default:ze,__moduleExports:ze}),Ke=j("native-function-to-string",Function.toString),We=Object.freeze({__proto__:null,default:Ke,__moduleExports:Ke}),Ge=Fe&&Ye||Fe,Je=He&&ze||He,qe=We&&Ke||We,Xe=b((function(e){var t=z("src"),r="toString",i=(""+qe).split(r);D.inspectSource=function(e){return qe.call(e)},(e.exports=function(e,r,n,s){var o="function"==typeof n;o&&(Je(n,"name")||Ge(n,"name",r)),e[r]!==n&&(o&&(Je(n,t)||Ge(n,t,e[r]?""+e[r]:i.join(String(r)))),e===x?e[r]=n:s?e[r]?e[r]=n:Ge(e,r,n):(delete e[r],Ge(e,r,n)))})(Function.prototype,r,(function(){return"function"==typeof this&&this[t]||qe.call(this)}))})),Qe=Object.freeze({__proto__:null,default:Xe,__moduleExports:Xe}),Ze=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},$e=Object.freeze({__proto__:null,default:Ze,__moduleExports:Ze}),et=$e&&Ze||$e,tt=function(e,t,r){if(et(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,i){return e.call(t,r,i)};case 3:return function(r,i,n){return e.call(t,r,i,n)}}return function(){return e.apply(t,arguments)}},rt=Object.freeze({__proto__:null,default:tt,__moduleExports:tt}),it=Qe&&Xe||Qe,nt=rt&&tt||rt,st="prototype",ot=function(e,t,r){var i,n,s,o,a=e&ot.F,c=e&ot.G,u=e&ot.S,d=e&ot.P,l=e&ot.B,h=c?x:u?x[t]||(x[t]={}):(x[t]||{})[st],f=c?D:D[t]||(D[t]={}),p=f[st]||(f[st]={});for(i in c&&(r=t),r)s=((n=!a&&h&&void 0!==h[i])?h:r)[i],o=l&&n?nt(s,x):d&&"function"==typeof s?nt(Function.call,s):s,h&&it(h,i,s,e&ot.U),f[i]!=s&&Ge(f,i,o),d&&p[i]!=s&&(p[i]=s)};x.core=D,ot.F=1,ot.G=2,ot.S=4,ot.P=8,ot.B=16,ot.W=32,ot.U=64,ot.R=128;var at=ot,ct=Object.freeze({__proto__:null,default:at,__moduleExports:at}),ut=pe&&fe||pe,dt=ct&&at||ct;dt({target:"RegExp",proto:!0,forced:ut!==/./.exec},{exec:ut});var lt=G("species"),ht=!ge((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),ft=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2===r.length&&"a"===r[0]&&"b"===r[1]}(),pt=function(e,t,r){var i=G(e),n=!ge((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),s=n?!ge((function(){var t=!1,r=/a/;return r.exec=function(){return t=!0,null},"split"===e&&(r.constructor={},r.constructor[lt]=function(){return r}),r[i](""),!t})):void 0;if(!n||!s||"replace"===e&&!ht||"split"===e&&!ft){var o=/./[i],a=r(m,i,""[e],(function(e,t,r,i,s){return t.exec===ut?n&&!s?{done:!0,value:o.call(t,r,i)}:{done:!0,value:e.call(r,t,i)}:{done:!1}})),c=a[0],u=a[1];it(String.prototype,e,c),Ge(RegExp.prototype,i,2==t?function(e,t){return u.call(e,this,t)}:function(e){return u.call(e,this)})}},mt=Object.freeze({__proto__:null,default:pt,__moduleExports:pt}),_t=h&&l||h,gt=T&&R||T,St=re&&te||re,vt=mt&&pt||mt;vt("match",1,(function(e,t,r,i){return[function(r){var i=e(this),n=null==r?void 0:r[t];return void 0!==n?n.call(r,i):new RegExp(r)[t](String(i))},function(e){var t=i(r,e,this);if(t.done)return t.value;var n=ie(e),s=String(this);if(!n.global)return St(n,s);var o=n.unicode;n.lastIndex=0;for(var a,c=[],u=0;null!==(a=St(n,s));){var d=String(a[0]);c[u]=d,""===d&&(n.lastIndex=gt(s,_t(n.lastIndex),o)),u++}return 0===u?null:c}]}));var Rt=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==W(e)?e.split(""):Object(e)},Tt=Object.freeze({__proto__:null,default:Rt,__moduleExports:Rt}),It=Tt&&Rt||Tt,yt=function(e){return It(m(e))},Et=Object.freeze({__proto__:null,default:yt,__moduleExports:yt}),bt=Math.max,Ct=Math.min,At=function(e,t){return(e=u(e))<0?bt(e+t,0):Ct(e,t)},kt=Object.freeze({__proto__:null,default:At,__moduleExports:At}),wt=Et&&yt||Et,Ot=kt&&At||kt,Pt=function(e){return function(t,r,i){var n,s=wt(t),o=_t(s.length),a=Ot(i,o);if(e&&r!=r){for(;o>a;)if((n=s[a++])!=n)return!0}else for(;o>a;a++)if((e||a in s)&&s[a]===r)return e||a||0;return!e&&-1}},Mt=Object.freeze({__proto__:null,default:Pt,__moduleExports:Pt}),Dt=function(e,t){return!!e&&ge((function(){t?e.call(null,(function(){}),1):e.call(null)}))},xt=Object.freeze({__proto__:null,default:Dt,__moduleExports:Dt}),Nt=Mt&&Pt||Mt,Ut=xt&&Dt||xt,Lt=Nt(!1),Vt=[].indexOf,Bt=!!Vt&&1/[1].indexOf(1,-0)<0;dt(dt.P+dt.F*(Bt||!Ut(Vt)),"Array",{indexOf:function(e){return Bt?Vt.apply(this,arguments)||0:Lt(this,e,arguments[1])}});var Yt={}.propertyIsEnumerable,Ft={f:Yt},jt=Object.freeze({__proto__:null,default:Ft,__moduleExports:Ft,f:Yt}),zt=jt&&Ft||jt,Ht=Object.getOwnPropertyDescriptor,Kt=Ee?Ht:function(e,t){if(e=wt(e),t=Pe(t,!0),Oe)try{return Ht(e,t)}catch(r){}if(Je(e,t))return Be(!zt.f.call(e,t),e[t])},Wt={f:Kt},Gt=Object.freeze({__proto__:null,default:Wt,__moduleExports:Wt,f:Kt}),Jt=Gt&&Wt||Gt,qt=function(e,t){if(ie(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")},Xt={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=nt(Function.call,Jt.f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(i){t=!0}return function(e,i){return qt(e,i),t?e.__proto__=i:r(e,i),e}}({},!1):void 0),check:qt},Qt=Xt.set,Zt=Xt.check,$t=Object.freeze({__proto__:null,default:Xt,__moduleExports:Xt,set:Qt,check:Zt}),er=($t&&Xt||$t).set,tr=function(e,t,i){var n,s=t.constructor;return s!==i&&"function"==typeof s&&(n=s.prototype)!==i.prototype&&r(n)&&er&&er(e,n),e},rr=Object.freeze({__proto__:null,default:tr,__moduleExports:tr}),ir=j("keys"),nr=function(e){return ir[e]||(ir[e]=z(e))},sr=Object.freeze({__proto__:null,default:nr,__moduleExports:nr}),or=sr&&nr||sr,ar=Nt(!1),cr=or("IE_PROTO"),ur=function(e,t){var r,i=wt(e),n=0,s=[];for(r in i)r!=cr&&Je(i,r)&&s.push(r);for(;t.length>n;)Je(i,r=t[n++])&&(~ar(s,r)||s.push(r));return s},dr=Object.freeze({__proto__:null,default:ur,__moduleExports:ur}),lr="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),hr=Object.freeze({__proto__:null,default:lr,__moduleExports:lr}),fr=dr&&ur||dr,pr=hr&&lr||hr,mr=pr.concat("length","prototype"),_r=Object.getOwnPropertyNames||function(e){return fr(e,mr)},gr={f:_r},Sr=Object.freeze({__proto__:null,default:gr,__moduleExports:gr,f:_r}),vr="\t\n\v\f\r Â áá ââââââââââââ¯âã\u2028\u2029\ufeff",Rr=Object.freeze({__proto__:null,default:vr,__moduleExports:vr}),Tr=Rr&&vr||Rr,Ir="["+Tr+"]",yr="âÂ",Er=RegExp("^"+Ir+Ir+"*"),br=RegExp(Ir+Ir+"*$"),Cr=function(e,t,r){var i={},n=ge((function(){return!!Tr[e]()||yr[e]()!=yr})),s=i[e]=n?t(Ar):Tr[e];r&&(i[r]=s),dt(dt.P+dt.F*n,"String",i)},Ar=Cr.trim=function(e,t){return e=String(m(e)),1&t&&(e=e.replace(Er,"")),2&t&&(e=e.replace(br,"")),e},kr=Cr,wr=Object.freeze({__proto__:null,default:kr,__moduleExports:kr}),Or=Object.keys||function(e){return fr(e,pr)},Pr=Object.freeze({__proto__:null,default:Or,__moduleExports:Or}),Mr=Pr&&Or||Pr,Dr=Ee?Object.defineProperties:function(e,t){ie(e);for(var r,i=Mr(t),n=i.length,s=0;n>s;)Ve.f(e,r=i[s++],t[r]);return e},xr=Object.freeze({__proto__:null,default:Dr,__moduleExports:Dr}),Nr=x.document,Ur=Nr&&Nr.documentElement,Lr=Object.freeze({__proto__:null,default:Ur,__moduleExports:Ur}),Vr=xr&&Dr||xr,Br=Lr&&Ur||Lr,Yr=or("IE_PROTO"),Fr=function(){},jr="prototype",zr=function(){var e,t=be("iframe"),r=pr.length,i="<",n=">";for(t.style.display="none",Br.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write(i+"script"+n+"document.F=Object"+i+"/script"+n),e.close(),zr=e.F;r--;)delete zr[jr][pr[r]];return zr()},Hr=Object.create||function(e,t){var r;return null!==e?(Fr[jr]=ie(e),r=new Fr,Fr[jr]=null,r[Yr]=e):r=zr(),void 0===t?r:Vr(r,t)},Kr=Object.freeze({__proto__:null,default:Hr,__moduleExports:Hr}),Wr=rr&&tr||rr,Gr=Sr&&gr||Sr,Jr=wr&&kr||wr,qr=Kr&&Hr||Kr,Xr=Gr.f,Qr=Jt.f,Zr=Ve.f,$r=Jr.trim,ei="Number",ti=x[ei],ri=ti,ii=ti.prototype,ni=W(qr(ii))==ei,si="trim"in String.prototype,oi=function(e){var t=Pe(e,!1);if("string"==typeof t&&t.length>2){var r,i,n,s=(t=si?t.trim():$r(t,3)).charCodeAt(0);if(43===s||45===s){if(88===(r=t.charCodeAt(2))||120===r)return NaN}else if(48===s){switch(t.charCodeAt(1)){case 66:case 98:i=2,n=49;break;case 79:case 111:i=8,n=55;break;default:return+t}for(var o,a=t.slice(2),c=0,u=a.length;c<u;c++)if((o=a.charCodeAt(c))<48||o>n)return NaN;return parseInt(a,i)}}return+t};if(!ti(" 0o1")||!ti("0b1")||ti("+0x1")){ti=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof ti&&(ni?ge((function(){ii.valueOf.call(r)})):W(r)!=ei)?Wr(new ri(oi(t)),r,ti):oi(t)};for(var ai,ci=Ee?Xr(ri):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),ui=0;ci.length>ui;ui++)Je(ri,ai=ci[ui])&&!Je(ti,ai)&&Zr(ti,ai,Qr(ri,ai));ti.prototype=ii,ii.constructor=ti,it(x,ei,ti)}var di=G("match"),li=function(e){var t;return r(e)&&(void 0!==(t=e[di])?!!t:"RegExp"==W(e))},hi=Object.freeze({__proto__:null,default:li,__moduleExports:li}),fi=G("species"),pi=function(e,t){var r,i=ie(e).constructor;return void 0===i||null==(r=ie(i)[fi])?t:et(r)},mi=Object.freeze({__proto__:null,default:pi,__moduleExports:pi}),_i=hi&&li||hi,gi=mi&&pi||mi,Si=Math.min,vi=[].push,Ri="split",Ti="length",Ii="lastIndex",yi=4294967295,Ei=!ge((function(){}));vt("split",2,(function(e,t,r,i){var n;return n="c"=="abbc"[Ri](/(b)*/)[1]||4!="test"[Ri](/(?:)/,-1)[Ti]||2!="ab"[Ri](/(?:ab)*/)[Ti]||4!="."[Ri](/(.?)(.?)/)[Ti]||"."[Ri](/()()/)[Ti]>1||""[Ri](/.?/)[Ti]?function(e,t){var i=String(this);if(void 0===e&&0===t)return[];if(!_i(e))return r.call(i,e,t);for(var n,s,o,a=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),u=0,d=void 0===t?yi:t>>>0,l=new RegExp(e.source,c+"g");(n=ut.call(l,i))&&!((s=l[Ii])>u&&(a.push(i.slice(u,n.index)),n[Ti]>1&&n.index<i[Ti]&&vi.apply(a,n.slice(1)),o=n[0][Ti],u=s,a[Ti]>=d));)l[Ii]===n.index&&l[Ii]++;return u===i[Ti]?!o&&l.test("")||a.push(""):a.push(i.slice(u)),a[Ti]>d?a.slice(0,d):a}:"0"[Ri](void 0,0)[Ti]?function(e,t){return void 0===e&&0===t?[]:r.call(this,e,t)}:r,[function(r,i){var s=e(this),o=null==r?void 0:r[t];return void 0!==o?o.call(r,s,i):n.call(String(s),r,i)},function(e,t){var s=i(n,e,this,t,n!==r);if(s.done)return s.value;var o=ie(e),a=String(this),c=gi(o,RegExp),u=o.unicode,d=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(Ei?"y":"g"),l=new c(Ei?o:"^(?:"+o.source+")",d),h=void 0===t?yi:t>>>0;if(0===h)return[];if(0===a.length)return null===St(l,a)?[a]:[];for(var f=0,p=0,m=[];p<a.length;){l.lastIndex=Ei?p:0;var _,g=St(l,Ei?a:a.slice(p));if(null===g||(_=Si(_t(l.lastIndex+(Ei?0:p)),a.length))===f)p=gt(a,p,u);else{if(m.push(a.slice(f,p)),m.length===h)return m;for(var S=1;S<=g.length-1;S++)if(m.push(g[S]),m.length===h)return m;p=f=_}}return m.push(a.slice(f)),m}]}));var bi=function(e){return Object(m(e))},Ci=Object.freeze({__proto__:null,default:bi,__moduleExports:bi}),Ai=function(e,t){var r=(D.Object||{})[e]||Object[e],i={};i[e]=t(r),dt(dt.S+dt.F*ge((function(){r(1)})),"Object",i)},ki=Object.freeze({__proto__:null,default:Ai,__moduleExports:Ai}),wi=Ci&&bi||Ci;(ki&&Ai||ki)("keys",(function(){return function(e){return Mr(wi(e))}}));var Oi={};Oi[G("toStringTag")]="z",Oi+""!="[object z]"&&it(Object.prototype,"toString",(function(){return"[object "+$(this)+"]"}),!0);var Pi=Object.getOwnPropertySymbols,Mi={f:Pi},Di=Object.freeze({__proto__:null,default:Mi,__moduleExports:Mi,f:Pi}),xi=Di&&Mi||Di,Ni=Object.assign,Ui=!Ni||ge((function(){var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach((function(e){t[e]=e})),7!=Ni({},e)[r]||Object.keys(Ni({},t)).join("")!=i}))?function(e,t){for(var r=wi(e),i=arguments.length,n=1,s=xi.f,o=zt.f;i>n;)for(var a,c=It(arguments[n++]),u=s?Mr(c).concat(s(c)):Mr(c),d=u.length,l=0;d>l;)a=u[l++],Ee&&!o.call(c,a)||(r[a]=c[a]);return r}:Ni,Li=Object.freeze({__proto__:null,default:Ui,__moduleExports:Ui}),Vi=Li&&Ui||Li;dt(dt.S+dt.F,"Object",{assign:Vi});var Bi=G("species"),Yi=function(e){var t=x[e];Ee&&t&&!t[Bi]&&Ve.f(t,Bi,{configurable:!0,get:function(){return this}})},Fi=Object.freeze({__proto__:null,default:Yi,__moduleExports:Yi}),ji=Fi&&Yi||Fi,zi=Ve.f,Hi=Gr.f,Ki=x.RegExp,Wi=Ki,Gi=Ki.prototype,Ji=/a/g,qi=/a/g,Xi=new Ki(Ji)!==Ji;if(Ee&&(!Xi||ge((function(){return qi[G("match")]=!1,Ki(Ji)!=Ji||Ki(qi)==qi||"/a/i"!=Ki(Ji,"i")})))){Ki=function(e,t){var r=this instanceof Ki,i=_i(e),n=void 0===t;return!r&&i&&e.constructor===Ki&&n?e:Wr(Xi?new Wi(i&&!n?e.source:e,t):Wi((i=e instanceof Ki)?e.source:e,i&&n?oe.call(e):t),r?this:Gi,Ki)};for(var Qi=function(e){e in Ki||zi(Ki,e,{configurable:!0,get:function(){return Wi[e]},set:function(t){Wi[e]=t}})},Zi=Hi(Wi),$i=0;Zi.length>$i;)Qi(Zi[$i++]);Gi.constructor=Ki,Ki.prototype=Gi,it(x,"RegExp",Ki)}ji("RegExp");var en=Math.max,tn=Math.min,rn=Math.floor,nn=/\$([$&`']|\d\d?|<[^>]*>)/g,sn=/\$([$&`']|\d\d?)/g,on=function(e){return void 0===e?e:String(e)};vt("replace",2,(function(e,t,r,i){return[function(i,n){var s=e(this),o=null==i?void 0:i[t];return void 0!==o?o.call(i,s,n):r.call(String(s),i,n)},function(e,t){var s=i(r,e,this,t);if(s.done)return s.value;var o=ie(e),a=String(this),c="function"==typeof t;c||(t=String(t));var d=o.global;if(d){var l=o.unicode;o.lastIndex=0}for(var h=[];;){var f=St(o,a);if(null===f)break;if(h.push(f),!d)break;""===String(f[0])&&(o.lastIndex=gt(a,_t(o.lastIndex),l))}for(var p="",m=0,_=0;_<h.length;_++){f=h[_];for(var g=String(f[0]),S=en(tn(u(f.index),a.length),0),v=[],R=1;R<f.length;R++)v.push(on(f[R]));var T=f.groups;if(c){var I=[g].concat(v,S,a);void 0!==T&&I.push(T);var y=String(t.apply(void 0,I))}else y=n(g,a,S,v,T,t);S>=m&&(p+=a.slice(m,S)+y,m=S+g.length)}return p+a.slice(m)}];function n(e,t,i,n,s,o){var a=i+e.length,c=n.length,u=sn;return void 0!==s&&(s=wi(s),u=nn),r.call(o,u,(function(r,o){var u;switch(o.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,i);case"'":return t.slice(a);case"<":u=s[o.slice(1,-1)];break;default:var d=+o;if(0===d)return r;if(d>c){var l=rn(d/10);return 0===l?r:l<=c?void 0===n[l-1]?o.charAt(1):n[l-1]+o.charAt(1):r}u=n[d-1]}return void 0===u?"":u}))}}));var an=Date.prototype,cn="Invalid Date",un="toString",dn=an[un],ln=an.getTime;new Date(NaN)+""!=cn&&it(an,un,(function(){var e=ln.call(this);return e==e?dn.call(this):cn})),Ee&&"g"!=/./g.flags&&Ve.f(RegExp.prototype,"flags",{configurable:!0,get:oe});var hn="toString",fn=/./[hn],pn=function(e){it(RegExp.prototype,hn,e,!0)};ge((function(){return"/a/b"!=fn.call({source:"a",flags:"b"})}))?pn((function(){var e=ie(this);return"/".concat(e.source,"/","flags"in e?e.flags:!Ee&&e instanceof RegExp?oe.call(e):void 0)})):fn.name!=hn&&pn((function(){return fn.call(this)}));for(var mn,_n=z("typed_array"),gn=z("view"),Sn=!(!x.ArrayBuffer||!x.DataView),vn=Sn,Rn=0,Tn=9,In="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");Rn<Tn;)(mn=x[In[Rn++]])?(Ge(mn.prototype,_n,!0),Ge(mn.prototype,gn,!0)):vn=!1;var yn={ABV:Sn,CONSTR:vn,TYPED:_n,VIEW:gn},En=yn.ABV,bn=yn.CONSTR,Cn=yn.TYPED,An=yn.VIEW,kn=Object.freeze({__proto__:null,default:yn,__moduleExports:yn,ABV:En,CONSTR:bn,TYPED:Cn,VIEW:An}),wn=function(e,t,r){for(var i in t)it(e,i,t[i],r);return e},On=Object.freeze({__proto__:null,default:wn,__moduleExports:wn}),Pn=function(e,t,r,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(r+": incorrect invocation!");return e},Mn=Object.freeze({__proto__:null,default:Pn,__moduleExports:Pn}),Dn=function(e){if(void 0===e)return 0;var t=u(e),r=_t(t);if(t!==r)throw RangeError("Wrong length!");return r},xn=Object.freeze({__proto__:null,default:Dn,__moduleExports:Dn}),Nn=function(e){for(var t=wi(this),r=_t(t.length),i=arguments.length,n=Ot(i>1?arguments[1]:void 0,r),s=i>2?arguments[2]:void 0,o=void 0===s?r:Ot(s,r);o>n;)t[n++]=e;return t},Un=Object.freeze({__proto__:null,default:Nn,__moduleExports:Nn}),Ln=Ve.f,Vn=G("toStringTag"),Bn=function(e,t,r){e&&!Je(e=r?e:e.prototype,Vn)&&Ln(e,Vn,{configurable:!0,value:t})},Yn=Object.freeze({__proto__:null,default:Bn,__moduleExports:Bn}),Fn=kn&&yn||kn,jn=On&&wn||On,zn=Mn&&Pn||Mn,Hn=xn&&Dn||xn,Kn=Un&&Nn||Un,Wn=Yn&&Bn||Yn,Gn=b((function(e,t){var r=Gr.f,i=Ve.f,n="ArrayBuffer",s="DataView",o="prototype",a="Wrong length!",c="Wrong index!",d=x[n],l=x[s],h=x.Math,f=x.RangeError,p=x.Infinity,m=d,_=h.abs,g=h.pow,S=h.floor,v=h.log,R=h.LN2,T="buffer",I="byteLength",y="byteOffset",E=Ee?"_b":T,b=Ee?"_l":I,C=Ee?"_o":y;function A(e,t,r){var i,n,s,o=new Array(r),a=8*r-t-1,c=(1<<a)-1,u=c>>1,d=23===t?g(2,-24)-g(2,-77):0,l=0,h=e<0||0===e&&1/e<0?1:0;for((e=_(e))!=e||e===p?(n=e!=e?1:0,i=c):(i=S(v(e)/R),e*(s=g(2,-i))<1&&(i--,s*=2),(e+=i+u>=1?d/s:d*g(2,1-u))*s>=2&&(i++,s/=2),i+u>=c?(n=0,i=c):i+u>=1?(n=(e*s-1)*g(2,t),i+=u):(n=e*g(2,u-1)*g(2,t),i=0));t>=8;o[l++]=255&n,n/=256,t-=8);for(i=i<<t|n,a+=t;a>0;o[l++]=255&i,i/=256,a-=8);return o[--l]|=128*h,o}function k(e,t,r){var i,n=8*r-t-1,s=(1<<n)-1,o=s>>1,a=n-7,c=r-1,u=e[c--],d=127&u;for(u>>=7;a>0;d=256*d+e[c],c--,a-=8);for(i=d&(1<<-a)-1,d>>=-a,a+=t;a>0;i=256*i+e[c],c--,a-=8);if(0===d)d=1-o;else{if(d===s)return i?NaN:u?-p:p;i+=g(2,t),d-=o}return(u?-1:1)*i*g(2,d-t)}function w(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function O(e){return[255&e]}function P(e){return[255&e,e>>8&255]}function M(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function D(e){return A(e,52,8)}function U(e){return A(e,23,4)}function L(e,t,r){i(e[o],t,{get:function(){return this[r]}})}function V(e,t,r,i){var n=Hn(+r);if(n+t>e[b])throw f(c);var s=e[E]._b,o=n+e[C],a=s.slice(o,o+t);return i?a:a.reverse()}function B(e,t,r,i,n,s){var o=Hn(+r);if(o+t>e[b])throw f(c);for(var a=e[E]._b,u=o+e[C],d=i(+n),l=0;l<t;l++)a[u+l]=d[s?l:t-l-1]}if(Fn.ABV){if(!ge((function(){d(1)}))||!ge((function(){new d(-1)}))||ge((function(){return new d,new d(1.5),new d(NaN),d.name!=n}))){for(var Y,F=(d=function(e){return zn(this,d),new m(Hn(e))})[o]=m[o],j=r(m),z=0;j.length>z;)(Y=j[z++])in d||Ge(d,Y,m[Y]);N||(F.constructor=d)}var H=new l(new d(2)),K=l[o].setInt8;H.setInt8(0,2147483648),H.setInt8(1,2147483649),!H.getInt8(0)&&H.getInt8(1)||jn(l[o],{setInt8:function(e,t){K.call(this,e,t<<24>>24)},setUint8:function(e,t){K.call(this,e,t<<24>>24)}},!0)}else d=function(e){zn(this,d,n);var t=Hn(e);this._b=Kn.call(new Array(t),0),this[b]=t},l=function(e,t,r){zn(this,l,s),zn(e,d,s);var i=e[b],n=u(t);if(n<0||n>i)throw f("Wrong offset!");if(n+(r=void 0===r?i-n:_t(r))>i)throw f(a);this[E]=e,this[C]=n,this[b]=r},Ee&&(L(d,I,"_l"),L(l,T,"_b"),L(l,I,"_l"),L(l,y,"_o")),jn(l[o],{getInt8:function(e){return V(this,1,e)[0]<<24>>24},getUint8:function(e){return V(this,1,e)[0]},getInt16:function(e){var t=V(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=V(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return w(V(this,4,e,arguments[1]))},getUint32:function(e){return w(V(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return k(V(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return k(V(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){B(this,1,e,O,t)},setUint8:function(e,t){B(this,1,e,O,t)},setInt16:function(e,t){B(this,2,e,P,t,arguments[2])},setUint16:function(e,t){B(this,2,e,P,t,arguments[2])},setInt32:function(e,t){B(this,4,e,M,t,arguments[2])},setUint32:function(e,t){B(this,4,e,M,t,arguments[2])},setFloat32:function(e,t){B(this,4,e,U,t,arguments[2])},setFloat64:function(e,t){B(this,8,e,D,t,arguments[2])}});Wn(d,n),Wn(l,s),Ge(l[o],Fn.VIEW,!0),t[n]=d,t[s]=l})),Jn=Object.freeze({__proto__:null,default:Gn,__moduleExports:Gn}),qn={},Xn=Object.freeze({__proto__:null,default:qn,__moduleExports:qn}),Qn=Xn&&qn||Xn,Zn=G("iterator"),$n=Array.prototype,es=function(e){return void 0!==e&&(Qn.Array===e||$n[Zn]===e)},ts=Object.freeze({__proto__:null,default:es,__moduleExports:es}),rs=or("IE_PROTO"),is=Object.prototype,ns=Object.getPrototypeOf||function(e){return e=wi(e),Je(e,rs)?e[rs]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?is:null},ss=Object.freeze({__proto__:null,default:ns,__moduleExports:ns}),os=G("iterator"),as=D.getIteratorMethod=function(e){if(null!=e)return e[os]||e["@@iterator"]||Qn[$(e)]},cs=Object.freeze({__proto__:null,default:as,__moduleExports:as}),us=Array.isArray||function(e){return"Array"==W(e)},ds=Object.freeze({__proto__:null,default:us,__moduleExports:us}),ls=ds&&us||ds,hs=G("species"),fs=function(e){var t;return ls(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!ls(t.prototype)||(t=void 0),r(t)&&null===(t=t[hs])&&(t=void 0)),void 0===t?Array:t},ps=Object.freeze({__proto__:null,default:fs,__moduleExports:fs}),ms=ps&&fs||ps,_s=function(e,t){return new(ms(e))(t)},gs=Object.freeze({__proto__:null,default:_s,__moduleExports:_s}),Ss=gs&&_s||gs,vs=function(e,t){var r=1==e,i=2==e,n=3==e,s=4==e,o=6==e,a=5==e||o,c=t||Ss;return function(t,u,d){for(var l,h,f=wi(t),p=It(f),m=nt(u,d,3),_=_t(p.length),g=0,S=r?c(t,_):i?c(t,0):void 0;_>g;g++)if((a||g in p)&&(h=m(l=p[g],g,f),e))if(r)S[g]=h;else if(h)switch(e){case 3:return!0;case 5:return l;case 6:return g;case 2:S.push(l)}else if(s)return!1;return o?-1:n||s?s:S}},Rs=Object.freeze({__proto__:null,default:vs,__moduleExports:vs}),Ts=G("unscopables"),Is=Array.prototype;null==Is[Ts]&&Ge(Is,Ts,{});var ys=function(e){Is[Ts][e]=!0},Es=Object.freeze({__proto__:null,default:ys,__moduleExports:ys}),bs=function(e,t){return{value:t,done:!!e}},Cs=Object.freeze({__proto__:null,default:bs,__moduleExports:bs}),As={};Ge(As,G("iterator"),(function(){return this}));var ks=function(e,t,r){e.prototype=qr(As,{next:Be(1,r)}),Wn(e,t+" Iterator")},ws=Object.freeze({__proto__:null,default:ks,__moduleExports:ks}),Os=ws&&ks||ws,Ps=ss&&ns||ss,Ms=G("iterator"),Ds=!([].keys&&"next"in[].keys()),xs="@@iterator",Ns="keys",Us="values",Ls=function(){return this},Vs=function(e,t,r,i,n,s,o){Os(r,t,i);var a,c,u,d=function(e){if(!Ds&&e in p)return p[e];switch(e){case Ns:case Us:return function(){return new r(this,e)}}return function(){return new r(this,e)}},l=t+" Iterator",h=n==Us,f=!1,p=e.prototype,m=p[Ms]||p[xs]||n&&p[n],_=m||d(n),g=n?h?d("entries"):_:void 0,S="Array"==t&&p.entries||m;if(S&&(u=Ps(S.call(new e)))!==Object.prototype&&u.next&&(Wn(u,l,!0),N||"function"==typeof u[Ms]||Ge(u,Ms,Ls)),h&&m&&m.name!==Us&&(f=!0,_=function(){return m.call(this)}),N&&!o||!Ds&&!f&&p[Ms]||Ge(p,Ms,_),Qn[t]=_,Qn[l]=Ls,n)if(a={values:h?_:d(Us),keys:s?_:d(Ns),entries:g},o)for(c in a)c in p||it(p,c,a[c]);else dt(dt.P+dt.F*(Ds||f),t,a);return a},Bs=Object.freeze({__proto__:null,default:Vs,__moduleExports:Vs}),Ys=Es&&ys||Es,Fs=Cs&&bs||Cs,js=Bs&&Vs||Bs,zs=js(Array,"Array",(function(e,t){this._t=wt(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,Fs(1)):Fs(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])}),"values");Qn.Arguments=Qn.Array,Ys("keys"),Ys("values"),Ys("entries");var Hs=G("iterator"),Ks=!1;try{var Ws=[7][Hs]();Ws.return=function(){Ks=!0},Array.from(Ws,(function(){throw 2}))}catch(Eu){}var Gs=function(e,t){if(!t&&!Ks)return!1;var r=!1;try{var i=[7],n=i[Hs]();n.next=function(){return{done:r=!0}},i[Hs]=function(){return n},e(i)}catch(Eu){}return r},Js=Object.freeze({__proto__:null,default:Gs,__moduleExports:Gs}),qs=[].copyWithin||function(e,t){var r=wi(this),i=_t(r.length),n=Ot(e,i),s=Ot(t,i),o=arguments.length>2?arguments[2]:void 0,a=Math.min((void 0===o?i:Ot(o,i))-s,i-n),c=1;for(s<n&&n<s+a&&(c=-1,s+=a-1,n+=a-1);a-- >0;)s in r?r[n]=r[s]:delete r[n],n+=c,s+=c;return r},Xs=Object.freeze({__proto__:null,default:qs,__moduleExports:qs}),Qs=Jn&&Gn||Jn,Zs=ts&&es||ts,$s=cs&&as||cs,eo=Rs&&vs||Rs,to=Js&&Gs||Js,ro=Xs&&qs||Xs,io=b((function(e){if(Ee){var t=N,i=x,n=ge,s=dt,o=Fn,a=Qs,c=nt,d=zn,l=Be,h=Ge,f=jn,p=u,m=_t,_=Hn,g=Ot,S=Pe,v=Je,R=$,T=r,I=wi,y=Zs,E=qr,b=Ps,C=Gr.f,A=$s,k=z,w=G,O=eo,P=Nt,M=gi,D=zs,U=Qn,L=to,V=ji,B=Kn,Y=ro,F=Ve,j=Jt,H=F.f,K=j.f,W=i.RangeError,J=i.TypeError,q=i.Uint8Array,X="ArrayBuffer",Q="Shared"+X,Z="BYTES_PER_ELEMENT",ee="prototype",te=Array[ee],re=a.ArrayBuffer,ie=a.DataView,ne=O(0),se=O(2),oe=O(3),ae=O(4),ce=O(5),ue=O(6),de=P(!0),le=P(!1),he=D.values,fe=D.keys,pe=D.entries,me=te.lastIndexOf,_e=te.reduce,Se=te.reduceRight,ve=te.join,Re=te.sort,Te=te.slice,Ie=te.toString,ye=te.toLocaleString,be=w("iterator"),Ce=w("toStringTag"),Ae=k("typed_constructor"),ke=k("def_constructor"),we=o.CONSTR,Oe=o.TYPED,Me=o.VIEW,De="Wrong length!",xe=O(1,(function(e,t){return Fe(M(e,e[ke]),t)})),Ne=n((function(){return 1===new q(new Uint16Array([1]).buffer)[0]})),Ue=!!q&&!!q[ee].set&&n((function(){new q(1).set({})})),Le=function(e,t){var r=p(e);if(r<0||r%t)throw W("Wrong offset!");return r},Ye=function(e){if(T(e)&&Oe in e)return e;throw J(e+" is not a typed array!")},Fe=function(e,t){if(!T(e)||!(Ae in e))throw J("It is not a typed array constructor!");return new e(t)},je=function(e,t){return ze(M(e,e[ke]),t)},ze=function(e,t){for(var r=0,i=t.length,n=Fe(e,i);i>r;)n[r]=t[r++];return n},He=function(e,t,r){H(e,t,{get:function(){return this._d[r]}})},Ke=function(e){var t,r,i,n,s,o,a=I(e),u=arguments.length,d=u>1?arguments[1]:void 0,l=void 0!==d,h=A(a);if(null!=h&&!y(h)){for(o=h.call(a),i=[],t=0;!(s=o.next()).done;t++)i.push(s.value);a=i}for(l&&u>2&&(d=c(d,arguments[2],2)),t=0,r=m(a.length),n=Fe(this,r);r>t;t++)n[t]=l?d(a[t],t):a[t];return n},We=function(){for(var e=0,t=arguments.length,r=Fe(this,t);t>e;)r[e]=arguments[e++];return r},qe=!!q&&n((function(){ye.call(new q(1))})),Xe=function(){return ye.apply(qe?Te.call(Ye(this)):Ye(this),arguments)},Qe={copyWithin:function(e,t){return Y.call(Ye(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return ae(Ye(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return B.apply(Ye(this),arguments)},filter:function(e){return je(this,se(Ye(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return ce(Ye(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ue(Ye(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){ne(Ye(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return le(Ye(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return de(Ye(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return ve.apply(Ye(this),arguments)},lastIndexOf:function(e){return me.apply(Ye(this),arguments)},map:function(e){return xe(Ye(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return _e.apply(Ye(this),arguments)},reduceRight:function(e){return Se.apply(Ye(this),arguments)},reverse:function(){for(var e,t=this,r=Ye(t).length,i=Math.floor(r/2),n=0;n<i;)e=t[n],t[n++]=t[--r],t[r]=e;return t},some:function(e){return oe(Ye(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return Re.call(Ye(this),e)},subarray:function(e,t){var r=Ye(this),i=r.length,n=g(e,i);return new(M(r,r[ke]))(r.buffer,r.byteOffset+n*r.BYTES_PER_ELEMENT,m((void 0===t?i:g(t,i))-n))}},Ze=function(e,t){return je(this,Te.call(Ye(this),e,t))},$e=function(e){Ye(this);var t=Le(arguments[1],1),r=this.length,i=I(e),n=m(i.length),s=0;if(n+t>r)throw W(De);for(;s<n;)this[t+s]=i[s++]},et={entries:function(){return pe.call(Ye(this))},keys:function(){return fe.call(Ye(this))},values:function(){return he.call(Ye(this))}},tt=function(e,t){return T(e)&&e[Oe]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},rt=function(e,t){return tt(e,t=S(t,!0))?l(2,e[t]):K(e,t)},it=function(e,t,r){return!(tt(e,t=S(t,!0))&&T(r)&&v(r,"value"))||v(r,"get")||v(r,"set")||r.configurable||v(r,"writable")&&!r.writable||v(r,"enumerable")&&!r.enumerable?H(e,t,r):(e[t]=r.value,e)};we||(j.f=rt,F.f=it),s(s.S+s.F*!we,"Object",{getOwnPropertyDescriptor:rt,defineProperty:it}),n((function(){Ie.call({})}))&&(Ie=ye=function(){return ve.call(this)});var st=f({},Qe);f(st,et),h(st,be,et.values),f(st,{slice:Ze,set:$e,constructor:function(){},toString:Ie,toLocaleString:Xe}),He(st,"buffer","b"),He(st,"byteOffset","o"),He(st,"byteLength","l"),He(st,"length","e"),H(st,Ce,{get:function(){return this[Oe]}}),e.exports=function(e,r,a,c){var u=e+((c=!!c)?"Clamped":"")+"Array",l="get"+e,f="set"+e,p=i[u],g=p||{},S=p&&b(p),v=!p||!o.ABV,I={},y=p&&p[ee],A=function(e,t){var i=e._d;return i.v[l](t*r+i.o,Ne)},k=function(e,t,i){var n=e._d;c&&(i=(i=Math.round(i))<0?0:i>255?255:255&i),n.v[f](t*r+n.o,i,Ne)},w=function(e,t){H(e,t,{get:function(){return A(this,t)},set:function(e){return k(this,t,e)},enumerable:!0})};v?(p=a((function(e,t,i,n){d(e,p,u,"_d");var s,o,a,c,l=0,f=0;if(T(t)){if(!(t instanceof re||(c=R(t))==X||c==Q))return Oe in t?ze(p,t):Ke.call(p,t);s=t,f=Le(i,r);var g=t.byteLength;if(void 0===n){if(g%r)throw W(De);if((o=g-f)<0)throw W(De)}else if((o=m(n)*r)+f>g)throw W(De);a=o/r}else a=_(t),s=new re(o=a*r);for(h(e,"_d",{b:s,o:f,l:o,e:a,v:new ie(s)});l<a;)w(e,l++)})),y=p[ee]=E(st),h(y,"constructor",p)):n((function(){p(1)}))&&n((function(){new p(-1)}))&&L((function(e){new p,new p(null),new p(1.5),new p(e)}),!0)||(p=a((function(e,t,i,n){var s;return d(e,p,u),T(t)?t instanceof re||(s=R(t))==X||s==Q?void 0!==n?new g(t,Le(i,r),n):void 0!==i?new g(t,Le(i,r)):new g(t):Oe in t?ze(p,t):Ke.call(p,t):new g(_(t))})),ne(S!==Function.prototype?C(g).concat(C(S)):C(g),(function(e){e in p||h(p,e,g[e])})),p[ee]=y,t||(y.constructor=p));var O=y[be],P=!!O&&("values"==O.name||null==O.name),M=et.values;h(p,Ae,!0),h(y,Oe,u),h(y,Me,!0),h(y,ke,p),(c?new p(1)[Ce]==u:Ce in y)||H(y,Ce,{get:function(){return u}}),I[u]=p,s(s.G+s.W+s.F*(p!=g),I),s(s.S,u,{BYTES_PER_ELEMENT:r}),s(s.S+s.F*n((function(){g.of.call(p,1)})),u,{from:Ke,of:We}),Z in y||h(y,Z,r),s(s.P,u,Qe),V(u),s(s.P+s.F*Ue,u,{set:$e}),s(s.P+s.F*!P,u,et),t||y.toString==Ie||(y.toString=Ie),s(s.P+s.F*n((function(){new p(1).slice()})),u,{slice:Ze}),s(s.P+s.F*(n((function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()}))||!n((function(){y.toLocaleString.call([1,2])}))),u,{toLocaleString:Xe}),U[u]=P?O:M,t||P||h(y,be,M)}}else e.exports=function(){}})),no=Object.freeze({__proto__:null,default:io,__moduleExports:io});(no&&io||no)("Uint8",1,(function(e){return function(t,r,i){return e(this,t,r,i)}}));var so=b((function(e){var t=z("meta"),i=Ve.f,n=0,s=Object.isExtensible||function(){return!0},o=!ge((function(){return s(Object.preventExtensions({}))})),a=function(e){i(e,t,{value:{i:"O"+ ++n,w:{}}})},c=function(e,i){if(!r(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Je(e,t)){if(!s(e))return"F";if(!i)return"E";a(e)}return e[t].i},u=function(e,r){if(!Je(e,t)){if(!s(e))return!0;if(!r)return!1;a(e)}return e[t].w},d=function(e){return o&&l.NEED&&s(e)&&!Je(e,t)&&a(e),e},l=e.exports={KEY:t,NEED:!1,fastKey:c,getWeak:u,onFreeze:d}})),oo=so.KEY,ao=so.NEED,co=so.fastKey,uo=so.getWeak,lo=so.onFreeze,ho=Object.freeze({__proto__:null,default:so,__moduleExports:so,KEY:oo,NEED:ao,fastKey:co,getWeak:uo,onFreeze:lo}),fo=G,po={f:fo},mo=Object.freeze({__proto__:null,default:po,__moduleExports:po,f:fo}),_o=mo&&po||mo,go=Ve.f,So=function(e){var t=D.Symbol||(D.Symbol=N?{}:x.Symbol||{});"_"==e.charAt(0)||e in t||go(t,e,{value:_o.f(e)})},vo=Object.freeze({__proto__:null,default:So,__moduleExports:So}),Ro=function(e){var t=Mr(e),r=xi.f;if(r)for(var i,n=r(e),s=zt.f,o=0;n.length>o;)s.call(e,i=n[o++])&&t.push(i);return t},To=Object.freeze({__proto__:null,default:Ro,__moduleExports:Ro}),Io=Gr.f,yo={}.toString,Eo="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],bo=function(e){try{return Io(e)}catch(Eu){return Eo.slice()}},Co=function(e){return Eo&&"[object Window]"==yo.call(e)?bo(e):Io(wt(e))},Ao={f:Co},ko=Object.freeze({__proto__:null,default:Ao,__moduleExports:Ao,f:Co}),wo=vo&&So||vo,Oo=To&&Ro||To,Po=ko&&Ao||ko,Mo=(ho&&so||ho).KEY,Do=Jt.f,xo=Ve.f,No=Po.f,Uo=x.Symbol,Lo=x.JSON,Vo=Lo&&Lo.stringify,Bo="prototype",Yo=G("_hidden"),Fo=G("toPrimitive"),jo={}.propertyIsEnumerable,zo=j("symbol-registry"),Ho=j("symbols"),Ko=j("op-symbols"),Wo=Object[Bo],Go="function"==typeof Uo&&!!xi.f,Jo=x.QObject,qo=!Jo||!Jo[Bo]||!Jo[Bo].findChild,Xo=Ee&&ge((function(){return 7!=qr(xo({},"a",{get:function(){return xo(this,"a",{value:7}).a}})).a}))?function(e,t,r){var i=Do(Wo,t);i&&delete Wo[t],xo(e,t,r),i&&e!==Wo&&xo(Wo,t,i)}:xo,Qo=function(e){var t=Ho[e]=qr(Uo[Bo]);return t._k=e,t},Zo=Go&&"symbol"==typeof Uo.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof Uo},$o=function(e,t,r){return e===Wo&&$o(Ko,t,r),ie(e),t=Pe(t,!0),ie(r),Je(Ho,t)?(r.enumerable?(Je(e,Yo)&&e[Yo][t]&&(e[Yo][t]=!1),r=qr(r,{enumerable:Be(0,!1)})):(Je(e,Yo)||xo(e,Yo,Be(1,{})),e[Yo][t]=!0),Xo(e,t,r)):xo(e,t,r)},ea=function(e,t){ie(e);for(var r,i=Oo(t=wt(t)),n=0,s=i.length;s>n;)$o(e,r=i[n++],t[r]);return e},ta=function(e,t){return void 0===t?qr(e):ea(qr(e),t)},ra=function(e){var t=jo.call(this,e=Pe(e,!0));return!(this===Wo&&Je(Ho,e)&&!Je(Ko,e))&&(!(t||!Je(this,e)||!Je(Ho,e)||Je(this,Yo)&&this[Yo][e])||t)},ia=function(e,t){if(e=wt(e),t=Pe(t,!0),e!==Wo||!Je(Ho,t)||Je(Ko,t)){var r=Do(e,t);return!r||!Je(Ho,t)||Je(e,Yo)&&e[Yo][t]||(r.enumerable=!0),r}},na=function(e){for(var t,r=No(wt(e)),i=[],n=0;r.length>n;)Je(Ho,t=r[n++])||t==Yo||t==Mo||i.push(t);return i},sa=function(e){for(var t,r=e===Wo,i=No(r?Ko:wt(e)),n=[],s=0;i.length>s;)!Je(Ho,t=i[s++])||r&&!Je(Wo,t)||n.push(Ho[t]);return n};Go||(Uo=function(){if(this instanceof Uo)throw TypeError("Symbol is not a constructor!");var e=z(arguments.length>0?arguments[0]:void 0),t=function(r){this===Wo&&t.call(Ko,r),Je(this,Yo)&&Je(this[Yo],e)&&(this[Yo][e]=!1),Xo(this,e,Be(1,r))};return Ee&&qo&&Xo(Wo,e,{configurable:!0,set:t}),Qo(e)},it(Uo[Bo],"toString",(function(){return this._k})),Jt.f=ia,Ve.f=$o,Gr.f=Po.f=na,zt.f=ra,xi.f=sa,Ee&&!N&&it(Wo,"propertyIsEnumerable",ra,!0),_o.f=function(e){return Qo(G(e))}),dt(dt.G+dt.W+dt.F*!Go,{Symbol:Uo});for(var oa="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),aa=0;oa.length>aa;)G(oa[aa++]);for(var ca=Mr(G.store),ua=0;ca.length>ua;)wo(ca[ua++]);dt(dt.S+dt.F*!Go,"Symbol",{for:function(e){return Je(zo,e+="")?zo[e]:zo[e]=Uo(e)},keyFor:function(e){if(!Zo(e))throw TypeError(e+" is not a symbol!");for(var t in zo)if(zo[t]===e)return t},useSetter:function(){qo=!0},useSimple:function(){qo=!1}}),dt(dt.S+dt.F*!Go,"Object",{create:ta,defineProperty:$o,defineProperties:ea,getOwnPropertyDescriptor:ia,getOwnPropertyNames:na,getOwnPropertySymbols:sa});var da=ge((function(){xi.f(1)}));dt(dt.S+dt.F*da,"Object",{getOwnPropertySymbols:function(e){return xi.f(wi(e))}}),Lo&&dt(dt.S+dt.F*(!Go||ge((function(){var e=Uo();return"[null]"!=Vo([e])||"{}"!=Vo({a:e})||"{}"!=Vo(Object(e))}))),"JSON",{stringify:function(e){for(var t,i,n=[e],s=1;arguments.length>s;)n.push(arguments[s++]);if(i=t=n[1],(r(t)||void 0!==e)&&!Zo(e))return ls(t)||(t=function(e,t){if("function"==typeof i&&(t=i.call(this,e,t)),!Zo(t))return t}),n[1]=t,Vo.apply(Lo,n)}}),Uo[Bo][Fo]||Ge(Uo[Bo],Fo,Uo[Bo].valueOf),Wn(Uo,"Symbol"),Wn(Math,"Math",!0),Wn(x.JSON,"JSON",!0);var la=function(e,t,r,i){try{return i?t(ie(r)[0],r[1]):t(r)}catch(Eu){var n=e.return;throw void 0!==n&&ie(n.call(e)),Eu}},ha=Object.freeze({__proto__:null,default:la,__moduleExports:la}),fa=function(e,t,r){t in e?Ve.f(e,t,Be(0,r)):e[t]=r},pa=Object.freeze({__proto__:null,default:fa,__moduleExports:fa}),ma=ha&&la||ha,_a=pa&&fa||pa;dt(dt.S+dt.F*!to((function(e){})),"Array",{from:function(e){var t,r,i,n,s=wi(e),o="function"==typeof this?this:Array,a=arguments.length,c=a>1?arguments[1]:void 0,u=void 0!==c,d=0,l=$s(s);if(u&&(c=nt(c,a>2?arguments[2]:void 0,2)),null==l||o==Array&&Zs(l))for(r=new o(t=_t(s.length));t>d;d++)_a(r,d,u?c(s[d],d):s[d]);else for(n=l.call(s),r=new o;!(i=n.next()).done;d++)_a(r,d,u?ma(n,c,[i.value,d],!0):i.value);return r.length=d,r}});var ga=S(!0);js(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=ga(t,r),this._i+=e.length,{value:e,done:!1})}));for(var Sa=G("iterator"),va=G("toStringTag"),Ra=Qn.Array,Ta={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Ia=Mr(Ta),ya=0;ya<Ia.length;ya++){var Ea,ba=Ia[ya],Ca=Ta[ba],Aa=x[ba],ka=Aa&&Aa.prototype;if(ka&&(ka[Sa]||Ge(ka,Sa,Ra),ka[va]||Ge(ka,va,ba),Qn[ba]=Ra,Ca))for(Ea in zs)ka[Ea]||it(ka,Ea,zs[Ea],!0)}var wa,Oa,Pa="2.1.501",Ma=window.screen.width,Da=window.screen.height,xa=!1,Na=500,Ua=18e5,La="HW_",Va="",Ba=!1,Ya=!1,Fa="baseinfotype",ja="customEvent",za="elementEvent",Ha="clickEvent",Ka=0,Wa="",Ga="",Ja=!0,qa=!1,Xa=0,Qa=document.referrer,Za="",$a="",ec="",tc="",rc=1,ic="",nc="",sc="",oc="",ac=(new Date).getTime(),cc=-1,uc="",dc="",lc={},hc={},fc={},pc={"Content-type":"application/x-www-form-urlencoded;charset=UTF-8"},mc=!0,_c=!0,gc=!1,Sc=["x_hasdk_debug","url","_id","_idts","_idvc","h","m","s"],vc="",Rc=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,Tc={type:(Oa=navigator.userAgent,Oa.match(/AppleWebKit.*Mobile.*/)?-1!==Oa.indexOf(" wv")?2:1:0)};function Ic(){try{document.documentElement.doScroll("left")}catch(tb){return setTimeout(Ic,20)}Ba&&Fc(Bc("baseinfotype"))}function yc(){Ac(),Ka=0,tu(window,"beforeunload",Ec),tu(document,"visibilitychange",bc)}function Ec(){var e,t=(new Date).getTime(),r=t+Na;if(xa&&_c&&Kc(Hc("viewts"),t,31536e6,"/"),bc(),Ya&&Fc(Bc("baseinfotype")),r){var i=0;do{if(e=new Date,++i>1e3)break}while(e.getTime()<r)}}function bc(){if(Ja){var e=(new Date).getTime();Ka+=e-(Xa||ac)}else Xa=(new Date).getTime();Ja=!Ja}function Cc(){Ba&&Fc(Bc("baseinfotype")),document.removeEventListener("DOMContentLoaded",Cc,!1)}function Ac(){!$a&&($a=document.title),Va=location.host}function kc(){xa=!0;var e=Hc("id"),t=zc(e),r=Hc("refts"),i=zc(r);if(_c&&Qa&&!i){var n=(new Date).getTime();Kc(r,n,15552e6,"/"),nc=n}else nc=_c?i:(new Date).getTime();var s=Hc("viewts");sc=zc(s)||(new Date).getTime();var o=Hc("idvc"),a=zc(o)||1;_c&&Kc(o,a?Number(a)-0+1:1,31536e6,"/"),rc=Number(a),cc=0;var c=Hc("idts");if(""!==t&&t)tc=zc(c)||(new Date).getTime(),wa=_c?wa||t:"unknown";else{t=Jc();var u=(new Date).getTime();_c?(Kc(e,t,31536e6,"/"),Kc(c,u,31536e6,"/"),wa&&"unknown"!=wa||(wa=t)):wa="unknown",tc=u}wc()}function wc(){var e=Hc("idn");""!==(ic=zc(e))&&ic||(ic=Jc()),_c&&Kc(e,ic,Ua,"/")}function Oc(e){var t=[];for(var r in e){var i=e[r];if(i.constructor===Array)for(var n in i)t.push(r+"="+i[n]);else t.push(r+"="+i)}return t.join("&")}function Pc(e){for(var t=e.split("&"),r=0;r<t.length;r++)if(t[r].split("=")[0].toLocaleLowerCase()==="token".toLocaleLowerCase()){t.splice(r,1);break}return t.join("&")}function Mc(){return mc?window.location.href:"/"}function Dc(){var e="";if(gc&&(e="x_hasdk_debug=true"),e=e?e+"&idsite="+Ga:"idsite="+Ga,Object.keys(fc).length){var t=Oc(fc);encodeURIComponent(oc).length+1+encodeURIComponent(e).length+1+encodeURIComponent(t).length>2048?console.error("The customUrlParams is too large, reduce the number of customUrlParams!!!"):e=e+"&"+t}return oc+"?"+e}function xc(e){return{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}[Object.prototype.toString.call(e)]}function Nc(e){return"object"==xc(e)}function Uc(e){return"boolean"==xc(e)}function Lc(e){return"number"==xc(e)}function Vc(e){return"string"==xc(e)}function Bc(e){if(""!==Ga){xa||kc(),ac=(new Date).getTime();var t=[],r={url:Pc(Mc()),title:$a,at:ac,rf:Pc(Qa)};if(e===Fa){if(r.res=Ma+" X "+Da,-1!==cc){var i=(new Date).getTime();r.cwt=i,r.dt=Ka}}else e===ja||e===Ha?(r.en=uc,r.el=dc,r.cd=hc):e===za&&(r.ei=lc.elementId===document?"#document":lc.elementId,r.ec=lc.cls,r.ps=lc.position,r.data=void 0===lc.data?"":lc.data,r.cd=hc);t.push(["type",e]),t.push(["vf",wa]),t.push(["rt",(new Date).getTime()]),t.push(["pt",r]),wc();var n={type:t[0][1],vf:t[1][1],rt:t[2][1],ut:Tc.type,cxx:Wa,idsite:Ga,suid:ec,cvar:lc.cvar?lc.cvar:Za,idts:tc,idvc:rc,idn:ic,refts:nc,viewts:sc,hsv:Pa,data:t[3][1]},s={idsite:encodeURIComponent(Ga),rec:"1",r:"886244",h:(new Date).getHours(),m:(new Date).getMinutes(),s:(new Date).getSeconds(),url:encodeURIComponent(Mc()),_id:encodeURIComponent(wa),_idts:tc,_idvc:rc,_idn:ic,urlref:Qa,_refts:nc,_viewts:sc,scd:"24",vpr:Ma+" X "+Da,cvar:encodeURIComponent(lc.cvar?lc.cvar:Za),pdf:"1",qt:"0",data:encodeURIComponent(JSON.stringify(n))};return Oc(Object.assign(Yc(),s))}console.error("idsite is empty")}function Yc(e){var t={};return e===za||e===Ha?t.link=encodeURIComponent($a):t.action_name=encodeURIComponent($a),t}function Fc(e){if(oc){if(e){if(vc)switch(vc){case"beacon":qc(e);break;case"ajax":Qc(e,pc);break;case"img":Xc(e)}else qa?Xc(e):navigator&&navigator.sendBeacon?qc(e):Rc?Qc(e,pc):Xc(e);jc()}}else console.error("serverUrl is empty")}function jc(){lc={},hc={}}function zc(e){if(!e)return 0;var t=new RegExp("(^|;)[ ]*"+e+"=([^;]*)").exec(document.cookie);return t?decodeURIComponent(t[2]):0}function Hc(e){return e&&Ga?(La+e+"_"+Ga+"_"+Va).replace(/\./g,"_"):""}function Kc(e,t,r,i,n,s){var o;e&&(r&&(o=new Date).setTime(o.getTime()+r),document.cookie=e+"="+encodeURIComponent(t)+(r?";expires="+o.toGMTString():"")+";path="+(i||"/")+(n?";domain="+n:"")+(s?";secure":""))}function Wc(e){var t=new Date;t.setTime(t.getTime()-1);var r=zc(e);null!=r&&(document.cookie=e+"="+r+";expires="+t.toUTCString()+";path=/")}function Gc(e){return("0"+e.toString(16)).substr(-2)}function Jc(){var e=new Uint8Array(16);return(window.crypto||window.webkitCrypto||window.mozCrypto||window.oCrypto||window.msCrypto).getRandomValues(e),Array.from(e,Gc).join("")}function qc(e){try{var t=new Blob([e],{type:"application/x-www-form-urlencoded;charset=UTF-8"}),r=Dc();navigator.sendBeacon(r,t)}catch(Eu){Qc(e,pc)}}function Xc(e){var t=new Image(1,1);t.onerror=function(){},t.src=oc+"?"+e}function Qc(e,t){try{if(Rc){var r=new XMLHttpRequest,i=Dc();for(var n in r.open("POST",i,!0),t)r.setRequestHeader(n,t[n]);r.send(e)}else{var s=document.createElement("script");s.type="text/javascript",s.async=!0,s.defer=!0,s.src=oc+"?"+e,document.getElementsByTagName("script")[0].parentNode.appendChild(s)}}catch(Eu){Xc(e)}}function Zc(e,t,r,i){var n=e===document?document:document.getElementById(e);return n&&eu(n,r,e,t,i),this}function $c(e,t,r,i,n){var s=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;lc.elementId=t,lc.cls=r.className,lc.data=e,lc.cvar=n,lc.position={res:i.screenX+"X"+i.screenY,vpr:i.clientX+"X"+i.clientY,doc:o+"X"+s},Fc(Bc(za))}function eu(e,t,r,i,n){function s(i){$c(t,r,e,i,n)}tu(e,i,s)}function tu(e,t,r){e.attachEvent?e.attachEvent("on"+t,r):e.addEventListener(t,r,!1)}function ru(){var e,t,r;for(e=0;e<arguments.length;e+=1){t=(r=arguments[e]).shift();try{"string"==typeof t||t instanceof String?this[t].apply(this,r):this.apply(this,r)}catch(Eu){console.error("Invalid method:"+t+", please check!!!")}}return this}function iu(e,t,r,i){return e&&(uc=e),t&&(dc=t),r&&(hc=r),i&&(lc.cvar=i),Fc(Bc(ja)),this}function nu(e,t,r,i){return e&&(uc=e),t&&(dc=t),r&&(hc=r),i&&(lc.cvar=i),Fc(Bc(Ha)),this}function su(e){return e&&(oc=e),this}function ou(e){return e&&(Za=e),this}function au(e){return e&&($a=e),this}function cu(e){return e&&(wa=e),this}function uu(e){return e&&(ec=e),this}function du(e){return e&&(Wa=e),this}function lu(e){return Uc(e)?(Ba=e,this):(console.error("baseinfotypeSwitch1 type should be boolean."),this)}function hu(e){return Uc(e)?(Ya=e,this):(console.error("baseinfotypeSwitch2 type should be boolean."),this)}function fu(e){return Vc(Ga)?new RegExp("^[a-zA-Z0-9_./][A-Za-z0-9_./]*$").test(e)?(Ga=e,this):(console.error("idsite is invalid."),this):(console.error("idsite type should be string."),this)}function pu(e){return Lc(e)?(Ua=e,this):(console.error("intervalTime type should be number."),this)}function mu(e){return Uc(e)?(qa=e,this):(console.error("isImg type should be boolean."),this)}function _u(){return Ka=0,Ba=!0,Cc(),this}function gu(){return Ya=!0,Ja=!0,Ec(),this}function Su(e){return Nc(e)?(pc=Object.assign(pc,e),this):(console.error("customheader type should be object."),this)}function vu(e){return Uc(e)?(mc=e,this):(console.error("usedPageUrl type should be boolean."),this)}function Ru(e){if(!Uc(e))return console.error("useCookie type should be boolean"),this;if(!(_c=e))for(var t=document.cookie.split("; "),r=/^(HW_)(id|idts|idvc|idn|viewts|refts)_/,i=0;i<t.length;i++){var n=t[i].split("=");r.test(n[0])&&Wc(n[0])}return xa=!1,this}function Tu(e){return Uc(e)?(gc=e,this):(console.error("debugMode type should be boolean"),this)}function Iu(e){if(!Nc(e))return console.error("customUrlParams type should be object"),this;for(var t in e){if(-1!==Sc.indexOf(t))return console.error("customUrlParams can'n include x_hasdk_debug, url, _id, _idts, _idvc, h, m, s"),this;var r=e[t];if(!Lc(r)&&!Vc(r)||!r)return console.error("customUrlParams object value should be number or string"),this;if(!new RegExp("^[a-zA-Z0-9_./][A-Za-z0-9_./]*$").test(t)||!new RegExp("^[a-zA-Z_0-9_./][A-Za-z0-9_./]*$").test(r))return console.error("customUrlParams object include invalid key or value"),this}return fc=e,this}function yu(e){return["beacon","ajax","img"].indexOf(e)>-1&&(vc=e),this}return yc(),window.addEventListener?document.addEventListener("DOMContentLoaded",Cc,!1):window.attachEvent&&Ic(),{push:ru,bindclick:Zc,sendData:iu,sendClickData:nu,setOnReportUrl:su,setTitle:au,setUserAccount:cu,setUid:uu,setCXX:du,setBaseinfotypeSwitch:lu,setWindowCloseSwitch:hu,setSessionTimeoutDuration:pu,setIdsite:fu,setPageData:ou,setReportMethod:mu,sendPageinfo:_u,sendPageClose:gu,setHttpHeader:Su,setIstUseUrl:vu,setIsUseCookie:Ru,setDebugMode:Tu,setCustomUrlParams:Iu,setRequestMode:yu}}()}(qT);var XT=qT.exports;const QT={},ZT={grs_sdk_global_route_config_hwrtc:{applications:[],services:[{name:"com.huawei.cloud.videortn",routeBy:"ser_country>geo_ip",servings:[{countryOrAreaGroup:"DR1",addresses:{GLOBAL:"wss://rtc.platform.dbankcloud.com",ROOT:"wss://rtc-drcn.platform.dbankcloud.com"}},{countryOrAreaGroup:"DR2",addresses:{GLOBAL:"wss://rtc.platform.dbankcloud.com",ROOT:"wss://rtc-dra.platform.dbankcloud.com"}},{countryOrAreaGroup:"DR3",addresses:{GLOBAL:"wss://rtc.platform.dbankcloud.com",ROOT:"wss://rtc-dre.platform.dbankcloud.com"}},{countryOrAreaGroup:"DR4",addresses:{GLOBAL:"wss://rtc.platform.dbankcloud.com",ROOT:"wss://rtc-drru.platform.dbankcloud.com"}}],countryOrAreaGroups:[]}],countryOrAreaGroups:[{id:"DR1",name:"China",countriesOrAreas:["CN"],description:"China zone"},{id:"DR2",name:"Asian-African-Latin American",countriesOrAreas:["AE","AF","AG","AI","AM","AO","AQ","AR","AS","AW","AZ","BB","BD","BF","BH","BI","BJ","BL","BM","BN","BO","BR","BS","BT","BV","BW","BY","BZ","CC","CD","CF","CG","CI","CK","CL","CM","CO","CR","CU","CV","CX","DJ","DM","DO","DZ","EC","EG","EH","ER","ET","FJ","FK","FM","GA","GD","GE","GF","GH","GM","GN","GP","GQ","GS","GT","GU","GW","GY","HK","HM","HN","HT","ID","IN","IO","IQ","JM","JO","JP","KE","KG","KH","KI","KM","KN","KP","KR","KW","KY","KZ","LA","LB","LC","LK","LR","LS","LY","MA","MG","MH","ML","MM","MN","MO","MP","MQ","MR","MS","MU","MV","MW","MX","MY","MZ","NA","NC","NE","NF","NG","NI","NP","NR","NU","OM","PA","PE","PF","PG","PH","PK","PN","PR","PS","PW","PY","QA","RE","RW","SA","SB","SC","SD","SG","SH","SL","SN","SO","SR","SS","ST","SV","SY","SZ","TC","TD","TF","TG","TH","TJ","TK","TL","TM","TN","TO","TT","TV","TW","TZ","UG","UY","UZ","VE","VG","VI","VN","VU","WF","WS","YE","YT","ZA","ZM","ZW"],description:"Asian-African-Latin American zone"},{id:"DR3",name:"Europe",countriesOrAreas:["AD","AL","AN","AT","AU","AX","BA","BE","BG","BQ","CA","CH","CW","CY","CZ","DE","DK","EE","ES","FI","FO","FR","GB","GG","GI","GL","GR","HR","HU","IE","IL","IM","IS","IT","JE","LI","LT","LU","LV","MC","MD","ME","MF","MK","MT","NL","NO","NZ","PL","PM","PT","RO","RS","SE","SI","SJ","SK","SM","SX","TR","UA","UM","US","VA","VC","XK","YK"],description:"Europe zone"},{id:"DR4",name:"Russia",countriesOrAreas:["RU"],description:"Russia zone"},{id:"DR5",name:"A2",countriesOrAreas:["IR"],description:"A2 zone"}]},grs_sdk_global_route_config_rtcha:{applications:[],services:[{name:"com.huawei.cloud.hianalytics",routeBy:"ser_country",servings:[{countryOrAreaGroup:"DR1",addresses:{ROOT:"https://metrics1.data.hicloud.com:6447"}},{countryOrAreaGroup:"DR2",addresses:{ROOT:"https://metrics3.data.hicloud.com:6447"}},{countryOrAreaGroup:"DR3",addresses:{ROOT:"https://metrics2.data.hicloud.com:6447"}},{countryOrAreaGroup:"DR4",addresses:{ROOT:"https://metrics5.data.hicloud.com:6447"}},{countryOrAreaGroup:"DR5",addresses:{ROOT:"https://metrics4.data.hicloud.com:6447"}}],countryOrAreaGroups:[]},{name:"com.huawei.cloud.hianalytics.aspg",routeBy:"ser_country",servings:[{countryOrAreaGroup:"DR1",addresses:{ROOT:"https://metrics1.data.hicloud.com:6447"}},{countryOrAreaGroup:"DR2",addresses:{ROOT:"https://metrics-dra.dt.hicloud.com:6447"}},{countryOrAreaGroup:"DR3",addresses:{ROOT:"https://metrics2.data.hicloud.com:6447"}},{countryOrAreaGroup:"DR4",addresses:{ROOT:"https://metrics5.data.hicloud.com:6447"}},{countryOrAreaGroup:"DR5",addresses:{ROOT:"https://metrics4.data.hicloud.com:6447"}}],countryOrAreaGroups:[]}],countryOrAreaGroups:[{id:"DR1",name:"China",countriesOrAreas:["CN"],description:"China zone"},{id:"DR2",name:"Asian-African-Latin American",countriesOrAreas:["AE","AF","AG","AI","AM","AO","AQ","AR","AS","AW","AZ","BB","BD","BF","BH","BI","BJ","BL","BM","BN","BO","BR","BS","BT","BV","BW","BY","BZ","CC","CD","CF","CG","CI","CK","CL","CM","CO","CR","CU","CV","CX","DJ","DM","DO","DZ","EC","EG","EH","ER","ET","FJ","FK","FM","GA","GD","GE","GF","GH","GM","GN","GP","GQ","GS","GT","GU","GW","GY","HK","HM","HN","HT","ID","IN","IO","IQ","JM","JO","JP","KE","KG","KH","KI","KM","KN","KP","KR","KW","KY","KZ","LA","LB","LC","LK","LR","LS","LY","MA","MG","MH","ML","MM","MN","MO","MP","MQ","MR","MS","MU","MV","MW","MX","MY","MZ","NA","NC","NE","NF","NG","NI","NP","NR","NU","OM","PA","PE","PF","PG","PH","PK","PN","PR","PS","PW","PY","QA","RE","RW","SA","SB","SC","SD","SG","SH","SL","SN","SO","SR","SS","ST","SV","SY","SZ","TC","TD","TF","TG","TH","TJ","TK","TL","TM","TN","TO","TT","TV","TW","TZ","UG","UY","UZ","VE","VG","VI","VN","VU","WF","WS","YE","YT","ZA","ZM","ZW"],description:"Asian-African-Latin American zone"},{id:"DR3",name:"Europe",countriesOrAreas:["AD","AL","AN","AT","AU","AX","BA","BE","BG","BQ","CA","CH","CW","CY","CZ","DE","DK","EE","ES","FI","FO","FR","GB","GG","GI","GL","GR","HR","HU","IE","IL","IM","IS","IT","JE","LI","LT","LU","LV","MC","MD","ME","MF","MK","MT","NL","NO","NZ","PL","PM","PT","RO","RS","SE","SI","SJ","SK","SM","SX","TR","UA","UM","US","VA","VC","XK","YK"],description:"Europe zone"},{id:"DR4",name:"Russia",countriesOrAreas:["RU"],description:"Russia zone"},{id:"DR5",name:"A2",countriesOrAreas:["IR"],description:"A2 zone"}]}},$T="RTCReport";const eI=new class{constructor(){this.logger=Qg.getLogger(),this.regularReport(Jv),XT.push(["setOnReportUrl","".concat(ZT.grs_sdk_global_route_config_rtcha.services[0].servings[0].addresses.ROOT,"/webv4")]),XT.push(["setIdsite","com.huawei.rtcsdk"]),XT.setRequestMode("ajax"),this.records=[],this.tempRecords=[],this.dataUploading=!1,hT.isFirefox()||(window.onbeforeunload=()=>{this.logger.info("stat","window is closing, emergency report"),this.dataUploading?this.tempRecords.length>0&&this.reportRecords(this.tempRecords).then((()=>{this.tempRecords.length=0})):this.records.length>0&&this.reportRecords(this.records).then((()=>{this.records.length=0}))})}setReportServer(e){if(e&&"string"==typeof e){const t=iR.getProxyServer();if(t){const r=e.replace(/http(s)?:\/\//,"");e="".concat(t,"/").concat(r,"/webv4")}else e="".concat(e,"/webv4");XT.push(["setOnReportUrl",e])}}regularReport(e){this.reportInterval&&clearInterval(this.reportInterval),this.reportInterval=setInterval((()=>{0!=this.records.length&&(this.dataUploading=!0,this.reportRecords(this.records).then((()=>{this.clearData(),this.logger.info($T,"regular RTCReport succ!")})).catch((e=>{this.logger.error($T,"regular RTCReport failed! error: ".concat(e))})).finally((()=>{this.dataUploading=!1,this.records=this.records.concat(this.tempRecords),this.tempRecords.length=0})))}),e)}async addRecords(e){this.dataUploading?(this.tempRecords=this.tempRecords.concat(e||[]),this.adjustRecordsLength(this.tempRecords)):(this.records=this.records.concat(e||[]),this.adjustRecordsLength(this.records))}async addRecord(e){this.dataUploading?(this.tempRecords.push(e),this.adjustRecordsLength(this.tempRecords)):(this.records.push(e),this.adjustRecordsLength(this.records))}adjustRecordsLength(e){e.length>1e4&&e.splice(0,e.length-1e4)}clearData(){this.records.length=0}async immediateReportRecords(){let e=[];return this.dataUploading?e=e.concat(this.tempRecords):(e=this.records.concat(this.tempRecords),this.records.length=0),this.tempRecords.length=0,this.reportRecords(e).then((()=>{this.logger.info($T,"immediateReportRecords RTCReport succ!")})).catch((t=>{this.logger.error($T,"immediateReportRecords RTCReport failed! error: ".concat(t)),this.tempRecords=this.tempRecords.concat(e)})).finally((()=>{this.records=this.records.concat(this.tempRecords),this.tempRecords.length=0}))}async reportRecords(e){try{e.forEach((e=>{const t=e.event.toString(),r={rtc_sdk:e};XT.push(["sendData",t,t,r])}))}catch(tb){throw this.logger.error($T,"fetch request failed"),tb}}},tI="statiscEnable",rI="accessResourceType",iI="portType",nI="environmentSuffix",sI="grsLocalExtInfo",oI={accessResourceType:rR.checkAccessResourceType},aI="ParametersUtil";const cI=new class{constructor(){this.logger=Qg.getLogger(),this.parameters=new Map}setParameter(e,t){if(!e)return this.logger.error(aI,"setParameter, parameterKey is null"),!1;try{return this.logger.debug(aI,"setParameter, parameterKey: ".concat(e,", parameterValue: ").concat(t)),oI[e]&&!oI[e](t)?(this.logger.error(aI,"setParameter occur error, parameterValue not valid"),!1):(this.parameters.set(e.toLowerCase(),t),!0)}catch(tb){return this.logger.error(aI,"setParameter occur error: ".concat(tb)),!1}}getParameter(e){try{return e&&this.parameters.has(e.toLowerCase())?this.parameters.get(e.toLowerCase()):null}catch(tb){return this.logger.error(aI,"getParameter occur error: ".concat(tb)),null}}};var uI,dI;!function(e){e.TRACK_TYPE_AUDIO="audio",e.TRACK_TYPE_VIDEO="video"}(uI||(uI={})),function(e){e.STREAM_TYPE_MAIN="main",e.STREAM_TYPE_AUX="aux"}(dI||(dI={}));const lI={"90p-":{width:120,height:90},"90p":{width:160,height:90},"120p":{width:160,height:120},"180p-":{width:240,height:180},"180p":{width:320,height:180},"240p":{width:320,height:240},"270p":{width:480,height:270},"300p":{width:400,height:300},"360p-":{width:480,height:360},"360p":{width:640,height:360},"450p":{width:800,height:450},"480p":{width:640,height:480},"540p":{width:960,height:540},"630p":{width:1120,height:630},"720p-":{width:960,height:720},"720p":{width:1280,height:720},"1080p":{width:1920,height:1080}};class hI{static getResolution(e,t){const r=Math.min(e,t);return r<180?"LD":r<360?"SD":r<720?"HD":"FHD"}static getResolutionType(e,t){return Object.keys(lI).find((r=>lI[r].width===e&&lI[r].height===t))}}class fI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;this.elements=new Array,this._size=e}push(e){return null!=e&&(null==this._size||isNaN(this._size)||this.elements.length===this._size&&this.elements.pop(),this.elements.unshift(e),!0)}size(){return this.elements.length}clear(){delete this.elements,this.elements=new Array}getElement(e){if(e<0||e>=this.size())return null;return this.elements[e]}}const pI=new class{constructor(){bu(this,"isFireFox",hT.isFirefox()),this.reportSymbol=Symbol("RTCInterval_".concat(Hg.getCurrentTimestamp())),this.mapInterval=new fI}getSymbol(){return this.reportSymbol}reset(){delete this.mapInterval,this.mapInterval=new fI,clearTimeout(this.gatherTimer),this.gatherTimer=null}init(e){this.connectionsManager=e,this.execMyInterval((async()=>{await this.execInterval()}),100)}checkKey(e,t){return!!this.isFireFox||!(!/(RTCInboundRTP.*)|(RTCOutboundRTP.*)|(RTCMediaStreamTrack.*)|(RTCRemote.*)/gi.test(e)&&"candidate-pair"!==t.type)}async getConnectionData(e,t){const r=await t.getStats();r&&r.forEach(((t,r)=>{"candidate-pair"===t.type&&e.set(r,t)}))}async getReceiversData(e,t){const r=await t.getStats();r&&r.forEach(((t,r)=>{this.checkKey(r,t)&&e.set(r,t)}))}async getSendersData(e,t){const r=await t.getStats();r&&r.forEach(((t,r)=>{this.checkKey(r,t)&&e.set(r,t)}))}async getMap(e,t){const r=[],i=this.connectionsManager.getConnection(t);if(!i||"function"!=typeof i.getStats)return;r.push(this.getConnectionData(e,i));const n=this.connectionsManager.getReceivers(t);if(n)for(let o=0;o<n.length;o++){const t=n[o];if("function"!=typeof t.getStats)break;r.push(this.getReceiversData(e,t))}const s=this.connectionsManager.getSenders(t);if(s)for(let o=0;o<s.length;o++){const t=s[o];if("function"!=typeof t.getStats)break;r.push(this.getSendersData(e,t))}await Promise.all(r)}async getData(e,t){await this.getMap(e,t)}async execInterval(){const e=new Map,t=new Map;if(this.connectionsManager){const r=new Map,i=new Map,n=[];n.push(this.getData(r,dI.STREAM_TYPE_MAIN)),n.push(this.getData(i,dI.STREAM_TYPE_AUX)),await Promise.all(n),t.set(dI.STREAM_TYPE_MAIN,r),t.set(dI.STREAM_TYPE_AUX,i),e.set("roomId",t)}this.mapInterval.push(e)}getLatestStatsByRemoteId(e,t,r){const i=this.mapInterval.getElement(0)&&this.mapInterval.getElement(0).get(e)&&this.mapInterval.getElement(0).get(e).get(t);return i&&i.get(r)?i.get(r):null}getLatestReport(e,t){return this.mapInterval.getElement(0)&&this.mapInterval.getElement(0).get(e)&&this.mapInterval.getElement(0).get(e).get(t)}getLatestStats(e,t,r){let i=this.getElementStats(e,t,r,0);return i||(i=this.getElementStats(e,t,r,1)),i}getElementStats(e,t,r,i){const n=this.mapInterval.getElement(i)&&this.mapInterval.getElement(i).get(e)&&this.mapInterval.getElement(i).get(e).get(t);if(!n)return null;if(this.isFireFox){let e=null;const t=r.split("_"),i=t[0].split("-"),s=i.slice(0,i.length-1),o=s.join("-"),a=parseInt(t[1]),c="outbound"===s[0]?this.connectionsManager.getMappingSsrcs(a):a;return n.forEach((t=>{t.type===o&&t.mediaType===i[i.length-1]&&t.ssrc===c&&(e=t)})),e}return n.get(r)}getLatestValue(e,t,r,i){const n=this.getLatestStats(e,t,r);return n?n[i]:null}getAllNumber(e,t,r,i){const n=this.mapInterval.size(),s=new Array(n);for(let o=0;o<n;o++){const n=this.getElementStats(e,t,r,o);s[o]=n?n[i]:null}return s}getFreeze(e,t,r,i,n){const s=this.getAllNumber(e,t,r,i),o=s.length;let a=0,c=0;for(let u=1;u<o;u++)s[u-1]&&s[u]&&s[u-1]===s[u]?a+=100:(a>n&&(c+=a),a=0);return a>n&&(c+=a,a=0),c}execMyInterval(e,t){let r=t;const i=(new Date).getTime();let n=null,s=0,o=0;const a=()=>{this.gatherTimer=setTimeout((()=>{o++,n=(new Date).getTime(),s=n-(i+o*t),r=t-s>0?t-s:0,e(),a()}),r)};e(),a()}};class mI{constructor(e){bu(this,"videoFreezeKey",hT.isFirefox()?"packetsReceived":"framesReceived"),bu(this,"mediaStatInfo",[]),bu(this,"mediaStatDebugInfo",[]),bu(this,"mediaStatSumInfo",[]),bu(this,"mediaStatSumDebugInfo",[]),bu(this,"ACSAddr",""),bu(this,"SFUAddr",""),bu(this,"lastSenderInfo",new Map),bu(this,"lastSenderDebugInfo",new Map),bu(this,"encryUserId",new Map),bu(this,"remoteStreamInfo",[]),bu(this,"audioPolicy",0),bu(this,"LocalStreamInfo",new Map),bu(this,"auxsStreamInfo",new Map),bu(this,"audioReceiveInfo",{audioReceivePackets:new Map,audioReceivePacketsLost:new Map,audioReceiveBytes:new Map}),bu(this,"videoReceiveInfo",{videoReceivePackets:new Map,videoReceivePacketsLost:new Map,videoReceiveBytes:new Map,videoReceiveFrame:new Map}),bu(this,"audioReceiveDebugInfo",{audioReceivePackets:new Map,audioReceivePacketsLost:new Map,audioReceiveBytes:new Map}),bu(this,"videoReceiveDebugInfo",{videoReceivePackets:new Map,videoReceivePacketsLost:new Map,videoReceiveBytes:new Map,videoReceiveFrame:new Map}),bu(this,"inBoundAudioSsrcInfos",[]),bu(this,"audioPolicyLastCycle",0),bu(this,"audioStreamReceiverMap",new Map),bu(this,"ssrcChangeCount",0),bu(this,"audioStreamInfos",[]),bu(this,"audioCount",0),bu(this,"audioStreamAllInfos",[]),bu(this,"audioAllCount",0),bu(this,"audioStreamTop3Count",0),bu(this,"module_","MediaStats"),bu(this,"tempStat",{bytesSent:0,bytesReceived:0,sendBitrate:0,recvBitrate:0,rtt:0}),bu(this,"stat",{bytesSent:0,bytesReceived:0,sendBitrate:0,recvBitrate:0,rtt:0}),bu(this,"audioLevelInfo",{localAudio:new Map,remoteAudio:new Map,top3Audio:new Map}),bu(this,"remoteUserMuteStatus",new Map),this.logger=e}setEncryInfo(e,t){this.encryUserId.set(e,t)}getEncryInfo(e){return this.encryUserId.get(e)}clearEncryUserId(){this.encryUserId.clear()}setRemoteUserManager(e){this.remoteUserManager=e}setStartSsrc(e){this.startSsrc=e}updateAudioLevel(e){if("local"===e.type){if(!this.audioLevelInfo.localAudio.get("local")){const e=[];this.audioLevelInfo.localAudio.set("local",e)}this.audioLevelInfo.localAudio.get("local").push(e.level)}else if("remoteTop3"===e.type){if(!this.audioLevelInfo.top3Audio.get("".concat(null==e?void 0:e.ssrc))){const t=[];this.audioLevelInfo.top3Audio.set("".concat(null==e?void 0:e.ssrc),t)}this.audioLevelInfo.top3Audio.get("".concat(null==e?void 0:e.ssrc)).push(e.level)}else{if(!this.audioLevelInfo.remoteAudio.get("".concat(null==e?void 0:e.ssrc,"_").concat(null==e?void 0:e.userId))){const t=[];this.audioLevelInfo.remoteAudio.set("".concat(null==e?void 0:e.ssrc,"_").concat(null==e?void 0:e.userId),t)}this.audioLevelInfo.remoteAudio.get("".concat(null==e?void 0:e.ssrc,"_").concat(null==e?void 0:e.userId)).push(e.level)}}getAudioLevel(e,t,r){let i=0,n=0;return"local"===e&&this.audioLevelInfo.localAudio.get("local")?(this.audioLevelInfo.localAudio.get("local").forEach((e=>{i+=e||0,n++})),this.audioLevelInfo.localAudio.clear()):"remoteTop3"===e&&this.audioLevelInfo.top3Audio.get("".concat(t))?(this.audioLevelInfo.top3Audio.get("".concat(t)).forEach((e=>{i+=e||0,n++})),this.audioLevelInfo.top3Audio.clear()):"remote"===e&&this.audioLevelInfo.remoteAudio.get("".concat(t,"_").concat(r))&&(this.audioLevelInfo.remoteAudio.get("".concat(t,"_").concat(r)).forEach((e=>{i+=e||0,n++})),this.audioLevelInfo.remoteAudio.clear()),0===n?0:Math.ceil(i/n)}setConnectionsManager(e){this.logger.info(this.module_,"setConnectionsManager"),this.connectionsManager=e}setSubscribeInfo(e){var t,r,i,n;if(!e)return;const s=this.remoteStreamInfo.find((t=>t.userId===e.userId));if(!s)return this.clearRemoteStreamInfoCache(e),void this.remoteStreamInfo.push(e);(null===(t=e.mainStream)||void 0===t||null===(r=t.tracks)||void 0===r?void 0:r.length)>0&&e.mainStream.tracks.forEach((t=>{s.mainStream.tracks.find((e=>e.trackId===t.trackId))||(this.doClearRemoteStreamInfoCache(e,e.userId,t.cssrc),s.mainStream.tracks.push(t))})),(null===(i=e.auxStream)||void 0===i||null===(n=i.tracks)||void 0===n?void 0:n.length)>0&&e.auxStream.tracks.forEach((t=>{s.auxStream.tracks.find((e=>e.trackId===t.trackId))||(this.doClearRemoteStreamInfoCache(e,e.userId,t.cssrc),s.auxStream.tracks.push(t))}))}doClearRemoteStreamInfoCache(e,t,r){let i=null;if(e.mainStream.tracks.forEach((e=>{e.cssrc===r&&(i=e.type)})),e.auxStream.tracks.forEach((e=>{e.cssrc===r&&(i=e.type)})),i===uI.TRACK_TYPE_AUDIO){const e="".concat(r,"-").concat(t);this.audioReceiveInfo.audioReceivePackets.delete(e),this.audioReceiveInfo.audioReceivePacketsLost.delete(e),this.audioReceiveInfo.audioReceiveBytes.delete(e)}else if(i===uI.TRACK_TYPE_VIDEO){const e="".concat(r,"-").concat(t);this.videoReceiveInfo.videoReceivePackets.delete(e),this.videoReceiveInfo.videoReceivePacketsLost.delete(e),this.videoReceiveInfo.videoReceiveBytes.delete(e),this.videoReceiveInfo.videoReceiveFrame.delete(e)}}clearRemoteStreamInfoCache(e){this.remoteStreamInfo.filter((t=>t.userId===e.userId)).forEach((t=>{this.clearRemoteStreamInfoCache4Stream(e,t.mainStream),this.clearRemoteStreamInfoCache4Stream(e,t.auxStream)}))}clearRemoteStreamInfoCache4Stream(e,t){t.tracks.forEach((t=>{const r=t.trackId,i=t.cssrc,n=e.userId;e.mainStream.tracks.forEach((t=>{t.cssrc===i&&t.trackId!==r&&this.doClearRemoteStreamInfoCache(e,n,i)}))}))}clearLocalStreamInfoCache(e){e&&this.LocalStreamInfo.forEach((t=>{e.ssrc===t.ssrc&&e.uid===t.uid&&e.streamId!==t.streamId&&this.lastSenderInfo.delete("".concat(e.ssrc,"-").concat(e.uid))}))}clearAuxsStreamInfoCache(e){e&&this.auxsStreamInfo.forEach((t=>{e.ssrc===t.ssrc&&e.uid===t.uid&&e.streamId!==t.streamId&&this.lastSenderInfo.delete("".concat(e.ssrc,"-").concat(e.uid))}))}setLocalMainStreamInfo(e,t){return!(!t||0===t.length)&&(this.LocalStreamInfo.clear(),t.forEach((t=>{const r={uid:e,streamId:"",ssrc:t.ssrc,type:t.type};t.type===uI.TRACK_TYPE_AUDIO?r.streamId=t.upstream.streamUid.toString():(r.streamId=t.upstream.streamUid.toString(),r.width=t.upstream.width,r.height=t.upstream.height,r.frame=t.upstream.fps),this.clearLocalStreamInfoCache(r),this.LocalStreamInfo.set(t.resolutionId,r)})),!0)}setLocalAuxsStreamInfo(e,t){if(!t)return!1;const r=Array.from(t.localTrackPublishInfos.values());return!!r&&(this.auxsStreamInfo.clear(),r.forEach((r=>{const i={uid:e,streamId:"",ssrc:r.ssrc,type:r.type};r.type===uI.TRACK_TYPE_VIDEO&&(i.publishInfo={stream:t.localStream}),this.clearAuxsStreamInfoCache(i),this.auxsStreamInfo.set(r.resolutionId,i)})),!0)}refreshUpstreams(e){const t=Array.from(this.LocalStreamInfo.values()).filter((e=>e.type===uI.TRACK_TYPE_VIDEO)),r=Array.from(this.auxsStreamInfo.values()).filter((e=>e.type===uI.TRACK_TYPE_VIDEO));e.forEach((e=>{const i=null==t?void 0:t.find((t=>t.streamId===e.streamUid.toString()));i&&(i.frame=e.fps,i.height=e.height,i.width=e.width);const n=null==r?void 0:r.find((t=>t.streamId===e.streamUid.toString()));n&&(n.frame=e.fps,n.height=e.height,n.width=e.width)}))}deleteSubscribeInfo(e,t,r){if(r||t){if(t){const i=this.remoteStreamInfo.find((t=>t.userId===e));if(!i)return;const n=t===dI.STREAM_TYPE_MAIN?i.mainStream:i.auxStream;n.tracks=r?n.tracks.filter((e=>e.trackId!==r)):null}}else this.remoteStreamInfo=this.remoteStreamInfo.filter((t=>t.userId!==e))}setAudioPolicy(e){this.audioPolicyLastCycle=this.audioPolicy,this.audioPolicy=e,this.setAudioStreamInfo()}setSFUAddr(e){this.SFUAddr=e}setACSAddr(e){this.ACSAddr=e}leaveRoom(){this.mediaStatInfo=[]}getAudioPolicy(){return this.audioPolicy}getTransportMediaStats(){return this.stat}getMediaStatInfo(){const e=this.mediaStatInfo;return this.mediaStatInfo=[],e}getMediaStatSum(){const e=this.mediaStatSumInfo;return this.mediaStatSumInfo=[],e}getInBoundAudioSsrc(){const e=this.inBoundAudioSsrcInfos;return this.inBoundAudioSsrcInfos=[],e}async dealStats(){this.connectionsManager.isConnectionsExist()?(this.getAudioStreamInfo(),await this.getSenderInfo(!1),await this.getReceiverInfo(!1),this.stat.bytesSent+=this.tempStat.bytesSent,this.stat.bytesReceived+=this.tempStat.bytesReceived,this.stat.sendBitrate=this.tempStat.sendBitrate,this.stat.recvBitrate=this.tempStat.recvBitrate,this.clearTempStats()):this.logger.debug(this.module_,"peerConnection is undefined")}clearTempStats(){this.tempStat.bytesSent=0,this.tempStat.bytesReceived=0,this.tempStat.sendBitrate=0,this.tempStat.recvBitrate=0}clearMediaStatBytes(){this.stat.bytesSent=0,this.stat.bytesReceived=0}cleanAudioStreamInfos(){this.audioCount=this.audioStreamInfos.length,this.audioAllCount=this.audioStreamAllInfos.length,this.audioStreamInfos=[],this.audioStreamAllInfos=[]}updateAudioStreamInfos(e,t){if("add"===t){let t=0;this.remoteStreamInfo.forEach((r=>{if(e===r.userId){const e=r.mainStream.tracks.filter((e=>e.streamType===dI.STREAM_TYPE_MAIN&&e.type===uI.TRACK_TYPE_AUDIO));t=e.length>0?e[0].cssrc:0}}));const r={userid:e,audioSsrc:t};this.audioStreamInfos=this.audioStreamInfos.filter((r=>r.userid!=e||r.audioSsrc!=t)),this.audioStreamAllInfos=this.audioStreamAllInfos.filter((r=>r.userid!=e||r.audioSsrc!=t)),this.audioStreamInfos.push(r),this.audioStreamAllInfos.push(r)}"delete"!==t&&"removed"!==t||(this.audioStreamInfos=this.audioStreamInfos.filter((t=>t.userid!==e)),this.audioStreamAllInfos=this.audioStreamAllInfos.filter((t=>t.userid!==e))),0!==this.audioPolicy&&this.audioCount===this.audioStreamInfos.length||this.ssrcChangeCount++,1!==this.audioPolicy&&this.audioAllCount===this.audioStreamAllInfos.length||this.ssrcChangeCount++}updateAudioStreamTop3(e){this.audioStreamTop3CountTimer&&clearTimeout(this.audioStreamTop3CountTimer),this.audioStreamTop3CountTimer=setTimeout((()=>{this.audioStreamTop3Count=0}),4e3),this.audioStreamTop3Count=e}checkAudioStreamInfosIsExist(e,t){return 0!==this.audioStreamInfos.filter((r=>r.userid===e&&r.audioSsrc===t)).length}setAudioStreamInfo(){this.audioPolicy!==this.audioPolicyLastCycle&&(this.ssrcChangeCount=1,this.audioStreamReceiverMap.clear(),this.audioStreamTop3Count=0,this.audioReceiveInfo.audioReceiveBytes.clear(),this.audioReceiveInfo.audioReceivePackets.clear(),this.audioReceiveInfo.audioReceivePacketsLost.clear())}async getAudioStreamInfo(){1===this.audioPolicy?await this.buildAudioStreamInfo3():0===this.audioPolicy?await this.buildAudioStreamInfo2():this.logger.debug(this.module_,"mode 1 not uesed")}async buildAudioStreamInfo3(){const e=[],t={timestamp:Hg.getCurrentTimestamp(),event:BT.QoS_DOWN_STREAM_AUDIO_STAT,access_addr:this.ACSAddr,sfu_addr:this.SFUAddr,audio_policy:this.audioPolicy,topn:3,audios_change_cnt:0,audios:e,no_stream_cnt:0};for(let i=0;i<3;i++){const r=this.startSsrc+i,n="".concat(AT.InboundRTPAudio,"_").concat(r),s=pI.getLatestStats("roomId",dI.STREAM_TYPE_MAIN,n);if(s){const i=this.connectionsManager.calcChangedStatistic(s.id,s.packetsReceived||0,["packetsReceived"])||s.packetsReceived,n=this.audioStreamReceiverMap.get(r)||0;let o=!0;0===i?o=!1:void 0===n?o=!0:i===n&&(o=!1),e.push({ssrc:r,userid:"",packet_cnt:i-n}),this.audioStreamReceiverMap.set(r,i),o||t.no_stream_cnt++}}const r=this.audioAllCount<3?this.audioAllCount:3;if(r<3){const e=t.no_stream_cnt-(3-r);t.no_stream_cnt=e<0?0:e}t.audios_change_cnt=this.ssrcChangeCount,this.inBoundAudioSsrcInfos.push(t)}async buildAudioStreamInfo2(){const e=[],t={timestamp:Hg.getCurrentTimestamp(),event:BT.QoS_DOWN_STREAM_AUDIO_STAT,access_addr:this.ACSAddr,sfu_addr:this.SFUAddr,audio_policy:this.audioPolicy,topn:17,audios_change_cnt:0,audios:e,no_stream_cnt:0};this.remoteStreamInfo.every((r=>{if(-1===this.audioStreamInfos.findIndex((e=>e.userid===r.userId)))return!0;const i=Array.from(r.mainStream.tracks.values()).find((e=>e.type===uI.TRACK_TYPE_AUDIO)),n="".concat(AT.InboundRTPAudio,"_").concat(null==i?void 0:i.cssrc),s=pI.getLatestStats("roomId",dI.STREAM_TYPE_MAIN,n);if(r&&i&&s){const n=r.userId,o=this.connectionsManager.calcChangedStatistic(s.id,s.packetsReceived||0,["packetsReceived"])||s.packetsReceived,a=this.audioStreamReceiverMap.get(i.cssrc)||0;let c=!0;0===o?c=!1:void 0===a?c=!0:o===a&&(c=!1);const u=this.getEncryInfo(r.userId)||Qg.secretString(r.userId)||"";e.push({ssrc:i.cssrc,userid:u,packet_cnt:o-a}),this.audioStreamReceiverMap.set(i.cssrc,o),!c&&this.checkAudioStreamInfosIsExist(n,i.cssrc)&&t.no_stream_cnt++}return!0})),t.audios_change_cnt=this.ssrcChangeCount,e.length>0&&this.inBoundAudioSsrcInfos.push(t)}async getVideoReceiverFrameDecodedMap(){const e=new Map;return await this.buildFrameDecodedMap(dI.STREAM_TYPE_MAIN,e),await this.buildFrameDecodedMap(dI.STREAM_TYPE_AUX,e),e}async buildFrameDecodedMap(e,t){const r=e===dI.STREAM_TYPE_AUX,i=this.connectionsManager.getReceivers(r?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN);for(let n=0;n<i.length;n++){if("function"!=typeof i[n].getStats)return void this.logger.warn(this.module_,"rtpreceiver is not support getStats");this.remoteStreamInfo.forEach((i=>{const n={};(r?i.auxStream.tracks:i.mainStream.tracks).forEach((s=>{const o=pI.getLatestStats("roomId",e,"".concat(AT.InboundRTPVideo,"_").concat(s.cssrc));if(o){n.userId=i.userId,n.isAux=r,n.decodedFrame=this.connectionsManager.calcChangedStatistic(o.id,o.framesDecoded||0,["framesDecoded"]);const e="".concat(i.userId,",").concat(r?"1":"0");t.get(e)||t.set(e,n)}}))}))}}async getReceiverInfo(e){const t={timestamp:Hg.getCurrentTimestamp(),event:BT.QoS_DOWN_STREAM_AUDIO_SUM,real_band_width:0,bytes:0,pkt_loss:0},r={timestamp:Hg.getCurrentTimestamp(),event:BT.QoS_DOWN_STREAM_VIDEO_SUM,real_band_width:0,tmmbr:0,video_tmmbr:0,req_band_width:0,pkt_loss:0,jitter:0,frame_rate:0,first_frame_count:0,bytes:0},i={isAudio:!1,isVideo:!1};await this.buildReceiverInfo(dI.STREAM_TYPE_MAIN,t,r,i,e),await this.buildReceiverInfo(dI.STREAM_TYPE_AUX,t,r,i,e),i.isAudio&&(e?this.mediaStatSumDebugInfo.push(t):this.mediaStatSumInfo.push(t)),i.isVideo&&(e?this.mediaStatSumDebugInfo.push(r):this.mediaStatSumInfo.push(r))}async buildReceiverInfo(e,t,r,i,n){const s=e===dI.STREAM_TYPE_AUX,o={timestamp:Hg.getCurrentTimestamp(),event:BT.QoS_DOWN_STREAM_AUDIO,streams:[]},a={timestamp:Hg.getCurrentTimestamp(),event:s?BT.QoS_AUX_DOWN_STREAM_VIDEO:BT.QoS_DOWN_STREAM_VIDEO,qos_estimate:3,streams:[]};s||this.buildAudioReceiverInfo(o,t,n),this.buildVideoReceiverInfo(e,a,r,n),0!==a.streams.length&&(n?this.mediaStatDebugInfo.push(a):this.mediaStatInfo.push(a),i.isVideo=!0),0!==o.streams.length&&(n?this.mediaStatDebugInfo.push(o):this.mediaStatInfo.push(o),i.isAudio=!0)}checkMuteStatusIsChange(e){const t=this.remoteUserManager.checkSsrcIsMute(e),r=this.remoteUserMuteStatus.get(e),i=!t&&t===r;return this.remoteUserMuteStatus.set(e,t),i}buildAudioReceiverInfo(e,t,r){let i=null,n=null,s=null,o=0;if(r?(i=this.audioReceiveDebugInfo.audioReceivePackets,n=this.audioReceiveDebugInfo.audioReceivePacketsLost,s=this.audioReceiveDebugInfo.audioReceiveBytes,o=this.rtcStatsInteval):(i=this.audioReceiveInfo.audioReceivePackets,n=this.audioReceiveInfo.audioReceivePacketsLost,s=this.audioReceiveInfo.audioReceiveBytes,o=5),1===this.audioPolicy){for(let a=0;a<3;a++){const c={ssrc_uid:"",stream_uid:"",sfu_addr:"",dst_rcv_vel:0,dst_rcv_nel:0,bit_rate:0,pkt_loss:0,rtt:0,jitter:0,bytes:0,pkts:0,lost_pkt_cnt:0,srtp_decode_err:0,max_cont_lost_pkts:0,mos:0,jb_depth:0,play_err:0,play_total_time:5e3,freeze_loss_time:0,freeze_time:0,jitter90:0,jitter95:0,jitter100:0,tsm_count:0,ts_exp_cnt:0,ssrc_change_cnt:0,audio_pkt_error:0,audio_decode_error:0,dst_burst_pkt_lost_cnt:0,dst_burst_cnt:0,dst_burst_pkt_lost_rate:0,dst_audio_jb_discard_lost_rate:0,net_loss:0,rtp_loss:0,dst_mean_lost_rate:0,buffer_max_length:0,buffer_mean_length:0,net_ate_max_delay:0,net_ate_cur_delay:0,jb_max_num_delay:0,jb_cur_num_delay:0,pkt_recv_max_interval:0,pkt_recv_mean_interval:0,ui_sample_rate:0,ui_channels:0,en_codec_type:0,ui_total_pkt_loss:0,ui_buffer_total_length:0,ui_buffer_cal_cnt:0,ui_rec_pkt_cnt:0,i_channel_id:0,ui_dst_inc_bytes:0,ui_recv_redn_rate:0,ui_plc_count:0,bad_pkt_cnt:0,empty_pkt_cnt:0,buf_drop_pkt_cnt:0},u=this.startSsrc+a,d="".concat(AT.InboundRTPAudio,"_").concat(u),l=pI.getLatestStats("roomId",dI.STREAM_TYPE_MAIN,d);if(l){c.ssrc_uid="".concat(u,"-").concat(u),c.stream_uid="STREAMUUID-".concat(u),c.sfu_addr=this.SFUAddr,this.connectionsManager.calcChangedStatistic(l.id,l,["bytesReceived","packetsReceived","packetsLost"]);const e=l.bytesReceived||0;s.get(u)||s.set(u,0),c.bytes=e<s.get(u)?e:e-s.get(u);const t=l.packetsReceived||0;c.jitter=1e3*(l.jitter||0),c.bit_rate=Math.round(c.bytes/(1024*o)*8),r||(this.tempStat.bytesReceived+=c.bytes,this.tempStat.recvBitrate+=c.bit_rate),s.set(u,e);const a=l.packetsLost||0;i.get(u)||i.set(u,0),n.get(u)||n.set(u,0);const h=a>n.get(u)?a-n.get(u):0;c.lost_pkt_cnt=h;const f=t-i.get(u);c.pkts=f,c.pkt_loss=Math.round(h/(f+h)*100),n.set(u,a),i.set(u,t),c.dst_rcv_vel=this.getAudioLevel("remoteTop3",u);const p=this.remoteUserManager.checkRemoteTop3NeedReport();this.remoteUserManager&&p&&(c.freeze_loss_time=pI.getFreeze("roomId",dI.STREAM_TYPE_MAIN,d,"packetsReceived",100))}c.ssrc_uid&&(e.streams.push(c),t.real_band_width+=Math.round(c.bytes/(1024*o)*8))}return}const a={audioReceivePackets:i,audioReceivePacketsLost:n,audioReceiveBytes:s,interval:o};this.buildAudioReceiver4SubscribedMode(a,e,t,r)}buildAudioReceiver4SubscribedMode(e,t,r,i){this.remoteStreamInfo.forEach((n=>{const s={ssrc_uid:"",stream_uid:"",sfu_addr:"",dst_rcv_vel:0,dst_rcv_nel:0,bit_rate:0,pkt_loss:0,rtt:0,jitter:0,bytes:0,pkts:0,lost_pkt_cnt:0,srtp_decode_err:0,max_cont_lost_pkts:0,mos:0,jb_depth:0,play_err:0,play_total_time:5e3,freeze_loss_time:0,freeze_time:0,jitter90:0,jitter95:0,jitter100:0,tsm_count:0,ts_exp_cnt:0,ssrc_change_cnt:0,audio_pkt_error:0,audio_decode_error:0,dst_burst_pkt_lost_cnt:0,dst_burst_cnt:0,dst_burst_pkt_lost_rate:0,dst_audio_jb_discard_lost_rate:0,net_loss:0,rtp_loss:0,dst_mean_lost_rate:0,buffer_max_length:0,buffer_mean_length:0,net_ate_max_delay:0,net_ate_cur_delay:0,jb_max_num_delay:0,jb_cur_num_delay:0,pkt_recv_max_interval:0,pkt_recv_mean_interval:0,ui_sample_rate:0,ui_channels:0,en_codec_type:0,ui_total_pkt_loss:0,ui_buffer_total_length:0,ui_buffer_cal_cnt:0,ui_rec_pkt_cnt:0,i_channel_id:0,ui_dst_inc_bytes:0,ui_recv_redn_rate:0,ui_plc_count:0,bad_pkt_cnt:0,empty_pkt_cnt:0,buf_drop_pkt_cnt:0},o=Array.from(n.mainStream.tracks.values()).find((e=>e.type===uI.TRACK_TYPE_AUDIO&&0===e.state)),a="".concat(AT.InboundRTPAudio,"_").concat(null==o?void 0:o.cssrc),c=pI.getLatestStats("roomId",dI.STREAM_TYPE_MAIN,a);if(n&&o&&c){const t=this.getEncryInfo(n.userId)||Qg.secretString(n.userId),r="".concat(o.cssrc,"-").concat(t);s.ssrc_uid=r,s.stream_uid="".concat(o.trackId)||"STREAMUUID-".concat(o.cssrc),s.sfu_addr=this.SFUAddr,this.connectionsManager.calcChangedStatistic(c.id,c,["bytesReceived","packetsReceived","packetsLost"]);const u=c.bytesReceived||0;e.audioReceiveBytes.get(r)||e.audioReceiveBytes.set(r,0),s.bytes=u<e.audioReceiveBytes.get(r)?u:u-e.audioReceiveBytes.get(r);const d=c.packetsReceived;s.jitter=1e3*(c.jitter||0),s.bit_rate=Math.round(s.bytes/(1024*e.interval)*8),i||(this.tempStat.bytesReceived+=s.bytes,this.tempStat.recvBitrate+=s.bit_rate),e.audioReceiveBytes.set(r,u);const l=c.packetsLost||0;e.audioReceivePackets.get(r)||e.audioReceivePackets.set(r,0),e.audioReceivePacketsLost.get(r)||e.audioReceivePacketsLost.set(r,0);const h=l>e.audioReceivePacketsLost.get(r)?l-e.audioReceivePacketsLost.get(r):0;s.lost_pkt_cnt=h;const f=d-e.audioReceivePackets.get(r);s.pkts=f,s.pkt_loss=Math.round(h/(f+h)*100),e.audioReceivePacketsLost.set(r,l),e.audioReceivePackets.set(r,d),s.dst_rcv_vel=this.getAudioLevel("remote",o.cssrc,n.userId);const p=this.checkMuteStatusIsChange(null==o?void 0:o.cssrc);this.remoteUserManager&&p&&(s.freeze_loss_time=pI.getFreeze("roomId",dI.STREAM_TYPE_MAIN,a,"packetsReceived",100))}s.ssrc_uid&&(t.streams.push(s),r.real_band_width+=Math.round(s.bytes/(1024*e.interval)*8))}))}buildVideoReceiverInfo(e,t,r,i){let n="",s=null,o=null,a=null,c=null,u=0;i?(s=this.videoReceiveDebugInfo.videoReceivePackets,o=this.videoReceiveDebugInfo.videoReceivePacketsLost,a=this.videoReceiveDebugInfo.videoReceiveBytes,c=this.videoReceiveDebugInfo.videoReceiveFrame,u=this.rtcStatsInteval):(s=this.videoReceiveInfo.videoReceivePackets,o=this.videoReceiveInfo.videoReceivePacketsLost,a=this.videoReceiveInfo.videoReceiveBytes,c=this.videoReceiveInfo.videoReceiveFrame,u=5),this.remoteStreamInfo.forEach((d=>{(e===dI.STREAM_TYPE_MAIN?d.mainStream.tracks.filter((e=>e.type===uI.TRACK_TYPE_VIDEO&&0===e.state)):d.auxStream.tracks.filter((e=>e.type===uI.TRACK_TYPE_VIDEO&&0===e.state))).forEach((l=>{const h={ssrc_uid:"",stream_uid:"",sfu_addr:"",expect_pic_w:0,expect_pic_h:0,image_width:0,image_height:0,roc:0,buffered:0,bit_rate:0,frame_rate:0,pkt_loss:0,rtt:0,jitter:0,bytes:0,jb_depth:0,fir_req_cnt:0,parse_srtp_fail:0,fir_frame_cnt:0,freeze_200ms_cnt:0,freeze_600ms_cnt:0,freeze_1000ms_cnt:0,freeze_200ms_time:0,freeze_600ms_time:0,freeze_1000ms_time:0,dec_key_frame_cnt:0,dec_key_frame_size:0,max_cont_lost_pkts:0,freeze_cnt:0,act_dec_runtime:5e3,ui_first_rcv_seq:0,ui_max_decode_delay:0,ui_min_decode_delay:0,ui_mean_decode_delay:0,ui_current_decode_delay:0,ui_max_channel_decode_delay:0,ui_min_channel_decode_delay:0,ui_mean_channel_decode_delay:0,ui_current_channel_decode_delay:0,ui_abnormal_pkt_count:0,ui_codec_pt_error:0,ui_no_dec_data_cnt:0,jb_discard_bytes:0,net_lost_pkt_counts:0,rcv_frame_counts:0,dec_bytes_out:0,rcv_red_bytes:0,dec_delay_over_time_cnt:0,channel_decode_over_time_cnt:0,dec_non_key_frame_size:0,dec_non_key_frame_cnt:0,us_loss_frame_rate:0,ui_pkt_rate:0,us_residual_pkt_loss:0,ul_decoder_start_time:0,us_mean_pkt_loss:0,ui_mean_rtt:0,e_dec_protocol:0,ui_distribute_tmmbr:0,frame_fail_cnt:0,advanced_frame_count:0,base_frame_count:0,before_postprocess_frames_rate:0,after_postprocess_frames_rate:0,red_rate:0,recover_rate:0,jb_listpacket_num:0,not_recv_pkt_cnt:0,not_recv_pkt_total_time:0,nack_request_cnt:0,send_key_request_cnt:0,jb_jitter:0,recv_frame_rate:0,recv_base_layer_frame_cnt:0,recv_mid_layer_frame_cnt:0,recv_out_layer_frame_cnt:0,jb_total_frame_cnt:0,jb_listframe_num:0,output_total_freezetime:0,output_freeze_cnt:0,ref_frame_error_cnt:0,force_out4_key_cnt:0,force_out4_struct_cnt:0,current_output_diftime:0,current_complete_type:0,jb_base_layer_frame_num:0,jb_mid_layer_frame_num:0,jb_out_layer_frame_num:0,freeze_400ms_cnt:0,freeze_400ms_time:0,freeze_200ms_rate:0,freeze_400ms_rate:0,freeze_600ms_rate:0,freeze_1000ms_rate:0,freeze_loss_time:0,first_frame_cnt:0,p_frame_cnt:0,lost_pkt_cnt:0,play_err:0,bad_pkt_cnt:0,empty_pkt_cnt:0,buf_drop_pkt_cnt:0},f="".concat(AT.InboundRTPVideo,"_").concat(l.cssrc),p=pI.getLatestStats("roomId",e,f);if(p){const t=this.getEncryInfo(d.userId)||Qg.secretString(d.userId),r="".concat(l.cssrc,"-").concat(t);h.ssrc_uid=r,this.connectionsManager.calcChangedStatistic(p.id,p,["keyFramesDecoded","packetsReceived","packetsLost","bytesReceived","framesDecoded","freezeCount"]),this.buildCommonVideoRecvInfo(h,p,l);const m=Hg.getValue(p.packetsReceived,0),_=Hg.getValue(p.packetsLost,0),g=s.get(r)||0,S=o.get(r)||0,v=_>S?_-S:0;h.real_lost_pkt_cnt=v;const R=m-g;h.pkts=R,h.pkt_loss=R>0?Math.round(v/R*100):0,o.set(r,_),s.set(r,m);const T=Hg.getValue(p.bytesReceived,0),I=a.get(r)||0;h.bytes=T<I?T:T-I,h.bit_rate=Math.round(h.bytes/(1024*u)*8),i||(this.tempStat.bytesReceived+=h.bytes,this.tempStat.recvBitrate+=h.bit_rate),a.set(r,T);const y=c.get(r)||0,E=p.framesDecoded||0,b=E<=y?E:E-y;h.dec_frame_cnt=b,h.frame_rate=b/u,c.set(r,E),n=p.trackId||p.remoteId,h.freeze_200ms_cnt=p.framesDropped,e===dI.STREAM_TYPE_MAIN&&this.remoteUserManager&&this.checkMuteStatusIsChange(l.cssrc)&&(h.freeze_600ms_time=pI.getFreeze("roomId",e,f,this.videoFreezeKey,500))}const m=pI.getLatestStatsByRemoteId("roomId",e,n);n&&m&&mI.buildVideoTrackInfo(h,m),h.ssrc_uid&&(t.streams.push(h),r.real_band_width+=Math.round(h.bytes/(1024*u)*8))}))}))}static buildVideoTrackInfo(e,t){e.image_width=t.frameWidth||0,e.image_height=t.frameHeight||0,e.freeze_cnt=t.freezeCount||0}buildCommonVideoRecvInfo(e,t,r){e.sfu_addr=this.SFUAddr,e.stream_uid=r.trackId||"",e.expect_pic_w=r.width||0,e.expect_pic_h=r.height||0,e.dec_key_frame_cnt=t.keyFramesDecoded||0,e.jitter=1e3*(t.jitter||0)}async getSenderInfo(e){const t={timestamp:Hg.getCurrentTimestamp(),event:BT.QoS_UP_STREAM_AUDIO_SUM,tmmbr:0,video_tmmbr:0,resp_band_width:0,real_band_width:0,bytes:0,pkt_loss:0},r={timestamp:Hg.getCurrentTimestamp(),event:BT.QoS_UP_STREAM_VIDEO_SUM,tmmbr:0,video_tmmbr:0,resp_band_width:0,real_band_width:0,pkt_loss:0,jitter:0,frame_rate:0,first_frame_count:0,bytes:0},i={isAudio:!1,isVideo:!1};await this.buildSenderInfo(!1,t,r,i,e),await this.buildSenderInfo(!0,t,r,i,e),i.isAudio&&(e?this.mediaStatSumDebugInfo.push(t):this.mediaStatSumInfo.push(t)),i.isVideo&&(e?this.mediaStatSumDebugInfo.push(r):this.mediaStatSumInfo.push(r))}async buildSenderInfo(e,t,r,i,n){const s=[],o=[],a={ssrc_uid:"",stream_uid:"",sfu_addr:"",src_chan_input_vol_scale:0,src_snd_vel:0,src_snd_nel:0,bit_rate:0,pkt_loss:0,rtt:0,jitter:0,bytes:0,pkts:0,pkt_rate:0,redn_rate:0,ui_bgm_mean_speech_level:0,ui_bgm_mean_noise_level:0,up_vqe_max_delay:0,up_vqe_mean_delay:0,up_capture_max_interval:0,up_capture_mean_interval:0,pre_send_max_delay:0,pre_send_mean_delay:0,up_enc_send_max_delay:0,up_enc_send_mean_delay:0,ui_sample_rate:0,ui_channels:0,en_codec_type:0,i_channel_id:0,ui_src_inc_bytes:0,ui_up_mean_delay:0,ui_up_max_delay:0,ui_up_capture_cnt:0,ui_up_vqe_total_delay:0,ui_pre_send_total_delay:0,ui_up_enc_send_pkt_cnt:0,ui_up_enc_send_total_delay:0,estimate_bit_rate:0,tmmbr:0,bad_pkt_cnt:0},c=e?Array.from(this.auxsStreamInfo.values()).filter((e=>e.type!==uI.TRACK_TYPE_AUDIO)):Array.from(this.LocalStreamInfo.values());if(0===c.length)return;const u=c.find((e=>e.type===uI.TRACK_TYPE_AUDIO)),d=c.filter((e=>e.type===uI.TRACK_TYPE_VIDEO)),l=n?this.rtcStatsInteval:5;if(this.buildAudioSenderInfo(u,a,n),a.ssrc_uid&&(t.real_band_width+=Math.round(a.bytes/(1024*l)*8),i.isAudio=!0,o.push(a)),null==d||d.forEach((t=>{const o={ssrc_uid:"",stream_uid:"",sfu_addr:"",expect_pic_w:0,expect_pic_h:0,expect_frame_rate:0,image_width:0,image_height:0,frame_rate:0,bit_rate:0,max_cont_loss:0,pkt_loss:0,rtt:0,jitter:0,bytes:0,pkts:0,roc:0,first_req_count:0,first_frame_count:0,frame_count:0,redn_rate:0,ui_first_send_seq:0,ui_no_ref_redundance_rate:0,ui_enc_max_bit_rate_set:0,ui_enc_min_bit_rate_set:0,ui_enc_current_bit_rate_set:0,ui_max_encode_delay:0,ui_min_encode_delay:0,ui_mean_encode_delay:0,ui_current_encode_delay:0,ui_buffer_data:0,ui_snd_fir_frame_key_count:0,ui_snd_fir_frame_arq_count:0,ui_snd_fir_frame_period_count:0,ui_max_channel_encode_delay:0,ui_min_channel_encode_delay:0,ui_mean_channel_encode_delay:0,ui_current_channel_encode_delay:0,ui_enc_frame_counts:0,ui_enc_bytes_out:0,ui_estimate_bitrate:0,ui_red_bytes_out:0,ui_nack_bytes_out:0,ui_enc_over_time_cnt:0,ui_enc_delay_over_time_cnt:0,ui_channel_encode_over_time_cnt:0,ui_before_pre_process_frm_cnt:0,ui_after_pre_process_frm_cnt:0,repeat_red_pkt_count:0,usable_bitrate:0,available_enc_bitrate:0,send_pkt_hungry_cnt:0,send_buffer_frm_cnt:0,advanced_frame_cnt:0,base_frame_cnt:0,avg_pre_process_time_in_period:0,max_pre_process_time:0,before_encode_lost_frm_cnt:0,us_sent_mean_lost_rate:0,ui_mean_r_t_t:0,ui_cumulative_lost:0,ui_extended_max_seq_num:0,ui_pkt_rate:0,ui_send_bit_rate:0,f_key_redundance_rate:0,f_ref_redundance_rate:0,f_no_ref_redundance_rate:0,e_enc_protocol:0,before_encode_frames_rate:0,before_send_frames_rate:0,after_send_frames_rate:0,data_cache_bytes:0,input_frame_cnt:0,input_pacing_pkt_cnt:0,input_pacing_fec_pkt_cnt:0,input_pacing_arq_pkt_cnt:0,send_fec_pkt_cnt:0,send_arq_pkt_cnt:0,nack_not_rsp_for_not_find_cnt:0,nack_not_rsp_for_key_cnt:0,nack_not_rsp_for_rtt_cnt:0,nack_not_rsp_for_time_cnt:0,nack_not_rsp_for_bw_cnt:0,deliver_red_rate:0,output_frame_cnt:0,estimate_bit_rate:0,tmmbr:0,p_frame_count:0,key_frame_count:0,bad_pkt_cnt:0,qos_estimate:3};this.buildVideoSenderInfo(t,o,e,n),o.ssrc_uid&&(r.real_band_width+=Math.round(o.bytes/(1024*l)*8),i.isVideo=!0,s.push(o))})),o.length>0){const e={timestamp:Hg.getCurrentTimestamp()};e.event=BT.QoS_UP_STREAM_AUDIO,e.streams=o,n?this.mediaStatDebugInfo.push(e):this.mediaStatInfo.push(e)}if(s.length>0){const t={timestamp:Hg.getCurrentTimestamp()};t.event=e?BT.QoS_AUX_UP_STREAM_VIDEO:BT.QoS_UP_STREAM_VIDEO,t.streams=s,n?this.mediaStatDebugInfo.push(t):this.mediaStatInfo.push(t)}}buildAudioSenderInfo(e,t,r){if(!e)return;const i=r?this.lastSenderDebugInfo:this.lastSenderInfo,n=r?this.rtcStatsInteval:5,s=i.get("".concat(e.ssrc,"-").concat(e.uid))||{audioSendPackets:0,audioSendPacketsLost:0,audioSendBytes:0,videoSendPackets:0,videoSendPacketsLost:0,videoSendBytes:0};let o="".concat(AT.OutboundRTPAudio,"_").concat(e.ssrc),a=pI.getLatestStats("roomId",dI.STREAM_TYPE_MAIN,o);if(a){const i=this.getEncryInfo(e.uid)||Qg.secretString(e.uid);t.ssrc_uid="".concat(e.ssrc,"-").concat(i),t.stream_uid=e.streamId,t.sfu_addr=this.SFUAddr;const o=a.bytesSent||0;t.bytes=o<s.audioSendBytes?o:o-s.audioSendBytes;const c=a.packetsSent||0;t.pkts=c<s.audioSendPackets?c:c-s.audioSendPackets,t.bit_rate=Math.round(t.bytes/(1024*n)*8)||0,r||(this.tempStat.bytesSent+=t.bytes,this.tempStat.sendBitrate+=t.bit_rate),s.audioSendBytes=o,s.audioSendPackets=c,t.src_snd_vel=this.getAudioLevel("local",e.ssrc)}if(o="".concat(AT.RemoteInboundRtpAudio,"_").concat(e.ssrc),a=pI.getLatestStats("roomId",dI.STREAM_TYPE_MAIN,o),a){t.jitter=1e3*a.jitter,t.rtt=1e3*(a.roundTripTime||0);const e=a.packetsLost||0,r=e>s.audioSendPacketsLost?e-s.audioSendPacketsLost:0,i=t.pkts;t.pkt_loss=i>0?Math.round(r/(i+r)*100):0,s.audioSendPacketsLost=e}i.set("".concat(e.ssrc,"-").concat(e.uid),s)}buildVideoSenderInfo(e,t,r,i){let n="";if(!e)return;const s=i?this.lastSenderDebugInfo:this.lastSenderInfo,o=i?this.rtcStatsInteval:5,a=s.get("".concat(e.ssrc,"-").concat(e.uid))||{audioSendPackets:0,audioSendPacketsLost:0,audioSendBytes:0,videoSendPackets:0,videoSendPacketsLost:0,videoSendBytes:0},c="".concat(AT.OutboundRTPVideo,"_").concat(e.ssrc),u=pI.getLatestStats("roomId",r?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN,c);if(u){const s=this.getEncryInfo(e.uid)||Qg.secretString(e.uid);t.ssrc_uid="".concat(e.ssrc,"-").concat(s),t.stream_uid=e.streamId,t.sfu_addr=this.SFUAddr,mI.buildCommonVideoSendInfo(t,u,e,r);const c=Hg.getValue(u.bytesSent,0);t.bytes=c<a.videoSendBytes?c:c-a.videoSendBytes;const d=Hg.getValue(u.packetsSent,0);t.pkts=d<a.videoSendPackets?d:d-a.videoSendPackets,a.videoSendPackets=d,t.bit_rate=Math.round(t.bytes/(1024*o)*8)||0,i||(this.tempStat.bytesSent+=t.bytes,this.tempStat.sendBitrate+=t.bit_rate),a.videoSendBytes=c,n=Hg.getValue(u.remoteId,"")}const d=pI.getLatestStatsByRemoteId("roomId",r?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN,n);if(n&&d){t.jitter=1e3*(d.jitter||0);const e=d.packetsLost||0;if(0!==e){const r=e>a.videoSendPacketsLost?e-a.videoSendPacketsLost:0,i=t.pkts;t.pkt_loss=Math.round(r/(i+r)*100)}else t.pkt_loss=0;a.videoSendPacketsLost=e,t.rtt=1e3*(d.roundTripTime||0)}s.set("".concat(e.ssrc,"-").concat(e.uid),a)}static buildCommonVideoSendInfo(e,t,r,i){if(i){var n;const t=null===(n=r.publishInfo)||void 0===n?void 0:n.stream;e.image_width=(null==t?void 0:t.getScreenWidth())||0,e.image_height=(null==t?void 0:t.getScreenHeight())||0,e.frame_rate=(null==t?void 0:t.getScreenframeRate())||0}else e.image_width=(null==r?void 0:r.width)||0,e.image_height=(null==r?void 0:r.height)||0,e.frame_rate=(null==r?void 0:r.frame)||0;e.image_width=t.frameWidth||0,e.image_height=t.frameHeight||0,e.frame_rate=t.framesPerSecond||0,e.first_frame_count=t.firCount||0,e.frame_count=t.framesSent||0}async buildRtcStatsDebugInfo(e){this.rtcStatsInteval=e;const t={mediaStatsDebugInfo:null,mediaStatsSumDebugInfo:null};return this.connectionsManager.isConnectionsExist()?(await this.getSenderInfo(!0),await this.getReceiverInfo(!0),t.mediaStatsDebugInfo=this.mediaStatDebugInfo,t.mediaStatsSumDebugInfo=this.mediaStatSumDebugInfo,this.mediaStatDebugInfo=[],this.mediaStatSumDebugInfo=[],t):(this.logger.debug(this.module_,"peerConnection is undefined"),t)}}class _I{constructor(e,t){bu(this,"eventInfoMap",new Map),bu(this,"reqInfoMap",new Map),bu(this,"sfuInfo",{ipAddress:"",videoPort:0,audioPort:0,auxPort:0}),bu(this,"deviceInfo",{audioOutputId:void 0,audioInputId:void 0,videoInputId:void 0}),bu(this,"mediaOpsData",[]),bu(this,"signalSendMsgs",[]),bu(this,"signalReceiveMsgs",[]),bu(this,"parentSpanIdMap",new Map),bu(this,"spanIdMap",new Map),this.logger=e,this.mediaStats=new mI(e),this.module_="RTCStat",this.commInfo={},this.commInfo.instance_id=Hg.getDeviceID(),t&&(this.commInfo.appid=t.appId,this.commInfo.domain=t.domain),this.commInfo.sdk_name="hwwebrtc",this.commInfo.corp="",this.commInfo.service_name="rtc",this.commInfo.operator="",this.commInfo.sdk_version="web-".concat(Kv,"-").concat(Wv),this.signalSendMsgs.push("BYE"),this.signalSendMsgs.push("PUSH_STREAM_RES_ALL"),this.signalSendMsgs.push("APPLY_PUSH_STREAM"),this.signalSendMsgs.push("AUDIO_POLICY"),this.signalSendMsgs.push("SWITCH_ROLE"),this.signalSendMsgs.push("CHANGE_STREAM_STATUS"),this.signalSendMsgs.push("APP_DATA"),this.signalSendMsgs.push("ENABLE_AUDIO"),this.signalSendMsgs.push("DISABLE_AUDIO"),this.signalSendMsgs.push("ENABLE_VIDEO"),this.signalSendMsgs.push("DISABLE_VIDEO"),this.signalSendMsgs.push("JOIN_ROOM"),this.signalSendMsgs.push("EXIT_ROOM"),this.signalSendMsgs.push("PING"),this.signalSendMsgs.push("PUSH_STREAM_RESULT"),this.signalSendMsgs.push("GET_ROOM_USERINFO"),this.signalSendMsgs.push("QUERY_PUBLISH"),this.signalSendMsgs.push("START_PUBLISH"),this.signalSendMsgs.push("STOP_PUSH_STREAM"),this.signalSendMsgs.push("STOP_PUBLISH"),this.signalSendMsgs.push("CANCEL_SUBS_STREAM"),this.signalSendMsgs.push("SUBS_STREAM"),this.signalSendMsgs.push("UPDATE_PUBLISH"),this.signalReceiveMsgs.push("WATCH_STREAM_NOTIFY")}static isStatiscEnable(){return"off"!==cI.getParameter(tI)}addCommInfo(e){return e.timestamp=Hg.getCurrentTimestamp(),e.trace_id=this.commInfo.trace_id||"",e.instance_id=this.commInfo.instance_id,e.room_uid=this.commInfo.room_uid||"",e.domain=this.commInfo.domain||"",e.event_name=(null==e?void 0:e.event_name)||"",e.appid=this.commInfo.appid||"",e.corp=this.commInfo.corp||"",e.room_id=this.commInfo.room_id||"",e.user_id=this.getMediaStat().getEncryInfo(this.commInfo.user_id)||Qg.secretString(this.commInfo.user_id)||"",e.sdk_version=this.commInfo.sdk_version||"",e.sdk_name=this.commInfo.sdk_name||"",e.service_name=this.commInfo.service_name||"",e.operator=this.commInfo.operator||"",e.net_type=Hg.getNetworkType()||"",e.country="",e.province="",e.city="",e}setRemoteUserManager(e){this.remoteUserManager=e,this.mediaStats.setRemoteUserManager(e)}clearMediaStatBytes(){this.mediaStats.clearMediaStatBytes()}async collectReceiverDecodedFrameMap(){return this.mediaStats.getVideoReceiverFrameDecodedMap()}setLocalUserInfo(e){this.commInfo.room_id=e.roomId,this.commInfo.user_id=e.userId,this.user=e}setTraceInfo(e){this.commInfo.trace_id=e}setRoomUid(e){this.commInfo.room_uid=e}setSFUAddress(e){this.sfuInfo=e,e.ipAddress&&this.mediaStats.setSFUAddr(e.ipAddress)}getMediaStat(){return this.mediaStats}leaveRoom(){this.mediaCollectionTimer&&clearTimeout(this.mediaCollectionTimer),this.mediaStats.leaveRoom()}startMediaCollector(){clearTimeout(this.mediaCollectionTimer),this.mediaCollectionTimer=setTimeout((async()=>{try{await this.mediaStats.dealStats(),this.setMediaStatInfo(),this.setMediaStatSumInfo(),this.setInBoundAudioSsrcInfos(),eI.addRecords(this.mediaOpsData),this.mediaOpsData.length=0}catch(tb){this.logger.error(this.module_,"startMediaCollector failed ".concat(tb))}finally{this.startMediaCollector()}}),5e3)}reportAudioMuteInfo(e,t){const r=t?1:3;let i;i=1===e?DT.INPUT_AUDIO:DT.OUTPUT_AUDIO,this.reportSwitchDevicesInfo(i,this.deviceInfo.audioInputId,1,r)}reportVideoMuteInfo(e,t){const r=t?4:5;this.reportSwitchDevicesInfo(DT.INPUT_VIDEO,this.deviceInfo.videoInputId,0,r)}async setDeviceStatusInfo(){(async function(){return new Promise(((e,t)=>{navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices||t(new Eu(ou.RTC_ERR_CODE_NOT_SUPPORT_MEDIA_DEVICES)),navigator.mediaDevices.enumerateDevices().then((r=>{if(r&&0!==r.length){const t={};r.forEach((e=>{"default"!==e.deviceId&&"communications"!==e.deviceId&&(t[e.kind]=[...t[e.kind]||[],e])})),e(t)}else t(new Eu(ou.RTC_ERR_CODE_NO_AVAILABLE_DEVICES))})).catch((e=>{t(e)}))}))})().then((e=>{this.setSpeakerDeviceInfo(e.audiooutput||[]),this.setCameraDeviceInfo(e.videoinput||[]),this.setMicrophoneDeviceInfo(e.audioinput||[]),this.setDeviceUserAgent()})).catch((e=>{this.logger.error(this.module_,"getRTCDeviceGroups failed ".concat(e))}))}recordUploadRequsetInfo(e){if(null!=e&&e.type&&"PING"!==e.type)switch(this.reqInfoMap.set(e.requestId,e),e.type){case"JOIN_ROOM":e.eventId=VT.EVENT_JOIN_ROOM,this.eventInfoMap.set(e.eventId,e);break;case"EXIT_ROOM":e.eventId=VT.EVENT_LEAVE_ROOM,this.eventInfoMap.set(e.eventId,e);break;case"SWITCH_ROLE":e.eventId=VT.EVENT_SWITCH_ROLE,this.eventInfoMap.set(e.eventId,e);break;case"PUSH_STREAM_RES_ALL":if(e.videoStreams&&e.videoStreams.length>0){e.videoStreams.find((e=>"desktop"===(null==e?void 0:e.content)))&&(e.eventId=VT.EVENT_SEND_AUX_STREAM,this.eventInfoMap.set(e.eventId,e))}}}getDownloadRequestInfo(e){if(null==e||!e.requestId)return"";if("PONG"===e.resultMessage)return"PONG";const t=this.reqInfoMap.get(e.requestId);return t&&(null==t?void 0:t.type)||""}recordDownloadRequestInfo(e){if(null==e||!e.requestId)return;if("PONG"===e.resultMessage)return;const t=this.reqInfoMap.get(e.requestId);if(t){switch(this.reportSignalRepForServer2Web(t,e),t.type){case"SUBS_STREAM":t.videoUpstreams&&this.reportVideoSub(t.videoSubType,t.requestId,t.videoUpstreams,e.resultCode,e.resultMessage),t.audioUpstreams&&this.reportAudioSub(t.audioSubType,t.requestId,t.audioUpstreams,e.resultCode);break;case"PUSH_STREAM_RES_ALL":t.videoStreams&&t.videoStreams.length>0&&this.reportUpStreamVideoInfo(t.videoStreams,t.requestId,e.resultCode);break;case"AUDIO_POLICY":this.reportAudioPolicyInfo(t.audioPolicy,t.requestId,e.resultCode)}this.reqInfoMap.delete(e.requestId)}}setMediaStatInfo(){const e=this.mediaStats.getMediaStatInfo()||[];e.forEach((e=>{this.addCommInfo(e)})),this.mediaOpsData=this.mediaOpsData.concat(e)}setMediaStatSumInfo(){const e=this.mediaStats.getMediaStatSum()||[];e.forEach((e=>{this.addCommInfo(e)})),this.mediaOpsData=this.mediaOpsData.concat(e)}setInBoundAudioSsrcInfos(){const e=this.mediaStats.getInBoundAudioSsrc()||[];e.forEach((e=>{this.addCommInfo(e)})),this.mediaOpsData=this.mediaOpsData.concat(e)}setRequestId(e){const t=this.eventInfoMap.get(e.event);return t&&(e.request_id=t.requestId),this}reportJoinInfo(e,t,r,i,n){var s,o;this.getMediaStat().setACSAddr(t);const a={};a.event=VT.EVENT_JOIN_ROOM,a.access_addr=t,a.sfu_addr=this.sfuInfo.ipAddress,a.aport=this.sfuInfo.audioPort,a.vport=this.sfuInfo.videoPort,this.setRequestId(a),a.result=e,a.platform="web-"+Hg.getPlatform(),a.user_agent="web-"+Hg.getUserAgent(),a.role=null===(s=this.user)||void 0===s?void 0:s.role,a.join_qos=JSON.stringify(i||{}),a.is_rejoin=r?1:0,a.nick_name=(null===(o=this.user)||void 0===o?void 0:o.userName)||"",a.time_diff_server=0,a.failMessage=n,this.addCommInfo(a),this.joinTime=a.timestamp,this.eventInfoMap.delete(VT.EVENT_JOIN_ROOM),eI.reportRecords([a]).catch((e=>{this.logger.info(this.module_,"setJoinInfo failed to report! ".concat(e)),eI.addRecord(a)}))}reportLeavInfo(e){const t={};t.event=VT.EVENT_LEAVE_ROOM,t.reason=0,t.result=e,t.a_snd_lost_mean=0,t.v_snd_lost_mean=0,t.a_snd_band_width_mean=0,t.v_snd_band_width_mean=0,t.a_snd_rtt_mean=0,t.a_recv_rtt_mean=0,t.v_snd_rtt_mean=0,t.v_recv_rtt_mean=0,t.a_recv_lost_mean=0,t.v_recv_lost_mean=0,t.a_recv_band_width_mean=0,t.v_recv_band_width_mean=0,t.freeze_200ms_cnt=0,t.freeze_600ms_cnt=0,t.freeze_1000ms_cnt=0,t.stut_time_mean=0,t.freeze_400ms_cnt=0,t.freeze_200ms_rate=0,t.freeze_400ms_rate=0,t.freeze_600ms_rate=0,t.freeze_1000ms_rate=0,t.v_snd_frame_rate=0,t.v_snd_pkt_rate=0,t.a_snd_pkt_rate=0,t.v_recv_frame_rate=0,t.v_recv_pkt_rate=0,t.a_recv_pkt_rate=0,t.v_snd_jitter=0,t.v_recv_jitter=0,t.elapsed=(Hg.getCurrentTimestamp()-this.joinTime)/1e3,this.addCommInfo(t),this.setRequestId(t),this.eventInfoMap.delete(VT.EVENT_LEAVE_ROOM),eI.reportRecords([t]).catch((e=>{this.logger.info(this.module_,"setLeaveInfo failed to report! ".concat(e)),eI.addRecord(t)}))}reportVideoSub(e,t,r,i,n){const s=[],o=[],a=[],c=[];null==r||r.forEach((e=>{const t=this.getMediaStat().getEncryInfo(e.pUserId)||Qg.secretString(e.pUserId)||"";o.push(t),s.push(e.pSsrcId);const r=this.remoteUserManager.getStreamInfoByPStreamUid(e.pStreamUid);if(r){const e=hI.getResolutionType(r.width,r.height);a.push(e&&e.toUpperCase().replace("-",""))}else this.logger.warn(this.module_,"Can not getStreamInfoByPStreamUid for reportVideoSub");c.push(String(e.pStreamUid))}));const u={event:VT.EVENT_WATCH,action:GT[e],request_id:t,ssrc_list:s.join(","),stream_uid_list:c.join(","),uid_list:o.join(","),img_list:a.join(","),result:i,failMessage:0===i?"":n};this.addCommInfo(u),eI.addRecord(u)}reportSwitchDevicesInfo(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6;e===DT.OUTPUT_AUDIO?this.deviceInfo.audioOutputId=t:e==DT.INPUT_AUDIO?this.deviceInfo.audioInputId=t:e===DT.INPUT_VIDEO&&(this.deviceInfo.videoInputId=t);const n={event:VT.EVENT_SWITCH_DEVICE,type:e,name:t,result:r,opt:i};this.addCommInfo(n),eI.addRecord(n)}reportSwitchRoleInfo(e,t){const r={event:VT.EVENT_SWITCH_ROLE,role:e,result:t};this.setRequestId(r),this.addCommInfo(r),eI.addRecord(r)}reportStartSendMediaStream(e,t){const r={event:VT.EVENT_SEND_MEDIA,type:e,opt:t};this.addCommInfo(r),eI.reportRecords([r]).catch((e=>{this.logger.info(this.module_,"reportStartSendMediaStream failed to report! ".concat(e)),eI.addRecord(r)}))}setMediaCaptureSucc(e,t){const r={event:VT.EVENT_START_MEDIA,type:e,dev_name:t};this.addCommInfo(r),eI.addRecord(r)}reportAuxiliaryStreamShareInfo(e,t){const r={event:VT.EVENT_SEND_AUX_STREAM,action:e,result:t};this.setRequestId(r),this.addCommInfo(r),eI.reportRecords([r]).catch((e=>{this.logger.info(this.module_,"setAuxiliaryStreamShareInfo failed to report! ".concat(e)),eI.addRecord(r)}))}setAudioSubscribeInfo(e,t,r){const i=[];let n;null==e||e.forEach((e=>{const t={uid:this.getMediaStat().getEncryInfo(null==e?void 0:e.userid)||Qg.secretString(null==e?void 0:e.userid)||"",ssrc:(null==e?void 0:e.ssrc)||0};i.push(t),n=e.action-1}));const s={event:VT.EVENT_SUBSCIBE,request_id:t,policy:this.getMediaStat().getAudioPolicy(),streams:i,action:n,result:r};this.addCommInfo(s),eI.reportRecords([s]).catch((e=>{this.logger.info(this.module_,"setAudioSubscribeInfo failed to report! ".concat(e)),eI.addRecord(s)}))}reportAudioSub(e,t,r,i){const n=[];null==r||r.forEach((e=>{const t={uid:this.getMediaStat().getEncryInfo(null==e?void 0:e.pUserId)||Qg.secretString(null==e?void 0:e.pUserId)||"",ssrc:(null==e?void 0:e.pSsrcId)||0};n.push(t)}));const s={event:VT.EVENT_SUBSCIBE,request_id:t,policy:this.getMediaStat().getAudioPolicy(),streams:n,action:e,result:i};this.addCommInfo(s),eI.reportRecords([s]).catch((e=>{this.logger.info(this.module_,"reportAudioSub failed to report! ".concat(e)),eI.addRecord(s)}))}setConnectionStatusInfo(e,t){const r={timestamp:0,event:VT.EVENT_CONNECTION_CHANNEL_STATUS,type:t,on:e};this.addCommInfo(r),eI.reportRecords([r]).catch((e=>{this.logger.info(this.module_,"setConnectionStatusInfo failed to report! ".concat(e)),eI.addRecord(r)}))}reportUpStreamVideoInfo(e,t,r){const i=[],n=[];e.forEach((e=>{n.push(hI.getResolution(e.width,e.height)),i.push("".concat(e.width,"*").concat(e.height))}));const s={event:VT.EVENT_SET_UP_STREAM,request_id:t,resolution_name_list:n.join(","),width_height_list:i.join(","),result:0===r?NT.SUCCESS:NT.FAIL};this.addCommInfo(s),eI.addRecord(s)}reportAudioPolicyInfo(e,t,r){const i={event:VT.EVENT_SET_AUDIO_POLICY,request_id:t,policy:e,result:r,topn:1===e?3:17};this.addCommInfo(i),eI.addRecord(i)}setSysBasicInfo(){const e={event:YT.DEVICE_RT_SYSTEM,device_cpu:0,app_cpu:0,mem_ratio:0};this.addCommInfo(e),eI.addRecord(e)}setCameraInfo(e,t){const r={event:YT.DEVICE_RT_CAMERA,cap_format:0,cap_width:(null==e?void 0:e.width)||0,cap_height:(null==e?void 0:e.height)||0,cap_frame_rate:(null==e?void 0:e.frameRate)||0,out_width:(null==t?void 0:t.width)||0,out_height:(null==t?void 0:t.height)||0,out_cap_frames:(null==t?void 0:t.frameRate)||0,cap_overtime_cnt:0,frame_capture_time:0,render_frame_rate:0,frame_render_time:0};this.addCommInfo(r),eI.addRecord(r)}setSpeakerInputInfo(){const e={event:YT.DEVICE_RT_SPEAKER,dst_down_vel:0,dst_down_nel:0,speaker_vol:0,speaker_play_err_num:0};this.addCommInfo(e),eI.addRecord(e)}setMicrophoneInfo(){const e={event:YT.DEVICE_RT_MICROPHONE,src_cap_vel:0,src_cap_nel:0,src_mic_vol_scale:0,capture_abnormal:0,mic_vol:0,mic_recoder_err_num:0};this.addCommInfo(e),eI.addRecord(e)}async setSpeakerDeviceInfo(e){const t=[];for(let i=0;i<e.length;i++)t.push("".concat(e[i].deviceId,"(").concat(e[i].label,")"));const r={event:FT.DEVICE_STATUS_SPEAKER,device_nums:e.length,device_list:t.join(",")};this.addCommInfo(r),eI.addRecord(r)}async setCameraDeviceInfo(e){const t=[];for(let i=0;i<e.length;i++)t.push("".concat(e[i].deviceId,"(").concat(e[i].label,")"));const r={event:FT.DEVICE_STATUS_CAMERA,device_nums:e.length,device_list:t.join(",")};this.addCommInfo(r),eI.addRecord(r)}async setMicrophoneDeviceInfo(e){const t=[];for(let i=0;i<e.length;i++)t.push("".concat(e[i].deviceId,"(").concat(e[i].label,")"));const r={event:FT.DEVICE_STATUS_MICROPHONE,device_nums:e.length,device_list:t.join(",")};this.addCommInfo(r),eI.addRecord(r)}setDeviceChangedInfo(e,t,r){this.logger.debug(this.module_,"setDeviceChangedInfo type[".concat(e,"] deviceId[").concat(t,"] state[").concat(r,"]"));let i=0;"audioinput"===e?i=1:"videoinput"===e&&(i=2);const n={timestamp:Hg.getCurrentTimestamp(),event:FT.DEVICE_STATUS_DEVICE_CHANGE,type:i,name:t,state:r};this.addCommInfo(n),eI.addRecord(n),this.setDeviceStatusInfo()}setAvAlarmInfo(){const e={event:FT.DEVICE_STATUS_ERROR,type:0,muid:"",err_num:"",err_info:""};this.addCommInfo(e),eI.addRecord(e)}setMediaQualityEvaluationInfo(){const e={timestamp:Hg.getCurrentTimestamp(),event:FT.DEVICE_STATUS_MEDIA_QUALITY,muid:"",type:0};this.addCommInfo(e),eI.addRecord(e)}setDeviceUserAgent(){const e={timestamp:Hg.getCurrentTimestamp(),event:FT.DEVICE_STATUS_USERAGENT,user_agent:navigator.userAgent};this.addCommInfo(e),eI.reportRecords([e]).catch((t=>{this.logger.info(this.module_,"setDeviceUserAgent failed to report! ".concat(t)),eI.addRecord(e)}))}reportSignalReqForLogUpload(e){if(!_I.isStatiscEnable())return;const t={event:jT.SIGNAL_REQUEST,event_name:"EVENT^log_upload^SDK^OPS",send_time:Hg.getCurrentTimestamp(),req_body:e,result:0,source:"sdk",target:"access"};this.addCommInfo(t),eI.addRecord(t)}reportSignalReqForHeartBeatLost(e,t){var r;if(!_I.isStatiscEnable()||"PING"!==e.type)return;let i="";null!==(r=e.body)&&void 0!==r&&r.action&&(i="#"+e.body.action);const n={timestamp:t,event:jT.SIGNAL_REQUEST,event_name:"SIGNAL^".concat(e.type).concat(i,"^SDK^ACS"),request_id:e.requestId,send_time:t,req_body:JSON.stringify(e),result:0,source:"sdk",target:"access"};this.addCommInfo(n),eI.addRecord(n)}reportSignalReqForWeb2Server(e){if(!_I.isStatiscEnable()||!e.type||"PING"===e.type)return;const t="SIGNAL^".concat(e.type,"^SDK^ACS"),r=Hg.getCurrentTimestamp(),i={timestamp:r,event:jT.SIGNAL_REQUEST,event_name:t,request_id:e.requestId,send_time:r,req_body:JSON.stringify(e),result:0,source:"sdk",target:"access"};this.addCommInfo(i),eI.addRecord(i)}reportSignalReqForServer2Web(e){if(_I.isStatiscEnable()&&e.type)switch(e.type){case"WATCH_STREAM_NOTIFY":case"APP_DATA_NOTIFY":case"PUBLISH_STATUS_NOTIFY":case"NOTIFY_STATUS":case"UPLOAD_LOG_NOTIFY":case"DISCONNECT_NOTIFY":case"PUSH_STREAM_NOTIFY":case"RECONNECT_NOTIFY":case"STOP_PUSH_STREAM_NOTIFY":case"CHANGE_STREAM_STATUS_NOTIFY":{const t="SIGNAL^".concat(e.type),r={event:jT.SIGNAL_REQUEST,event_name:"".concat(t,"^ACS^SDK"),request_id:e.requestId,send_time:Hg.getCurrentTimestamp(),req_body:JSON.stringify(e),result:0,source:"access",target:"sdk"};this.addCommInfo(r),eI.addRecord(r);break}}}reportSignalRepForLogUpload(e,t){if(!_I.isStatiscEnable())return;const r={timestamp:Hg.getCurrentTimestamp(),event:jT.SIGNAL_RESPONSE,event_name:"EVENT^log_upload^OPS^SDK",recv_time:Hg.getCurrentTimestamp(),rsp_body:e,rsp_code:t,result:0,source:"access",target:"sdk"};this.addCommInfo(r),eI.addRecord(r)}reportSignalRepForServer2Web(e,t){if(!_I.isStatiscEnable())return;const r="SIGNAL^".concat(e.type,"^SDK^ACS"),i=Hg.getCurrentTimestamp(),n={event:jT.SIGNAL_RESPONSE,eventName:r,request_id:t.requestId,recv_time:i,rsp_body:JSON.stringify(t),rsp_code:t.result||0,result:t.result||0,source:"access",target:"sdk"};this.addCommInfo(n),eI.addRecord(n)}setApiCallInfo(e,t,r,i,n){if(!_I.isStatiscEnable())return;const s="API^web#".concat(e,"^APP^SDK");for(var o=arguments.length,a=new Array(o>5?o-5:0),c=5;c<o;c++)a[c-5]=arguments[c];const u={api_call_id:Hg.generateUuid(),api_name:s,start_time:t,end_time:r,event:zT.API_CALL,event_name:s,params:JSON.stringify(a)};i?u.exception="".concat(i.code," - ").concat(i.message):u.ret=n?JSON.stringify(n):"",this.addCommInfo(u),/checkSystemRequirements/.test(e)?eI.reportRecords([u]):eI.addRecord(u)}recordCallbackInfo(e,t,r,i,n,s){if(!_I.isStatiscEnable())return;if(-1!==ST.indexOf(e))return;const o=s((null==n?void 0:n.stream)||n),a={event:zT.CALLBACK_API,event_name:"CALLBACK^web#".concat(t,"$#").concat(e,"#^SDK^APP"),api_call_id:Hg.generateUuid(),callback_name:"CALLBACK^web#".concat(t,"$#").concat(e,"#^SDK^APP"),callback_type:e,params:o,start_time:r,end_time:i};this.addCommInfo(a),eI.addRecord(a)}setFirstFrameInfo(e){if(!_I.isStatiscEnable())return;const t={event:HT.FirstFrame,startupqos:e};this.addCommInfo(t),eI.addRecord(t)}setSpanId(e,t){t&&""!==t&&e&&""!==e&&this.spanIdMap.set(e,t)}getSpanId(e){if(e&&""!==e){const t=this.spanIdMap.get(e);return t&&this.spanIdMap.delete(e),t||""}return""}setParentSpanId(e,t){e&&""!==e&&t&&""!==t&&this.parentSpanIdMap.set(e,t)}getParentSpanId(e){if(e&&""!==e){const t=this.parentSpanIdMap.get(e);return t&&this.parentSpanIdMap.delete(e),t||""}return""}checkSignalReceiveMsgs(e){return this.signalReceiveMsgs.includes(e)}checkSignalSendMsgs(e){return this.signalSendMsgs.includes(e)}reportTraceInfo2Nuwa(e){if(!_I.isStatiscEnable())return;const t={event:KT.TraceNuwa,trace_info:"".concat(e.version,"|").concat(e.startTimestamp,"|").concat(e.traceId,"|").concat(e.spanId,"|").concat(e.parentSpanId,"|").concat(e.ip,"|").concat(e.source,"|").concat(e.target,"|").concat(e.spanName,"|").concat(e.status,"|").concat(e.endTimestamp,"||||||||").concat(e.scope)};this.addCommInfo(t),eI.addRecord(t)}async buildRtcStatsDebugInfo(e){return this.mediaStats.buildRtcStatsDebugInfo(e)}}const gI="HRTCStat";class SI{constructor(){this.reportSymbol=Symbol("HRTCStat_".concat(Hg.getCurrentTimestamp())),this.logger=Qg.getLogger(this),this.stat=new _I(this.logger),this.stat.setDeviceStatusInfo()}static getStat(){return SI.hrtcStat.stat}getSymbol(){return this.reportSymbol}getInfo(){return{}}onLogUploadResult(e){this.logger.debug(gI,"status=".concat(e))}onLogUploadProgress(e){this.logger.debug(gI,"status=".concat(e))}}bu(SI,"hrtcStat",new SI);const vI=["IDLE","DISCONNECTED","CONNECTING","RECONNECTING","CONNECTED"];var RI,TI,II,yI,EI;!function(e){e[e.IDLE=0]="IDLE",e[e.DISCONNECTED=1]="DISCONNECTED",e[e.CONNECTING=2]="CONNECTING",e[e.RECONNECTING=3]="RECONNECTING",e[e.CONNECTED=4]="CONNECTED"}(RI||(RI={})),function(e){e[e.MediaStatusAvailable=1]="MediaStatusAvailable",e[e.MediaStatusUnavailable=2]="MediaStatusUnavailable"}(TI||(TI={})),function(e){e[e.StreamPkgsSend=1]="StreamPkgsSend",e[e.NoStreamPkgsSend=2]="NoStreamPkgsSend"}(II||(II={})),function(e){e[e.BackgroundMusic=1]="BackgroundMusic",e[e.Audio=2]="Audio",e[e.Video=3]="Video",e[e.Aux=4]="Aux"}(yI||(yI={})),function(e){e[e.MediaOffline=0]="MediaOffline",e[e.MediaMuted=1]="MediaMuted",e[e.MediaUnmuted=2]="MediaUnmuted"}(EI||(EI={}));const bI=new Set(["TOP_AUDIO"]);var CI,AI;!function(e){e.configNotify="NOTIFY_CONFIG",e.watchStreamNotify="WATCH_STREAM_NOTIFY",e.disconnectNotify="DISCONNECT_NOTIFY",e.pushStreamNotify="PUSH_STREAM_NOTIFY",e.reconnectNotify="RECONNECT_NOTIFY",e.stopPushStreamNotify="STOP_PUSH_STREAM_NOTIFY",e.changeStreamStatusNotify="CHANGE_STREAM_STATUS_NOTIFY",e.appDataChangeNotify="APP_DATA_NOTIFY",e.top3AudioVolumeNotify="TOP_AUDIO",e.statusChangeNotify="NOTIFY_STATUS",e.publishStatusNotify="PUBLISH_STATUS_NOTIFY",e.kickNotify="KICK_ROOM",e.uploadLogNotify="UPLOAD_LOG_NOTIFY"}(CI||(CI={})),function(e){e.main="main",e.middle1="middle1",e.middle2="middle2",e.middle3="middle3",e.middle4="middle4",e.slides="slides",e.desktop="desktop"}(AI||(AI={}));const kI="0",wI=-1e3;var OI,PI;!function(e){e[e.ON=1]="ON",e[e.OFF=2]="OFF"}(OI||(OI={})),function(e){e[e.portNormal=1]="portNormal",e[e.portReduce=2]="portReduce"}(PI||(PI={}));const MI={Error:"error",StreamAdded:"stream-added",StreamRemoved:"stream-removed",StreamUpdated:"stream-updated",StreamSubscribed:"stream-subscribed",ClientBanned:"client-banned",NetworkQuality:"network-quality",ConnectionStateChanged:"connection-state-changed",PeerJoin:"peer-join",PeerLeave:"peer-leave",SubstreamAvaliable:"screen-capture-available",MuteAudio:"mute-audio",UnmuteAudio:"unmute-audio",MuteVideo:"mute-video",UnmuteVideo:"unmute-video",LogUploaded:"log-upload-result",LogUploadProgress:"log-upload-process",SignatureExpired:"signature-expired",CameraChanged:"camera-changed",RecordingDeviceChanged:"recording-device-changed",PlaybackDeviceChanged:"playback-device-changed",StreamInterrupted:"stream-interrupted",StreamRecovered:"stream-recovered",VolumeIndicator:"volume-indicator",UserNameChanged:"remote-user-name-changed",BatchSubscribeFailed:"batch-subscribe-failed",LiveStreamingUpdated:"live-streaming-updated",RtcStats:"rtc-stats"},DI={videoinput:"CameraChanged",audioinput:"RecordingDeviceChanged",audiooutput:"PlaybackDeviceChanged"},xI="ADD",NI="REMOVE",UI="DeviceChangeListener";const LI=new class{constructor(){this.internalEventEmitters=[],this.clientEventEmitter=null,this.deviceChangeCallBack=[],this.initFlag=!1,this.logger=Qg.getLogger(),this.stat=new _I(this.logger)}initDeviceChangedNotify(e,t){this.addEventEmitter(e,t),this.initFlag||(this.initFlag=!0,this.registerDeviceChangedNotify())}addEventEmitter(e,t){t?this.internalEventEmitters.push(e):this.clientEventEmitter=e}removeEventEmitter(e){e!==this.clientEventEmitter?this.internalEventEmitters=this.internalEventEmitters.filter((t=>t!==e)):this.clientEventEmitter=null}registerDeviceChangedNotify(){let e=!1;JT().then((e=>{(!e||e.length<=0)&&this.logger.info(UI,"no device avaliable now"),e=e||[],this.preDevices=new Map;for(const t of e)Qg.addPrivacyString(t.deviceId),t.deviceId&&"default"!==t.deviceId&&"communications"!==t.deviceId&&this.preDevices.set(t.deviceId,t.kind)})).finally((()=>{navigator.mediaDevices.ondevicechange=async t=>{if(t.isTrusted){if(this.deviceChangeCallBack.push(this.handleDeviceChangeEvent.bind(this)),!e)for(;this.deviceChangeCallBack.length>0;)e=!0,await this.deviceChangeCallBack.shift()(),this.deviceChangeCallBack.length<1&&(e=!1)}else this.logger.error(UI,"device change event trigger by script")}}))}async handleDeviceChangeEvent(){let e=await JT();e=e||[];const t=new Map;for(const i of e)i.deviceId&&"default"!==i.deviceId&&"communications"!==i.deviceId&&t.set(i.deviceId,i.kind);let r=this.internalEventEmitters;this.clientEventEmitter&&(r=[...this.internalEventEmitters,this.clientEventEmitter]),this.preDevices.forEach(((e,i)=>{t.has(i)||(this.logger.info(UI,"deviceType: ".concat(e," deviceId: ").concat(i," remove")),r.forEach((t=>{t.emit(MI[DI[e]],{deviceId:i,state:NI})})),this.stat.setDeviceChangedInfo(e,i,1))})),t.forEach(((e,t)=>{this.preDevices.has(t)||(this.logger.info(UI,"deviceType: ".concat(e," deviceId: ").concat(t," add")),r.forEach((r=>{r.emit(MI[DI[e]],{deviceId:t,state:xI})})),this.stat.setDeviceChangedInfo(e,t,0))})),this.preDevices=t}};const VI=new class{constructor(){bu(this,"eventHandlers",{visibilitychange:()=>{let e="FOREGROUND";document.hidden&&(e="BACKGROUND");for(const t of this.eventBus.values())t.emit(e)}}),bu(this,"eventListeners",{visibilitychange:e=>{"ADD"===e?document.addEventListener("visibilitychange",this.eventHandlers.visibilitychange):document.removeEventListener("visibilitychange",this.eventHandlers.visibilitychange)}}),this.eventBus=new Map,this.addListener("visibilitychange",Hg.isMobileDevice.bind(Hg))}register(e){const t=Hg.generateRandomId(32);return this.eventBus.set(t,e),t}unregister(e){e&&this.eventBus.delete(e)}addListener(e,t){t&&!t()||this.eventListeners[e]&&this.eventListeners[e]("ADD")}removeListener(e){this.eventListeners[e]&&this.eventListeners[e]("REMOVE")}};class BI{constructor(){this.context_=new AudioContext,this.script_=this.context_.createScriptProcessor(2048,1,1),this.script_.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0);let r=0,i=0;for(let n=0;n<t.length;n++)r+=t[n]*t[n],Math.abs(t[n])>.99&&(i+=1);this.instant_=Math.sqrt(r/t.length),this.slow_=.95*this.slow_+.05*this.instant_,this.clip_=i/t.length},this.instant_=0,this.slow_=0,this.clip_=0}connectToSource(e){return new Promise(((t,r)=>{try{const r=new MediaStream;r.addTrack(e),this.mic_=this.context_.createMediaStreamSource(r),this.mic_.connect(this.script_),this.script_.connect(this.context_.destination),t()}catch(i){r(i)}}))}stop(){this.mic_.disconnect(),this.script_.disconnect(),this.context_.close()}getVolume(){return parseFloat(this.instant_.toFixed(2))}}class YI{constructor(e){this.module_="RTCPlayer",this.mediaStream_=new MediaStream,this.log_=e.logger,this.track_=e.track,this.playerDiv_=e.playerDiv,this.playerId_=e.playerId,this.playerElement_=null,this.state_="NONE",this.event_=new xv,this.pauseCount=0,this.listenHandlers={canPlayHandler:this.canPlayHandler.bind(this),playingHandler:this.playingHandler.bind(this),playerEndedHandler:this.playerEndedHandler.bind(this),playerPausedHandler:this.playerPausedHandler.bind(this),trackEndedHandler:this.trackEndedHandler.bind(this),trackMutedHandler:this.trackMutedHandler.bind(this),trackUnmutedHandler:this.trackUnmutedHandler.bind(this),playHandler:null,backgroundHandler:this.backgroundHandler.bind(this),foregroundHandler:this.foregroundHandler.bind(this)}}on(e,t){this.event_.on(e,t)}off(e,t){this.event_.removeListener(e,t)}foregroundHandler(){this.log_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, application is foreground"),this.module_.indexOf("Audio")>0&&this.track_&&this.trackEnable!==this.track_.enabled&&(this.track_.enabled=this.trackEnable),"PAUSED"===this.state_&&(this.module_.indexOf("Video")>0?this.event_.emit("videoCanPlay"):this.event_.emit("audioCanPlay"))}backgroundHandler(){this.log_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, application is background"),this.module_.indexOf("Audio")>0&&this.track_&&(this.trackEnable=this.track_.enabled,this.trackEnable&&(this.track_.enabled=!1))}canPlayHandler(){this.log_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, player is canplay status"),this.event_.emit(this.module_.indexOf("Video")>0?"videoCanPlay":"audioCanPlay"),this.event_.emit(gT,{event:"playerCanplay",type:"".concat(this.module_),streamId:this.playerId_})}playingHandler(){this.log_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, player is starting playing"),this.event_.emit(gT,{event:"playerPlaying",type:"".concat(this.module_),streamId:this.playerId_}),this.state_="PLAYING",this.event_.emit(fT,{state:this.state_,reason:"playing"})}playerEndedHandler(){this.log_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, player is ended"),this.event_.emit(gT,{event:"playerEnded",type:"".concat(this.module_),streamId:this.playerId_}),"STOPPED"!==this.state_&&(this.state_="STOPPED",this.event_.emit(fT,{state:this.state_,reason:"ended"}))}playerPausedHandler(){this.log_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, player is paused"),this.event_.emit(gT,{event:"playerPause",type:"".concat(this.module_),streamId:this.playerId_}),this.state_="PAUSED",this.event_.emit(fT,{state:this.state_,reason:"pause"}),this.module_.indexOf("Video")>0?(this.log_.debug("".concat(this.module_,"#").concat(this.playerId_),"try to play again"),this.event_.emit("videoCanPlay")):(this.log_.debug("".concat(this.module_,"#").concat(this.playerId_),"try to play again"),this.event_.emit("audioCanPlay"))}trackEndedHandler(){this.log_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, player track is ended"),this.event_.emit(gT,{event:"trackEnded",type:"".concat(this.module_),streamId:this.playerId_}),"STOPPED"!==this.state_&&(this.state_="STOPPED",this.event_.emit(fT,{state:this.state_,reason:"ended",trackEnded:!0}))}trackMutedHandler(){this.log_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, track is muted"),this.event_.emit(gT,{event:"trackMute",type:"".concat(this.module_),streamId:this.playerId_}),"PAUSED"!==this.state_&&(this.state_="PAUSED",this.event_.emit(fT,{state:this.state_,reason:"mute"}))}trackUnmutedHandler(){this.log_.debug("".concat(this.module_,"#[").concat(this.playerId_,"]"),"handleEvents, track is unmuted"),this.event_.emit(gT,{event:"trackUnmute",type:"".concat(this.module_),streamId:this.playerId_}),"PAUSED"===this.state_&&(this.state_="PLAYING",this.event_.emit(fT,{state:this.state_,reason:"unmute"}))}closeAllEvents(){var e,t,r,i,n,s,o,a,c;null===(e=this.playerElement_)||void 0===e||e.removeEventListener("canplay",this.listenHandlers.canPlayHandler),null===(t=this.playerElement_)||void 0===t||t.removeEventListener("playing",this.listenHandlers.playingHandler),null===(r=this.playerElement_)||void 0===r||r.removeEventListener("ended",this.listenHandlers.playerEndedHandler),null===(i=this.playerElement_)||void 0===i||i.removeEventListener("pause",this.listenHandlers.playerPausedHandler),null===(n=this.track_)||void 0===n||n.removeEventListener("ended",this.listenHandlers.trackEndedHandler),null===(s=this.track_)||void 0===s||s.removeEventListener("mute",this.listenHandlers.trackMutedHandler),null===(o=this.track_)||void 0===o||o.removeEventListener("unmute",this.listenHandlers.trackUnmutedHandler),null===(a=this.event_)||void 0===a||a.removeListener("videoCanPlay",this.listenHandlers.playHandler),null===(c=this.event_)||void 0===c||c.removeListener("audioCanPlay",this.listenHandlers.playHandler),this.event_.removeListener("FOREGROUND",this.listenHandlers.foregroundHandler),this.event_.removeListener("BACKGROUND",this.listenHandlers.backgroundHandler),VI.unregister(this.sysEventRegisterUid)}handleEvents(){this.playerElement_.addEventListener("canplay",this.listenHandlers.canPlayHandler),this.playerElement_.addEventListener("playing",this.listenHandlers.playingHandler),this.playerElement_.addEventListener("ended",this.listenHandlers.playerEndedHandler),this.playerElement_.addEventListener("pause",this.listenHandlers.playerPausedHandler),this.track_.addEventListener("ended",this.listenHandlers.trackEndedHandler),this.track_.addEventListener("mute",this.listenHandlers.trackMutedHandler),this.track_.addEventListener("unmute",this.listenHandlers.trackUnmutedHandler),this.event_.on("FOREGROUND",this.listenHandlers.foregroundHandler),this.event_.on("BACKGROUND",this.listenHandlers.backgroundHandler),this.sysEventRegisterUid=VI.register(this.event_)}stop(){this.closeAllEvents(),this.playerElement_&&(this.playerElement_.srcObject=null),this.playerElement_=null,this.mediaStream_=new MediaStream,this.log_.info(this.module_,"stop success")}replaceTrack(e){this.log_.info(this.module_,"replaceTrack start");const t=this.module_.indexOf("Audio")>0?this.mediaStream_.getAudioTracks():this.mediaStream_.getVideoTracks(),r=t.length?t[0]:null;r!==e&&(r&&this.mediaStream_.removeTrack(r),this.mediaStream_.addTrack(e),this.track_=e)}async resume(e){return new Promise(((t,r)=>{this.playerElement_?this.playerElement_.play().then((()=>{this.log_.info(this.module_,"audio player resume success, streamId:".concat(this.playerId_,", playParameters: ").concat(JSON.stringify(e))),t(null)})).catch((t=>{this.log_.error(this.module_,"player resume failed, errmsg=".concat(t," , playParameters: ").concat(JSON.stringify(e))),"NotAllowedError"===t.name?r(new Eu(ou.RTC_ERR_CODE_PLAY_NOT_ALLOW)):r(new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR,t.message))})):r(new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"resume failed, element is null"))}))}async multiPlatformAdapter(){return new Promise((e=>{if(Hg.isWKWebview()){const t=window.WeixinJSBridge;t?(this.log_.info(this.module_,"multiPlatformAdapter handle begin"),t.invoke("getNetworkType",{},(()=>{e()}),!1)):document.addEventListener("WeixinJSBridgeReady",(()=>{this.log_.info(this.module_,"multiPlatformAdapter WeixinJSBridgeReady,  handle begin"),t.invoke("getNetworkType",{},(()=>{e()}),!1)}))}else e()}))}async doPlay(e,t,r){let i;return await this.multiPlatformAdapter(),i=this.module_.indexOf("Video")>0?", screenFit:".concat(r.objectFit,", mirror:").concat(r.mirror):", deviceId:".concat(r.outputDeviceId,", volume:").concat(r.volume,", muted:").concat(r.muted),this.playerElement_.play().then((()=>{var t,r;this.log_.info(this.module_,"play success, parentDiv id:".concat(null===(t=this.playerDiv_)||void 0===t?void 0:t.id,", resolutionId or streamId:").concat(this.playerId_,", physical track id:").concat(null===(r=this.track_)||void 0===r?void 0:r.id).concat(i)),this.afterPlayStrategy(),e(null)})).catch((e=>{var r,n;this.log_.error(this.module_,"play failed, errmsg=".concat(e,",parentDiv id:").concat(null===(r=this.playerDiv_)||void 0===r?void 0:r.id,", resolutionId or streamId:").concat(this.playerId_,", physical track id:").concat(null===(n=this.track_)||void 0===n?void 0:n.id).concat(i)),"NotAllowedError"===e.name?t(new Eu(ou.RTC_ERR_CODE_PLAY_NOT_ALLOW)):t(new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR,e.message))})).finally((()=>{clearTimeout(this.playTimeOutTimer)}))}afterPlayStrategy(){if(!this.pauseCount&&Hg.getPlatform().indexOf("Ios15")>=0){this.log_.error(this.module_,Hg.getPlatform());const e=setTimeout((()=>{clearTimeout(e),this.playerElement_.pause(),this.pauseCount++}),100)}}}class FI extends YI{constructor(e){super({logger:e.logger,track:e.track,playerDiv:e.playerDiv,playerId:e.playerId}),this.module_="RTCAudioPlayer",this.muted_=e.muted,this.outputDeviceId_="",this.volume_="number"==typeof(null==e?void 0:e.volume)?e.volume:.5,this.soundMeter_=null}async play(){return new Promise(((e,t)=>{let r,i=!0;var n;(r=this.playerDiv_?this.playerDiv_.querySelector("#audio_".concat(this.playerId_)):this.playerElement_,r)||(r=document.createElement("audio"),r.muted=this.muted_,r.setAttribute("id","audio_".concat(this.playerId_)),r.setAttribute("autoplay",""),r.setAttribute("playsinline",""),r.setAttribute("muted",""),null===(n=this.playerDiv_)||void 0===n||n.appendChild(r),i=!1);!("sinkId"in HTMLMediaElement.prototype)&&this.outputDeviceId_&&r.setSinkId(this.outputDeviceId_),0===this.mediaStream_.getAudioTracks().length&&this.mediaStream_.addTrack(this.track_),r.srcObject=this.mediaStream_,this.playerElement_=r,this.setVolume(this.volume_),this.handleEvents(),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{this.log_.info(this.module_,"trigger audioCanPlay event by Timer"),this.event_.emit("audioCanPlay"),this.playTimeOutTimer&&(clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{this.log_.info(this.module_,"audio playing timeout"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=null,e(null)}),2e3))}),i?0:1e3),this.listenHandlers.playHandler&&this.event_.removeListener("audioCanPlay",this.listenHandlers.playHandler),this.listenHandlers.playHandler=this.doPlay.bind(this,e,t,{deviceId:this.outputDeviceId_,volume:this.volume_,muted:this.muted_}),this.event_.on("audioCanPlay",this.listenHandlers.playHandler)}))}setSinkId(e){this.outputDeviceId_!==e&&(this.playerElement_.setSinkId(e),this.outputDeviceId_=e)}setVolume(e){this.playerElement_.volume=e}getAudioLevel(){return this.soundMeter_||(this.soundMeter_=new BI,this.soundMeter_.connectToSource(this.track_)),this.soundMeter_.getVolume()}stop(){super.stop(),this.soundMeter_&&(this.soundMeter_.stop(),this.soundMeter_=null)}async resume(){return super.resume({streamId:this.playerId_,deviceId:this.outputDeviceId_,volume:this.volume_,muted:this.muted_})}replaceTrack(e){super.replaceTrack(e),this.soundMeter_&&(this.soundMeter_.stop(),this.soundMeter_=null)}}class jI extends YI{constructor(e){super({logger:e.logger,track:e.track,playerDiv:e.parentDiv,playerId:e.playerId}),this.module_="RTCVideoPlayer",this.objectFit_=e.objectFit,this.mirror_=e.mirror}async play(){return new Promise(((e,t)=>{let r=this.playerDiv_.querySelector("#video_".concat(this.playerId_)),i=!0;if(!r){r=document.createElement("video"),r.muted=!0;let e="0";this.mirror_&&(e="180deg"),r.setAttribute("id","video_".concat(this.playerId_)),r.style.width="100%",r.style.height="100%",r.style.position="absolute",r.style.transform="rotateY(".concat(e,")"),r.style["object-fit"]=this.objectFit_,r.setAttribute("autoplay",""),r.setAttribute("playsinline",""),r.setAttribute("muted",""),this.playerDiv_.appendChild(r),i=!1}0===this.mediaStream_.getVideoTracks().length&&this.mediaStream_.addTrack(this.track_),r.srcObject=this.mediaStream_,this.playerElement_=r,this.handleEvents(),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{this.log_.info(this.module_,"trigger videoCanPlay event by Timer"),this.event_.emit("videoCanPlay"),this.playTimeOutTimer&&(clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{this.log_.info(this.module_,"video playing timeout"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=null,e(null)}),2e3))}),i?0:1e3),this.listenHandlers.playHandler&&this.event_.removeListener("videoCanPlay",this.listenHandlers.playHandler),this.listenHandlers.playHandler=this.doPlay.bind(this,e,t,{objectFit:this.objectFit_,mirror:this.mirror_}),this.event_.on("videoCanPlay",this.listenHandlers.playHandler)}))}async resume(){return super.resume({streamId:this.playerId_,screentFit:this.objectFit_,mirror:this.mirror_})}getVideoFrame(){const e=document.createElement("canvas");return e.width=this.playerElement_.videoWidth,e.height=this.playerElement_.videoHeight,e.getContext("2d").drawImage(this.playerElement_,0,0),e.toDataURL("image/png")}}function zI(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function HI(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?zI(Object(r),!0).forEach((function(t){bu(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zI(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function KI(e){const t=ET.find((t=>t.startsWith("".concat(e.height))&&yT[t].width===e.width||parseInt(t)>e.height));t&&(e.maxBitrate&&e.minBitrate||(e.maxBitrate=yT[t].maxBitrate,e.minBitrate=yT[t].minBitrate),e.frameRate||(e.frameRate=yT[t].frameRate))}class WI{static getLocalProfileByTrack(e){const t={},r=e.getSettings();if(e.kind===uI.TRACK_TYPE_AUDIO)t.sampleRate=r.sampleRate,t.channelCount=1;else{var i,n,s,o;const a=e.getConstraints();t.width=("number"==typeof a.width?a.width:null===(i=a.width)||void 0===i?void 0:i.ideal)||r.width,t.height=("number"==typeof a.height?a.height:null===(n=a.height)||void 0===n?void 0:n.ideal)||r.height,t.frameRate=("number"==typeof a.frameRate?a.frameRate:null===(s=a.frameRate)||void 0===s?void 0:s.ideal)||parseInt(null===(o=r.frameRate)||void 0===o?void 0:o.toString()),t.minBitrate=null,t.maxBitrate=null,KI(t)}return t}static formatVideoProfile(e){let t={};if(!e){return t=HI({},yT["360p_2"]),t}if("string"==typeof e){if(ET.includes(e)){t=HI({},yT[e])}}else t.height=e.height,t.width=e.width,t.frameRate=e.frameRate,t.maxBitrate=e.maxBitrate,t.minBitrate=e.minBitrate,void 0!==t.width&&void 0!==t.height||(t.width=yT["360p_2"].width,t.height=yT["360p_2"].height),KI(t);return t}static formatAudioProfile(e){let t={};if(!e){return t=HI({},TT.standard),t}if("string"==typeof e){if(IT.includes(e)){t=HI({},TT[e])}}else t.bitrate=e.bitrate,t.channelCount=e.channelCount,t.sampleRate=e.sampleRate,t.sampleRate||(t.sampleRate=16e3),t.channelCount||(t.channelCount=1),t.bitrate||(t.bitrate=24e3);return t}static formatScreenProfile(e){let t={};if(!e){return t=HI({},bT["720p"]),t}if("string"==typeof e){if(CT.includes(e)){t=HI({},bT[e])}}else t.height=e.height,t.width=e.width,t.bitrate=e.bitrate,t.frameRate=e.frameRate,t.width&&t.height||(t.width=bT["720p"].width,t.height=bT["720p"].height),t.frameRate||(t.frameRate=15),t.bitrate||(t.bitrate=bT["720p"].bitrate);return t}}class GI{static getOptimalVideoConstraint(e,t){const r={},i=[];["user","environment","left","right"].includes(e)?r.facingMode={exact:e}:r.deviceId={exact:e};const n=[{width:t.width,height:t.height},{aspectRatio:t.width/t.height}];i.push(...n),Hg.isSupportConstraints("aspectRatio")&&(r.aspectRatio={ideal:t.width/t.height}),r.width={min:yT["90p_2"].width,ideal:t.width},r.height={min:yT["90p_2"].height,ideal:t.height},r.frameRate={ideal:t.frameRate},r.advanced=i;const s={};return s.video=r,s}static getSuboptimalVideoConstraint(e,t){const r={};["user","environment","left","right"].includes(e)?r.facingMode={exact:e}:r.deviceId={exact:e},Hg.isSupportConstraints("aspectRatio")&&(r.aspectRatio={exact:t.width/t.height}),r.width={min:yT["90p_2"].width,ideal:t.width},r.height={min:yT["90p_2"].height,ideal:t.height},r.frameRate={ideal:t.frameRate};const i={};return i.video=r,i}static getNextVideoConstraint(e,t){const r={};["user","environment","left","right"].includes(e)?r.facingMode={exact:e}:r.deviceId={exact:e},Hg.isSupportConstraints("aspectRatio")&&(r.aspectRatio={ideal:t.width/t.height}),r.width={min:yT["90p_2"].width,ideal:t.width},r.height={min:yT["90p_2"].height,ideal:t.height},r.frameRate={ideal:t.frameRate};const i={};return i.video=r,i}static getWorstVideoConstraint(e,t){const r={};["user","environment","left","right"].includes(e)?r.facingMode={ideal:e}:r.deviceId={ideal:e},Hg.isSupportConstraints("aspectRatio")&&(r.aspectRatio={ideal:t.width/t.height}),r.width={min:yT["90p_2"].width,ideal:t.width},r.height={min:yT["90p_2"].height,ideal:t.height},r.frameRate={ideal:t.frameRate};const i={};return i.video=r,i}static initScreenShareConstraint(e,t){const r={};if(r.video={width:t.width||void 0,height:t.height||void 0,frameRate:{ideal:t.frameRate}},e){const e={sampleRate:TT.high.sampleRate,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0};hT.isChrome()&&(e.googNoiseSuppression=!0,e.googAutoGainControl=!0,e.googAutoGainControl2=!0),r.audio=e}return r}static initAudioConstraint(e,t){const r={},i={sampleRate:t.sampleRate,channelCount:t.channelCount,deviceId:e,echoCancellation:!0};return hT.isFirefox()&&e&&(i.deviceId={exact:e}),i.noiseSuppression=!0,i.autoGainControl=!0,hT.isChrome()&&(i.googNoiseSuppression=!0,i.googAutoGainControl=!0,i.googAutoGainControl2=!0),r.audio=i,r}}const JI="HRTCTrack";class qI{constructor(e){this.log_=e.logger||Qg.getLogger(),this.trackType_=e.trackType,this.streamType_=e.streamType,this.isRemote_=e.isRemote,this.resolutionId_=e.resolutionId,e.track?this.setLocalProfileByTrack(e.track):this.setTrackProfile(e.trackProfile),this.track_=e.track,this.playState_=2,this.trackMuted_=!1,this.event_=e.event||new xv,this.trackType_===uI.TRACK_TYPE_AUDIO?this.statusChangeReporter_=e=>{this.event_.emit(fT,{type:uI.TRACK_TYPE_AUDIO,id:this.getResolutionId(),state:e.state,reason:e.reason})}:this.statusChangeReporter_=e=>{this.event_.emit(fT,{type:uI.TRACK_TYPE_VIDEO,id:this.getResolutionId(),state:e.state,reason:e.reason})},this.statusTraceReporter_=e=>{this.event_.emit(gT,e)}}async initScreenShare(e){const t=GI.initScreenShareConstraint(e,this.profile_);this.log_.info(JI,"initScreenShare, screen constraints: ".concat(JSON.stringify(t)));const r=[],i={type:uI.TRACK_TYPE_AUDIO},n={type:uI.TRACK_TYPE_VIDEO};return new Promise((s=>{navigator.mediaDevices.getDisplayMedia(t).then((t=>{const r=t.getVideoTracks()[0];this.track_&&(this.track_.stop(),this.player_&&this.player_.replaceTrack(r)),this.track_=r,n.track=r,this.content=AI.desktop,r.onended=()=>{this.event_.emit(pT,this.trackId_||this.resolutionId_)},e&&(0===(t.getAudioTracks()||[]).length?this.log_.info(JI,"initScreenShare, cannot capture system output audio, pls make sure checked the share Audio option in share page"):i.track=t.getAudioTracks()[0])})).catch((e=>{this.log_.error(JI,"initScreenShare, getDisplayMedia failed, errMsg= ".concat(e)),i.error=this.handleCaptureError(e),n.error=i.error})).finally((()=>{r.push(i),r.push(n),s(r)}))}))}async initAudioCapture(e){const t=GI.initAudioConstraint(e,this.profile_);return await this.getUserMedia(t,uI.TRACK_TYPE_AUDIO,AI.main)}async initVideoCapture(e,t){let r;return this.log_.info(JI,"initVideoCapture, try getOptimalVideoConstraint"),r=await this.getUserMedia(GI.getOptimalVideoConstraint(e,this.profile_),uI.TRACK_TYPE_VIDEO,t),qI.isTrackAvailable(r.track)?r:(this.log_.info(JI,"initVideoCapture, try getSuboptimalVideoConstraint"),r=await this.getUserMedia(GI.getSuboptimalVideoConstraint(e,this.profile_),uI.TRACK_TYPE_VIDEO,t),qI.isTrackAvailable(r.track)?r:(this.log_.info(JI,"initVideoCapture, try getNextVideoConstraint"),r=await this.getUserMedia(GI.getNextVideoConstraint(e,this.profile_),uI.TRACK_TYPE_VIDEO,t),qI.isTrackAvailable(r.track)?r:(this.log_.info(JI,"initVideoCapture, try getWorstVideoConstraint"),await this.getUserMedia(GI.getWorstVideoConstraint(e,this.profile_),uI.TRACK_TYPE_VIDEO,t))))}async getUserMedia(e,t,r){const i={type:t};try{var n;null===(n=this.track_)||void 0===n||n.stop();const s=await navigator.mediaDevices.getUserMedia(e),o=t===uI.TRACK_TYPE_VIDEO?s.getVideoTracks()[0]:s.getAudioTracks()[0];return this.track_&&(o.enabled=this.track_.enabled,this.player_&&this.player_.replaceTrack(o)),this.track_=o,this.setLocalProfileByTrack(this.track_),i.track=this.track_,this.content=r,i.type===uI.TRACK_TYPE_VIDEO&&this.setCameraCaptureReport(),i}catch(tb){return i.error=this.handleCaptureError(tb,t),i}}static isTrackAvailable(e){return!!e&&(e.enabled&&!e.muted&&"live"===e.readyState)}setCameraCaptureReport(){this.cameraCaptureHandleTimer&&clearInterval(this.cameraCaptureHandleTimer),this.cameraCaptureHandleTimer=setInterval((()=>{if(this.track_&&this.profile_){var e;const t=this.track_.getSettings(),r={width:this.profile_.width,height:this.profile_.height,frameRate:parseInt(null===(e=this.profile_.frameRate)||void 0===e?void 0:e.toString())||0};this.event_.emit(vT.CameraCapture,t,r)}}),2e3)}clearCameraCaptureReport(){this.cameraCaptureHandleTimer&&clearInterval(this.cameraCaptureHandleTimer)}handleCaptureError(e,t){if(/.*Malformed constraints.*/gi.test(e.message))return this.log_.warn(JI,"init ".concat(t||"screen","capture getUserMedia failed, handleCaptureError: ").concat(e)),null;const r=e.name||"";let i;return i=/.*NotAllowedError.*/gi.test(r)?new Eu(ou.RTC_ERR_CODE_CAPTURE_PERMISSION_DENIED):/.*OverConstrainedError.*/gi.test(r)?new Eu(ou.RTC_ERR_CODE_CAPTURE_OVER_CONSTRAINED):/.*NotReadableError.*/gi.test(r)?new Eu(ou.RTC_ERR_CODE_CAPTURE_DEVICE_NOT_READABLE):/.*NotFoundError.*/gi.test(r)?new Eu(ou.RTC_ERR_CODE_CAPTURE_DEVICE_NOT_FOUND):new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR,e.message),this.log_.error(JI,"init ".concat(t||"screen","capture getUserMedia failed, handleCaptureError: ").concat(i)),i}isClosed(){return 2===this.playState_}isPlaying(){return 1===this.playState_}getTrackType(){return this.trackType_}getResolutionId(){return this.resolutionId_}getTrackId(){return this.trackId_}getElementId(){return this.elementId_}getObjectFit(){return this.objectFit_}setTrackId(e){this.trackId_=e}getTrackProfile(){return this.profile_}setTrackContentType(e){this.content=e}getTrackContentType(){return this.content||AI.main}updateTrackProfile(e){this.trackType_===uI.TRACK_TYPE_VIDEO&&e&&(this.profile_.width=e.width,this.profile_.height=e.height)}setTrackProfile(e){this.log_.info(JI,"setTrackProfile begin,uniqueId_:".concat(this.resolutionId_,", ").concat(this.trackType_,",")+"".concat(this.streamType_,", profile:").concat(JSON.stringify(e))),this.trackType_!==uI.TRACK_TYPE_AUDIO?this.trackType_!==uI.TRACK_TYPE_VIDEO||this.streamType_!==dI.STREAM_TYPE_MAIN?this.trackType_===uI.TRACK_TYPE_VIDEO&&this.streamType_===dI.STREAM_TYPE_AUX&&(this.profile_=WI.formatScreenProfile(e)):this.profile_=WI.formatVideoProfile(e):this.profile_=WI.formatAudioProfile(e)}getTrack(){return this.track_}async replaceTrack(e){var t;if(e){var r;if(null===(t=this.player_)||void 0===t||t.replaceTrack(e),!this.isRemote_)null===(r=this.track_)||void 0===r||r.stop();this.track_=e,this.track_.enabled=!this.trackMuted_,this.isRemote_||(this.setLocalProfileByTrack(e),1===this.playState_&&await this.restart())}}setLocalProfileByTrack(e){this.profile_=WI.getLocalProfileByTrack(e),this.log_.info(JI,"setLocalProfileByTrack, this.profile_:".concat(JSON.stringify(this.profile_)))}removeTrack(){var e;(this.player_&&this.player_.stop(),this.isRemote_)||(null===(e=this.track_)||void 0===e||e.stop());this.track_=null}async play(e,t,r){const i=this.getTrackType();if(this.log_.info(JI,"".concat(i," track begin play, elementId:").concat(t,", playerDiv.id:").concat(e.id,", options:").concat(JSON.stringify(r)," ")),1===this.playState_)return this.log_.info(JI,"".concat(i," track is playing, return")),{trackType:i,error:null};if(!this.track_)return this.log_.error(JI,"".concat(i," track is empty")),{trackType:i,error:new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"".concat(i," track is empty"))};switch(this.elementId_=t,this.trackType_){case uI.TRACK_TYPE_AUDIO:this.player_||(this.log_.info(JI,"create AudioPlayer"),this.player_=new FI({logger:this.log_,playerDiv:e,playerId:this.getTrackId()||this.getResolutionId(),track:this.track_,muted:r.muted,volume:this.audioVolume_}));break;case uI.TRACK_TYPE_VIDEO:this.objectFit_=r.objectFit,this.player_||(this.log_.info(JI,"create VideoPlayer"),this.player_=new jI({logger:this.log_,parentDiv:e,playerId:this.getTrackId()||this.getResolutionId(),track:this.track_,objectFit:r.objectFit,mirror:r.mirror}))}this.player_.off(fT,this.statusChangeReporter_),this.player_.on(fT,this.statusChangeReporter_),this.player_.off(gT,this.statusTraceReporter_),this.player_.on(gT,this.statusTraceReporter_),this.log_.info(JI,"play ".concat(i," track start")),this.playState_=1;try{return await this.player_.play(),{trackType:i,error:null}}catch(tb){const t=tb instanceof Eu&&/.*timeout.*/i.test(tb.getMsg());return this.log_[t?"warn":"error"](JI,"play ".concat(i," failed: ").concat(tb)),this.playState_=0,{trackType:i,error:tb}}}async replay(){if(!this.player_)return this.log_.info(JI,"".concat(this.getTrackType()," player is null")),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"".concat(this.getTrackType()," player is null"));this.player_.off(fT,this.statusChangeReporter_),this.player_.on(fT,this.statusChangeReporter_),this.player_.off(gT,this.statusTraceReporter_),this.player_.on(gT,this.statusTraceReporter_),this.log_.info(JI,"rePlay ".concat(this.getTrackType()," track start")),this.playState_=1;try{return await this.player_.play(),null}catch(tb){return this.log_.error(JI,"replay".concat(this.getTrackType(),", replay failed: ").concat(tb)),this.playState_=0,tb}}stop(){this.player_?(this.player_.off(fT,this.statusChangeReporter_),this.player_.stop(),this.player_=null,this.playState_=0,this.trackMuted_=!1,this.log_.info(JI,"".concat(this.getTrackType()," stop player success"))):this.log_.info(JI,"".concat(this.getTrackType()," player is null"))}close(){var e;(this.stop(),this.isRemote_)||(null===(e=this.track_)||void 0===e||e.stop());this.elementId_="",this.log_.info(JI,"".concat(this.getTrackType()," close success")),this.playState_=2,this.clearCameraCaptureReport()}async resume(){if(!this.player_)return this.log_.info(JI,"".concat(this.getTrackType()," player is null")),null;try{return await this.player_.resume(),null}catch(tb){return this.log_.error(JI,"".concat(this.getTrackType()," resume failed: ").concat(tb)),tb}}async restart(){this.player_&&(this.player_.stop(),await this.player_.play(),this.log_.info(JI,"restart success"))}getTrackMuted(){return this.track_?!this.track_.enabled:this.trackMuted_}muteTrack(){this.track_&&(this.track_.enabled=!1),this.trackMuted_=!0}unmuteTrack(){this.track_&&(this.track_.enabled=!0),this.trackMuted_=!1}setSinkId(e){this.trackType_===uI.TRACK_TYPE_AUDIO&&this.player_&&this.player_.setSinkId(e)}setAudioVolume(e){this.trackType_===uI.TRACK_TYPE_AUDIO&&(this.audioVolume_=e/100,this.player_&&this.player_.setVolume(this.audioVolume_))}getAudioLevel(){return this.trackType_===uI.TRACK_TYPE_AUDIO&&this.player_?this.player_.getAudioLevel():0}getVideoFrame(){return this.trackType_===uI.TRACK_TYPE_VIDEO&&this.player_?this.player_.getVideoFrame():null}setAudioOutput(e){this.trackType_===uI.TRACK_TYPE_AUDIO&&this.player_&&this.player_.setSinkId(e)}}function XI(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function QI(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?XI(Object(r),!0).forEach((function(t){bu(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XI(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ZI(e){return(t,r,i)=>{const n=i.value,s=e.substr(0,e.indexOf("$"));return QI(QI({},i),{},{async value(){let t,r;const i=Hg.getCurrentTimestamp();for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];const u=a||[],d=ey(u);try{this.logger.info(s,"".concat(n.name," begin : parameters are ").concat(JSON.stringify(d))),t=await n.apply(this,u);const o=t?ey([t]):[];return this.logger.info(s,"".concat(n.name," end success : result is ").concat(JSON.stringify(o))),t}catch(tb){throw this.logger.error(s,"".concat(n.name," end error : ").concat(tb)),r=tb,tb}finally{const n=Hg.getCurrentTimestamp(),s=ey(this.getStatExtraInfo?[t,...u,this.getStatExtraInfo()]:[t,...u]);this.stat.setApiCallInfo(e,i,n,r,...s)}}})}}function $I(e){return(t,r,i)=>{const n=i.value,s=e.substr(0,e.indexOf("$"));return QI(QI({},i),{},{value(){let t,r;const i=Hg.getCurrentTimestamp();for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];const u=a||[],d=ey(u);try{this.logger.info(s,"".concat(n.name," begin : parameters are ").concat(JSON.stringify(d))),r=n.apply(this,u);const o=r?ey([r]):[];return this.logger.info(s,"".concat(n.name," end success : result is ").concat(JSON.stringify(o))),r}catch(tb){throw this.logger.error(s,"".concat(n.name," end error : ").concat(tb)),t=tb,tb}finally{const n=Hg.getCurrentTimestamp(),s=ey(this.getStatExtraInfo?[r,...u,this.getStatExtraInfo()]:[r,...u]);this.stat.setApiCallInfo(e,i,n,t,...s)}}})}}function ey(e){try{return e.map((e=>["object","function"].includes(typeof e)&&e.getStatInfo?e.getStatInfo():e))}catch(t){return e}}const ty=(()=>{let e=0;return()=>e++})();class ry extends Eu{constructor(e,t,r){super(e,t),this.captureResults=r}getMediaCaptureResult(){return this.captureResults}getMediaCaptureResultByType(e){var t;return null===(t=this.captureResults)||void 0===t?void 0:t.find((t=>t.type===e))}toString(){return'["code": '.concat(this.code,', "message": "').concat(this.message," : ").concat(JSON.stringify(this.captureResults),'"]')}}class iy{constructor(e){bu(this,"callbackMap",new Map),bu(this,"onCallbackMap",new Map),bu(this,"module_","Stream"),bu(this,"getOnCallback",((e,t)=>{const r="".concat(e,"_").concat(null==t?void 0:t.name);this.logger.debug(this.module_,"getOnCallback, event = "+e.toString());const i=t=>{if(this.callbackMap.get(r)){const i=Hg.getCurrentTimestamp();let n=i+5e3,s=!1;const o=setTimeout((()=>{s=!0,clearTimeout(o),this.stat.recordCallbackInfo(e.toString(),"Stream",i,n,t,(e=>e&&e instanceof iy?JSON.stringify(e.getStatInfo()):JSON.stringify(e||{})))}),1e4);this.callbackMap.get(r)&&this.callbackMap.get(r)(t),s||(n=Hg.getCurrentTimestamp(),clearTimeout(o),this.stat.recordCallbackInfo(e.toString(),"Stream",i,n,t,(e=>e&&e instanceof iy?JSON.stringify(e.getStatInfo()):JSON.stringify(e||{}))))}};return this.callbackMap.set(r,t),this.onCallbackMap.set(r,i),i})),bu(this,"getOffCallback",((e,t)=>{const r="".concat(e,"_").concat(null==t?void 0:t.name);this.logger.debug(this.module_,"getOnCallback, event = "+e.toString());const i=this.onCallbackMap.get(r);return this.onCallbackMap.get(r)&&this.onCallbackMap.delete(r),this.callbackMap.get(r)&&this.callbackMap.delete(r),i})),this.streamSymbol=Symbol("client_".concat(ty(),"_").concat(Hg.getCurrentTimestamp())),this.isRemote_=e.isRemote,this.id_=Hg.generateStreamId(),this.type_=e.type,this.logger=e.log,this.logger||(this.logger=Qg.getLogger()),this.stat=new _I(this.logger),this.isAuxiliary_="auxiliary"===e.type,this.tracks={video:new Map,audio:new Map},this.playDivContainers=new Map,this.eventEmitter=new xv,this.traceHandler=this.playerStatusTrace.bind(this)}getStreamInfo(){return this.getStreamInfoImpl()}getStreamInfoImpl(){const e={videoProfiles:[]};for(const[r,i]of this.tracks[uI.TRACK_TYPE_VIDEO])if(i.getTrackType()===uI.TRACK_TYPE_VIDEO){const t={resolutionId:r,hasTrack:!!i.getTrack(),width:i.getTrackProfile().width,height:i.getTrackProfile().height,frameRate:i.getTrackProfile().frameRate,minBitrate:i.getTrackProfile().minBitrate,maxBitrate:i.getTrackProfile().maxBitrate};e.videoProfiles.push(t)}const t=this.getAnyAudioHRTCTrack();return t&&(e.audioProfile={sampleRate:t.getTrackProfile().sampleRate,channelCount:t.getTrackProfile().channelCount,bitrate:t.getTrackProfile().bitrate}),this.logger.info(this.module_,"getStreamInfoImpl success: ".concat(JSON.stringify(e))),e}getMaxResolutionHRTCTrack(e){let t;const r=Array.from(this.tracks[uI.TRACK_TYPE_VIDEO].values()),i=e?r:r.filter((e=>e.getTrack()));for(const n of i)t?t&&Math.max(n.getTrackProfile().width,n.getTrackProfile().height)-Math.max(t.getTrackProfile().width,t.getTrackProfile().height)>0&&(t=n):t=n;return t}getMaxResolutionProfile(e){if(0===e.size)return null;let t,r;for(const[i,n]of e)t?Math.max(n.width,n.height)-Math.max(t.width,t.height)>0&&(t=n,r=i):(t=n,r=i);return t?{resolutionId:r,width:t.width,height:t.height,frameRate:t.frameRate,minBitrate:t.minBitrate,maxBitrate:t.maxBitrate}:null}getHRTCTracks(e){const t=[],r=Array.from(this.tracks[uI.TRACK_TYPE_AUDIO].values()),i=Array.from(this.tracks[uI.TRACK_TYPE_VIDEO].values());if(!e)return[...r,...i];const n=void 0===e.hasTrack?r:r.filter((t=>!!t.getTrack()===e.hasTrack)),s=void 0===e.hasTrack?i:i.filter((t=>!!t.getTrack()===e.hasTrack));return e.mediaType?e.mediaType===uI.TRACK_TYPE_VIDEO?t.push(...s):t.push(...n):(t.push(...n),t.push(...s)),t}getHRTCTrackIds(e){const t=[];for(const r of this.getHRTCTracks(e))t.push(r.getTrackId());return t}getAnyVideoHRTCTrack(e){let t;return t=e?this.tracks[uI.TRACK_TYPE_VIDEO].get(e):this.getMaxResolutionHRTCTrack(!0),t}getVideoHRTCTrack(e){var t;let r;return r=e?this.tracks[uI.TRACK_TYPE_VIDEO].get(e):this.getMaxResolutionHRTCTrack(),null!==(t=r)&&void 0!==t&&t.getTrack()?r:null}getAnyAudioHRTCTrack(){return this.isAuxiliary_?this.tracks[uI.TRACK_TYPE_AUDIO].get("auxAudio"):this.tracks[uI.TRACK_TYPE_AUDIO].get("mainAudio")}getUninitializedAudioHRTCTrack(){const e=this.getAnyAudioHRTCTrack();return null!=e&&e.getTrack()?null:e}getUninitializedVideoHRTCTrack(e){var t;let r;return r=e?this.tracks[uI.TRACK_TYPE_VIDEO].get(e):this.getMaxResolutionHRTCTrack(!0),null!==(t=r)&&void 0!==t&&t.getTrack()?null:r}getAudioHRTCTrack(){const e=this.getAnyAudioHRTCTrack();return null!=e&&e.getTrack()?e:null}getSymbol(){return this.streamSymbol}getUniqueId(){return this.id_}getInfo(){return{appId:"",roomId:"",userName:"",userId:"",domain:""}}onLogUploadResult(){}onLogUploadProgress(){}startupPlay(e,t){this.client_.forEach((r=>{r.startupQoSReportPlay(e,t)}))}async play(e,t){const r=Hg.getCurrentTimestamp();this.startupPlay(this.getUniqueId(),r),await this.playImpl(e,t)}async playImpl(e,t){let r;if(null!=t&&t.objectFit){if(!/^cover|contain|fill$/.test(t.objectFit))throw this.logger.error(this.module_,"invalid play options.objectFit: ".concat(t.objectFit)),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"invalid play options.objectFit: ".concat(t.objectFit));r=t.objectFit}else r=this.isRemote_&&"auxiliary"===this.getType()?"contain":"cover";const i=!(null==t||!t.muted);if(this.logger.info(this.module_,"stream start to play with elementId: ".concat(e,", options.objectFit: ").concat(r,",options.muted: ").concat(i," resolutionId:").concat(null==t?void 0:t.resolutionId)),!e)throw this.logger.error(this.module_,"elementId:".concat(e," not a invalid HTMLElement Id")),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"elementId:".concat(e," not a invalid HTMLElement Id"));const n=document.getElementById(e);if(!n)throw this.logger.error(this.module_,"document.getElementById by elementId:".concat(e," failed")),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"document.getElementById by elementId:".concat(e," failed"));let s;const o=null!=t&&t.resolutionId?this.getVideoHRTCTrack(t.resolutionId):this.getMaxResolutionHRTCTrack(),a=o?o.getResolutionId():this.id_,c=this.playDivContainers.get(e);if(c){var u;s=c.HTMLElement,n.querySelector("#".concat(s.id))||n.appendChild(s),this.logger.info(this.module_,"get exist player div, key:".concat(e,", div: ").concat(null===(u=c.HTMLElement)||void 0===u?void 0:u.id))}else{s=document.createElement("div"),s.setAttribute("id","player_".concat(a)),s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",s.style["background-color"]="#000",n.appendChild(s);const t={HTMLElement:s,hasVideoTrack:!1,hasAudioTrack:!1};this.playDivContainers.set(e,t),this.logger.info(this.module_,"new player div, key:".concat(e,", div: ").concat(s.id))}s.style.display=null!=t&&t.playerElementHidden?"none":"block",await this.playTracks(e,s,r,i,null==t?void 0:t.resolutionId)}reportCanPlay(e){this.client_.forEach((t=>{t.startupQoSReportCanPlay(e)}))}playerStatusTrace(e){this.logger.debug(this.module_,"playerStatusTrace, ".concat(JSON.stringify(e))),null!=e&&e.event&&"playerCanplay"===e.event&&(e.id=this.getUniqueId(),this.reportCanPlay(e))}async playTracks(e,t,r,i,n){const s=[],o=this.isAuxiliary_?null:this.getAudioHRTCTrack(),a=n?this.getVideoHRTCTrack(n):this.getMaxResolutionHRTCTrack();null!=a&&a.getTrack()&&s.push(a.play(t,e,{objectFit:r,mirror:this.mirror_})),null!=o&&o.getTrack()&&s.push(o.play(t,e,{muted:i})),0!==s.length?(this.off(gT,this.traceHandler),this.on(gT,this.traceHandler),await Promise.all(s).then((r=>{const i=r.filter((e=>null!==e.error));i.length===s.length&&t&&t.remove();const n=r.filter((e=>null===e.error)),o=null==n?void 0:n.some((e=>e.trackType===uI.TRACK_TYPE_AUDIO)),a=null==n?void 0:n.some((e=>e.trackType===uI.TRACK_TYPE_VIDEO));if(this.playDivContainers.has(e)&&this.playDivContainers.set(e,{HTMLElement:t,hasAudioTrack:o,hasVideoTrack:a}),i.length>0)throw i[0].error}))):this.logger.warn(this.module_,"no available track for play")}stop(e){this.stopImpl(e)}stopImpl(e){var t;this.logger.info(this.module_,"stopImpl begin, option:".concat(JSON.stringify(e)));const r=this.getHRTCTracks({hasTrack:!0,mediaType:uI.TRACK_TYPE_VIDEO}),i=[];var n;(!e||e.video&&!e.resolutionIds?i.push(...r):e.video&&null!==(t=e.resolutionIds)&&void 0!==t&&t.length&&e.resolutionIds.forEach((e=>{const t=this.getVideoHRTCTrack(e);t&&i.push(t)})),i.forEach((e=>{e.stop()})),!e||e.audio)&&(null===(n=this.getAudioHRTCTrack())||void 0===n||n.stop());this.mediaStream=null}async resume(e){await this.resumeImpl(e)}async resumeImpl(e){var t;this.logger.info(this.module_,"resumeImpl begin, option:".concat(JSON.stringify(e)));const r=this.getHRTCTracks({hasTrack:!0,mediaType:uI.TRACK_TYPE_VIDEO}),i=[];!e||e.video&&!e.resolutionIds?i.push(...r):e.video&&null!==(t=e.resolutionIds)&&void 0!==t&&t.length&&e.resolutionIds.forEach((e=>{const t=this.getVideoHRTCTrack(e);t&&i.push(t)}));const n=[];if(i.forEach((e=>{n.push(e.resume())})),!e||e.audio){const e=this.getAudioHRTCTrack();e&&n.push(e.resume())}await Promise.all(n)}close(e){this.closeImpl(e)}closeImpl(e){if(this.logger.info(this.module_,"closeImpl begin, options:".concat(JSON.stringify(e))),!e||e.video&&!e.resolutionIds&&e.audio){for(const e of this.getHRTCTracks({hasTrack:!0}))e.close();for(const e of this.playDivContainers.values())e.HTMLElement&&e.HTMLElement.remove();return this.playDivContainers.clear(),void LI.removeEventEmitter(this.eventEmitter)}if(e.video){var t;const r=[];if(null!==(t=e.resolutionIds)&&void 0!==t&&t.length)e.resolutionIds.forEach((e=>{const t=this.getVideoHRTCTrack(e);t&&r.push(t)}));else{const e=this.getHRTCTracks({hasTrack:!0,mediaType:uI.TRACK_TYPE_VIDEO});r.push(...e)}r.forEach((e=>{const t=null==e?void 0:e.getElementId();if(e.close(),t){const e=this.playDivContainers.get(t);var r,i,n;if(e)if(e.hasVideoTrack=!1,this.logger.debug(this.module_,"closeImpl, elementId:".concat(t,", divInfo: ").concat(null===(r=e.HTMLElement)||void 0===r?void 0:r.id,", hasAudioTrack: ").concat(e.hasAudioTrack,", hasVideoTrack: ").concat(e.hasVideoTrack,"}")),!e.hasAudioTrack)null===(i=this.playDivContainers.get(t))||void 0===i||null===(n=i.HTMLElement)||void 0===n||n.remove(),this.playDivContainers.delete(t),this.logger.info(this.module_,"closeImpl, release elementId: ".concat(t))}}))}e.audio&&this.closeAudio();this.getHRTCTracks({hasTrack:!0}).every((e=>e.isClosed()))&&(LI.removeEventEmitter(this.eventEmitter),this.mediaStream=null)}closeAudio(){const e=this.getAudioHRTCTrack();if(e){const n=e.getElementId();if(e.close(),n){const e=this.playDivContainers.get(n);var t,r,i;if(e)if(e.hasAudioTrack=!1,this.logger.debug(this.module_,"closeAudio, elementId:".concat(n,", divInfo: ").concat(null===(t=e.HTMLElement)||void 0===t?void 0:t.id,", hasAudioTrack: ").concat(e.hasAudioTrack,", hasVideoTrack: ").concat(e.hasVideoTrack,"}")),!e.hasVideoTrack)null===(r=this.playDivContainers.get(n))||void 0===r||null===(i=r.HTMLElement)||void 0===i||i.remove(),this.playDivContainers.delete(n),this.logger.info(this.module_,"closeAudio, release elementId: ".concat(n))}}}muteAudio(){return this.muteAudioImpl()}muteAudioImpl(){try{const e=this.getAudioHRTCTrack();return!!e&&(e.muteTrack(),!0)}catch(tb){return this.logger.error(this.module_,"muteAudio failed: ".concat(tb)),!1}}muteVideo(){return this.muteVideoImpl()}muteVideoImpl(){try{if(!this.hasVideoTrack())return!1;for(const e of this.getHRTCTracks({hasTrack:!0,mediaType:uI.TRACK_TYPE_VIDEO}))e.muteTrack();return!0}catch(tb){return this.logger.error(this.module_,"muteVideo failed: ".concat(tb)),!1}}unmuteAudio(){return this.unmuteAudioImpl()}unmuteAudioImpl(){try{const e=this.getAudioHRTCTrack();return!!e&&(e.unmuteTrack(),!0)}catch(tb){return this.logger.error(this.module_,"unmuteAudio failed: ".concat(tb)),!1}}unmuteVideo(){return this.unmuteVideoImpl()}unmuteVideoImpl(){try{if(!this.hasVideoTrack())return!1;for(const e of this.getHRTCTracks({hasTrack:!0,mediaType:uI.TRACK_TYPE_VIDEO}))e.unmuteTrack();return!0}catch(tb){return this.logger.error(this.module_,"unmuteVideo failed: ".concat(tb)),!1}}getId(){var e;return null===(e=this.getMaxResolutionHRTCTrack())||void 0===e?void 0:e.getTrackId()}setStreamId(e,t){var r;null===(r=this.getVideoHRTCTrack(t))||void 0===r||r.setTrackId(e)}getUserId(){return this.userId_}getType(){return this.type_}async setAudioOutput(e){return this.setAudioOutputImpl(e)}setAudioOutputImpl(e){try{const t=this.getAudioHRTCTrack();t&&t.setSinkId(e),this.stat.reportSwitchDevicesInfo(DT.OUTPUT_AUDIO,e,WT.SUCCESS)}catch(tb){throw this.stat.reportSwitchDevicesInfo(DT.OUTPUT_AUDIO,e,WT.FAIL),tb}}setAudioVolume(e){this.setAudioVolumeImpl(e)}setAudioVolumeImpl(e){const t=this.getAudioHRTCTrack();t&&t.setAudioVolume(e)}getAudioLevel(){const e=this.getAudioHRTCTrack();return e?e.getAudioLevel():0}hasAudioTrack(){return!!this.getAudioHRTCTrack()}hasVideoTrack(){return Array.from(this.tracks[uI.TRACK_TYPE_VIDEO].values()).filter((e=>e.getTrack())).length>0}isAuxiliary(){return this.isAuxiliary_}getAudioTrack(){const e=this.getAudioHRTCTrack();return e?e.getTrack():null}getVideoTrack(e){const t=this.getVideoHRTCTrack(e);return t?t.getTrack():null}getVideoFrame(e){const t=this.getVideoHRTCTrack(e);return t?t.getVideoFrame():null}on(e,t){if(-1!==ST.indexOf(e.toString()))this.eventEmitter.on(e,t);else{const r=this.getOnCallback(e,t);this.eventEmitter.on(e,r)}}off(e,t){if(-1!==ST.indexOf(e.toString()))this.eventEmitter.off(e,t);else{const r=this.getOffCallback(e,t);r&&this.eventEmitter.removeListener(e,r)}}async restart(e){var t;if(e)return void(await(null===(t=this.getVideoHRTCTrack(e))||void 0===t?void 0:t.restart()));const r=[];for(const i of this.getHRTCTracks({hasTrack:!0}))r.push(i.restart());await Promise.all(r)}async rePlayAudio(){const e=this.getAudioHRTCTrack();e&&!e.isPlaying()&&await e.replay()}getStatInfo(){return{isRemote_:this.isRemote_,type_:this.type_,userId_:this.userId_,id_:this.id_,isAuxiliary_:this.isAuxiliary_}}getStatExtraInfo(){return{isRemote:this.isRemote_,id:this.id_,userId:this.userId_}}hasAudio(){var e;const t=!!(null===(e=this.getAudioHRTCTrack())||void 0===e?void 0:e.getTrack());return this.logger.debug(this.module_,"hasAudio: ".concat(t)),t}hasVideo(){const e=this.hasVideoTrack();return this.logger.debug(this.module_,"hasVideo: ".concat(e)),e}}Mv([$I("Stream$getStreamInfo#StreamInfo")],iy.prototype,"getStreamInfo",null),Mv([ZI("Stream$play#Promise<void>#string#{ objectFit?: string; muted: boolean; resolutionId?: string; playerElementHidden?: boolean }#string")],iy.prototype,"play",null),Mv([$I("Stream$stop#void#StreamOption")],iy.prototype,"stop",null),Mv([ZI("Stream$resume#Promise<void>#StreamOption")],iy.prototype,"resume",null),Mv([$I("Stream$close#void#StreamOption")],iy.prototype,"close",null),Mv([$I("Stream$muteAudio#boolean")],iy.prototype,"muteAudio",null),Mv([$I("Stream$muteVideo#boolean")],iy.prototype,"muteVideo",null),Mv([$I("Stream$unmuteAudio#boolean")],iy.prototype,"unmuteAudio",null),Mv([$I("Stream$unmuteVideo#boolean")],iy.prototype,"unmuteVideo",null),Mv([ZI("Stream$setAudioOutput#Promise<void>#string")],iy.prototype,"setAudioOutput",null),Mv([$I("Stream$setAudioVolume#void#number")],iy.prototype,"setAudioVolume",null);class ny extends iy{constructor(e){super({isRemote:!1,type:"local",log:null}),this.module_="LocalStream",this.userId_=e.userId,this.audio_=e.audio,this.microphoneId_=e.microphoneId,this.video_=e.video,this.cameraId_=e.cameraId,this.facingMode_=e.facingMode,this.screen_=e.screen,this.isAuxiliary_=!!this.screen_,this.screenAudio_=e.screenAudio,this.audioSource_=e.audioSource,this.videoSource_=e.videoSource,this.mirror_=e.mirror,this.client_=[],this.audioMixOption_={filePath:null,startTime:0,replace:!1,loop:!1,repeatCount:1},this.audioMixInfo_={audioMixState:kT.IDLE,audioCtx:null,mediaNode:null,sourceNode:null,buffer:null,destNode:null,gainNode:null,gainValue:.5,startAt:0,pauseAt:0,pauseDur:0,playAutoEnded:!1,totalDur:0},this.mutePackageData=new Uint8Array([255,241,80,128,3,223,252,222,2,0,76,97,118,99,53,56,46,55,53,46,49,48,48,0,66,32,8,193,24,56,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28,255,241,80,128,1,191,252,33,16,4,96,140,28]).buffer,this.muteSendInfo={audioMixState:kT.IDLE,audioCtx:null,mediaNode:null,sourceNode:null,destNode:null},this.screenShareMixInfo={bindStream:null,screenShareAudioNode:null,destNode:null,gainNode:null,gainValue:.5,status:kT.INIT,muteMainAudio:!1},this.videoProfiles_=new Map,this.videoContents=new Map,this.logger.info(this.module_,"new local stream, stream config: ".concat(JSON.stringify(e)))}setMediaStream(e){this.mediaStream||(this.mediaStream=new MediaStream),this.mediaStream.addTrack(e)}getMediaStream(){return this.mediaStream}getLocalId(){return this.id_}async initialize(){return await this.initializeImpl()}async reset(){this.closeImpl();for(const e of this.getHRTCTracks({hasTrack:!0})){const t=e.getTrack();t&&await this.removeTrack(t)}this.tracks[uI.TRACK_TYPE_VIDEO].clear(),this.tracks[uI.TRACK_TYPE_AUDIO].clear()}async initAuxStream(){var e,t,r,i;const n=new qI({streamType:dI.STREAM_TYPE_AUX,trackType:uI.TRACK_TYPE_VIDEO,isRemote:!1,trackProfile:this.screenProfile_,logger:this.logger,resolutionId:this.generateResolutionId(),event:this.eventEmitter}),s=await n.initScreenShare(this.screenAudio_),o=null===(e=s.find((e=>e.error)))||void 0===e?void 0:e.error;if(o)throw this.logger.error(this.module_,"initAuxStream, fail, errMsg = ".concat(o)),o instanceof Eu?new ry(o.getCode(),o.getMsg(),s):o;this.stat.setMediaCaptureSucc(xT.AUX,null===(t=n.getTrack())||void 0===t?void 0:t.label),this.tracks[uI.TRACK_TYPE_VIDEO].set(n.getResolutionId(),n),this.setMediaStream(null===(r=s.find((e=>e.type===uI.TRACK_TYPE_VIDEO&&e.track)))||void 0===r?void 0:r.track);const a=null===(i=s.find((e=>e.type===uI.TRACK_TYPE_AUDIO&&e.track)))||void 0===i?void 0:i.track;return a&&this.tracks[uI.TRACK_TYPE_AUDIO].set("auxAudio",new qI({streamType:dI.STREAM_TYPE_AUX,trackType:uI.TRACK_TYPE_AUDIO,isRemote:!1,logger:this.logger,resolutionId:this.generateResolutionId(),track:a,event:this.eventEmitter})),this.auxStreamStopByNativeHandler=()=>{this.close(),this.eventEmitter.removeListener(pT,this.auxStreamStopByNativeHandler)},this.eventEmitter.on(pT,this.auxStreamStopByNativeHandler),new ry(ou.RTC_ERR_CODE_SUCCESS,"",s)}async initMainStreamWithCfg(){const e=this.getMaxResolutionProfile(this.videoProfiles_);return await this.addCaptureWithCfg(this.video_,this.audio_,e,this.audioProfile_,AI.main)}async initMainStream(){return LI.initDeviceChangedNotify(this.eventEmitter,!0),this.on(MI.CameraChanged,(e=>{"REMOVE"===e.state&&this.clearEffectiveDeviceId(e.deviceId,"videoInput")})),this.on(MI.RecordingDeviceChanged,(e=>{"REMOVE"===e.state&&this.client_.length>0&&this.client_[0].getPublishAudioSender()&&(this.startSendMutePackage(),this.clearEffectiveDeviceId(e.deviceId,"audioInput"))})),this.on(vT.CameraCapture,((e,t)=>{this.setCameraCaptureReport(e,t)})),this.audioSource_||this.videoSource_?this.initMainStreamWithTrack(this.audioSource_,this.videoSource_):await this.initMainStreamWithCfg()}async initializeImpl(){this.logger.info(this.module_,"initializeImpl begin");try{return await this.reset(),this.screen_?await this.initAuxStream():await this.initMainStream()}catch(tb){throw this.logger.error(this.module_,"initializeImpl fail, errMsg:".concat(tb)),"function"!=typeof tb.getMediaCaptureResult?new ry(tb.getCode(),tb.getMsg(),null):tb}}setCameraCaptureReport(e,t){this.client_.forEach((r=>{r.setCameraCaptureReport(e,t)}))}async addCaptureWithCfg(e,t,r,i,n){this.logger.info(this.module_,"addCaptureWithCfg begin, video:".concat(e,", audio:").concat(t,",")+"camera:".concat(this.getCurrentCameraId(),", microphone:").concat(this.getCurrentMicrophoneId(),",")+"videoProfileInfo:".concat(JSON.stringify(r),", audioProfile:").concat(JSON.stringify(i)));if((this.tracks&&this.tracks[uI.TRACK_TYPE_VIDEO].size)>=2){const e=new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"resolution count can not be greater than ".concat(2));throw this.logger.error(this.module_,"addCaptureWithCfg fail, errMsg is=".concat(e)),e}const s=[];let o,a;e&&(o=new qI({streamType:dI.STREAM_TYPE_MAIN,trackType:uI.TRACK_TYPE_VIDEO,isRemote:!1,trackProfile:r,logger:this.logger,resolutionId:r?r.resolutionId:this.generateResolutionId(),event:this.eventEmitter}),s.push(o.initVideoCapture(this.getCurrentCameraId()||this.facingMode_,n))),t&&(a=new qI({streamType:dI.STREAM_TYPE_MAIN,trackType:uI.TRACK_TYPE_AUDIO,isRemote:!1,trackProfile:i,logger:this.logger,resolutionId:this.generateResolutionId(),event:this.eventEmitter}),s.push(a.initAudioCapture(this.getCurrentMicrophoneId())));const c=await Promise.all(s);let u=0;for(const d of c)d.error?u++:(d.type===uI.TRACK_TYPE_AUDIO?(this.tracks[uI.TRACK_TYPE_AUDIO].set("mainAudio",a),this.stat.setMediaCaptureSucc(xT.AUDIO,a.getTrack().label)):(Array.from(Array.from(this.tracks[uI.TRACK_TYPE_VIDEO].values()).values()).some((e=>e.getTrackMuted()))&&o.muteTrack(),this.tracks[uI.TRACK_TYPE_VIDEO].set(o.getResolutionId(),o),this.stat.setMediaCaptureSucc(xT.VIDEO,o.getTrack().label),r&&this.videoProfiles_.set(o.getResolutionId(),r),this.videoContents.set(o.getResolutionId(),n)),this.setMediaStream(d.track),this.appendDefaultLocalTrack(r,i),this.updateEffectiveDeviceInfo(d));if(u){const e=new ry(ou.RTC_ERR_CODE_INVALID_OPERATION,"browser initialize capture fail",c);throw this.logger.error(this.module_,"addCaptureWithCfg fail, errMsg= ".concat(e)),e}return this.logger.info(this.module_,"addCaptureWithCfg success, camera:".concat(this.getCurrentCameraId(),", microphone:").concat(this.getCurrentMicrophoneId())),new ry(ou.RTC_ERR_CODE_SUCCESS,"",c)}appendDefaultLocalTrack(e,t){if(!this.getAnyAudioHRTCTrack()){const e=new qI({streamType:dI.STREAM_TYPE_MAIN,trackType:uI.TRACK_TYPE_AUDIO,isRemote:!1,trackProfile:t,logger:this.logger,resolutionId:this.generateResolutionId(),event:this.eventEmitter});e.setTrackContentType(AI.main),this.tracks[uI.TRACK_TYPE_AUDIO].set("mainAudio",e),this.logger.info(this.module_,"addDefaultEmptyTrack success, audioTrack:".concat(e.getResolutionId(),",")+"track profile:".concat(JSON.stringify(e.getTrackProfile())))}if(!this.getAnyVideoHRTCTrack(null==e?void 0:e.resolutionId)){const t=new qI({streamType:dI.STREAM_TYPE_MAIN,trackType:uI.TRACK_TYPE_VIDEO,isRemote:!1,trackProfile:e,logger:this.logger,resolutionId:e?e.resolutionId:this.generateResolutionId(),event:this.eventEmitter});t.setTrackContentType(AI.main),this.tracks[uI.TRACK_TYPE_VIDEO].set(t.getResolutionId(),t),this.logger.info(this.module_,"addDefaultEmptyTrack success, videoTrack:".concat(t.getResolutionId(),",")+"track profile:".concat(JSON.stringify(t.getTrackProfile())))}}generateResolutionId(){return this.id_+"-"+Hg.generateRandomId(8,16)}initMainStreamWithTrack(e,t){const r=[];if(e){const t=new qI({streamType:dI.STREAM_TYPE_MAIN,trackType:uI.TRACK_TYPE_AUDIO,isRemote:!1,logger:this.logger,resolutionId:this.generateResolutionId(),track:e,event:this.eventEmitter});this.tracks[uI.TRACK_TYPE_AUDIO].set("mainAudio",t),r.push({type:uI.TRACK_TYPE_AUDIO,track:e})}if(t){const e=new qI({streamType:dI.STREAM_TYPE_MAIN,trackType:uI.TRACK_TYPE_VIDEO,isRemote:!1,logger:this.logger,resolutionId:this.generateResolutionId(),track:t,event:this.eventEmitter});this.tracks[uI.TRACK_TYPE_VIDEO].set(e.getResolutionId(),e),r.push({type:uI.TRACK_TYPE_VIDEO,track:t})}return this.appendDefaultLocalTrack(this.getMaxResolutionProfile(this.videoProfiles_),this.audioProfile_),new ry(ou.RTC_ERR_CODE_SUCCESS,"",r)}async addAudioTrackCapture(e){return await this.addAudioTrackCaptureImpl(e)}async addAudioTrackCaptureImpl(e){var t;this.logger.info(this.module_,"addAudioTrackCaptureImpl, microphoneId: ".concat(e));const r=new qI({streamType:dI.STREAM_TYPE_MAIN,trackType:uI.TRACK_TYPE_AUDIO,isRemote:!1,trackProfile:this.audioProfile_,logger:this.logger,resolutionId:this.generateResolutionId(),event:this.eventEmitter}),i=await r.initAudioCapture(e||this.microphoneId_);if(i.error)throw this.logger.error(this.module_,"addAudioTrackCaptureImpl fail, errMsg: ".concat(i.error)),i.error;return this.stat.setMediaCaptureSucc(xT.AUDIO,null===(t=i.track)||void 0===t?void 0:t.label),this.updateEffectiveDeviceInfo(i),await this.addTrackImpl(i.track),i.track}async addVideoTrackCapture(e){return await this.addVideoTrackCaptureImpl(e)}async addVideoTrackCaptureImpl(e){var t;this.logger.info(this.module_,"addVideoTrackCaptureImpl, option: ".concat(JSON.stringify(e)));const r=null==e?void 0:e.resolutionId,i=r?this.videoProfiles_.get(r):this.getMaxResolutionProfile(this.videoProfiles_),n=new qI({streamType:dI.STREAM_TYPE_MAIN,trackType:uI.TRACK_TYPE_VIDEO,isRemote:!1,trackProfile:i,logger:this.logger,resolutionId:this.generateResolutionId(),event:this.eventEmitter}),s=(null==e?void 0:e.cameraId)||this.cameraId_||this.facingMode_,o=await n.initVideoCapture(s,r?this.videoContents.get(r):AI.main);if(o.error)throw this.logger.error(this.module_,"addVideoTrackCaptureImpl fail, errMsg: ".concat(o.error)),o.error;return this.updateEffectiveDeviceInfo(o),this.stat.setMediaCaptureSucc(xT.AUDIO,null===(t=o.track)||void 0===t?void 0:t.label),await this.addTrackImpl(o.track,r),o.track}updateEffectiveDeviceInfo(e){e.type===uI.TRACK_TYPE_VIDEO?(this.effectiveCameraId_=e.track.getSettings().deviceId,this.logger.info(this.module_,"updateEffectiveDeviceInfo, effectiveCameraId_: ".concat(this.effectiveCameraId_))):e.type===uI.TRACK_TYPE_AUDIO&&(this.effectiveMicrophoneId_=e.track.getSettings().deviceId,this.logger.info(this.module_,"updateEffectiveDeviceInfo, effectiveMicrophoneId_: ".concat(this.effectiveMicrophoneId_)))}getCurrentCameraId(){return this.cameraId_||this.effectiveCameraId_}getCurrentMicrophoneId(){return this.microphoneId_||this.effectiveMicrophoneId_}getAudioSendBitrate(){const e=this.getAudioHRTCTrack();return e?e.getTrackProfile().bitrate:0}isAudioMuted(){const e=this.getAudioHRTCTrack();return!e||e.getTrackMuted()}isVideoMuted(e){const t=this.getVideoHRTCTrack(e);return!t||t.getTrackMuted()}setAudioProfile(e){this.setAudioProfileImpl(e)}setAudioProfileImpl(e){const t=this.getAudioHRTCTrack();this.audioProfile_=e,null==t||t.setTrackProfile(e)}getVideoMaxBitrate(e){var t;const r=null===(t=this.getVideoHRTCTrack(e))||void 0===t?void 0:t.getTrackProfile();return r?r.maxBitrate:0}getVideoMaxSendBitrate(e){var t;const r=null===(t=this.getVideoHRTCTrack(e))||void 0===t?void 0:t.getTrackProfile();return r?r.maxBitrate<35e4?r.maxBitrate-2e4:r.maxBitrate:0}getVideoMiniBitrate(e){var t;const r=null===(t=this.getVideoHRTCTrack(e))||void 0===t?void 0:t.getTrackProfile();return r?r.minBitrate:0}getVideoWidth(e){var t;const r=null===(t=this.getVideoHRTCTrack(e))||void 0===t?void 0:t.getTrackProfile();return r?r.width:0}getVideoHeight(e){var t;const r=null===(t=this.getVideoHRTCTrack(e))||void 0===t?void 0:t.getTrackProfile();return r?r.height:0}getVideoframeRate(e){var t;const r=null===(t=this.getVideoHRTCTrack(e))||void 0===t?void 0:t.getTrackProfile();return r?r.frameRate:0}getVideoProfile(e){var t;return null===(t=this.getVideoHRTCTrack(e))||void 0===t?void 0:t.getTrackProfile()}async setVideoProfile(e,t){await this.setVideoProfileImpl(e,t)}async addResolution(e,t){return await this.addResolutionImpl(e,t)}async addResolutionImpl(e,t){try{const r=WI.formatVideoProfile(e),i={resolutionId:this.generateResolutionId(),width:r.width,height:r.height,frameRate:r.frameRate,minBitrate:r.minBitrate,maxBitrate:r.maxBitrate};this.logger.info(this.module_,"addResolutionImpl begin, profile:".concat(JSON.stringify(i)," ")),await this.addCaptureWithCfg(!0,t,i,this.audioProfile_,AI.slides);for(const e of this.client_)await e.publish(this);return this.logger.info(this.module_,"addResolutionImpl success"),i}catch(tb){throw this.logger.error(this.module_,"addResolutionImpl fail, errMsg:".concat(tb)),"function"!=typeof tb.getMediaCaptureResult?new ry(tb.getCode(),tb.getMsg(),null):tb}}async removeResolution(e){return this.removeResolutionImpl(e)}async removeResolutionImpl(e){this.logger.info(this.module_,"removeResolutionImpl begin, resolutionId:".concat(e));const t=this.getVideoHRTCTrack(e);if(!t)throw this.logger.error(this.module_,"removeResolutionImpl, resolutionId:".concat(e," not found ")),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"resolutionId:".concat(e," not found"));this.tracks[uI.TRACK_TYPE_VIDEO].delete(e),t.removeTrack();const r=this.getHRTCTracks({mediaType:uI.TRACK_TYPE_VIDEO});r&&0!==r.length||this.tracks[uI.TRACK_TYPE_AUDIO].delete("mainAudio");for(const i of this.client_)await i.publish(this);this.logger.info(this.module_,"removeResolutionImpl success, resolutionId:".concat(e))}async setVideoProfileImpl(e,t){var r;this.logger.info(this.module_,"setVideoProfile begin, profile: ".concat(JSON.stringify(e)));const i=this.getVideoHRTCTrack(t),n=WI.formatVideoProfile(e);if(!i){const e=this.generateResolutionId();return void this.videoProfiles_.set(e,n)}const s={};Hg.isSupportConstraints("aspectRatio")&&(s.aspectRatio={ideal:n.width/n.height}),s.width={ideal:n.width},s.height={ideal:n.height},s.frameRate={ideal:n.frameRate},await(null===(r=i.getTrack())||void 0===r?void 0:r.applyConstraints(s).then((()=>{this.logger.info(this.module_,"setVideoProfile, constraint: ".concat(JSON.stringify(i.getTrack().getConstraints()))),i.setLocalProfileByTrack(i.getTrack()),this.videoProfiles_.set(i.getResolutionId(),n),this.client_.forEach((async e=>{if(e){const t=e.getMainStreamSenderByTrack(i.getTrackId());await e.setSendBitrate(t,this.getVideoMaxSendBitrate(i.getResolutionId()),this.isAuxiliary()?"auxVideo":"mainVideo"),await e.publish(this)}}))})))}getScreenSendBitrate(){const e=this.getVideoHRTCTrack();return e?e.getTrackProfile().bitrate:0}getScreenWidth(){const e=this.getVideoHRTCTrack();return e?e.getTrackProfile().width:0}getScreenHeight(){const e=this.getVideoHRTCTrack();return e?e.getTrackProfile().height:0}getScreenframeRate(){const e=this.getVideoHRTCTrack();return e?e.getTrackProfile().frameRate:0}setScreenProfile(e){this.setScreenProfileImpl(e)}setScreenProfileImpl(e){const t=this.getVideoHRTCTrack();this.screenProfile_=e,t&&t.setTrackProfile(e)}async switchVideoDevice(e){var t;this.logger.info(this.module_,"switchVideoDevice begin, cameraId is ".concat(e));const r=this.getHRTCTracks({hasTrack:!0,mediaType:uI.TRACK_TYPE_VIDEO});if(0===r.length)return void this.logger.error(this.module_,"switchVideoDevice failed, no video tracks");const i=[];for(const d of r){var n;null===(n=this.mediaStream)||void 0===n||n.removeTrack(d.getTrack()),d.setTrackProfile(this.videoProfiles_.get(d.getResolutionId())),i.push(d.initVideoCapture(e,d.getTrackContentType()))}const s=await Promise.all(i),o=[];for(const d of s){var a,c,u;if(d.error)throw d.error;null===(a=this.mediaStream)||void 0===a||a.addTrack(d.track);const e=d.track.getConstraints(),t=d.track.getSettings(),i="number"==typeof e.width?e.width:(null===(c=e.width)||void 0===c?void 0:c.ideal)||t.width,n="number"==typeof e.height?e.height:(null===(u=e.height)||void 0===u?void 0:u.ideal)||t.height,s=r.find((e=>{const t=e.getTrackProfile();return t.width===i&&t.height===n}));for(const r of this.client_){const e=r.getMainStreamSenderByTrack(null==s?void 0:s.getTrackId());e&&o.push(e.replaceTrack(d.track))}}if(s.length&&(this.cameraId_=e,this.effectiveCameraId_=e),0!==o.length){this.stat.setMediaCaptureSucc(xT.VIDEO,null===(t=s[0].track)||void 0===t?void 0:t.label),await Promise.all(o);for(const e of this.client_)await e.publish(this);this.logger.info(this.module_,"switchVideoDevice success")}else this.logger.debug(this.module_,"switchVideoDevice, no need replace sender track")}async switchAudioDevice(e){var t,r,i;this.logger.info(this.module_,"switchAudioDevice begin, microphoneId is ".concat(e));const n=this.getAudioHRTCTrack();if(!n)return void this.logger.error(this.module_,"switchAudioDevice failed, no audio tracks");null===(t=this.mediaStream)||void 0===t||t.removeTrack(n.getTrack());const s=await n.initAudioCapture(e);if(s.error)throw s.error;this.stat.setMediaCaptureSucc(xT.AUDIO,null===(r=s.track)||void 0===r?void 0:r.label),this.replaceMixAudioTrack(s.track),null===(i=this.mediaStream)||void 0===i||i.addTrack(s.track);const o=[];this.client_.forEach((e=>{const t=e.getPublishAudioSender();t&&o.push(t.replaceTrack(this.getPublishAudioTrack()))})),0===o.length&&this.logger.info(this.module_,"switchAudioDevice, no need replace sender track"),this.microphoneId_=e,this.effectiveMicrophoneId_=e,await Promise.all(o)}async switchDevice(e,t){return await this.switchDeviceImpl(e,t)}async switchDeviceImpl(e,t){return new Promise(((r,i)=>{if(this.logger.info(this.module_,"switchDeviceImpl begin, type:".concat(e,", deviceId:").concat(t)),e===uI.TRACK_TYPE_AUDIO){if("default"!==t&&(this.effectiveMicrophoneId_===t||this.audioSource_))return void r();this.switchAudioDevice(t).then((()=>{this.stopSendMutePackage(),this.stat.reportSwitchDevicesInfo(DT.INPUT_AUDIO,t,WT.SUCCESS),r()})).catch((e=>{this.stat.reportSwitchDevicesInfo(DT.INPUT_AUDIO,t,WT.FAIL),this.logger.error(this.module_,"switchDevice failed, errmsg= ".concat(e)),i(new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR))}))}else if(e===uI.TRACK_TYPE_VIDEO){if(this.effectiveCameraId_===t||this.videoSource_)return void r();this.switchVideoDevice(t).then((()=>{this.stat.reportSwitchDevicesInfo(DT.INPUT_VIDEO,t,WT.SUCCESS),r()})).catch((e=>{this.stat.reportSwitchDevicesInfo(DT.INPUT_VIDEO,t,WT.FAIL),this.logger.error(this.module_,"switchDevice failed, errmsg= ".concat(e)),i(new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR))}))}else i(new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"invalid media type:".concat(e)))}))}async addTrack(e,t){return await this.addTrackImpl(e,t)}async addTrackImpl(e,t){var r;if(!e)throw this.logger.error(this.module_,"addTrack, track is null"),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"track is null");if(this.logger.info(this.module_,"addTrackImpl begin, resolutionId:".concat(t,", physical track id:").concat(e.id)),e.kind===uI.TRACK_TYPE_AUDIO){const r=this.getUninitializedAudioHRTCTrack();if(!r)throw this.logger.error(this.module_,"addTrackImpl failed, audio track already exist"),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"audio track already exist");{await r.replaceTrack(e),this.replaceMixAudioTrack(e);const i=this.getAnyVideoHRTCTrack(t),n=null!=i&&i.isPlaying()?i:null;n&&await this.play(n.getElementId(),{objectFit:n.getObjectFit(),muted:n.getTrackMuted(),resolutionId:n.getResolutionId()}),this.logger.info(this.module_,"addTrackImpl success , track type is audio,"+"physical track id:".concat(e.id))}}else{const r=this.getUninitializedVideoHRTCTrack(t);if(!r)throw this.logger.error(this.module_,"addTrackImpl failed, video track already exist"),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"video track already exist");{await r.replaceTrack(e);const t=this.getAnyAudioHRTCTrack(),i=null!=t&&t.isPlaying()?t:null;i&&await this.play(i.getElementId(),{objectFit:i.getObjectFit(),muted:i.getTrackMuted(),resolutionId:null}),this.logger.info(this.module_,"addTrackImpl success , track type is video,"+"physical track id:".concat(e.id))}}null===(r=this.mediaStream)||void 0===r||r.addTrack(e);for(const i of this.client_)i&&await i.publish(this)}async removeTrack(e){return await this.removeTrackImpl(e)}async removeTrackImpl(e){var t;if(!e)throw this.logger.error(this.module_,"removeTrack, track is null"),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"track is null");if(e.kind===uI.TRACK_TYPE_AUDIO)for(const[n,s]of this.tracks[uI.TRACK_TYPE_AUDIO]){var r;e.id===(null==s||null===(r=s.getTrack())||void 0===r?void 0:r.id)&&(s.removeTrack(),this.tracks[uI.TRACK_TYPE_AUDIO].set(n,s),this.logger.info(this.module_,"removeTrackImpl success , track type is ".concat(s.getTrackType(),",")+"physical track id:".concat(e.id)))}else for(const[n,s]of this.tracks[uI.TRACK_TYPE_VIDEO]){var i;e.id===(null==s||null===(i=s.getTrack())||void 0===i?void 0:i.id)&&(s.removeTrack(),this.tracks[uI.TRACK_TYPE_VIDEO].set(n,s),this.logger.info(this.module_,"removeTrackImpl success , track type is ".concat(s.getTrackType(),",")+"physical track id:".concat(e.id)))}null===(t=this.mediaStream)||void 0===t||t.removeTrack(e);for(const n of this.client_)n&&await n.publish(this)}async replaceTrack(e,t,r){return await this.replaceTrackImpl(e,t,r)}async replaceTrackImpl(e,t,r){var i,n,s;if(!e)throw this.logger.error(this.module_,"replaceTrack, track is null"),new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR);let o;t===uI.TRACK_TYPE_AUDIO?(o=this.getAudioHRTCTrack(),this.replaceMixAudioTrack(e)):t===uI.TRACK_TYPE_VIDEO&&(o=this.getVideoHRTCTrack(r)),null===(i=this.mediaStream)||void 0===i||i.removeTrack(o.getTrack()),null===(n=this.mediaStream)||void 0===n||n.addTrack(e),await(null===(s=o)||void 0===s?void 0:s.replaceTrack(e));for(const a of this.client_)a&&await a.publish(this)}addClient(e){this.client_=this.client_.filter((t=>t&&t.getSymbol()!==e.getSymbol())),e&&this.client_.push(e)}removeClient(e){e&&-1!==this.client_.indexOf(e)&&this.client_.splice(this.client_.indexOf(e),1)}muteAudio(){return!!super.muteAudio()&&(this.stat.reportAudioMuteInfo(1,!0),this.client_.forEach((e=>{e.changeStreamMuteStatusNotify(!0,uI.TRACK_TYPE_AUDIO),e.reportAudioMuteInfo(1,!0)})),!0)}muteVideo(){return!!super.muteVideo()&&(this.stat.reportVideoMuteInfo(this.userId_,!0),this.client_.forEach((e=>{var t;const r=(null===(t=this.getHRTCTracks({hasTrack:!0,mediaType:uI.TRACK_TYPE_VIDEO}))||void 0===t?void 0:t.length)>1;e.changeStreamMuteStatusNotify(!0,uI.TRACK_TYPE_VIDEO,this.isAuxiliary_?AI.desktop:AI.main,r),e.reportVideoMuteInfo(this.userId_,!0)})),!0)}unmuteAudio(){return!!super.unmuteAudio()&&(this.stat.reportAudioMuteInfo(1,!1),this.client_.forEach((e=>{e.changeStreamMuteStatusNotify(!1,uI.TRACK_TYPE_AUDIO),e.reportAudioMuteInfo(1,!1)})),!0)}unmuteVideo(){return!!super.unmuteVideo()&&(this.stat.reportVideoMuteInfo(this.userId_,!1),this.client_.forEach((e=>{var t;const r=(null===(t=this.getHRTCTracks({hasTrack:!0,mediaType:uI.TRACK_TYPE_VIDEO}))||void 0===t?void 0:t.length)>1;e.changeStreamMuteStatusNotify(!1,uI.TRACK_TYPE_VIDEO,this.isAuxiliary_?AI.desktop:AI.main,r),e.reportVideoMuteInfo(this.userId_,!1)})),!0)}closeImpl(e){!1!==(null==e?void 0:e.audio)&&(this.closeScreenShareAudio(),this.isAuxiliary()||this.audioMixInfo_.playAutoEnded||this.audioMixInfo_.audioMixState===kT.IDLE||this.audioMixInfo_.audioMixState===kT.INIT||this.stopAudioMixing()),super.closeImpl(e)}clearEffectiveDeviceId(e,t){this.logger.info(this.module_,"clearEffectiveDeviceId, Input:".concat(e,", type:").concat(t)),"audioInput"===t?this.effectiveMicrophoneId_===e&&(this.effectiveMicrophoneId_="",this.logger.info(this.module_,"clearEffectiveDeviceId, audioInput:".concat(e))):"videoInput"===t&&this.effectiveCameraId_===e&&(this.effectiveCameraId_="",this.logger.info(this.module_,"clearEffectiveDeviceId, videoInput:".concat(e)))}startSendMutePackage(){var e;this.logger.debug(this.module_,"start SendMutePackage");const t=null===(e=this.getAudioHRTCTrack())||void 0===e?void 0:e.getTrack();if(!t||"ended"!==t.readyState)return void this.logger.info(this.module_,"removed device is not in use, startSendMutePackage end");if(this.muteSendInfo.audioMixState!=kT.IDLE||!this.client_[0].getPublishAudioSender())return void this.logger.info(this.module_,"the condition is not met, startSendMutePackage end");this.muteSendInfo.audioCtx||(this.muteSendInfo.audioCtx=new AudioContext);let r=this.mutePackageData.slice(0);this.muteSendInfo.audioCtx.decodeAudioData(r,(e=>{var t;this.muteSendInfo.destNode=this.muteSendInfo.audioCtx.createMediaStreamDestination(),this.muteSendInfo.sourceNode=this.muteSendInfo.audioCtx.createBufferSource(),this.muteSendInfo.sourceNode.buffer=e,this.muteSendInfo.sourceNode.connect(this.muteSendInfo.destNode),this.muteSendInfo.sourceNode.loop=!0,this.muteSendInfo.sourceNode.start(0,0),this.muteSendInfo.audioMixState=kT.PLAY,null===(t=this.client_[0].getPublishAudioSender())||void 0===t||t.replaceTrack(this.muteSendInfo.destNode.stream.getAudioTracks()[0]),this.logger.info(this.module_,"startSendMutePackage success"),r=null}),(()=>{this.muteSendInfo.audioMixState=kT.IDLE,this.logger.info(this.module_,"startSendMutePackage failed"),r=null}))}stopSendMutePackage(){var e,t,r;this.logger.info(this.module_,"stopSendMutePackage begin"),this.muteSendInfo.audioMixState===kT.PLAY?(null===(e=this.muteSendInfo.mediaNode)||void 0===e||e.connect(this.muteSendInfo.destNode),null===(t=this.muteSendInfo.sourceNode)||void 0===t||t.stop(),null===(r=this.muteSendInfo.sourceNode)||void 0===r||r.disconnect(),this.muteSendInfo.sourceNode=null,this.muteSendInfo.audioMixState=kT.IDLE):this.logger.info(this.module_,"stopSendMutePackage end")}bindScreenAudio2RelatedStream(e,t){this.bindScreenAudio2RelatedStreamImpl(e,t)}bindScreenAudio2RelatedStreamImpl(e,t){if(this.logger.info(this.module_,"bindScreenAudio2RelatedStreamImpl, streamId: ".concat(e.getId())),t&&!e.hasAudioTrack()){const t=this.getAudioTrack();if(t){const r=new qI({streamType:dI.STREAM_TYPE_MAIN,trackType:uI.TRACK_TYPE_AUDIO,isRemote:!1,logger:this.logger,resolutionId:this.generateResolutionId(),track:t,event:this.eventEmitter});e.tracks[uI.TRACK_TYPE_AUDIO].set("mainAudio",r)}}this.screenShareMixInfo.bindStream=e,e.screenShareMixInfo.bindStream=this;this.mixScreenAudio(t)||(this.screenShareMixInfo.bindStream=null,e.screenShareMixInfo.bindStream=null)}mixScreenAudio(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r=this.screenShareMixInfo.bindStream;if(!this.isAuxiliary()||null==r||!r.getAudioHRTCTrack()||!this.getAudioHRTCTrack())return this.logger.error(this.module_,"mixScreenAudio2MainStreamAudio failed, isAuxiliary: ".concat(this.isAuxiliary()," ,main stream or audio track is null")),!1;if(this.screenShareMixInfo.status=kT.PLAY,!r.audioMixInfo_.audioCtx){var i;r.audioMixInfo_.audioCtx=new AudioContext,r.audioMixInfo_.destNode=r.audioMixInfo_.audioCtx.createMediaStreamDestination();const e=null===(i=r.getAudioHRTCTrack())||void 0===i?void 0:i.getTrack();e&&(r.audioMixInfo_.mediaNode=r.audioMixInfo_.audioCtx.createMediaStreamSource(new MediaStream([e])),r.audioMixInfo_.mediaNode.connect(r.audioMixInfo_.destNode))}t&&(r.audioMixInfo_.mediaNode.disconnect(r.screenShareMixInfo.destNode),this.logger.info(this.module_,"mixScreenAudio2MainStreamAudio, only play screen share audio stream"));const n=null===(e=this.getAudioHRTCTrack())||void 0===e?void 0:e.getTrack();return this.screenShareMixInfo.screenShareAudioNode=r.audioMixInfo_.audioCtx.createMediaStreamSource(new MediaStream([n])),this.screenShareMixInfo.destNode=r.audioMixInfo_.destNode,this.screenShareMixInfo.gainNode=r.audioMixInfo_.audioCtx.createGain(),this.screenShareMixInfo.gainNode.gain.value=this.screenShareMixInfo.gainValue,this.screenShareMixInfo.screenShareAudioNode.connect(this.screenShareMixInfo.gainNode),this.screenShareMixInfo.gainNode.connect(this.screenShareMixInfo.destNode),this.screenShareMixInfo.muteMainAudio=t,!0}getPublishAudioTrack(){var e;if(this.isAuxiliary()){if(this.screenShareMixInfo.destNode&&this.screenShareMixInfo.destNode.stream){const e=this.screenShareMixInfo.destNode.stream.getAudioTracks();if(e&&e.length>0)return e[0]}}else{const e=this.screenShareMixInfo.bindStream;if(e){const t=e.client_.length>0&&e.client_[0].getPublishVideoSender(dI.STREAM_TYPE_AUX).length,r=this.audioMixInfo_.audioMixState===kT.PAUSE||this.audioMixInfo_.audioMixState===kT.PLAY;if((t||r)&&this.audioMixInfo_.destNode&&this.audioMixInfo_.destNode.stream){const e=this.audioMixInfo_.destNode.stream.getAudioTracks();if(e&&e.length>0)return e[0]}}else if(this.audioMixInfo_.destNode&&this.audioMixInfo_.destNode.stream){const e=this.audioMixInfo_.destNode.stream.getAudioTracks();if(e&&e.length>0)return e[0]}}return null===(e=super.getAudioHRTCTrack())||void 0===e?void 0:e.getTrack()}async resumeMixScreenAudio(){const e=this.screenShareMixInfo.bindStream;if(!(this.isAuxiliary()&&e&&this.screenShareMixInfo.gainNode&&this.screenShareMixInfo.destNode))return void this.logger.info(this.module_,"cannot resumeMixScreenAudio, isAuxiliary: ".concat(this.isAuxiliary()));this.screenShareMixInfo.gainNode.connect(this.screenShareMixInfo.destNode);const t=e.client_.length>0&&e.client_[0].getPublishAudioSender(),r=this.client_.length>0&&this.client_[0].getPublishVideoSender(dI.STREAM_TYPE_AUX).length;t&&r&&await e.client_[0].getPublishAudioSender().replaceTrack(this.getPublishAudioTrack())}async stopMixScreenAudio(){this.screenShareMixInfo.gainNode&&this.screenShareMixInfo.destNode?this.screenShareMixInfo.gainNode.disconnect(this.screenShareMixInfo.destNode):this.logger.info(this.module_,"stopScreenAudio gainNode or destNode is null")}setAudioVolume(e){if(this.isAuxiliary()){if(!this.screenShareMixInfo.bindStream||this.screenShareMixInfo.status!==kT.PLAY)return void this.logger.error(this.module_,"setScreenAudioVolume failed for play status error");const t=e/100;this.logger.info(this.module_,"setScreenAudioVolume: "+t),this.screenShareMixInfo.gainNode.gain.value=t,this.screenShareMixInfo.gainValue=t}else super.setAudioVolume(e)}closeScreenShareAudio(){if(this.isAuxiliary())this.screenShareMixInfo.gainNode&&this.screenShareMixInfo.gainNode.disconnect(),this.screenShareMixInfo.screenShareAudioNode&&this.screenShareMixInfo.screenShareAudioNode.disconnect(),this.screenShareMixInfo.gainNode=null,this.screenShareMixInfo.gainValue=.5,this.screenShareMixInfo.screenShareAudioNode=null,this.screenShareMixInfo.bindStream=null,this.screenShareMixInfo.status=kT.INIT;else{const e=this.screenShareMixInfo.bindStream;if(!e)return void this.logger.debug(this.module_,"closeScreenShareAudio, no need closeScreenShareAudio, aux stream is null");e.closeScreenShareAudio(),this.screenShareMixInfo.bindStream=null}}async startAudioMixing(e){await this.startAudioMixingImpl(e),this.eventEmitter.emit(_T),this.logger.info(this.module_,"emit ".concat(_T," at startAudioMixing"))}async startAudioMixingImpl(e){var t,r;if(this.logger.info(this.module_,"startAudioMixing start at: "+e.startTime),this.checkAudioMixingParameter(),this.audioMixInfo_.audioMixState===kT.IDLE&&this.initIdleAudioMixInfo(),this.audioMixInfo_.audioMixState!==kT.INIT)throw this.logger.error(this.module_,"startAudioMixing status: ".concat(this.audioMixInfo_.audioMixState)),new Eu(ou.RTC_ERR_CODE_STATUS_ERROR,"startAudioMixing status: ".concat(this.audioMixInfo_.audioMixState));(this.setAudioMixOption(e),this.audioMixOption_.replace)?this.logger.info(this.module_,"startAudioMixing: replace"):null===(r=this.audioMixInfo_.mediaNode)||void 0===r||r.connect(this.audioMixInfo_.destNode);await(null===(t=this.client_[0].getPublishAudioSender())||void 0===t?void 0:t.replaceTrack(this.audioMixInfo_.destNode.stream.getAudioTracks()[0]));try{const e=await aR.fetch(this.audioMixOption_.filePath);await this.audioMixInfo_.audioCtx.decodeAudioData(e.data,(e=>{this.audioMixInfo_.startAt=Hg.getCurrentTimestamp(),this.audioMixInfo_.pauseAt=0,this.audioMixInfo_.pauseDur=0,this.audioMixInfo_.playAutoEnded=!1,this.audioMixInfo_.totalDur=0,this.audioMixInfo_.sourceNode=this.audioMixInfo_.audioCtx.createBufferSource(),this.audioMixInfo_.sourceNode.onended=()=>{Math.abs(this.audioMixInfo_.totalDur-(Hg.getCurrentTimestamp()-this.audioMixInfo_.startAt-this.audioMixInfo_.pauseDur))<200&&(this.stopAudioMixing(),this.audioMixInfo_.playAutoEnded=!0,this.eventEmitter.emit(mT),this.logger.info(this.module_,"emit ".concat(mT," at startAudioMixingImpl")))},this.audioMixInfo_.sourceNode.buffer=e,this.audioMixInfo_.buffer=e,this.audioMixInfo_.sourceNode.connect(this.audioMixInfo_.gainNode),this.audioMixInfo_.gainNode.connect(this.audioMixInfo_.destNode),this.audioMixInfo_.audioMixState=kT.PLAY,this.logger.info(this.module_,"startAudioMixing, duration: ".concat(this.getAudioMixingDuration())),this.doAudioMixing(),this.logger.info(this.module_,"startAudioMixing end")}),(e=>{throw this.logger.error(this.module_,"startAudioMixing, decode audio failed"),e}))}catch(tb){var i,n,s;if(this.logger.error(this.module_,"startAudioMixing failed: ".concat(tb)),this.audioMixInfo_.audioMixState=kT.INIT,!this.audioMixOption_.replace)null===(s=this.audioMixInfo_.mediaNode)||void 0===s||s.disconnect(this.audioMixInfo_.destNode);throw null===(i=this.client_[0].getPublishAudioSender())||void 0===i||i.replaceTrack(null===(n=this.getAudioHRTCTrack())||void 0===n?void 0:n.getTrack()),tb}}doAudioMixing(){if(this.audioMixOption_.repeatCount>1){if(this.audioMixOption_.startTime>=this.getAudioMixingDuration())throw this.logger.error(this.module_,"startAudioMixing: ".concat(this.audioMixInfo_.audioMixState)),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"startAudioMixing: not valid startTime");this.audioMixInfo_.sourceNode.loop=!0;const e=this.audioMixOption_.repeatCount*this.getAudioMixingDuration()-this.audioMixOption_.startTime;this.audioMixInfo_.totalDur=e,this.audioMixInfo_.sourceNode.start(0,this.audioMixOption_.startTime/1e3,e/1e3)}else this.audioMixInfo_.sourceNode.loop=this.audioMixOption_.loop,this.audioMixOption_.loop?this.audioMixInfo_.totalDur=1/0:(this.getAudioMixingDuration()<=this.audioMixOption_.startTime&&(this.logger.info(this.module_,"startAudioMixing, bookmark: ".concat(this.audioMixOption_.startTime," invalid and reset to begin.")),this.audioMixOption_.startTime=0),this.audioMixInfo_.totalDur=this.getAudioMixingDuration()-this.audioMixOption_.startTime),this.audioMixInfo_.sourceNode.start(0,this.audioMixOption_.startTime/1e3)}setAudioMixOption(e){e.replace||(e.replace=!1),e.startTime||(e.startTime=0),e.loop||(e.loop=!1),e.repeatCount&&!e.loop||(e.repeatCount=0),this.audioMixOption_=e}initIdleAudioMixInfo(){if(!this.audioMixInfo_.audioCtx){var e;this.audioMixInfo_.audioCtx=new AudioContext,this.audioMixInfo_.destNode=this.audioMixInfo_.audioCtx.createMediaStreamDestination();const t=null===(e=this.getAudioHRTCTrack())||void 0===e?void 0:e.getTrack();t&&(this.audioMixInfo_.mediaNode=this.audioMixInfo_.audioCtx.createMediaStreamSource(new MediaStream([t])))}this.audioMixInfo_.gainNode=this.audioMixInfo_.audioCtx.createGain(),this.audioMixInfo_.gainNode.gain.value=this.audioMixInfo_.gainValue,this.audioMixInfo_.audioMixState=kT.INIT}checkAudioMixingParameter(){if(!this.client_||this.client_.length<1||!this.client_[0].getPublishAudioSender())throw this.logger.error(this.module_,"startAudioMixing failed"),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"no mediaStream or no client or no audio!")}replaceMixAudioTrack(e){if(this.audioMixInfo_.audioMixState!==kT.IDLE&&this.audioMixInfo_.audioMixState!==kT.INIT&&this.audioMixInfo_.mediaNode&&this.audioMixInfo_.destNode){if(this.audioMixOption_.replace)return;return this.audioMixInfo_.mediaNode.disconnect(this.audioMixInfo_.destNode),this.audioMixInfo_.mediaNode=null,this.audioMixInfo_.mediaNode=this.audioMixInfo_.audioCtx.createMediaStreamSource(new MediaStream([e])),void this.audioMixInfo_.mediaNode.connect(this.audioMixInfo_.destNode)}if(!this.isAuxiliary_){var t;const r=null===(t=this.screenShareMixInfo.bindStream)||void 0===t?void 0:t.screenShareMixInfo;r&&!r.muteMainAudio&&this.audioMixInfo_.audioCtx&&this.audioMixInfo_.destNode&&(this.audioMixInfo_.mediaNode=this.audioMixInfo_.audioCtx.createMediaStreamSource(new MediaStream([e])),this.audioMixInfo_.mediaNode.connect(this.audioMixInfo_.destNode))}}async stopAudioMixing(){await this.stopAudioMixingImpl()}async stopAudioMixingImpl(){if(!this.audioMixInfo_.playAutoEnded)if(this.audioMixInfo_.audioMixState!==kT.IDLE&&this.audioMixInfo_.audioMixState!==kT.INIT){try{var e,t;await(null===(e=this.client_[0].getPublishAudioSender())||void 0===e?void 0:e.replaceTrack(null===(t=this.getAudioHRTCTrack())||void 0===t?void 0:t.getTrack()))}catch(i){throw this.logger.error(this.module_,"stopAudioMixing: ".concat(this.audioMixInfo_.audioMixState,", errMsg = ").concat(i)),new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR)}var r;if(this.logger.info(this.module_,"stopAudioMixing"),!this.audioMixOption_.replace&&this.audioMixInfo_.audioMixState!==kT.PAUSE)null===(r=this.audioMixInfo_.mediaNode)||void 0===r||r.disconnect(this.audioMixInfo_.destNode);this.audioMixInfo_.sourceNode.stop(),this.audioMixInfo_.buffer=null,this.audioMixInfo_.sourceNode.disconnect(),this.audioMixInfo_.gainNode.disconnect(),this.audioMixInfo_.gainValue=.5,this.audioMixInfo_.sourceNode=null,this.audioMixInfo_.playAutoEnded=!1,this.audioMixInfo_.audioMixState=kT.INIT}else this.logger.info(this.module_,"stopAudioMixing: ".concat(this.audioMixInfo_.audioMixState))}pauseAudioMixing(){this.pauseAudioMixingImpl()}pauseAudioMixingImpl(){if(this.audioMixInfo_.audioMixState===kT.PLAY){this.logger.info(this.module_,"pauseAudioMixing"),this.audioMixOption_.replace||this.audioMixInfo_.mediaNode.disconnect(this.audioMixInfo_.destNode);try{var e,t;null===(e=this.client_[0].getPublishAudioSender())||void 0===e||e.replaceTrack(null===(t=this.getAudioHRTCTrack())||void 0===t?void 0:t.getTrack())}catch(r){throw this.logger.error(this.module_,"pauseAudioMixing, errMsg = ".concat(r)),new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR)}this.audioMixInfo_.sourceNode.stop(),this.audioMixInfo_.sourceNode.disconnect(),this.audioMixInfo_.gainNode.disconnect(),this.audioMixInfo_.pauseAt=Hg.getCurrentTimestamp(),this.audioMixInfo_.audioMixState=kT.PAUSE}else this.logger.error(this.module_,"pauseAudioMixing: ".concat(this.audioMixInfo_.audioMixState))}resumeAudioMixing(){this.resumeAudioMixingImpl(),this.eventEmitter.emit(_T),this.logger.info(this.module_,"emit ".concat(_T," at resumeAudioMixing"))}resumeAudioMixingImpl(){if(this.audioMixInfo_.audioMixState!==kT.PAUSE)return void this.logger.error(this.module_,"resumeAudioMixing: ".concat(this.audioMixInfo_.audioMixState));this.logger.info(this.module_,"resumeAudioMixing"),this.audioMixOption_.replace||this.audioMixInfo_.mediaNode.connect(this.audioMixInfo_.destNode);try{var e;null===(e=this.client_[0].getPublishAudioSender())||void 0===e||e.replaceTrack(this.audioMixInfo_.destNode.stream.getAudioTracks()[0])}catch(i){throw this.logger.error(this.module_,"pauseAudioMixing, errMsg = ".concat(i)),new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR)}this.audioMixInfo_.sourceNode=this.audioMixInfo_.audioCtx.createBufferSource(),this.audioMixInfo_.sourceNode.onended=()=>{Math.abs(this.audioMixInfo_.totalDur-(Hg.getCurrentTimestamp()-this.audioMixInfo_.startAt-this.audioMixInfo_.pauseDur))<200&&(this.stopAudioMixing(),this.audioMixInfo_.playAutoEnded=!0,this.eventEmitter.emit(mT),this.logger.info(this.module_,"emit ".concat(mT," at resumeAudioMixingImpl")))},this.audioMixInfo_.sourceNode.buffer=this.audioMixInfo_.buffer,this.audioMixInfo_.sourceNode.connect(this.audioMixInfo_.gainNode),this.audioMixInfo_.gainNode.connect(this.audioMixInfo_.destNode);const t=this.audioMixInfo_.pauseAt-this.audioMixInfo_.startAt-this.audioMixInfo_.pauseDur,r=t+this.audioMixOption_.startTime;if(this.audioMixOption_.repeatCount>1){this.audioMixInfo_.sourceNode.loop=!0;const e=this.audioMixOption_.repeatCount*this.getAudioMixingDuration()-this.audioMixOption_.startTime-t;this.audioMixInfo_.sourceNode.start(0,r%this.getAudioMixingDuration()/1e3,e/1e3)}else this.audioMixInfo_.sourceNode.loop=this.audioMixOption_.loop,this.audioMixInfo_.sourceNode.start(0,r%this.getAudioMixingDuration()/1e3);this.audioMixInfo_.pauseDur=this.audioMixInfo_.pauseDur+Hg.getCurrentTimestamp()-this.audioMixInfo_.pauseAt,this.audioMixInfo_.audioMixState=kT.PLAY}getAudioMixingCurrentPosition(){let e=0;if(this.audioMixInfo_.audioMixState===kT.PAUSE)e=this.audioMixInfo_.pauseAt;else{if(this.audioMixInfo_.audioMixState!==kT.PLAY)return 0;e=Hg.getCurrentTimestamp()}const t=this.getAudioMixingDuration();let r=(e-this.audioMixInfo_.startAt-this.audioMixInfo_.pauseDur+this.audioMixOption_.startTime)%t;return r=Math.min(Math.round(r),t),this.logger.debug(this.module_,"getAudioMixingDuration: ".concat(r)),r}getAudioMixingDuration(){if(this.audioMixInfo_.audioMixState!==kT.PLAY&&this.audioMixInfo_.audioMixState!==kT.PAUSE)return this.logger.error(this.module_,"getAudioMixingDuration failed for play status error"),0;const e=1e3*this.audioMixInfo_.sourceNode.buffer.duration;return this.logger.debug(this.module_,"getAudioMixingDuration: ".concat(e)),e}setAudioMixingVolume(e){this.setAudioMixingVolumeImpl(e)}setAudioMixingVolumeImpl(e){if(this.audioMixInfo_.audioMixState!==kT.PLAY&&this.audioMixInfo_.audioMixState!==kT.PAUSE)return void this.logger.error(this.module_,"setAudioMixingVolume failed for play status error");const t=e/100;this.logger.debug(this.module_,"setAudioMixingVolume: "+t),this.audioMixInfo_.gainValue=t,this.audioMixInfo_.gainNode.gain.value=t}setAudioMixingPosition(e){this.setAudioMixingPositionImpl(e)}setAudioMixingPositionImpl(e){if(this.audioMixInfo_.audioMixState!==kT.PLAY&&this.audioMixInfo_.audioMixState!==kT.PAUSE)return void this.logger.error(this.module_,"setAudioMixingPosition failed for play status error");const t=this.getAudioMixingDuration();if(e<0||e>t)return void this.logger.error(this.module_,"setAudioMixingPosition failed for params error");let r;this.logger.debug(this.module_,"setAudioMixingPosition: ".concat(e)),this.audioMixInfo_.mediaNode.connect(this.audioMixInfo_.destNode),this.audioMixInfo_.sourceNode.stop(),this.audioMixInfo_.sourceNode.disconnect(),this.audioMixInfo_.gainNode.disconnect(),this.audioMixInfo_.sourceNode=null,r=this.audioMixInfo_.audioMixState===kT.PAUSE?this.audioMixInfo_.pauseAt:Hg.getCurrentTimestamp();const i=r-this.audioMixInfo_.startAt-this.audioMixInfo_.pauseDur+this.audioMixOption_.startTime;if(this.audioMixOption_.replace&&(this.audioMixInfo_.mediaNode.disconnect(this.audioMixInfo_.destNode),this.logger.info(this.module_,"resumeAudioMixing: replace")),this.audioMixInfo_.startAt=Hg.getCurrentTimestamp(),this.audioMixInfo_.pauseAt=0,this.audioMixInfo_.pauseDur=0,this.audioMixInfo_.playAutoEnded=!1,this.audioMixInfo_.sourceNode=this.audioMixInfo_.audioCtx.createBufferSource(),this.audioMixInfo_.sourceNode.onended=()=>{Math.abs(this.audioMixInfo_.totalDur-(Hg.getCurrentTimestamp()-this.audioMixInfo_.startAt-this.audioMixInfo_.pauseDur))<200&&(this.stopAudioMixing(),this.audioMixInfo_.playAutoEnded=!0,this.eventEmitter.emit(mT),this.logger.info(this.module_,"emit ".concat(mT," at setAudioMixingPositionImpl")))},this.audioMixInfo_.sourceNode.buffer=this.audioMixInfo_.buffer,this.audioMixInfo_.sourceNode.connect(this.audioMixInfo_.gainNode),this.audioMixInfo_.gainNode.connect(this.audioMixInfo_.destNode),i>=t&&this.audioMixOption_.repeatCount>1&&(this.audioMixOption_.repeatCount=Math.max(0,this.audioMixOption_.repeatCount-Math.floor(i/t))),this.audioMixOption_.repeatCount>1){this.audioMixInfo_.sourceNode.loop=!0;const r=this.audioMixOption_.repeatCount*t-e;this.audioMixInfo_.totalDur=r,this.audioMixInfo_.sourceNode.start(0,e/1e3,r/1e3)}else this.audioMixOption_.loop?this.audioMixInfo_.totalDur=1/0:this.audioMixInfo_.totalDur=t-e,this.audioMixInfo_.sourceNode.loop=this.audioMixOption_.loop,this.audioMixInfo_.sourceNode.start(0,e/1e3);this.audioMixOption_.startTime=e,this.audioMixInfo_.audioMixState===kT.PAUSE&&this.pauseAudioMixing()}getStatInfo(){return{audioProfile_:this.audioProfile_,videoProfile_:this.videoProfiles_,screenProfile_:this.screenProfile_,audio_:this.audio_,video_:this.video_,cameraId_:this.getCurrentCameraId(),facingMode_:this.facingMode_,microphoneId_:this.getCurrentMicrophoneId(),screen_:this.screen_,screenAudio_:this.screenAudio_}}}Mv([ZI("LocalStream$initialize#Promise<StreamInitializeResult>")],ny.prototype,"initialize",null),Mv([ZI("LocalStream$addAudioTrackCapture#Promise<MediaStreamTrack>#string")],ny.prototype,"addAudioTrackCapture",null),Mv([ZI("LocalStream$addVideoTrackCapture#Promise<MediaStreamTrack>#VideoCaptureOption")],ny.prototype,"addVideoTrackCapture",null),Mv([$I("LocalStream$setAudioProfile#void#string|RTCAudioProfile")],ny.prototype,"setAudioProfile",null),Mv([ZI("LocalStream$setVideoProfile#void#string|RTCVideoProfile")],ny.prototype,"setVideoProfile",null),Mv([ZI("LocalStream$addResolution#Promise<RTCVideoProfileInfo>#string|RTCVideoProfile#boolean")],ny.prototype,"addResolution",null),Mv([ZI("LocalStream$removeResolution#Promise<void>#string")],ny.prototype,"removeResolution",null),Mv([$I("LocalStream$setScreenProfile#void#string|RTCScreenProfile")],ny.prototype,"setScreenProfile",null),Mv([ZI("LocalStream$switchDevice#Promise<void>#string#string")],ny.prototype,"switchDevice",null),Mv([ZI("LocalStream$addTrack#Promise<void>#MediaStreamTrack#string")],ny.prototype,"addTrack",null),Mv([ZI("LocalStream$removeTrack#Promise<void>#MediaStreamTrack#string")],ny.prototype,"removeTrack",null),Mv([ZI("LocalStream$replaceTrack#Promise<void>#MediaStreamTrack#string#string")],ny.prototype,"replaceTrack",null),Mv([$I("LocalStream$bindScreenAudio2RelatedStream#void#LocalStream#boolean")],ny.prototype,"bindScreenAudio2RelatedStream",null),Mv([ZI("LocalStream$startAudioMixing#Promise<void>#AudioMixOption")],ny.prototype,"startAudioMixing",null),Mv([ZI("LocalStream$stopAudioMixing#Promise<void>")],ny.prototype,"stopAudioMixing",null),Mv([$I("LocalStream$pauseAudioMixing#void")],ny.prototype,"pauseAudioMixing",null),Mv([$I("LocalStream$resumeAudioMixing#void")],ny.prototype,"resumeAudioMixing",null),Mv([$I("LocalStream$setAudioMixingVolume#void#number")],ny.prototype,"setAudioMixingVolume",null),Mv([$I("LocalStream$setAudioMixingPosition#void#number")],ny.prototype,"setAudioMixingPosition",null);class sy extends iy{constructor(e){super({isRemote:!0,type:e.type,log:e.log}),this.userId_=e.userId,this.client_=[],this.client_.push(e.client),this.module_="RemoteStream",this.roomId_=e.roomId}muteAudio(){return!!super.muteAudio()&&(this.stat.reportAudioMuteInfo(2,!0),!0)}unmuteAudio(){return!!super.unmuteAudio()&&(this.stat.reportAudioMuteInfo(2,!1),!0)}getVideoHRTCTrackByTrackId(e){let t;for(const r of this.tracks[uI.TRACK_TYPE_VIDEO].values())if(r.getTrackId()===e){t=r;break}return t}updateRemoteResolutions(e,t,r){if(!t)return;const i=this.getHRTCTrackIds({mediaType:uI.TRACK_TYPE_VIDEO}),n=t.map((e=>e.streamId));for(const a of i)if(null==n||!n.includes(a))for(const t of this.getHRTCTracks({mediaType:uI.TRACK_TYPE_VIDEO}))if((null==t?void 0:t.getTrackId())===a){this.logger.info(this.module_,"updateRemoteResolutions, streamType:".concat(e,",delete track:").concat(a)),this.stop({audio:!1,video:!0,resolutionIds:[a]}),this.removeRemoteVideoTrack(a),this.tracks[uI.TRACK_TYPE_VIDEO].delete(t.getResolutionId());break}for(const a of t){if(i.includes(a.streamId)){var s;null===(s=this.getVideoHRTCTrackByTrackId(a.streamId))||void 0===s||s.updateTrackProfile(a);continue}const t=new qI({streamType:e,trackType:uI.TRACK_TYPE_VIDEO,isRemote:!0,trackProfile:{width:a.width,height:a.height},logger:this.logger,resolutionId:a.streamId,event:this.eventEmitter});t.setTrackId(a.streamId||t.getResolutionId()),this.tracks[uI.TRACK_TYPE_VIDEO].set(a.streamId,t)}const o=this.getAnyAudioHRTCTrack();if(r){if(!o){const t=new qI({streamType:e,trackType:uI.TRACK_TYPE_AUDIO,isRemote:!0,logger:this.logger,resolutionId:this.id_,event:this.eventEmitter});this.tracks[uI.TRACK_TYPE_AUDIO].set("mainAudio",t)}}else o&&(this.logger.info(this.module_,"updateRemoteResolutions, streamType:".concat(e,",delete audio track")),this.stop({audio:!0,video:!1}),this.removeRemoteAudioTrack(),this.tracks[uI.TRACK_TYPE_AUDIO].delete("mainAudio"));this.logger.info(this.module_,"updateResolutions success,userId:".concat(this.getUserId(),", streamType:").concat(e,",")+"new resolution is ".concat(this.getHRTCTracksProfileString(),"  hasAudio: ").concat(this.hasAudioTrack()))}getHRTCTracksProfileString(){const e=this.getHRTCTracks();let t="";return e.forEach((e=>{t=t+e.getTrackId()+":"+JSON.stringify(e.getTrackProfile())+","})),t}addRemoteTrack(e,t){if(e.kind===uI.TRACK_TYPE_AUDIO){const t=this.getAnyAudioHRTCTrack();null==t||t.replaceTrack(e)}else{const r=Array.from(this.tracks[uI.TRACK_TYPE_VIDEO].values()).find((e=>e.getTrackId()===t));null==r||r.replaceTrack(e)}this.logger.info(this.module_,"addRemoteTrack MediaStreamTrack for trackId:".concat(t," success,userId:").concat(this.getUserId(),", type:").concat(this.getType(),",")+"new resolution is ".concat(this.getHRTCTracksProfileString(),", hasAudio: ").concat(this.hasAudioTrack()))}isTracksReady(e,t){if(this.isRemote_){let r=!0;if(null!=e&&e.length){const t=this.getHRTCTrackIds();for(const i of e)if(!t.includes(i)||!this.getVideoHRTCTrackByTrackId(i).getTrack()){r=!1;break}}const i=this.getAudioHRTCTrack(),n=i&&!!i.getTrack(),s=r&&(!t||n);return this.logger.debug(this.module_,"isTracksReady userId:".concat(this.getUserId(),", type:").concat(this.getType(),",")+"result: ".concat(s,",videoTrackIds: ").concat(e,", isVideoReady:").concat(r,", isAudioReady:").concat(n)),s}return!0}isTrackReady(e,t){if(this.isRemote_){var r;if(e===uI.TRACK_TYPE_VIDEO)return!(null===(r=this.getVideoHRTCTrackByTrackId(t))||void 0===r||!r.getTrack());return!!this.getAudioHRTCTrack()}return!1}removeRemoteAudioTrack(){const e=this.getAnyAudioHRTCTrack();e&&e.removeTrack()}removeRemoteVideoTrack(e){const t=this.tracks[uI.TRACK_TYPE_VIDEO].get(e);t&&t.removeTrack()}}const oy=0,ay=2;class cy{get clientSymbol(){return this.clientSymbol_}set clientSymbol(e){this.clientSymbol_=e}get roomId(){return this.roomId_}set roomId(e){this.roomId_=e}get signature(){return this.signature_}set signature(e){this.signature_=e}get ctime(){return this.ctime_}set ctime(e){this.ctime_=e}get userId(){return this.userId_}set userId(e){this.userId_=e}get encUserId(){return this.encUserId_}set encUserId(e){this.encUserId_=e}get userName(){return this.userName_}set userName(e){this.userName_=e}get role(){return this.role_}set role(e){this.role_=e}get roleSignalType(){return ay===this.role_?"audience":"anchor"}get appData(){return this.appData_}set appData(e){this.appData_=e}}const uy=new Map;class dy{static get(e){return uy.get(e)}static init(e,t,r){const i=new cy;return i.clientSymbol=e,i.userId=r.userId,i.userName=r.userName,i.role=r.role,i.signature=r.signature,i.ctime=r.ctime,i.appData={},r.userName&&(i.appData.nickname=r.userName),r.optionInfo&&[!0,!1].includes(r.optionInfo.recordPlaceholder)&&(i.appData.show_window=r.optionInfo.recordPlaceholder),i.roomId=t,uy.set(e,i),i}static transLocalUserToJoinConfig(e){var t;return{userId:e.userId,userName:e.userName,signature:e.signature,ctime:e.ctime,role:e.role,optionInfo:{recordPlaceholder:null===(t=e.appData)||void 0===t?void 0:t.show_window}}}}class ly{static async callAsyncApi(e,t,r,i){let n,s;const o=Hg.getCurrentTimestamp(),a=r||[];try{return s=await t.call(e,...a),s}catch(tb){throw n=tb,tb}finally{const t=Hg.getCurrentTimestamp(),r=ly.doFinalParam([s,...a,e]);e.stat.setApiCallInfo(i,o,t,n,...r)}}static doFinalParam(e){return e.map((e=>["object","function"].includes(typeof e)&&e.getStatInfo?e.getStatInfo():e))}static callApi(e,t,r,i){let n,s;const o=Hg.getCurrentTimestamp(),a=r||[];try{return s=t.call(e,...a),s}catch(tb){throw n=tb,tb}finally{const t=Hg.getCurrentTimestamp(),r=ly.doFinalParam([s,...a,e]);e.stat.setApiCallInfo(i,o,t,n,...r)}}static callWithTimeout(e,t){let r;const i=new Eu(ou.RTC_ERR_CODE_WAIT_RSP_TIMEOUT),n=new Promise(((e,t)=>{r=t}));let s=null;return t&&(s=setTimeout((()=>{s&&clearTimeout(s),r(i)}),t)),Promise.race([e.finally((()=>{s&&clearTimeout(s)})),n])}static async callWithRetryTimes(e,t,r,i,n){let s=r>=0?r+1:-1,o=1,a=!1;for(;-1===s||s;){let c,u;try{u=await e(o)}catch(tb){c=tb,a=n&&n(c),console.warn("FunctionUtil","callWithRetryTimes, func:".concat(e.name,", isInterrupted:").concat(a,",")+"retryTimes:".concat(r,", left times:").concat(-1===s?-1:s-1,", tryNumber:").concat(o,", err: ").concat(c))}finally{if(!((c||!c&&t)&&!a&&(-1===s||--s>0))){if(!c)return u;throw c}{const e="number"==typeof i?i:i(c);await Hg.sleep(e),o++}}}}}var hy,fy;!function(e){e[e.Health=0]="Health",e[e.SubHealth=1]="SubHealth",e[e.Unavailable=2]="Unavailable"}(hy||(hy={})),function(e){e.ReceiveData="ReceiveData",e.ConnectionQuality="ConnectionQuality",e.Reconnected="Reconnected",e.SessionUnavailable="SessionUnavailable",e.ConnectionUnavailable="ConnectionUnavailable",e.ConnectionStateChanged="ConnectionStateChanged",e.AuthenticateFail="AuthenticateFail",e.SignatureExpired="SignatureExpired",e.ClientBanned="ClientBanned"}(fy||(fy={}));const py="HealthMonitor";class my{constructor(e){this.client=e,this.emitter=new xv,this.logger=e.logger,this.reset()}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.removeListener(e,t)}reset(){this.streamDetectTimer=null,this.streamStats={mainStream:{bytesIn:{previousBytes:0,currentBytes:0},bytesOut:{previousBytes:0,currentBytes:0}},auxStream:{bytesIn:{previousBytes:0,currentBytes:0},bytesOut:{previousBytes:0,currentBytes:0}},upQuality:{previousQuality:0,currentQuality:0},downQuality:{previousQuality:0,currentQuality:0}}}isStreamAvailable(){if(!this.client)return!1;const e=this.isAvailableStreamIncoming(dI.STREAM_TYPE_MAIN),t=this.isAvailableStreamIncoming(dI.STREAM_TYPE_AUX),r=this.isAvailableStreamOutgoing(dI.STREAM_TYPE_MAIN),i=this.isAvailableStreamOutgoing(dI.STREAM_TYPE_AUX);return e||t||r||i}getWsConnectionHealthStatus(){return this.streamDetectTimer?this.isStreamAvailable()?hy.SubHealth:hy.Unavailable:hy.Health}startStreamStateDetection(){this.streamDetectTimer||(this.streamDetectTimer=setInterval((async()=>{if(this.client){const e=this.client.getICETransportStat(dI.STREAM_TYPE_MAIN);e&&this.updateStreamStat(e,dI.STREAM_TYPE_MAIN);const t=this.client.getICETransportStat(dI.STREAM_TYPE_AUX);t&&this.updateStreamStat(t,dI.STREAM_TYPE_AUX),this.updateConnectionQuality(this.getWsConnectionHealthStatus())}}),3e3))}stopStreamStateDetection(){this.streamDetectTimer&&(clearInterval(this.streamDetectTimer),this.streamDetectTimer=null),this.updateConnectionQuality(this.getWsConnectionHealthStatus())}updateConnectionQuality(e){if(!this.client)return;let t;switch(e){case hy.Health:t=1;break;case hy.SubHealth:t=4;break;case hy.Unavailable:t=6;break;default:return void this.logger.error(py,"unknown quality status:".concat(e," "))}const r=this.client.isSendingStream()?t:0,i=this.client.isReceivingStream()?t:0;this.updateSignalQuality(r,i)}isAvailableStreamIncoming(e){const t=e===dI.STREAM_TYPE_MAIN?this.streamStats.mainStream:this.streamStats.auxStream;return t.bytesIn.currentBytes-t.bytesIn.previousBytes>my.getMinAvailableBytes()}static getMinAvailableBytes(){return TT.low.bitrate/8*3}isAvailableStreamOutgoing(e){const t=e===dI.STREAM_TYPE_MAIN?this.streamStats.mainStream:this.streamStats.auxStream;return t.bytesOut.currentBytes-t.bytesOut.previousBytes>my.getMinAvailableBytes()}updateStreamStat(e,t){const r=t===dI.STREAM_TYPE_MAIN?this.streamStats.mainStream:this.streamStats.auxStream;r.bytesIn.previousBytes=r.bytesIn.currentBytes,r.bytesIn.currentBytes=e.bytesReceived,r.bytesOut.previousBytes=r.bytesOut.currentBytes,r.bytesOut.currentBytes=e.bytesSent}updateSignalQuality(e,t){if(this.streamStats.upQuality.previousQuality=this.streamStats.upQuality.currentQuality,this.streamStats.upQuality.currentQuality=e,this.streamStats.downQuality.previousQuality=this.streamStats.downQuality.currentQuality,this.streamStats.downQuality.currentQuality=t,this.isSignalQualityChange()){const r={uplinkNetworkQuality:e,downlinkNetworkQuality:t};this.logger.info(py,"emit:".concat(MI.NetworkQuality,", quality:").concat(JSON.stringify(r))),this.emitter.emit(fy.ConnectionQuality,r)}}isSignalQualityChange(){return this.streamStats.upQuality.currentQuality!==this.streamStats.upQuality.previousQuality||this.streamStats.downQuality.currentQuality!==this.streamStats.downQuality.previousQuality}}function _y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}const gy="Socket",Sy="heartbeat",vy="reconnectingEnd";var Ry,Ty,Iy;!function(e){e[e.normal=1e3]="normal",e[e.multiKickoff=4e3]="multiKickoff",e[e.authenticateFail=4001]="authenticateFail",e[e.kickoff=4002]="kickoff",e[e.releaseRoom=4003]="releaseRoom",e[e.heartbeatTimeout=4004]="heartbeatTimeout",e[e.serverReconnectReq=4005]="serverReconnectReq",e[e.serveReconnectReqWithoutSfu=4006]="serveReconnectReqWithoutSfu"}(Ry||(Ry={}));class yy{constructor(e,t,r){bu(this,"callbacks",new Map),this.taskId=1e3,this.appId=e,this.edgeNodeDomains=t,this.logger=r.logger,this.stat=r.stat,this.eventEmit=new xv,this.clientConfig=r.clientConfig,this.wsStatus={curState:RI.IDLE,preState:RI.IDLE,isHeartbeat:!1,isWsReconnecting:!1,hasEverConnected:!1},this.healthMonitor=new my(r),this.healthMonitor.on(fy.ConnectionQuality,this.getConnectionQualityListener()),this.wsReset()}setKeepAliveParams(e){this.heartBeatConfig=e}on(e,t){this.eventEmit.on(e,t)}off(e,t){this.eventEmit.removeListener(e,t)}setTraceId(e){this.traceId=e}wsReset(){var e;this.closeConnection(),this.traceId="",this.connectId="",this.wsUrl="",this.acsIP="",this.wsStatus.curState=RI.IDLE,this.wsStatus.preState=RI.IDLE,this.wsStatus.hasEverConnected=!1,this.userInfo=void 0,null===(e=this.healthMonitor)||void 0===e||e.reset()}wsDisconnect(){this.healthMonitor.off(fy.ConnectionQuality,this.getConnectionQualityListener()),this.wsReset(),this.healthMonitor=void 0}getConnectionQualityListener(){return e=>{this.eventEmit.emit(fy.ConnectionQuality,e)}}async wsConnect(e,t,r,i,n,s,o){this.logger.info(gy,"wsConnect, acsIP:".concat(t,", firstTimeout:").concat(n,", retryTimeout:").concat(s,", retryCount:").concat(i,",retryInterval:").concat(o)),this.wsStatus.isWsReconnecting&&(this.logger.info(gy,"wsConnect, waiting for reconnecting ending"),await this.stopReconnecting(),this.logger.info(gy,"wsConnect, reconnecting end")),this.acsIP=t,this.userInfo=e,this.wsStatus.curState=RI.DISCONNECTED,await this.doConnect(t,r,i,n,s,o,!1)}async startHeartbeat(){try{if(this.wsStatus.isHeartbeat)return void this.logger.warn(gy,"startHeartbeat, isHeartbeat so return");this.wsStatus.isHeartbeat=!0;const e=async e=>await this.sendHeartbeat(e);return await ly.callWithRetryTimes(e,!0,-1,this.getAsyncInterval(1e3*this.heartBeatConfig.heartBeatPeriod),this.needInterrupted())}catch(tb){this.logger.warn(gy,"startHeartbeat, error:".concat(tb))}finally{this.wsStatus.isHeartbeat=!1}}async wsSendRequest(e,t,r,i,n){this.logger.debug(gy,"wsSendRequest: ".concat(e.type," - ").concat(e.requestId));return await ly.callWithRetryTimes((async i=>await this.wsSendReqOnce(e.requestId,e,t,r,i)),!1,i,this.getAsyncInterval(n),this.needInterrupted())}wsSendResponse(e){this.ws.send(e)}generateRequestId(){return this.traceId,this.traceId+"Web"+(this.taskId++).toString()}async doConnect(e,t,r,i,n,s,o){return await ly.callWithRetryTimes((async r=>await this.wsConnectOnce(e,t,i,n,r,o)),!1,r,this.getAsyncInterval(s),this.needInterrupted())}async wsConnectOnce(e,t,r,i,n,s){if(this.wsStatus.curState===RI.IDLE||!this.userInfo||this.wsStatus.curState===RI.CONNECTING)throw new Eu(ou.RTC_ERR_CODE_WEBSOCKET_INTERRUPTED);if(this.wsStatus.curState!==RI.DISCONNECTED)return this.logger.error(gy,"wsConnectOnce, cusState:".concat(this.wsStatus.curState,", not DISCONNECTED, return")),null;this.connectId=this.taskId.toString(),this.wsUrl=this.getWsUrl(e,s);const o=Hg.getCurrentTimestamp();this.ws=new WebSocket(this.wsUrl),this.logger.info(gy,"wsConnectOnce, url:".concat(Qg.shieldUrlParameters(this.wsUrl),", connectId:").concat(this.connectId,", begin create websocket connection with server ")),1!==n||s?this.triggerConnectStatesChangeEvent(RI.RECONNECTING):this.triggerConnectStatesChangeEvent(RI.CONNECTING),this.ws.onopen=this.onopen.bind(this),this.ws.onerror=this.onerror.bind(this),this.ws.onmessage=this.onmessage.bind(this),this.ws.onclose=this.onclose.bind(this);const a={id:((null==t?void 0:t.length)||0)+1,domain:this.edgeNodeDomains.get(e),start_ms:Hg.getCurrentTimestamp(),delay_ms:0,stepName:"wsConnect",rspCode:"",errMsg:""};try{const e=1===n?r:i;await this.getConnectionResp(e),a.delay_ms=Hg.getCurrentTimestamp()-a.start_ms,a.rspCode="101"}catch(tb){throw this.logger.error(gy,"wsConnectOnce, connect occur exception, connectId:".concat(this.connectId,", error: ").concat(tb)),a.delay_ms=Hg.getCurrentTimestamp()-a.start_ms,"function"==typeof tb.getCode&&(a.rspCode="".concat(tb.getCode()),a.errMsg=tb.getMsg()),tb}finally{null==t||t.push(a);const e=Hg.getCurrentTimestamp(),r={version:"v1",startTimestamp:o,traceId:this.xNuwaTraceId,spanId:this.xNuwaSpanId,parentSpanId:"0000000000000000",ip:"",source:"SDK",target:"WiseCloudRtcAccessService",spanName:"connect",status:"0",endTimestamp:e,url:"",httpMethod:"",requestSize:"",responseSize:"",statusCode:"",tag:"",Events:"",scope:"videortn"};this.stat.reportTraceInfo2Nuwa(r)}}async stopReconnecting(){let e=null;this.wsStatus.curState=RI.IDLE;const t=[new Promise((t=>{this.callbacks.set(vy,(r=>{e&&clearTimeout(e),t(r)}))})),new Promise(((t,r)=>{e=setTimeout((()=>{r(new Eu(ou.RTC_ERR_CODE_WEBSOCKET_RECONNECT_TIMEOUT))}),3e4)}))];return await Promise.race(t).then((e=>e)).finally((()=>{this.callbacks.delete(vy)}))}async getConnectionResp(e){const t=this.connectId;await ly.callWithTimeout(new Promise(((e,r)=>{this.callbacks.set(t,(i=>{if(i.isSuccess)this.logger.info(gy,"getConnectionResp, connectId:".concat(t,", connect success")),this.triggerConnectStatesChangeEvent(RI.CONNECTED),e();else{const e=yy.newSocketException(i);this.logger.info(gy,"getConnectionResp, connectId:".concat(t,", connect fail, errMsg=").concat(e)),r(e)}}))})),e).catch((r=>{if(this.triggerConnectStatesChangeEvent(RI.DISCONNECTED),r.getCode()!==ou.RTC_ERR_CODE_WAIT_RSP_TIMEOUT)throw r;throw this.logger.error(gy,"getConnectionResp, connectId:".concat(t,", websocket connect timeout after ").concat(e," ms")),this.ws&&this.ws.readyState===this.ws.CONNECTING&&(this.logger.info(gy,"getConnectionResp, connectId:".concat(t,",websocket connect timeout, close webSocket manual")),this.ws.close()),new Eu(ou.RTC_ERR_CODE_WEBSOCKET_CONNECT_TIMEOUT)})).finally((()=>{this.callbacks.delete(t)}))}static newSocketException(e){if(e.isSuccess)return null;const t=ou.RTC_ERR_CODE_WEBSOCKET_CONNECT_ERROR,r=e.code,i="".concat(r||""," websocket connect error");return new Eu(t,i)}getWsUrl(e,t){let r,i;this.xNuwaTraceId=Hg.generateRandomId(32,16),this.xNuwaSpanId=Hg.generateRandomId(16,16);let n,s="443";const o=/ws(?:s)?:\/\/([^/]+)(.*)/.exec(this.edgeNodeDomains.get(e));if(o&&3===o.length){const e=o[1].split(":");i=e[0],s=e[1]||"443",n=o[2]}else i=this.edgeNodeDomains.get(e),n="/websocket";const a=iR.getProxyServer();return r=a?/^http.*/.test(a)?a.replace("http","ws"):a.replace("https","wss"):"".concat("wss","://").concat(i,":").concat(s),r="".concat(r).concat(n,"?appId=").concat(escape(this.appId),"&roomId=").concat(escape(this.userInfo.roomId))+"&userId=".concat(escape(this.userInfo.userId),"&role=").concat(this.userInfo.roleSignalType,"&Authorization=").concat(escape(this.userInfo.signature))+"&ctime=".concat(this.userInfo.ctime,"&clientVersion=").concat(Kv,"&clientType=").concat(Hg.getSystemType())+"&romVersion=".concat(Hg.getRomVersion(),"&agentType=").concat(2,"&netType=").concat(Hg.getNetworkType())+"&traceId=".concat(this.traceId,"&x-nuwa-trace-id=").concat(this.xNuwaTraceId,"&x-nuwa-span-id=").concat(this.xNuwaSpanId)+"&HoldTime=".concat(120).concat(t?"&reconnect=true":"")+"&instanceId=".concat(Hg.getDeviceID().replace(/[-]/g,""),"&clientCountryCode=").concat(this.clientConfig.countryCode),a&&(r="".concat(r,"&org_domain=").concat(i,"&org_port=").concat(s)),r}cancelWsCloseCallBack(){this.ws&&(this.ws.onclose=e=>{this.logger.info(gy,"cancelWsCloseCallBack, connect close,code:".concat(e.code,", reason:").concat(e.reason))})}closeConnection(){this.ws&&(this.logger.info(gy,"close ws when reset"),this.cancelWsCloseCallBack(),this.ws.close(),this.ws=null)}triggerConnectStatesChangeEvent(e,t){this.wsStatus.preState=this.wsStatus.curState,this.wsStatus.curState=e;const r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_y(Object(r),!0).forEach((function(t){bu(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({prevState:vI[this.wsStatus.preState],curState:vI[this.wsStatus.curState]},t);r.preState!=vI[e]&&(this.logger.info(gy,"triggerConnectStatesChangeEvent, emit:".concat(MI.ConnectionStateChanged,", body:").concat(JSON.stringify(r))),this.eventEmit.emit(fy.ConnectionStateChanged,r))}static removeWatchType(e){if(null!=e&&e.watchType){const t=JSON.parse(JSON.stringify(e));return delete t.watchType,t}return e}needInterrupted(){return e=>"function"==typeof(null==e?void 0:e.getCode)&&e.getCode()===ou.RTC_ERR_CODE_WEBSOCKET_INTERRUPTED}getAsyncInterval(e){return t=>"function"==typeof(null==t?void 0:t.getCode)&&t.getCode()===ou.RTC_ERR_CODE_WAIT_RSP_TIMEOUT?0:e}async wsSendReqOnce(e,t,r,i,n){const s=yy.removeWatchType(t),o=Hg.getCurrentTimestamp();try{if(this.wsStatus.curState===RI.IDLE)throw new Eu(ou.RTC_ERR_CODE_WEBSOCKET_INTERRUPTED);if(!this.ws||this.ws.readyState!==this.ws.OPEN)throw new Eu(ou.RTC_ERR_CODE_WEBSOCKET_NOT_OPEN);n>1&&this.logger.debug(gy,"wsSendReq: ".concat(e,", retry send message"));const a=JSON.stringify(s);this.ws.send(a),this.stat&&(this.stat.reportSignalReqForWeb2Server(s),this.stat.recordUploadRequsetInfo(t));const c=1===n?r:i;return await this.getResponse(s,c)}catch(tb){throw this.logger.error(gy,"wsSendReq: ".concat(e,", type: ").concat(s.type,", tryNumber: ").concat(n,",error: ").concat(tb)),"PING"===t.type&&this.healthMonitor.startStreamStateDetection(),this.recordWsException(t,tb,o),tb}finally{const e=this.stat.checkSignalSendMsgs((null==s?void 0:s.type)||""),t=s["x-nuwa-span-id"],r=Hg.getCurrentTimestamp(),i={version:"v1",startTimestamp:o,traceId:s["x-nuwa-trace-id"],spanId:t,parentSpanId:e?"0000000000000000":this.stat.getParentSpanId(s["x-nuwa-span-id"]),ip:"",source:"SDK",target:"WiseCloudRtcAccessService",spanName:(null==s?void 0:s.type)||"",status:"0",endTimestamp:r,url:"",httpMethod:"",requestSize:"",responseSize:"",statusCode:"",tag:"",Events:"",scope:"videortn"};this.stat.reportTraceInfo2Nuwa(i)}}recordWsException(e,t,r){if("PING"!==e.type)switch(e.type){case"SUBS_STREAM":{const r=t.getCode(),i=t.getMsg();e.videoUpstreams&&this.stat.reportVideoSub(e.videoSubType,e.requestId,e.videoUpstreams,r,i),e.audioUpstreams&&this.stat.reportAudioSub(e.audioSubType,e.requestId,e.audioUpstreams,r);break}}else this.stat.reportSignalReqForHeartBeatLost(e,r)}async getResponse(e,t){let r=null;const i=[new Promise((t=>{const i="PING"===e.type?Sy:e.requestId;this.callbacks.set(i,(e=>{r&&clearTimeout(r),t(e)}))})),new Promise(((e,i)=>{r=setTimeout((()=>{i(new Eu(ou.RTC_ERR_CODE_WAIT_RSP_TIMEOUT))}),t)}))];return await Promise.race(i).then((e=>e)).finally((()=>{const t="PING"===e.type?Sy:e.requestId;this.callbacks.delete(t)}))}onopen(e){this.callbacks.has(this.connectId)&&this.callbacks.get(this.connectId)({isSuccess:!0}),this.logger.info(gy,"onopen, wss[".concat(Qg.shieldUrlParameters(this.wsUrl),"], connectId:").concat(this.connectId,", connect success, ").concat(JSON.stringify(e))),this.stat.setConnectionStatusInfo(1,0)}onerror(e){this.logger.error(gy,"onerror, connectId:".concat(this.connectId,", websocket occur error:").concat(JSON.stringify(e))),this.stat.setConnectionStatusInfo(0,0),this.callbacks.has(this.connectId)&&this.callbacks.get(this.connectId)({isSuccess:!1})}onmessage(e){if(null==e||!e.data)return;const t=JSON.parse(e.data);this.wsStatus.hasEverConnected=!0;const r=this.callbacks.get(Sy);if(r&&r(t),t.type)this.eventEmit.emit(fy.ReceiveData,t);else{const e=this.callbacks.get(t.requestId);e&&e(t)}this.stat.reportSignalReqForServer2Web(t);const i=this.stat.getDownloadRequestInfo(t);this.stat.recordDownloadRequestInfo(t);const n=this.stat.checkSignalReceiveMsgs((null==t?void 0:t.type)||""),s=Hg.generateRandomId(16,16),o=t["x-nuwa-span-id"];n&&this.stat.setSpanId(o,s);const a=Hg.getCurrentTimestamp(),c={version:"v1",startTimestamp:a,traceId:t["x-nuwa-trace-id"],spanId:s,parentSpanId:o,ip:"",source:"WiseCloudRtcAccessService",target:"SDK",spanName:(null==t?void 0:t.type)||i,status:"0",endTimestamp:a,url:"",httpMethod:"",requestSize:"",responseSize:"",statusCode:"",tag:"",Events:"",scope:"videortn"};this.stat.reportTraceInfo2Nuwa(c)}async onclose(e){const t=e.code,r=e.reason;if(this.logger.warn(gy,"onclose,connectId:".concat(this.connectId,", code:").concat(t,", reason:").concat(r)),this.stat.setConnectionStatusInfo(0,0),this.callbacks.has(this.connectId)&&this.callbacks.get(this.connectId)({isSuccess:!1,code:t,reason:r}),this.triggerConnectStatesChangeEvent(RI.DISCONNECTED,{code:t,reason:r}),!yy.isServerAuthFail(t))return yy.isKickedOff(t)?(this.logger.warn(gy,"handleKickedOff, emit:".concat(fy.ClientBanned)),void this.eventEmit.emit(fy.ClientBanned)):yy.isServerSessionValidateFail(t)?(this.logger.warn(gy,"onclose, emit:".concat(fy.SessionUnavailable)),void this.eventEmit.emit(fy.SessionUnavailable)):void(t===Ry.heartbeatTimeout||t===Ry.serveReconnectReqWithoutSfu||t>1e3&&t<4e3?await this.reconnect():this.logger.error(gy,"onclose, no handler"));this.handleServerAuthFail(e)}handleServerAuthFail(e){this.logger.error(gy,"handleServerAuthFail, auth failed to leave room"),this.logger.warn(gy,"handleServerAuthFail, emit:".concat(fy.AuthenticateFail," ")),this.eventEmit.emit(fy.AuthenticateFail),this.eventEmit.emit(fy.SignatureExpired,e)}async reconnect(){if(this.logger.info(gy,"reconnect, not user call leave, network error, go ws reconnecting"),!this.wsStatus.hasEverConnected)return this.logger.info(gy,"reconnect, haven't connect yet, so return"),null;if(this.wsStatus.isWsReconnecting)return this.logger.info(gy,"reconnect, isWsReConnecting so return"),null;try{this.wsStatus.isWsReconnecting=!0;const e=12e3,t=1e3;await this.doConnect(this.acsIP,null,-1,e,e,t,!0),this.logger.info(gy,"wsReconnect, success");const r=this.callbacks.get(vy);r&&r("success"),this.logger.warn(gy,"emit:".concat(fy.Reconnected)),this.eventEmit.emit(fy.Reconnected)}catch(tb){this.logger.error(gy,"wsReconnect, errMsg:".concat(tb));const t=this.callbacks.get(vy);t&&t(tb)}finally{this.wsStatus.isWsReconnecting=!1}}static isServerAuthFail(e){return[Ry.authenticateFail,Ry.releaseRoom].includes(e)}static isKickedOff(e){return[Ry.multiKickoff,Ry.kickoff].includes(e)}static isServerSessionValidateFail(e){return[Ry.serverReconnectReq].includes(e)}async sendHeartbeat(e){try{if(this.wsStatus.curState===RI.IDLE||this.wsStatus.curState===RI.CONNECTING)throw this.logger.info(gy,"sendHeartbeat, but wsStatus is IDLE or CONNECTING, interrupted"),new Eu(ou.RTC_ERR_CODE_WEBSOCKET_INTERRUPTED);if(!this.traceId)throw this.logger.error(gy,"sendHeartbeat, traceId is null"),new Eu(ou.RTC_ERR_CODE_WEBSOCKET_INTERRUPTED);const e={type:"PING",traceId:this.traceId,requestId:this.generateRequestId(),version:Gv,"x-nuwa-trace-id":Hg.generateRandomId(32,16),"x-nuwa-span-id":Hg.generateRandomId(16,16)};await this.wsSendRequest(e,1e3*this.heartBeatConfig.heartBeatPeriod,1e3*this.heartBeatConfig.heartBeatPeriod,this.heartBeatConfig.heartBeatRetryTimes,1e3*this.heartBeatConfig.heartBeatPeriod),this.healthMonitor.stopStreamStateDetection()}catch(tb){this.logger.info(gy,"sendHeartbeatï¼father tryNumber:".concat(e,",child heartbeat retry out of limit:").concat(this.heartBeatConfig.heartBeatRetryTimes," and fail, error:").concat(tb)),this.handleHeartbeatFail(tb)}}handleHeartbeatFail(e){if("function"==typeof(null==e?void 0:e.getCode)&&e.getCode()===ou.RTC_ERR_CODE_WEBSOCKET_INTERRUPTED)throw this.logger.warn(gy,"handleHeartbeatFail, ErrorCode.RTC_ERR_CODE_WEBSOCKET_INTERRUPTED"),e;const t=this.healthMonitor.getWsConnectionHealthStatus();this.logger.warn(gy,"handleHeartbeatFail, healthStatus:".concat(t)),t===hy.Unavailable&&(this.logger.info(gy,"handleHeartbeatFail, connection unavailable when error:".concat(e)),this.logger.warn(gy,"emit:".concat(fy.ConnectionUnavailable)),this.eventEmit.emit(fy.ConnectionUnavailable))}}function Ey(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function by(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,Ey(e,t,"get"))}function Cy(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,Ey(e,t,"set"),r),r}!function(e){e.SEND_RECV="sendrecv",e.SEND_ONLY="sendonly",e.RECV_ONLY="recvonly",e.INACTIVE="inactive"}(Ty||(Ty={})),function(e){e.H264="H264",e.H265="H265",e.H264H265="H264H265",e.OPUS="opus"}(Iy||(Iy={}));var Ay=nc;Xr({target:"WeakMap",proto:!0,real:!0,forced:false},{deleteAll:function(){return Ay.apply(this,arguments)}});var ky=uS;Xr({target:"WeakSet",proto:!0,real:!0,forced:false},{addAll:function(){return ky.apply(this,arguments)}});var wy=nc;function Oy(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}Xr({target:"WeakSet",proto:!0,real:!0,forced:false},{deleteAll:function(){return wy.apply(this,arguments)}});var Py=new WeakMap;class My{constructor(e){Oy(this,Py,{writable:!0,value:void 0}),"boolean"!=typeof e?Cy(this,Py,e):e&&Cy(this,Py,new xv)}on(e,t){this.eventEmitter.on(e,t)}off(e,t){this.eventEmitter.removeListener(e,t)}emit(e,t){this.eventEmitter.emit(e,t)}get eventEmitter(){return by(this,Py)}set eventEmitter(e){Cy(this,Py,e)}}function Dy(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var xy=new WeakMap;class Ny{constructor(){Dy(this,xy,{writable:!0,value:void 0})}createLogger(e){Cy(this,xy,Qg.getLogger(e))}get logger(){return by(this,xy)}set logger(e){Cy(this,xy,e)}}function Uy(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var Ly=new WeakMap;class Vy{constructor(){Uy(this,Ly,{writable:!0,value:void 0})}createStat(e){Cy(this,Ly,new _I(e))}set stat(e){Cy(this,Ly,e)}get stat(){return by(this,Ly)}}function By(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var Yy=new WeakMap;var Fy=new class{constructor(){By(this,Yy,{writable:!0,value:void 0}),Cy(this,Yy,(()=>{let e=0;return()=>e++})())}getSequence(){return by(this,Yy).call(this)}};function jy(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var zy=new WeakMap;class Hy{constructor(e){jy(this,zy,{writable:!0,value:void 0}),Cy(this,zy,e)}getInfo(){return{}}getSymbol(){return by(this,zy)}onLogUploadResult(){}getModuleName(){return"default"}}function Ky(e,t){Gy(e,t),t.add(e)}function Wy(e,t,r){Gy(e,t),t.set(e,r)}function Gy(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Jy(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var qy=new WeakMap,Xy=new WeakMap,Qy=new WeakMap,Zy=new WeakMap,$y=new WeakMap,eE=new WeakMap,tE=new WeakSet,rE=new WeakSet;function iE(e,t){const r=this.getOnCallback(e,t);by(this,Zy).on(e,r)}function nE(e,t){const r=this.getOffCallback(e,t);r&&by(this,Zy).off(e,r)}const sE="signal",oE=5e3;class aE extends class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{emitter:!1,logger:!1,stat:!1};if(Ky(this,rE),Ky(this,tE),Wy(this,qy,{writable:!0,value:void 0}),Wy(this,Xy,{writable:!0,value:void 0}),Wy(this,Qy,{writable:!0,value:void 0}),Wy(this,Zy,{writable:!0,value:void 0}),Wy(this,$y,{writable:!0,value:new Map}),Wy(this,eE,{writable:!0,value:new Map}),Cy(this,qy,Symbol("identifiedID_".concat(Fy.getSequence()))),(null==e.emitter||e.emitter)&&Cy(this,Zy,new My(e.emitter)),Cy(this,Xy,new Ny),"boolean"!=typeof e.logger)by(this,Xy).logger=e.logger;else if(e.logger){const e=this.getLogProvider()||new Hy(Symbol("default_logger"));by(this,Xy).createLogger(e)}Cy(this,Qy,new Vy),"boolean"!=typeof e.stat?by(this,Qy).stat=e.stat:e.stat&&by(this,Qy).createStat(by(this,Xy).logger)}on(e,t,r){r?Jy(this,tE,iE).call(this,e,t):by(this,Zy).on(e,t)}off(e,t,r){r?Jy(this,rE,nE).call(this,e,t):by(this,Zy).off(e,t)}emit(e,t){by(this,Zy).emit(e,t)}getOnCallback(e,t){const r="".concat(e,"_").concat(null==t?void 0:t.name),i=async t=>{if(by(this,$y).get(r)){const n=Hg.getCurrentTimestamp();let s;try{await ly.callWithTimeout(by(this,$y).get(r)(t),1e4),s=Hg.getCurrentTimestamp()}catch(tb){s=n+5e3}finally{var i;null===(i=this.stat)||void 0===i||i.recordCallbackInfo(e.toString(),this.logger.getProvider().getModuleName(),n,s,t,(e=>["object","function"].includes(typeof e)&&e.getStatInfo?JSON.stringify(e.getStatInfo()):JSON.stringify(e||{})))}}};return by(this,$y).set(r,t),by(this,eE).set(r,i),i}getOffCallback(e,t){const r="".concat(e,"_").concat(null==t?void 0:t.name),i=by(this,eE).get(r);return by(this,eE).get(r)&&by(this,eE).delete(r),by(this,$y).get(r)&&by(this,$y).delete(r),i}get stat(){return by(this,Qy).stat}get logger(){return by(this,Xy).logger}get eventEmitter(){return by(this,Zy).eventEmitter}get identifiedID(){return by(this,qy)}}{constructor(e,t,r){super({emitter:!0,logger:r.logger,stat:r.stat}),this.edgeNodeDomains=t,this.socket=new yy(e,t,r),this.onSocketEvent(),this.reset()}on(e,t){super.on(e,t)}off(e,t){super.off(e,t)}reset(){var e;this.traceId="",this.isConnecting=!1,null===(e=this.socket)||void 0===e||e.wsReset()}disconnect(){var e;this.offSocketEvent(),this.reset(),null===(e=this.socket)||void 0===e||e.wsDisconnect(),this.socket=void 0}getConnectionQualityListener(){return e=>{this.emit(MI.NetworkQuality,e)}}getConnectionStateChangedListener(){return e=>{this.emit(MI.ConnectionStateChanged,e)}}getSignatureExpiredListener(){return e=>{this.emit(fy.SignatureExpired,e)}}getReceiveDataListener(){return e=>{this.receiveMsg(e)}}getSessionUnavailableListener(){return e=>{this.emit(fy.SessionUnavailable,e)}}getConnectionUnavailableListener(){return e=>{this.emit(fy.ConnectionUnavailable,e)}}getReconnectedListener(){return e=>{this.emit(fy.Reconnected,e)}}getAuthenticateFailListener(){return e=>{this.emit(fy.AuthenticateFail,e)}}getKickedOffListener(){return e=>{this.emit(fy.ClientBanned,e)}}onSocketEvent(){this.socket&&(this.socket.on(fy.ConnectionQuality,this.getConnectionQualityListener()),this.socket.on(fy.ConnectionStateChanged,this.getConnectionStateChangedListener()),this.socket.on(fy.SignatureExpired,this.getSignatureExpiredListener()),this.socket.on(fy.ReceiveData,this.getReceiveDataListener()),this.socket.on(fy.SessionUnavailable,this.getSessionUnavailableListener()),this.socket.on(fy.ConnectionUnavailable,this.getConnectionUnavailableListener()),this.socket.on(fy.Reconnected,this.getReconnectedListener()),this.socket.on(fy.AuthenticateFail,this.getAuthenticateFailListener()),this.socket.on(fy.ClientBanned,this.getKickedOffListener()))}offSocketEvent(){this.socket&&(this.socket.off(fy.ConnectionQuality,this.getConnectionQualityListener()),this.socket.off(fy.ConnectionStateChanged,this.getConnectionStateChangedListener()),this.socket.off(fy.SignatureExpired,this.getSignatureExpiredListener()),this.socket.off(fy.ReceiveData,this.getReceiveDataListener()),this.socket.off(fy.SessionUnavailable,this.getSessionUnavailableListener()),this.socket.off(fy.ConnectionUnavailable,this.getConnectionUnavailableListener()),this.socket.off(fy.Reconnected,this.getReconnectedListener()),this.socket.off(fy.AuthenticateFail,this.getAuthenticateFailListener()),this.socket.off(fy.ClientBanned,this.getKickedOffListener()))}getRandomAcsIp(){let e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(1===this.edgeNodeDomains.size||t)return this.selectedAcsIp="default",this.selectedAcsIp;let r=0;return this.selectedAcsIp?(e=[...this.edgeNodeDomains.keys()].filter((e=>"default"!==e&&e!==this.selectedAcsIp)),e.length<1||(r=Math.round(Hg.getRandom()*(e.length-1)),this.selectedAcsIp=e[r]),this.selectedAcsIp):(e=[...this.edgeNodeDomains.keys()].filter((e=>"default"!==e)),r=Math.round(Hg.getRandom()*(e.length-1)),this.selectedAcsIp=e[r],this.selectedAcsIp)}async connect(e,t){if(this.isConnecting)return this.logger.info(sE,"connect, isConnecting so return"),null;this.traceId=Hg.generateStandardUuid(),this.socket.setTraceId(this.traceId);try{this.isConnecting=!0;const r=async r=>await this.connectOnce(e,t,r);return await ly.callWithRetryTimes(r,!1,2,this.getAsyncInterval(),this.needInterrupted())}finally{this.isConnecting=!1}}needInterrupted(){return e=>"function"==typeof(null==e?void 0:e.getCode)&&e.getCode()===ou.RTC_ERR_CODE_WEBSOCKET_INTERRUPTED}getAsyncInterval(){return()=>Math.round(500*Hg.getRandom()+500)}async connectOnce(e,t,r){const i=this.getRandomAcsIp(aE.isLastTry(2,r));if(!i)throw this.logger.error(sE,"selectedAcsIP is null"),new Eu(ou.RTC_ERR_CODE_WEBSOCKET_NOT_CONNECTED,"no avaliable servers to connect");return await this.socket.wsConnect(e,i,t,0,1e4,0,0),"default"===i?this.edgeNodeDomains.get("default"):i}static isLastTry(e,t){return t===e+1}async join(e,t,r,i,n){return new Promise(((s,o)=>{const a=aE.setJoinRequest(e,t,r,i,n);this.sendRequest(a).then((e=>{var t;0!==e.resultCode?(this.logger.error(sE,"join code:".concat(e.resultCode,",msg:").concat(e.resultMessage)),o(new Eu(Number(e.resultCode),e.resultMessage))):(null===(t=e.userInfos)||void 0===t||t.forEach((e=>{Qg.addPrivacyString(e.userId),Qg.addPrivacyString(e.appData.nickname)})),s(e))})).catch((e=>{o(e)}))}))}async subscribe(e,t,r){const i={type:"SUBS_STREAM",videoUpstreams:e,audioUpstreams:t,videoSubType:1,audioSubType:1,watchType:r,"x-nuwa-trace-id":Hg.generateRandomId(32,16),"x-nuwa-span-id":Hg.generateRandomId(16,16)},n=await this.sendRequest(i);if(0!==n.resultCode){const e=JSON.stringify(i);throw this.logger.error(sE,"subscribe fail,err_code:".concat(n.resultCode,",")+"error_msg:".concat(n.resultMessage,",request ").concat(e)),new Eu(Number(n.resultCode),n.resultMessage)}return this.logger.info(sE,"subscribe send msg result:".concat(n.resultMessage)),n}async queryRoomUsers(e){var t;const r={type:"GET_ROOM_USERINFO","x-nuwa-trace-id":Hg.generateRandomId(32,16),"x-nuwa-span-id":Hg.generateRandomId(16,16)};null!=e&&e.length&&(r.userIds=e);const i=await this.sendRequest(r);if(0!==i.resultCode)throw this.logger.error(sE,"queryRoomUsers fail,err_code:".concat(i.resultCode,",error_msg:").concat(i.resultMessage)),new Eu(Number(i.resultCode),i.resultMessage);return null===(t=i.userInfos)||void 0===t||t.forEach((e=>{Qg.addPrivacyString(e.userId),Qg.addPrivacyString(e.appData.nickname)})),this.logger.info(sE,"queryRoomUsers send msg result:".concat(i.resultMessage)),i}async leave(){try{const e=await this.sendRequest({type:"EXIT_ROOM"});if(0!==e.resultCode)throw this.logger.error(sE,"leave, exit room, err_code:".concat(e.resultCode,",error_msg:").concat(e.resultMessage)),new Eu(Number(e.resultCode),e.resultMessage);const t=await this.sendRequest({type:"BYE"});if(0!==t.resultCode)throw this.logger.error(sE,"leave, exit room, err_code:".concat(t.resultCode,",error_msg:").concat(t.resultMessage)),new Eu(Number(t.resultCode),t.resultMessage)}catch(tb){throw new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR)}}async changeStreamStatus(e){try{return e.type="CHANGE_STREAM_STATUS",await this.sendRequest(e)}catch(tb){throw this.logger.error(sE,"changeStreamStatus fail, error:".concat(tb)),new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR)}}static setJoinRequest(e,t,r,i,n){return{type:"JOIN_ROOM",sdp:{secCap:"sec3.0",sfuType:cI.getParameter(rI)||0,crypto:{type:1},audios:[{content:AI.main,codecs:[{codec:Iy.OPUS,pt:112,ability:2}],audioLevel:3}],videos:[{content:AI.main,codecs:[{codec:Iy.H264,pt:122,ability:2}]},{content:AI.slides,codecs:[{codec:Iy.H264,pt:122,ability:2}]}],desktopVideos:[{content:AI.desktop,codecs:[{codec:Iy.H264,pt:122,ability:2}]}],audioPolicy:i},negSdp:[{type:0,sdp:t},{type:1,sdp:r}],scenario:1,relayMode:0,agentType:2,appData:e.appData,mediaData:{portType:n},"x-nuwa-trace-id":Hg.generateRandomId(32,16),"x-nuwa-span-id":Hg.generateRandomId(16,16)}}async switchRole(e,t){const r=aE.setSwitchRoleRequest(e,t),i=await this.sendRequest(r);if(0!==i.resultCode)throw this.logger.error(sE,"switch user role fail,err_code:".concat(i.resultCode,",error_msg:").concat(i.resultMessage)),new Eu(Number(i.resultCode),i.resultMessage);return i}static setSwitchRoleRequest(e,t){const r=e===oy?"anchor":"audience",i=t?parseInt(t.ctime):null;return{type:"SWITCH_ROLE",role:r,authorization:null==t?void 0:t.signature,ctime:i,"x-nuwa-trace-id":Hg.generateRandomId(32,16),"x-nuwa-span-id":Hg.generateRandomId(16,16)}}async pushStreamResponse(e){this.logger.info(sE,"pushStreamRep send msg start:");try{await this.socket.wsSendResponse(JSON.stringify(e)),this.logger.info(sE,"pushStreamRep send response")}catch(t){throw this.logger.error(sE,"pushStreamRep send response fail, errMsg = ".concat(t)),new Eu(ou.RTC_ERR_CODE_PUBLISH_RESPONSE_FAIL)}}keepAlive(){this.logger.info(sE,"keepAlive"),this.socket.startHeartbeat()}async sendRequest(e){return this.assignCommonMsgInfo(e),await this.socket.wsSendRequest(e,oE,oE,2,oE)}assignCommonMsgInfo(e){Object.assign(e,{traceId:this.traceId,requestId:this.socket.generateRequestId(),version:Gv,"x-nuwa-trace-id":Hg.generateRandomId(32,16),"x-nuwa-span-id":Hg.generateRandomId(16,16)})}async publish(e){return new Promise(((t,r)=>{const i=[],n=[];e.forEach((e=>{e.codec===Iy.H264?i.push({content:e.content,mute:e.mute,width:e.width,height:e.height,fps:e.fps,maxFs:e.maxFs,maxMbps:e.maxMbps,codec:e.codec,pt:e.pt,streamData:e.streamData,streamUid:e.streamUid,ssrc:e.ssrc,createDate:e.createDate}):e.codec===Iy.OPUS&&n.push({content:e.content,mute:e.mute,channels:e.channels,sampleRate:e.sampleRate,maxMbps:e.maxMbps,codec:e.codec,pt:e.pt,streamData:e.streamData,streamUid:e.streamUid,ssrc:e.ssrc,createDate:e.createDate})}));const s={type:"PUSH_STREAM_RES_ALL",pushStreamType:0,videoStreams:i,audioStreams:n,"x-nuwa-trace-id":Hg.generateRandomId(32,16),"x-nuwa-span-id":Hg.generateRandomId(16,16)};this.sendRequest(s).then((e=>{0!==e.resultCode?(this.logger.error(sE,"publish resp code:".concat(e.resultCode,",msg:").concat(e.resultMessage)),r(new Eu(Number(e.resultCode),e.resultMessage))):t(e)})).catch((e=>{r(e)}))}))}async appData(e,t,r){return new Promise(((i,n)=>{const s={};Object.assign(s,e),s[t]=r;const o={type:"APP_DATA",appData:s};this.sendRequest(o).then((e=>{0!==e.resultCode?(this.logger.error(sE,"appset code:".concat(e.resultCode,",msg:").concat(e.resultMessage)),n(new Eu(Number(e.resultCode),e.resultMessage))):i(e)})).catch((e=>{n(e)}))}))}async changeAudioPolicy(e){return new Promise(((t,r)=>{const i={type:"AUDIO_POLICY",audioPolicy:e,"x-nuwa-trace-id":Hg.generateRandomId(32,16),"x-nuwa-span-id":Hg.generateRandomId(16,16)};this.sendRequest(i).then((n=>{if(0!==n.resultCode){const t=JSON.stringify(i);this.logger.error(sE,"change audioPolicy code:".concat(n.resultCode,",audioPolicy:").concat(e,",msg:").concat(n.resultMessage," request ").concat(t)),r(new Eu(Number(n.resultCode),n.resultMessage))}else this.logger.info(sE,"change audioPolicy  ".concat(e," success")),t(n)})).catch((t=>{this.logger.info(sE,"change audioPolicy  ".concat(e," exception")),r(t)}))}))}async updateLiveStreaming(e,t,r){return new Promise(((i,n)=>{const s={type:"UPDATE_PUBLISH",traceId:Hg.generateStandardUuid(),taskId:e,config:t,userInfos:r,"x-nuwa-trace-id":Hg.generateRandomId(32,16),"x-nuwa-span-id":Hg.generateRandomId(16,16)};this.sendRequest(s).then((e=>{if(0!==e.resultCode){const t=JSON.stringify(s);this.logger.error(sE,"updateLiveStreaming code:".concat(e.resultCode,", msg:").concat(e.resultMessage,", request ").concat(t)),n(new Eu(Number(e.resultCode),e.resultMessage))}else this.logger.info(sE,"updateLiveStreaming success"),i(e)})).catch((e=>{this.logger.info(sE,"updateLiveStreaming failed: ".concat(e)),n(e)}))}))}async startLiveStreaming(e,t,r,i){return new Promise(((n,s)=>{const o={type:"START_PUBLISH",traceId:Hg.generateStandardUuid(),taskId:e,config:r,userInfos:i,urls:t,"x-nuwa-trace-id":Hg.generateRandomId(32,16),"x-nuwa-span-id":Hg.generateRandomId(16,16)};this.sendRequest(o).then((e=>{if(0!==e.resultCode){const t=JSON.stringify(o);this.logger.error(sE,"startLiveStreamRequest code:".concat(e.resultCode,", msg:").concat(e.resultMessage,", request ").concat(t)),s(new Eu(Number(e.resultCode),e.resultMessage))}else this.logger.info(sE,"startLiveStreamRequest success"),n(e)})).catch((e=>{this.logger.info(sE,"startLiveStreamRequest failed: ".concat(e)),s(e)}))}))}async stopLiveStreaming(e){return new Promise(((t,r)=>{const i={type:"STOP_PUBLISH",traceId:Hg.generateStandardUuid(),taskId:e,"x-nuwa-trace-id":Hg.generateRandomId(32,16),"x-nuwa-span-id":Hg.generateRandomId(16,16)};this.sendRequest(i).then((e=>{if(0!==e.resultCode){const t=JSON.stringify(i);this.logger.error(sE,"stopLiveStreaming code:".concat(e.resultCode,", msg:").concat(e.resultMessage,", request ").concat(t)),r(new Eu(Number(e.resultCode),e.resultMessage))}else this.logger.info(sE,"stopLiveStreaming success"),t(e)})).catch((e=>{this.logger.info(sE,"stopLiveStreaming failed: ".concat(e)),r(e)}))}))}receiveMsg(e){if(e.type)switch(bI.has("".concat(e.type))||this.logger.info(sE,"message type: ".concat(e.type)),e.type){case CI.statusChangeNotify:var t;null===(t=e.infos)||void 0===t||t.forEach((e=>{Qg.addPrivacyString(e.userId),Qg.addPrivacyString(e.appData.nickname)})),this.emit(CI.statusChangeNotify,e);break;case CI.uploadLogNotify:this.emit(CI.uploadLogNotify,e);break;case CI.pushStreamNotify:{const t=e;Qg.addPrivacyString(t.userId),this.emit(CI.pushStreamNotify,e);break}case CI.stopPushStreamNotify:{const t=e;Qg.addPrivacyString(t.userId),this.emit(CI.stopPushStreamNotify,e);break}case CI.watchStreamNotify:this.emit(CI.watchStreamNotify,e);break;case CI.changeStreamStatusNotify:{const t=e;Qg.addPrivacyString(t.userId),this.emit(CI.changeStreamStatusNotify,e);break}case CI.disconnectNotify:{const t=e;Qg.addPrivacyString(t.userId),this.emit(CI.disconnectNotify,e);break}case CI.reconnectNotify:{const t=e;Qg.addPrivacyString(t.userId),this.emit(CI.reconnectNotify,e);break}case CI.configNotify:this.emit(CI.configNotify,e);break;case CI.appDataChangeNotify:{const t=e;Qg.addPrivacyString(t.userId),this.emit(CI.appDataChangeNotify,e);break}case CI.top3AudioVolumeNotify:var r;null===(r=e.topUserAudios)||void 0===r||r.forEach((e=>{Qg.addPrivacyString(e.userId)})),this.emit(CI.top3AudioVolumeNotify,e);break;case CI.publishStatusNotify:this.emit(CI.publishStatusNotify,e);break;case CI.kickNotify:this.emit(CI.kickNotify,e);break;default:this.logger.error(sE,"unknown message type ".concat(e.type))}else this.logger.error(sE,"unknown message:".concat(e))}setConfigParams(e){this.socket.setKeepAliveParams(e)}getLogProvider(){}getStatInfo(){}}const cE="AsyncLock";class uE{constructor(){bu(this,"callback_",[]),this.callback_=[],this.logger=Qg.getLogger()}async Lock(e){this.logger.info(cE,"".concat(e," try to get lock")),await new Promise((t=>{const r={callbackFunc:()=>t(),lockTrigger:"".concat(e)};this.callback_.push(r),1===this.callback_.length&&(this.callback_[0].callbackFunc(),this.logger.info(cE,"".concat(this.callback_[0].lockTrigger," got lock")))}))}unLock(e){if(this.logger.info(cE,"".concat(e," try to unlock")),this.callback_.length>0){const e=this.callback_.shift();this.logger.info(cE,"".concat(e.lockTrigger," unlocked")),this.callback_.length>0&&(this.callback_[0].callbackFunc(),this.logger.info(cE,"".concat(this.callback_[0].lockTrigger," got lock")))}else this.logger.error(cE,"unlock, but no lock exist")}clear(){this.callback_=[]}}class dE{constructor(){this.audioStreams=new Map,this.logger=Qg.getLogger()}getAudioStreams(){return[...this.audioStreams.values()]}getAudioStream(e){return this.audioStreams.get(e)}addAudioStream(e,t){const r={audioPlayer:null,audioMediaTrack:null,streamId:e,ssrc:t,playStatus:"init"};this.audioStreams.set(e,r)}updateAudioStream(e,t){const r=this.audioStreams.get(e);r.audioMediaTrack=t,r.audioPlayer=new FI({logger:this.logger,playerId:e,track:t})}getAudioLevel(){const e=[];for(const r of this.audioStreams.values()){var t;e.push({streamId:r.streamId,ssrc:r.ssrc,level:null===(t=r.audioPlayer)||void 0===t?void 0:t.getAudioLevel()})}return e}setAudioVolume(e){const t=e/100;for(const i of this.audioStreams.values()){var r;if("notAllow"===i.playStatus)this.resume(i.streamId).then((()=>{var e;null===(e=i.audioPlayer)||void 0===e||e.setVolume(t)}));else null===(r=i.audioPlayer)||void 0===r||r.setVolume(t)}}muteAudio(e){for(const t of this.audioStreams.values())e||"notAllow"!==t.playStatus?t.audioMediaTrack.enabled=!e:this.resume(t.streamId).then((()=>{t.audioMediaTrack.enabled=!e}))}isAudioMuted(){const e=Array.from(this.audioStreams.values());return!e.every((e=>"normal"===e.playStatus))||!e.every((e=>e.audioMediaTrack.enabled))}async play(e){for(const i of this.audioStreams.values())try{var t;if(e){if(i.streamId===e){var r;await(null===(r=i.audioPlayer)||void 0===r?void 0:r.play()),i.playStatus="normal";break}}else await(null===(t=i.audioPlayer)||void 0===t?void 0:t.play()),i.playStatus="normal"}catch(tb){this.logger.error("RemoteTopNAudioStreams","resume failed, error: ".concat(tb)),i.playStatus="notAllow"}}async resume(e){for(const i of this.audioStreams.values())try{var t;if(e){if(i.streamId===e){var r;await(null===(r=i.audioPlayer)||void 0===r?void 0:r.resume()),i.playStatus="normal";break}}else await(null===(t=i.audioPlayer)||void 0===t?void 0:t.resume()),i.playStatus="normal"}catch(tb){this.logger.error("RemoteTopNAudioStreams","resume failed, error: ".concat(tb)),i.playStatus="notAllow"}}setAudioVolume4Id(e,t){for(const r of this.audioStreams.values())if(r.streamId===e&&r.audioPlayer){"notAllow"===r.playStatus?this.resume(e).then((()=>{r.audioPlayer.setVolume(t/100)})):r.audioPlayer.setVolume(t/100);break}}close(e){if(e&&this.audioStreams.has(e)){const t=this.audioStreams.get(e);return t.audioPlayer.stop(),t.audioMediaTrack=null,t.audioPlayer=null,t.playStatus="init",void this.audioStreams.delete(e)}for(const t of this.audioStreams.values())t.audioPlayer.stop(),t.audioMediaTrack=null,t.audioPlayer=null,t.playStatus="init";this.audioStreams.clear()}}const lE="LocalStreamPublishManager";class hE{constructor(){this.logger=Qg.getLogger(),this.localStreams=new Map,this.sdpRepInfo=null}reset(){Array.from(this.localStreams.values()).forEach((e=>{e.localTrackPublishInfos.clear()})),this.logger.info(lE,"reset successfully")}getStreamTrackInfo(e){const t=[];let r;return e.getHRTCTracks({hasTrack:!0}).forEach((i=>{const n=i.getTrackProfile();if(i.getTrackType()===uI.TRACK_TYPE_AUDIO)i.setTrackId(this.sdpRepInfo.audio.streamCodecs[0].streamUid.toString()),r={type:uI.TRACK_TYPE_AUDIO,resolutionId:i.getResolutionId(),upstream:{content:AI.main,mute:i.getTrackMuted(),maxMbps:Math.round((n.bitrate||0)/1e3),sampleRate:n.sampleRate,channels:n.channelCount,codec:Iy.OPUS,pt:112,streamUid:this.sdpRepInfo.audio.streamCodecs[0].streamUid,ssrc:this.sdpRepInfo.audio.sendSsrcBegin}};else{let t;if(e.isAuxiliary())i.setTrackId(this.sdpRepInfo.desktopVideo.streamCodecs[0].streamUid.toString()),t={content:AI.desktop,mute:i.getTrackMuted(),width:n.width,height:n.height,fps:n.frameRate,maxMbps:Math.round((n.maxBitrate||0)/1e3),maxFs:n.frameRate,codec:Iy.H264,pt:122,streamUid:this.sdpRepInfo.desktopVideo.streamCodecs[0].streamUid,ssrc:this.sdpRepInfo.desktopVideo.sendSsrcBegin};else{const e=i.getTrackContentType(),r=this.sdpRepInfo.video.streamCodecs.find((t=>t.content===e)).streamUid;i.setTrackId(r.toString()),t={content:e,mute:i.getTrackMuted(),width:n.width,height:n.height,fps:n.frameRate,maxMbps:Math.round((n.maxBitrate||0)/1e3),maxFs:n.frameRate,codec:Iy.H264,pt:122,streamUid:r,ssrc:e===AI.main?this.sdpRepInfo.video.sendSsrcBegin:this.sdpRepInfo.video.sendSsrcEnd}}r={type:uI.TRACK_TYPE_VIDEO,resolutionId:i.getResolutionId(),upstream:t}}t.push(r)})),this.logger.info(lE,"getStreamTrackInfo, get trackInfos: ".concat(JSON.stringify(t))),t}getLocalStream(e){const t=this.localStreams.get(e);return t?t.localStream:null}generatePubInfoWhenPublish(e){const t={allTracks2Publish:[],tracks2NewPublish:[],tracks2KeepPublish:[],tracks2UnPublish:[]},r=e.isAuxiliary()?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN,i=this.localStreams.get(r);return i&&0!==i.localTrackPublishInfos.size?this.isSameStreamId(e)?this.updateStream(e,t):this.replaceStream(e,t):this.addStream(e,t),this.buildAll2PublishTrackInfo(t.allTracks2Publish,e.isAuxiliary(),!0),this.logger.info(lE,"generatePubInfoWhenPublish tracks2Update input: ".concat(JSON.stringify(t))),t}setSdpRepInfo(e){this.sdpRepInfo=e}buildAll2PublishTrackInfo(e,t,r){t?(this.buildMediaPubInfo(e,uI.TRACK_TYPE_VIDEO,dI.STREAM_TYPE_MAIN),this.buildMediaPubInfo(e,uI.TRACK_TYPE_AUDIO,dI.STREAM_TYPE_MAIN),r&&this.buildMediaPubInfo(e,uI.TRACK_TYPE_VIDEO,dI.STREAM_TYPE_AUX)):(this.buildMediaPubInfo(e,uI.TRACK_TYPE_VIDEO,dI.STREAM_TYPE_AUX),r&&(this.buildMediaPubInfo(e,uI.TRACK_TYPE_VIDEO,dI.STREAM_TYPE_MAIN),this.buildMediaPubInfo(e,uI.TRACK_TYPE_AUDIO,dI.STREAM_TYPE_MAIN)))}buildMediaPubInfo(e,t,r){var i;const n=null===(i=this.localStreams.get(r))||void 0===i?void 0:i.localTrackPublishInfos;n&&Array.from(n.values()).filter((e=>e.type===t)).forEach((t=>{t.sender&&(t.upstream.mute=!t.sender.track.enabled),e.push(t)}))}isSameStreamId(e){const t=e.isAuxiliary()?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN;return this.localStreams.get(t).streamId===e.getLocalId()}static getString4TrackPublishInfos(e){let t;for(const r of e.entries())t="".concat(t||""," resolutionId: ").concat(r[0],", track type: ").concat(r[1].type,"ï¼ watched: ").concat(r[1].watched,", published: ").concat(r[1].published);return t}updateStream(e,t){this.logger.info(lE,"updateStream, update stream begin");const r=[],i=e.isAuxiliary()?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN,n=this.getStreamTrackInfo(e),s=this.localStreams.get(i);n.forEach((e=>{const n=s.localTrackPublishInfos.get(e.resolutionId);r.push(e),n?(n.upstream.mute=e.upstream.mute,n.published&&t.tracks2KeepPublish.push(n),n.watched&&!n.published&&t.tracks2NewPublish.push(n)):this.addTrack(i,e,t,s)}));const o=[];Array.from(s.localTrackPublishInfos.values()).forEach((e=>{const i=r.find((t=>t.resolutionId===e.resolutionId));if(i){if(!hE.isSameResolution(i,e)){const t={type:i.type,resolutionId:i.resolutionId,upstream:i.upstream,published:e.published,watched:e.watched,ssrc:e.ssrc,sender:e.sender};s.localTrackPublishInfos.set(i.resolutionId,t)}}else e.published&&t.tracks2UnPublish.push(e),o.push(e.resolutionId)})),o.forEach((e=>{s.localTrackPublishInfos.delete(e)})),this.logger.info(lE,"updateStream, update stream ".concat(e.getLocalId()," successfully\n    ").concat(hE.getString4TrackPublishInfos(s.localTrackPublishInfos)))}static isSameResolution(e,t){return e.upstream.height===t.upstream.height&&e.upstream.width===t.upstream.width}replaceStream(e,t){return this.logger.info(lE,"replaceStream begin"),this.addStream(e,t)}addStream(e,t){const r=e.isAuxiliary()?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN,i=this.getStreamTrackInfo(e),n={localStream:e,streamId:e.getLocalId(),localTrackPublishInfos:new Map};i.forEach((e=>{this.addTrack(r,e,t,n)})),this.localStreams.set(r,n),this.logger.info(lE,"addStream, add stream ".concat(e.getLocalId()," successfully ,\n    ").concat(hE.getString4TrackPublishInfos(n.localTrackPublishInfos)))}generatePubInfoWhenUnPublish(e){const t=e.isAuxiliary()?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN,r={allTracks2Publish:[],tracks2KeepPublish:[],tracks2NewPublish:[],tracks2UnPublish:[]},i=this.localStreams.get(t);return i?(Array.from(i.localTrackPublishInfos.values()).filter((e=>e.published)).forEach((e=>{r.tracks2UnPublish.push(e)})),this.buildAll2PublishTrackInfo(r.allTracks2Publish,e.isAuxiliary(),!1),r):(this.logger.warn(lE,"stream not publish"),r.allTracks2Publish=null,r)}removeStream(e){const t=e.isAuxiliary()?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN;if(!this.localStreams.has(t))throw this.logger.error(lE,"removeStream, stream not exist"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);this.localStreams.delete(t)}generatePubInfoWhenWatch(e,t,r){if(this.logger.info(lE,"generatePubInfoWhenWatch watch ".concat(e," streams")),!t||!r)return null;const i={allTracks2Publish:null,tracks2KeepPublish:[],tracks2NewPublish:[],tracks2UnPublish:[]},n=this.localStreams.get(e);if(!n)return this.logger.warn(lE,"generatePubInfoWhenWatch, stream not exist"),null;const s=Array.from(n.localTrackPublishInfos.values());return 0===t.length&&0===r.length&&s.forEach((e=>{this.renewTrack2Update(!1,e,i)})),s.forEach((e=>{if(t.length>0&&e.type===uI.TRACK_TYPE_VIDEO){const r=t.find((t=>t===e.upstream.ssrc));this.renewTrack2Update(!!r,e,i)}if(r.length>0&&e.type===uI.TRACK_TYPE_AUDIO){const t=r.find((t=>t===e.upstream.ssrc));this.renewTrack2Update(!!t,e,i)}})),t.forEach((e=>{s.some((t=>e===t.upstream.ssrc))||this.logger.error(lE,"generatePubInfoWhenWatch, watch video ssrc:".concat(e," is not exist"))})),r.forEach((e=>{s.some((t=>e===t.upstream.ssrc))||this.logger.error(lE,"generatePubInfoWhenWatch, watch audio ssrc:".concat(e," is not exist"))})),i}renewTrack2Update(e,t,r){e?t.published?(r.tracks2KeepPublish.push(t),this.logger.info(lE,"generatePubInfoWhenWatch , keep ".concat(t.type," ssrc:").concat(t.ssrc))):(t.watched=!0,r.tracks2NewPublish.push(t),this.logger.info(lE,"generatePubInfoWhenWatch , new publish ".concat(t.type," ssrc:").concat(t.ssrc))):t.published&&(t.watched=!1,r.tracks2UnPublish.push(t),this.logger.info(lE,"generatePubInfoWhenWatch , new unpublish ".concat(t.type," ssrc:").concat(t.ssrc)))}addTrack(e,t,r,i){const n=hE.getDefaultWatchFlag(e,t.type),s={type:t.type,resolutionId:t.resolutionId,published:!1,watched:n,upstream:t.upstream,ssrc:t.upstream.ssrc,sender:null};s.watched&&r.tracks2NewPublish.push(s),i.localTrackPublishInfos.set(t.resolutionId,s),this.logger.info(lE,"addTrack, add track for resolutionId ".concat(t.resolutionId," successfully"))}static getDefaultWatchFlag(e,t){return e===dI.STREAM_TYPE_MAIN&&t===uI.TRACK_TYPE_AUDIO}publishAuxVideoTrackOK(e,t){this.publishTrackSuccess(dI.STREAM_TYPE_AUX,uI.TRACK_TYPE_VIDEO,e,t)}publishMainVideoTrackOK(e,t,r){this.publishTrackSuccess(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_VIDEO,e,t,r)}publishMainAudioTrackOK(e,t){this.publishTrackSuccess(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_AUDIO,e,t)}publishTrackSuccess(e,t,r,i,n){const s=this.localStreams.get(e);if(!s)throw this.logger.error(lE,"stream is empty"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);const o=this.getTrackInfo(s,t,n);if(!o)throw this.logger.error(lE,"getTrackInfo return empty"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);o.published&&this.logger.info(lE,"stream already published"),o.published=!0,o.sender=r,this.logger.info(lE,"publish track for trackId: ".concat(n," successfully"))}unPublishTrackSuccess(e,t,r){const i=this.localStreams.get(e);if(!i)throw this.logger.error(lE,"stream is empty"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);if(t===uI.TRACK_TYPE_VIDEO&&!r)throw this.logger.error(lE,"video trackId is empty"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);const n=this.getTrackInfo(i,t,r);n?(n.published||this.logger.info(lE,"stream already unPublished"),n.published=!1,n.sender=null,this.logger.info(lE,"unPublish track for trackId: ".concat(r," successfully"))):this.logger.info(lE,"getTrackInfo return empty")}getMainStreamVideoPublishInfo(){return this.getTrackPublishInfos(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_VIDEO)}getPublishedMainVideoTrackInfo(e){const t=this.getTrackPublishInfo(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_VIDEO,e);return null!=t&&t.published&&t.sender?t:null}getPublishedMainAudioTrackInfo(){const e=this.getTrackPublishInfo(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_AUDIO);return null!=e&&e.published&&e.sender?e:null}getPublishedAuxVideoTrackInfo(){const e=this.getTrackPublishInfo(dI.STREAM_TYPE_AUX,uI.TRACK_TYPE_VIDEO);return null!=e&&e.published&&e.sender?e:null}getPublishedMainVideoTrackInfos(){const e=this.getTrackPublishInfos(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_VIDEO);return(null==e?void 0:e.length)>0?e.filter((e=>e.published&&e.sender)):null}getPublishedMainStreamInfos(){const e=this.getTrackPublishInfos(dI.STREAM_TYPE_MAIN);return(null==e?void 0:e.length)>0?e.filter((e=>e.published&&e.sender)):null}getPublishedAuxStreamInfo(){const e=this.localStreams.get(dI.STREAM_TYPE_AUX);if(!e)return null;return Array.from(e.localTrackPublishInfos.values()).find((e=>e.published&&e.sender))?e:null}getTrackPublishInfos(e,t){const r=this.localStreams.get(e);return r?t?Array.from(r.localTrackPublishInfos.values()).filter((e=>e.type===t)):Array.from(r.localTrackPublishInfos.values()):(this.logger.info(lE,"getTrackPublishInfos, not found"),null)}getTrackPublishInfo(e,t,r){const i=this.localStreams.get(e);return i?this.getTrackInfo(i,t,r):null}isAuxVideoTrackPublished(){const e=this.isTrackPublished(dI.STREAM_TYPE_AUX,uI.TRACK_TYPE_VIDEO);return this.logger.info(lE,"isAuxVideoTrackPublished: ".concat(e)),e}isMainStreamPublished(){const e=this.isTrackPublished(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_VIDEO)||this.isTrackPublished(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_AUDIO);return this.logger.info(lE,"isMainVideoTrackPublished: ".concat(e)),e}isTrackPublished(e,t,r){const i=this.localStreams.get(e);if(!i)return this.logger.info(lE,"isTrackPublished, not found"),!1;const n=this.getTrackInfo(i,t,r);return n?n.published&&!!n.sender:(this.logger.info(lE,"isTrackPublished, not found"),!1)}getTrackInfo(e,t,r){if(!e||0===e.localTrackPublishInfos.size)return null;if(t===uI.TRACK_TYPE_AUDIO)return Array.from(e.localTrackPublishInfos.values()).find((e=>e.type===uI.TRACK_TYPE_AUDIO));if(r)return Array.from(e.localTrackPublishInfos.values()).find((e=>e.type===uI.TRACK_TYPE_VIDEO&&e.upstream.streamUid.toString()===r));const i=hE.getMaxResolutionId(e);return i?e.localTrackPublishInfos.get(i):null}static getMaxResolutionId(e){var t,r;return null==e||null===(t=e.localStream)||void 0===t||null===(r=t.getMaxResolutionHRTCTrack())||void 0===r?void 0:r.getResolutionId()}unPublishAuxStreamOK(){this.unPublishStreamSuccess(dI.STREAM_TYPE_AUX)}unPublishMainStreamOK(){this.unPublishStreamSuccess(dI.STREAM_TYPE_MAIN)}unPublishStreamSuccess(e){var t;const r=this.localStreams.get(e);r?(null===(t=r.localStream)||void 0===t||t.getHRTCTracks({hasTrack:!0,mediaType:uI.TRACK_TYPE_VIDEO}).forEach((e=>e&&e.setTrackId(""))),this.removeStream(r.localStream),this.logger.info(lE,"unPublishStreamSuccess, ".concat(e))):this.logger.warn(lE,"stream not publish")}isAuxVideoTrackValid(e){return this.isTrackValid(dI.STREAM_TYPE_AUX,uI.TRACK_TYPE_VIDEO,e)}isTrackValid(e,t,r){const i=this.localStreams.get(e);return i?Array.from(i.localTrackPublishInfos.values()).some((e=>e.type===t&&e.upstream.streamUid.toString()===r)):(this.logger.info(lE,"isTrackValid, not found"),!1)}generateOptTags(e,t){const r=[],i=this.localStreams.get(e);if(!i)return r;return Array.from(i.localTrackPublishInfos.values()).filter((e=>e.type===t&&e.published&&e.sender)).forEach((e=>{if(t===uI.TRACK_TYPE_VIDEO){const t=e.upstream?e.upstream.height:0,i=e.upstream?e.upstream.width:0,n="".concat(e.ssrc,":").concat(t,"*").concat(i);r.push(n)}else{var n;const t=null===(n=i.localStream.getAudioHRTCTrack())||void 0===n?void 0:n.getTrackProfile(),s="".concat(e.ssrc,":").concat(t?t.sampleRate:0);r.push(s)}})),r}generateMainAudioOptTag(){const e=this.generateOptTags(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_AUDIO);return e.length>0?e[0]:null}generateAuxOptTag(){const e=this.generateOptTags(dI.STREAM_TYPE_AUX,uI.TRACK_TYPE_VIDEO);return e.length>0?e[0]:null}generateMainVideoOptTags(){const e=this.generateOptTags(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_VIDEO);return e.length>0?e:null}}var fE={},pE={exports:{}},mE=pE.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(mE).forEach((function(e){mE[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),function(e){var t=function(e){return String(Number(e))===e?Number(e):e},r=function(e,r,i){var n=e.name&&e.names;e.push&&!r[e.push]?r[e.push]=[]:n&&!r[e.name]&&(r[e.name]={});var s=e.push?{}:n?r[e.name]:r;!function(e,r,i,n){if(n&&!i)r[n]=t(e[1]);else for(var s=0;s<i.length;s+=1)null!=e[s+1]&&(r[i[s]]=t(e[s+1]))}(i.match(e.reg),s,e.names,e.name),e.push&&r[e.push].push(s)},i=pE.exports,n=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},s=[],o=t;return e.split(/(\r\n|\r|\n)/).filter(n).forEach((function(e){var t=e[0],n=e.slice(2);"m"===t&&(s.push({rtp:[],fmtp:[]}),o=s[s.length-1]);for(var a=0;a<(i[t]||[]).length;a+=1){var c=i[t][a];if(c.reg.test(n))return r(c,o,n)}})),t.media=s,t};var s=function(e,r){var i=r.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&r.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(s,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var r=[],i=e.split(" ").map(t),n=0;n<i.length;n+=3)r.push({component:i[n],ip:i[n+1],port:i[n+2]});return r},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var r,i=!1;return"~"!==e[0]?r=t(e):(r=t(e.substring(1,e.length)),i=!0),{scid:r,paused:i}}))}))}}(fE);var _E=pE.exports,gE=/%[sdv%]/g,SE=function(e){var t=1,r=arguments,i=r.length;return e.replace(gE,(function(e){if(t>=i)return e;var n=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}}))},vE=function(e,t,r){var i=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var n=0;n<t.names.length;n+=1){var s=t.names[n];t.name?i.push(r[t.name][s]):i.push(r[t.names[n]])}else i.push(r[t.name]);return SE.apply(null,i)},RE=["v","o","s","i","u","e","p","c","b","t","r","z","a"],TE=["i","c","b","a"],IE=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||RE,i=t.innerOrder||TE,n=[];return r.forEach((function(t){_E[t].forEach((function(r){r.name in e&&null!=e[r.name]?n.push(vE(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){n.push(vE(t,r,e))}))}))})),e.media.forEach((function(e){n.push(vE("m",_E.m[0],e)),i.forEach((function(t){_E[t].forEach((function(r){r.name in e&&null!=e[r.name]?n.push(vE(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){n.push(vE(t,r,e))}))}))}))})),n.join("\r\n")+"\r\n"},yE=IE,EE=fE.parse,bE=fE.parseParams;const CE="packetization-mode",AE="profile-level-id",kE=["groups","media"],wE=["candidates","connection","direction","mid","payloads","port","protocol","rtp","type","fmtp","ssrcs"];class OE{constructor(e){bu(this,"module_","sdp"),bu(this,"ssrcAttrCname_","cname"),bu(this,"ssrcAttrMslabel_","mslabel"),bu(this,"ssrcAttrLabel_","label"),bu(this,"ssrcAttrMsid_","msid"),bu(this,"validateIp",(e=>/^((\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))(\.|$)){4}$/.test(e))),this.logger_=e}setPortType(e){this.portType_=e}parseSdp(e){if(!e)return void this.logger_.error(this.module_,"parseSdp failed : sdp  is null ");const t=EE(e);if(0!==t.media.length)return t;this.logger_.error(this.module_,"parseSdp failed : the media of sdp is null ")}printSdpInfo(e){const t=this.parseSdp(e);if(t){for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(kE.includes(e)||delete t[e],"media"===e&&t[e].forEach((e=>{for(const t in e)wE.includes(t)||delete e[t]})));return Qg.shieldIpAddress(yE(t))}}getMedias(e,t){return e.media.filter((e=>{let{type:r}=e;return r===t}))}deleteUnexpectedMedia(e){e.media&&(e.media=e.media.filter((e=>{let{type:t}=e;return t===uI.TRACK_TYPE_VIDEO||t===uI.TRACK_TYPE_AUDIO})),this.portType_===PI.portNormal&&e.groups&&(e.groups=e.groups.filter((e=>{let{type:t}=e;return"BUNDLE"!==t.toLocaleUpperCase()}))))}transformVideoPayload(e){if(!e.rtp)return void this.logger_.warn(this.module_,"transformVideoPayload failed ,rtp is null");let t=null,r=null,i=0;for(const n of e.rtp){if(n.codec.toUpperCase()!==Iy.H264)continue;r||(r=n.payload,this.logger_.info(this.module_,"record firstPayload, firstPayload: ".concat(r)));const s=OE.getPacketizationMode(e.fmtp,n.payload),o=OE.getProfileLevelId(e.fmtp,n.payload);if(1===s&&(0===i&&(r=n.payload,i=1),"42e01f"===o)){t=n.payload,this.logger_.info(this.module_,"set retainPayload in transformVideoPayload, retainPayload: ".concat(t));break}}t||(t=r,this.logger_.info(this.module_,"no expected payload, use firstPayload as retainPayload, retainPayload: ".concat(t))),t?(OE.deletePayload(e,t),OE.modifyPayload(e,122),OE.addVideoFec(e),OE.addFmtpAttr(e,122,"max-br","5000000"),OE.addFmtpAttr(e,107,"apt","".concat(122))):this.logger_.error(this.module_,"transformVideoPayload failed,can not find expected payload.")}transformAudioPayload(e){if(!e.rtp)return void this.logger_.warn(this.module_,"transformAudioPayload failed, rtp is null");let t;for(const r of e.rtp)if(r.codec.toLowerCase()===Iy.OPUS){t=r.payload;break}t?(OE.deletePayload(e,t),OE.modifyPayload(e,112),OE.addNack(e)):this.logger_.error(this.module_,"transformAudioPayload failed,can not find expected payload.")}deleteRetransmissionSsrc(e){if(!e.ssrcGroups||!e.ssrcs)return;const t=[];e.ssrcGroups.forEach((e=>{let{ssrcs:r}=e;const i=this.getRetransmissionSsrc(r);null!=i&&t.push(i)})),0!==t.length&&(e.ssrcGroups=void 0,e.ssrcs=e.ssrcs.filter((e=>{let{id:r}=e;return!t.includes(r.toString())})))}addVideoSsrcRange(e,t){!t||t.length<1||(e.invalid||(e.invalid=[]),e.invalid.push({value:"send-ssrc-list:".concat(t.join(","))}))}static addAudioSsrcRange(e,t){t&&(e.invalid||(e.invalid=[]),e.invalid.push({value:"send-ssrc-list:".concat(t)}))}modifyCandidate(e,t){if(this.validateIp(e.connection.ip)&&"0.0.0.0"!==e.connection.ip||(e.connection.ip="127.0.0.1"),!e.candidates){const r=null==t?void 0:t.find((t=>"".concat(e.mid)==="".concat(t.sdpMid)));if(r){const t=/.*generation\s(\d+).*/.exec(r.candidate)||[],i=/.*network\-id\s(\d+).*/.exec(r.candidate)||[],n=/.*network\-cost\s(\d+).*/.exec(r.candidate)||[];e.candidates=e.candidates||[],e.candidates.push({foundation:r.foundation,component:"rtp"===r.component?1:2,transport:r.protocol,priority:r.priority,ip:r.address,port:r.port,type:r.type,raddr:r.relatedAddress,rport:r.relatedPort,tcptype:r.tcpType,generation:2===t.length?parseInt(t[1]):void 0,"network-id":2===i.length?parseInt(i[1]):void 0,"network-cost":2===n.length?parseInt(n[1]):void 0})}}if(e.candidates)for(let r=0;r<e.candidates.length;r++)this.validateIp(e.candidates[r].ip)&&"0.0.0.0"!==e.candidates[r].ip||(e.candidates[r].ip="127.0.0.1")}static getPacketizationMode(e,t){if(!e)return 1;for(const r of e){if(r.payload!==t)continue;if(!r.config.includes(CE))return 1;const e=bE(r.config);return null==e["packetization-mode"]?1:parseInt(String(e["packetization-mode"]),10)}return 1}static getProfileLevelId(e,t){if(!e)return"";for(const r of e){if(r.payload!==t)continue;if(!r.config.includes(AE))return"";const e=bE(r.config);return e["profile-level-id"]?String(e["profile-level-id"]):""}return""}static deletePayload(e,t){e.rtp&&(e.rtp=e.rtp.filter((e=>{let{payload:r}=e;return r===t}))),e.rtcpFb&&(e.rtcpFb=e.rtcpFb.filter((e=>{let{payload:r}=e;return r===t}))),e.fmtp&&(e.fmtp=e.fmtp.filter((e=>{let{payload:r}=e;return r===t}))),e.payloads=t.toString()}static modifyPayload(e,t){e.rtp&&e.rtp.forEach((e=>{e.payload=t})),e.rtcpFb&&e.rtcpFb.forEach((e=>{e.payload=t})),e.fmtp&&e.fmtp.forEach((r=>{r.payload=t,e.type===uI.TRACK_TYPE_AUDIO&&/stereo/.test(r.config)&&(r.config=r.config.replace("stereo=1","stereo=0"))})),e.payloads=t.toString()}static addVideoFec(e){e.rtp||(e.rtp=[]),e.rtp.push({payload:107,codec:"rtx",rate:9e4}),e.rtp.push({payload:110,codec:"red",rate:9e4}),e.rtp.push({payload:127,codec:"ulpfec",rate:9e4}),e.payloads="".concat(107," ",e.payloads," ",110," ",127)}static addFmtpAttr(e,t,r,i){if(!e.fmtp||0===e.fmtp.length)return e.fmtp=[],void e.fmtp.push({payload:t,config:r+"="+i});const n=e.fmtp.find((e=>e.payload===t));if(n){if(bE(n.config)[r])return;n.config=n.config+";"+r+"="+i}else e.fmtp.push({payload:t,config:r+"="+i})}static addNack(e){const t=e.rtp[0].payload;e.rtcpFb||(e.rtcpFb=[]),e.rtcpFb.push({payload:t,type:"ccm",subtype:"fir"}),e.rtcpFb.push({payload:t,type:"nack"}),e.rtcpFb.push({payload:t,type:"nack",subtype:"pli"})}getRetransmissionSsrc(e){if(!e)return void this.logger_.warn(this.module_,"getRetransmissionSsrc failed, ssrcs is null");const t=e.split(" ");if(2===t.length)return t[1];this.logger_.warn(this.module_,"getRetransmissionSsrc failed, ssrcs(".concat(e,") is invalid"))}static generateSsrcLabel(){return"".concat(Hg.generateRandomId(8,36),"-").concat(Hg.generateRandomId(4,36),"-").concat(Hg.generateRandomId(4,36),"-").concat(Hg.generateRandomId(4,36),"-").concat(Hg.generateRandomId(12,36))}static addSsrcAttr(e,t,r){e.ssrcs||(e.ssrcs=[]);for(let i=0;i<r.length;i++)e.ssrcs.push({id:t,attribute:r[i][0],value:r[i][1]})}static deleteSsrcAttr(e,t){e.ssrcs&&(e.ssrcs=e.ssrcs.filter((e=>{let{id:r}=e;return!t.find((e=>e.toString()===r.toString()))})))}deleteTcpCandidate(e){this.logger_.info(this.module_,"deleteTcpCandidate");const t=this.parseSdp(e);if(!t)return void this.logger_.error(this.module_,"deleteTcpCandidate failed,the sdp is invalid");t.media.forEach((e=>{e.candidates&&(e.candidates=e.candidates.filter((e=>{let{transport:t}=e;return"tcp"!==t.toLocaleLowerCase()})))}));const r=yE(t);return this.logger_.info(this.module_,"deleteTcpCandidate success"),r}generateSsrcMslabel(){return Hg.generateRandomId(36)}containsValidVideoPayload(e){this.logger_.debug(this.module_,"containsValidVideoPayload, offerSdp: ".concat(this.printSdpInfo(e)));const t=this.parseSdp(e);if(!t)return this.logger_.error(this.module_,"containsValidVideoPayload failed,the sdp is invalid"),!1;return this.getMedias(t,uI.TRACK_TYPE_VIDEO).some((e=>{var t;return null===(t=e.rtp)||void 0===t?void 0:t.some((e=>e.codec.toUpperCase()===Iy.H264))}))}transformOfferSdp(e){this.logger_.info(this.module_,"transformOfferSdp begin");const t=this.parseSdp(e);if(!t)return void this.logger_.error(this.module_,"transformOfferSdp failed,the sdp is invalid");this.deleteUnexpectedMedia(t);const r=this.getMedias(t,uI.TRACK_TYPE_VIDEO),i=this.getMedias(t,uI.TRACK_TYPE_AUDIO);r.forEach((e=>{this.transformVideoPayload(e),this.deleteRetransmissionSsrc(e)})),i.forEach((e=>{this.transformAudioPayload(e),this.deleteRetransmissionSsrc(e)}));const n=yE(t);return this.logger_.debug(this.module_,"transformOfferSdp success, sdp: ".concat(this.printSdpInfo(n))),n}modifyAuxSdpCandidates(e,t,r){const i=this.deleteTcpCandidate(e),n=this.parseSdp(i);if(!n)return void this.logger_.error(this.module_,"modifyAuxSdpCandidates failed,the sdp is invalid : ".concat(e));const s=this.getMedias(n,uI.TRACK_TYPE_VIDEO);s&&s.length>0&&(this.addVideoSsrcRange(s[0],r),this.modifyCandidate(s[0],t));const o=yE(n);return this.logger_.debug(this.module_,"modifyAuxSdpCandidates success, sdp: ".concat(this.printSdpInfo(o))),o}modifySdpCandidates(e,t,r,i){const n=this.deleteTcpCandidate(e),s=this.parseSdp(n);if(!s)return void this.logger_.error(this.module_,"modifySdpCandidates failed, the sdp is invalid : ".concat(e));const o=this.getMedias(s,uI.TRACK_TYPE_VIDEO),a=this.getMedias(s,uI.TRACK_TYPE_AUDIO);let c="",u="";if(o&&o.length>0&&(this.addVideoSsrcRange(o[0],r),this.modifyCandidate(o[0],t),u=o[0].mid,o.length>1))for(let l=0;l<s.media.length;l++)s.media[l].type!==uI.TRACK_TYPE_AUDIO&&s.media[l].mid!==o[0].mid&&delete s.media[l];a&&a.length>0&&(OE.addAudioSsrcRange(a[0],i),this.modifyCandidate(a[0],t),c=a[0].mid);for(const l of s.groups||[])if("BUNDLE"===l.type){l.mids="".concat(c," ").concat(u);break}const d=yE(s);return this.logger_.debug(this.module_,"modifySdpCandidates success, sdp: ".concat(this.printSdpInfo(d))),d}getSfuInfo(e,t){const r=this.parseSdp(e),i={ipAddress:"",auxPort:0};let n;const s=this.getMedias(r,uI.TRACK_TYPE_AUDIO);s&&s.length>0&&(i.audioPort=s[0].port,n=s[0].connection);const o=this.getMedias(r,uI.TRACK_TYPE_VIDEO);if(o&&o.length>0&&(i.videoPort=o[0].port,n=o[0].connection),n&&(i.ipAddress=n.ip),t){const e=this.parseSdp(t),r=this.getMedias(e,uI.TRACK_TYPE_VIDEO);r&&r.length>0&&r[0].connection&&(i.auxPort=r[0].port)}return i}}class PE extends OE{static modifyDirection(e){e.ssrcs&&0!==e.ssrcs.length?e.direction=Ty.SEND_RECV:e.direction=Ty.RECV_ONLY}hasSSRC(e,t){const r=this.parseSdp(e);if(!r)return this.logger_.error(this.module_,"hasSSRC failed"),!1;const i=this.getMedias(r,t);return i&&i.length>0&&!!i[0].ssrcs}getMslabelByCname(e,t){if(!e)return null;if(!e.ssrcs)return null;let r;for(const i of e.ssrcs)if(i.attribute.toLocaleLowerCase()===this.ssrcAttrCname_&&i.value===t){r=i.id;break}if(!r)return null;for(const i of e.ssrcs)if(i.id===r&&i.attribute.toLocaleLowerCase()===this.ssrcAttrMslabel_)return i.value;return null}addSsrc(e,t,r,i,n,s){const o=r,a=this.getMslabelByCname(e,o),c=this.getMslabelByCname(t,o);let u,d,l=!1,h=!1;if(a&&a===i||!n||(h=!0),c&&c===i||!s||(l=!0),h&&(u=c||i||this.generateSsrcMslabel()),l&&(d=i||this.generateSsrcMslabel()),this.logger_.debug(this.module_,"addSsrc, userId: ".concat(r,", audioMslabel: ").concat(u," videooMslabel: ").concat(d)),u){const t=OE.generateSsrcLabel(),r=[[this.ssrcAttrCname_,o],[this.ssrcAttrMslabel_,u],[this.ssrcAttrLabel_,t],[this.ssrcAttrMsid_,u+" "+t]];OE.addSsrcAttr(e,n,r)}if(d){const e=OE.generateSsrcLabel(),r=[[this.ssrcAttrCname_,o],[this.ssrcAttrMslabel_,d],[this.ssrcAttrLabel_,e],[this.ssrcAttrMsid_,d+" "+e]];OE.addSsrcAttr(t,s,r)}return d||u}static modifyMediaSsrc(e,t){if(!e.ssrcs)return;for(let r=0;r<t.length;r++)for(let i=0;i<4;i++)e.ssrcs[4*r+i].id=t[r]}transformAnswerSdp(e){this.logger_.debug(this.module_,"transformAnswerSdp, answerSdp: ".concat(this.printSdpInfo(e)));const t=this.parseSdp(e);if(!t)return void this.logger_.error(this.module_,"transformAnswerSdp failed,the sdp is invalid");const r=this.getMedias(t,uI.TRACK_TYPE_VIDEO),i=this.getMedias(t,uI.TRACK_TYPE_AUDIO);r&&r.length>0&&(this.portType_===PI.portNormal&&(r[0].rtcpMux=void 0),PE.modifyDirection(r[0])),i&&i.length>0&&(this.portType_===PI.portNormal&&(i[0].rtcpMux=void 0),PE.modifyDirection(i[0])),this.portType_===PI.portNormal&&(t.groups=void 0);const n=yE(t);return this.logger_.debug(this.module_,"transformAnswerSdp success,answerSdp: ".concat(this.printSdpInfo(n))),n}deleteSSRC(e,t,r){if(0===t.length&&!r)return e;this.logger_.info(this.module_,"deleteVideoSSRC ".concat(t,", ").concat(r));const i=this.parseSdp(e);if(!i)return void this.logger_.error(this.module_,"deleteVideoSSRC failed");const n=this.getMedias(i,uI.TRACK_TYPE_VIDEO);n&&n.length>0&&(t&&OE.deleteSsrcAttr(n[0],t),PE.modifyDirection(n[0]));const s=this.getMedias(i,uI.TRACK_TYPE_AUDIO);s&&s.length>0&&(r&&OE.deleteSsrcAttr(s[0],[r]),PE.modifyDirection(s[0]));const o=yE(i);return this.logger_.info(this.module_,"deleteVideoSSRC ".concat(t," success")),o}addUser(e,t,r,i){const n=this.parseSdp(e);if(!n)return void this.logger_.error(this.module_,"addUser failed,the sdp is invalid : ".concat(e));const s=this.getMedias(n,uI.TRACK_TYPE_VIDEO),o=this.getMedias(n,uI.TRACK_TYPE_AUDIO);let a,c;s&&s.length>0&&(a=s[0]),o&&o.length>0&&(c=o[0]);const u=this.addSsrc(c,a,t,r,i.audioSsrc,i.videoSsrc);a&&PE.modifyDirection(a),c&&PE.modifyDirection(c);const d=yE(n);return this.logger_.debug(this.module_,"addUser success, answerSdp: ".concat(this.printSdpInfo(d))),{answerSdp:d,streamId:u}}deleteUser(e,t,r){const i=this.parseSdp(e);if(!i)return void this.logger_.error(this.module_,"deleteUser failed,the sdp is invalid : ".concat(e));if((null==t?void 0:t.length)>0){const e=this.getMedias(i,uI.TRACK_TYPE_VIDEO);e&&e.length>0&&(t.forEach((t=>{t&&OE.deleteSsrcAttr(e[0],[t])})),PE.modifyDirection(e[0]))}if((null==r?void 0:r.length)>0){const e=this.getMedias(i,uI.TRACK_TYPE_AUDIO);e&&e.length>0&&(r.forEach((t=>{t&&OE.deleteSsrcAttr(e[0],[t])})),PE.modifyDirection(e[0]))}const n=yE(i);return this.logger_.debug(this.module_,"deleteUser success, answerSdp: ".concat(this.printSdpInfo(n))),n}modifyPublishOfferSdp(e,t,r){this.logger_.debug(this.module_,"modifyPublishOfferSdp start, sdp: ".concat(this.printSdpInfo(e)));const i=this.parseSdp(e);if(!i)return void this.logger_.error(this.module_,"modifyPublishOfferSdp failed, the sdp is invalid: ".concat(e));this.deleteUnexpectedMedia(i);const n=this.getMedias(i,uI.TRACK_TYPE_VIDEO),s=this.getMedias(i,uI.TRACK_TYPE_AUDIO);if(n&&n.length>0&&(this.transformVideoPayload(n[0]),this.deleteRetransmissionSsrc(n[0]),t&&t.length>0&&PE.modifyMediaSsrc(n[0],t)),s&&s.length>0&&(this.transformAudioPayload(s[0]),this.deleteRetransmissionSsrc(s[0]),r)){const e=[r];PE.modifyMediaSsrc(s[0],e)}const o=yE(i);return this.logger_.debug(this.module_,"modifyPublishOfferSdp success, sdp: ".concat(this.printSdpInfo(o))),o}}class ME extends OE{static modifyDirectionWhenAddUser(e,t){e&&(e.direction===Ty.RECV_ONLY?e.direction=Ty.SEND_RECV:e.direction===Ty.INACTIVE&&(e.direction=Ty.SEND_ONLY)),t&&(t.direction===Ty.SEND_ONLY?t.direction=Ty.SEND_RECV:t.direction===Ty.INACTIVE&&(t.direction=Ty.RECV_ONLY))}addSSRC(e,t,r,i){const n=r||this.generateSsrcMslabel();this.logger_.debug(this.module_,"addSSRC, userId:".concat(t,", mslabel:").concat(n,", streamId:").concat(r,", ssrc:").concat(i)),e.ssrcs&&delete e.ssrcs;const s=OE.generateSsrcLabel(),o=[[this.ssrcAttrCname_,t],[this.ssrcAttrMslabel_,n],[this.ssrcAttrLabel_,s],[this.ssrcAttrMsid_,n+" "+s]];return OE.addSsrcAttr(e,i,o),n}static modifyDirectionWhenDelUser(e,t){e.direction===Ty.SEND_RECV?e.direction=Ty.RECV_ONLY:e.direction===Ty.SEND_ONLY&&(e.direction=Ty.INACTIVE),t.direction===Ty.SEND_RECV?t.direction=Ty.SEND_ONLY:t.direction===Ty.RECV_ONLY&&(t.direction=Ty.INACTIVE)}hasSSRC(e,t){const r=this.parseSdp(e);if(!r)return this.logger_.error(this.module_,"hasSSRC failed"),!1;return this.getMedias(r,t).some((e=>(e.direction===Ty.SEND_ONLY||e.direction===Ty.SEND_RECV)&&!!e.ssrcs))}delteInvalidLines(e){this.deleteUnexpectedMedia(e);const t=this.getMedias(e,uI.TRACK_TYPE_VIDEO),r=this.getMedias(e,uI.TRACK_TYPE_AUDIO);t.forEach((e=>{this.transformVideoPayload(e),this.deleteRetransmissionSsrc(e)})),r.forEach((e=>{this.transformAudioPayload(e),this.deleteRetransmissionSsrc(e)}))}getAvailableSenderMedia(e,t){return e.media.filter((e=>{let{type:r,direction:i}=e;return r===t&&(i===Ty.SEND_ONLY||i===Ty.SEND_RECV)}))}modifyUnifiedMediaSsrc(e,t,r){if(e.ssrcs&&0!==e.ssrcs.length)e.ssrcs.forEach((e=>{e.attribute===this.ssrcAttrCname_&&(e.value=r),e.id=t}));else{const i=[[this.ssrcAttrCname_,r]];OE.addSsrcAttr(e,t,i)}}static modifyBundle(e,t){for(const r of e.groups||[])if("BUNDLE"===r.type){r.mids="".concat(r.mids," ").concat(t);break}}modifyAnswerDirection(e,t){var r;const i=this.parseSdp(e);if(!i)return void this.logger_.error(this.module_,"modifyAnswerDirection failed,the sdp is invalid");const n=null===(r=i.media)||void 0===r?void 0:r.find((e=>"".concat(e.mid)==="".concat(t)));return n&&(n.direction===Ty.INACTIVE?n.direction=Ty.RECV_ONLY:n.direction===Ty.SEND_ONLY&&(n.direction=Ty.SEND_RECV)),yE(i)}transformAnswerSdp(e,t){this.logger_.debug(this.module_,"transformAnswerSdp, answerSdp: ".concat(this.printSdpInfo(e)));const r=this.parseSdp(e),i=this.parseSdp(t);if(!r||!i)return void this.logger_.error(this.module_,"transformAnswerSdp failed,the sdp is invalid");this.getMedias(r,uI.TRACK_TYPE_AUDIO).forEach((e=>{this.portType_===PI.portNormal&&(e.rtcpMux=void 0),e.ssrcs||(e.direction=Ty.INACTIVE)}));let n=this.getMedias(r,uI.TRACK_TYPE_VIDEO);const s=this.getMedias(i,uI.TRACK_TYPE_VIDEO);if(s.length!==n.length){const e=n.map((e=>"".concat(e.mid)));s.forEach((t=>{if(!e.includes("".concat(t.mid))){const e=JSON.parse(JSON.stringify(n[0]));e.mid=t.mid,r.media.push(e),ME.modifyBundle(r,t.mid)}}))}n=this.getMedias(r,uI.TRACK_TYPE_VIDEO),n.forEach((e=>{this.portType_===PI.portNormal&&(e.rtcpMux=void 0),e.direction=Ty.INACTIVE})),this.portType_===PI.portNormal&&(r.groups=void 0);const o=yE(r);return this.logger_.debug(this.module_,"transformAnswerSdp success,answerSdp: ".concat(this.printSdpInfo(o))),o}addUser(e,t,r,i,n,s){var o,a;const c=this.parseSdp(e);if(!c)return this.logger_.error(this.module_,"addUser failed,the sdp is invalid : ".concat(e)),null;const u=this.parseSdp(t);if(!u)return this.logger_.error(this.module_,"addUser failed,the sdp is invalid : ".concat(t)),null;this.delteInvalidLines(u);const d=null===(o=u.media)||void 0===o?void 0:o.find((e=>"".concat(e.mid)===r)),l=null===(a=c.media)||void 0===a?void 0:a.find((e=>e.type===d.type)),h=JSON.parse(JSON.stringify(l));h.mid=r,h.direction=Ty.SEND_ONLY,h.type===uI.TRACK_TYPE_AUDIO&&this.portType_===PI.portReduce&&delete h.candidates;const f=this.addSSRC(h,i,n,s);c.media.push(h),ME.modifyBundle(c,r),ME.modifyDirectionWhenAddUser(h,d);const p=yE(c),m=yE(u);return this.logger_.debug(this.module_,"addUser success, offer: ".concat(this.printSdpInfo(m)," answer: ").concat(this.printSdpInfo(p))),{offerSdp:m,answerSdp:p,streamId:f}}async deleteUser(e,t,r,i,n){const s=this.parseSdp(e);if(!s)return this.logger_.error(this.module_,"deleteUser failed,the sdp is invalid : ".concat(e)),null;const o=this.parseSdp(t);if(!o)return this.logger_.error(this.module_,"deleteUser failed,the sdp is invalid : ".concat(t)),null;for(const u of s.media)if(u.ssrcs&&u.ssrcs.some((e=>r.includes(parseInt("".concat(e.id)))))){ME.modifyDirectionWhenDelUser(u,o.media.find((e=>e.mid===u.mid))),u.ssrcs.forEach((e=>{e.value="-"}));const e=i.find((e=>"".concat(e.mid)==="".concat(u.mid)));e&&(e.direction=e.currentDirection===Ty.SEND_RECV||e.currentDirection===Ty.SEND_ONLY?Ty.SEND_ONLY:Ty.INACTIVE,await n(e.receiver))}const a=yE(s),c=yE(o);return this.logger_.debug(this.module_,"deleteUser success, offer: ".concat(this.printSdpInfo(c)," answer: ").concat(this.printSdpInfo(a))),{offerSdp:c,answerSdp:a}}modifySdpByMid(e,t,r,i,n,s){var o,a;const c=this.parseSdp(e);if(!c)return this.logger_.error(this.module_,"modifySdpByMid failed,the sdp is invalid : ".concat(e)),null;const u=null===(o=c.media)||void 0===o?void 0:o.find((e=>"".concat(e.mid)===r)),d=this.addSSRC(u,i,n,s),l=this.parseSdp(t);l||this.logger_.error(this.module_,"modifySdpByMid failed,the sdp is invalid : ".concat(t));const h=null===(a=l.media)||void 0===a?void 0:a.find((e=>"".concat(e.mid)===r));ME.modifyDirectionWhenAddUser(u,h);const f=yE(c),p=yE(l);return this.logger_.debug(this.module_,"modifySdpByMid success, offer: ".concat(this.printSdpInfo(p)," answer: ").concat(this.printSdpInfo(f))),{offerSdp:p,answerSdp:f,streamId:d}}getAllMidsByType(e,t){var r;const i=this.parseSdp(e),n=[];return i?(null===(r=i.media)||void 0===r||r.forEach((e=>{e.type===t&&n.push("".concat(e.mid))})),n):(this.logger_.error(this.module_,"getAllMidsByType failed,the sdp is invalid : ".concat(e)),n)}getIdleTransceiverWithSameSsrc(e,t,r){if(!t||0===t.length)return null;const i=this.parseSdp(e);if(!i)return this.logger_.error(this.module_,"getIdleMidWithSameSsrc failed,the sdp is invalid : ".concat(e)),null;const n=i.media.find((e=>!(!e.ssrcs||0===e.ssrcs.length)&&e.ssrcs[0].id===r));let s;for(const o of t)if(n){if("".concat(n.mid)==="".concat(o.mid)){s=t.splice(t.indexOf(o),1)[0];break}}else{const e=i.media.find((e=>"".concat(e.mid)==="".concat(o.mid)));if(!e.ssrcs||0===e.ssrcs.length){s=t.shift();break}}return s}deleteSSRC(e,t,r,i){if(0===r.length&&!i)return e;this.logger_.info(this.module_,"deleteSSRC ".concat(r,", ").concat(i));const n=this.parseSdp(e),s=this.parseSdp(t);if(!n)return void this.logger_.error(this.module_,"deleteSSRC failed");null==r||r.forEach((e=>{n.media.filter((e=>e.type===uI.TRACK_TYPE_VIDEO)).forEach((t=>{var r;if(null!==(r=t.ssrcs)&&void 0!==r&&r.find((t=>t.id===e))){var i;const e=null===(i=s.media)||void 0===i?void 0:i.find((e=>"".concat(e.mid)==="".concat(t.mid)));ME.modifyDirectionWhenPublish(t,e,!1),t.ssrcs=void 0}}))})),n.media.filter((e=>e.type===uI.TRACK_TYPE_AUDIO)).forEach((e=>{var t;if(null!==(t=e.ssrcs)&&void 0!==t&&t.find((e=>e.id===i))){var r;const t=null===(r=s.media)||void 0===r?void 0:r.find((t=>"".concat(t.mid)==="".concat(e.mid)));ME.modifyDirectionWhenPublish(e,t,!1),e.ssrcs=void 0}}));const o=yE(n),a=yE(s);return this.logger_.debug(this.module_,"deleteSSRC ".concat(r," success, offer: ").concat(this.printSdpInfo(o)," answer: ").concat(this.printSdpInfo(a))),{offerSdp:o,answerSdp:a}}modifyPublishOfferSdp(e,t,r,i,n){this.logger_.debug(this.module_,"modifyPublishOfferSdp start, sdp: ".concat(this.printSdpInfo(e)));const s=this.parseSdp(e),o=this.parseSdp(t);if(!s)return void this.logger_.error(this.module_,"modifyPublishOfferSdp failed, the sdp is invalid: ".concat(e));if(this.deleteUnexpectedMedia(s),i&&i.length>0){let e=this.getAvailableSenderMedia(s,uI.TRACK_TYPE_VIDEO);null==i||i.forEach((t=>{var i;let n=e.find((e=>{var r;return null===(r=e.ssrcs)||void 0===r?void 0:r.find((e=>"".concat(e.id)==="".concat(t)))}));n?e=e.filter((e=>{var r;return!e.ssrcs||(null===(r=e.ssrcs)||void 0===r?void 0:r.find((e=>"".concat(e.id)!=="".concat(t))))})):n=e.shift(),this.transformVideoPayload(n),this.deleteRetransmissionSsrc(n),this.modifyUnifiedMediaSsrc(n,t,r);const s=null===(i=o.media)||void 0===i?void 0:i.find((e=>"".concat(e.mid)==="".concat(n.mid)));ME.modifyDirectionWhenPublish(n,s,!0)}))}s.media.filter((e=>{let{type:t,direction:r}=e;return t===uI.TRACK_TYPE_VIDEO&&r!==Ty.SEND_ONLY&&r!==Ty.SEND_RECV})).forEach((e=>{this.transformVideoPayload(e),this.deleteRetransmissionSsrc(e),e.ssrcs=void 0}));const a=this.getAvailableSenderMedia(s,uI.TRACK_TYPE_AUDIO);if(a&&a.length>0){const e=a[0];if(this.transformAudioPayload(e),this.deleteRetransmissionSsrc(e),n){var c;const t=null===(c=o.media)||void 0===c?void 0:c.find((t=>"".concat(t.mid)==="".concat(e.mid)));this.modifyUnifiedMediaSsrc(e,n,r),ME.modifyDirectionWhenPublish(e,t,!0)}}const u=yE(s),d=yE(o);return this.logger_.debug(this.module_,"modifyPublishOfferSdp success, offerSdp: ".concat(this.printSdpInfo(u),", answerSdp: ").concat(this.printSdpInfo(d))),{offerSdp:u,answerSdp:d}}static modifyDirectionWhenPublish(e,t,r){r?e.direction===Ty.RECV_ONLY?e.direction=Ty.SEND_RECV:e.direction===Ty.INACTIVE&&(e.direction=Ty.SEND_ONLY):e.direction===Ty.SEND_ONLY?e.direction=Ty.INACTIVE:e.direction===Ty.SEND_RECV&&(e.direction=Ty.RECV_ONLY),r?t.direction===Ty.SEND_ONLY?t.direction=Ty.SEND_RECV:t.direction===Ty.INACTIVE&&(t.direction=Ty.RECV_ONLY):t.direction===Ty.SEND_RECV?t.direction=Ty.SEND_ONLY:t.direction===Ty.RECV_ONLY&&(t.direction=Ty.INACTIVE)}generateMatchedAnswerWithOffer(e,t,r){this.logger_.debug(this.module_,"generateCorrespondingRemoteSdpMedia start, sdp: ".concat(this.printSdpInfo(e)));const i=this.parseSdp(e);this.portType_!==PI.portNormal&&ME.modifyBundle(i,t);const n=this.getMedias(i,r);if(!n||0===n.length)return e;const s=JSON.parse(JSON.stringify(n[0]));s.mid=t,delete s.ssrcs,delete s.candidates,s.direction=Ty.INACTIVE,i.media.push(s);const o=yE(i);return this.logger_.debug(this.module_,"generateCorrespondingRemoteSdpMedia success, sdp: ".concat(this.printSdpInfo(o))),o}getBrowserDefaultSsrc(e){const t=this.parseSdp(e),r=this.getMedias(t,uI.TRACK_TYPE_VIDEO),i=this.getMedias(t,uI.TRACK_TYPE_AUDIO),n=[];let s;if(r&&r.length>0&&r.forEach((e=>{e.ssrcs&&e.ssrcs.length>0&&n.push(parseInt(e.ssrcs[0].id.toString()))})),i&&i.length>0)for(const o of i)if(o.ssrcs&&o.ssrcs.length>0){s=parseInt(o.ssrcs[0].id.toString());break}return{videoSsrcs:n,audioSsrc:s}}getLeastMid(e){const t=this.parseSdp(e);if(!t)return void this.logger_.error(this.module_,"getLeastMid failed, the sdp is invalid : ".concat(e));let r;for(const i of t.groups||[])if("BUNDLE"===i.type){const e=(i.mids||"").split(" ");r=e[e.length-1];break}return r}}const DE="PeerConnectionsManager";class xE{constructor(e,t){bu(this,"isFireFox",hT.isFirefox()),this.logger=e,this.stats=t,this.peerConnections=new Map,hT.isOnlySupportUnfiedPlan()?(this.sdpDescMode="unified-plan",this.rtcSdp=new ME(this.logger)):(this.sdpDescMode="plan-b",this.rtcSdp=new PE(this.logger)),this.logger.debug(DE,"ConnectionsManager, SDP mode: ".concat(this.sdpDescMode)),this.setPortType(PI.portReduce),this.mainReceiverPreStatisticMap=new Map,this.auxReceiverPreStatisticMap=new Map}setPortType(e){const t=cI.getParameter(iI)||0;0!==t&&(e=t),e===PI.portNormal&&hT.isOnlySupportUnfiedPlan()&&(e=PI.portReduce),this.portType=e,this.portType===PI.portNormal&&(this.sdpDescMode="plan-b",this.rtcSdp=new PE(this.logger)),this.logger.debug(DE,"ConnectionsManager, portType: ".concat(1===this.portType?"normal":"reduce")),this.rtcSdp.setPortType(this.portType)}getPortType(){return this.portType}setTurnServer(e){this.turnServerConfig=e}isConnectionsExist(){return this.peerConnections.size>0}getReceivers(e){var t;const r=null===(t=this.peerConnections.get(e))||void 0===t?void 0:t.connection;if("plan-b"===this.sdpDescMode)return null==r?void 0:r.getReceivers();const i=[],n=null==r?void 0:r.getTransceivers();if(!n)return null;for(const s of n)s.currentDirection!==Ty.SEND_RECV&&s.currentDirection!==Ty.RECV_ONLY||i.push(s.receiver);return i}getSenders(e){var t;const r=null===(t=this.peerConnections.get(e))||void 0===t?void 0:t.connection;if("plan-b"===this.sdpDescMode)return null==r?void 0:r.getSenders();const i=[],n=null==r?void 0:r.getTransceivers();if(!n)return null;for(const s of n)s.currentDirection!==Ty.SEND_RECV&&s.currentDirection!==Ty.SEND_ONLY||i.push(s.sender);return i}calcChangedStatistic(e,t,r){if(this.mainReceiverPreStatisticMap.has(e)||this.auxReceiverPreStatisticMap.has(e)){const i=this.mainReceiverPreStatisticMap.get(e)||this.auxReceiverPreStatisticMap.get(e);if("number"==typeof t)return Object.prototype.hasOwnProperty.call(i,r[0])?t>=i[r[0]]?t-i[r[0]]:(this.clearReveiverPreStatisticBySsrcLabel(e),t):t;this.doCalcChangedStatisticObject(e,t,i,r)}else if("number"==typeof t)return t}doCalcChangedStatisticObject(e,t,r,i){if(i&&i.length>0){let n=0;for(const e of i)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]>=r[e]?t[e]=t[e]-r[e]:n++);n===i.length&&this.clearReveiverPreStatisticBySsrcLabel(e)}else{let i=0;for(const e in t)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]>=r[e]?t[e]=t[e]-r[e]:i++);i===Object.keys(t).length&&this.clearReveiverPreStatisticBySsrcLabel(e)}}clearReveiverPreStatisticBySsrcLabel(e){this.mainReceiverPreStatisticMap.delete(e)||this.auxReceiverPreStatisticMap.delete(e)}async initConnectionAndSdp(e,t,r){const i=this.createPeerConnection(e),n="main"!==e;let s=await this.createOffer(e,{offerToReceiveAudio:!n,offerToReceiveVideo:!0});if(this.isFireFox){e===dI.STREAM_TYPE_MAIN&&(await i.connection.setLocalDescription({type:"offer",sdp:this.rtcSdp.transformOfferSdp(s.sdp)}),i.connection.addTransceiver("video",{direction:Ty.INACTIVE}),s=await i.connection.createOffer());const t=this.rtcSdp.getBrowserDefaultSsrc(s.sdp);i.videoSendSsrcs=t.videoSsrcs,i.sendSsrcsMapping=new Map,t.videoSsrcs.forEach(((e,t)=>{i.sendSsrcsMapping.set(t,e)})),!n&&t.audioSsrc&&(i.audioSendSsrc=t.audioSsrc,i.sendSsrcsMapping.set(2,t.audioSsrc))}const o=this.rtcSdp.transformOfferSdp(s.sdp);if(await i.connection.setLocalDescription({type:"offer",sdp:o}),await this.iceAddressCollect(i.connection),!this.isFireFox){const t=this.rtcSdp.deleteTcpCandidate(i.connection.localDescription.sdp);this.logger.debug(DE,"setLocalDescription, ".concat(e,"sdp offer: ").concat(this.rtcSdp.printSdpInfo(t))),await i.connection.setLocalDescription({type:"offer",sdp:this.rtcSdp.transformOfferSdp(t)})}n?this.onConnection(i,t.onTrackHandler,!0):this.rtcSdp.containsValidVideoPayload(s.sdp)||r?this.onConnection(i,t.onTrackHandler,!1):(this.destroyPeerConnection(e),this.logger.error(DE,"initConnectionAndSdp, no H264 payload and try createOffer again"),await this.initConnectionAndSdp(e,t,!0))}setSsrcsMapping(e){const t=this.peerConnections.get(dI.STREAM_TYPE_MAIN);t.sendSsrcsMapping&&t.sendSsrcsMapping.size>0&&(t.sendSsrcsMapping.has(0)&&(t.sendSsrcsMapping.set(e.video.sendSsrcBegin,t.sendSsrcsMapping.get(0)),t.sendSsrcsMapping.delete(0)),t.sendSsrcsMapping.has(1)&&(t.sendSsrcsMapping.set(e.video.sendSsrcEnd,t.sendSsrcsMapping.get(1)),t.sendSsrcsMapping.delete(1)),t.sendSsrcsMapping.has(2)&&(t.sendSsrcsMapping.set(e.audio.sendSsrcBegin,t.sendSsrcsMapping.get(2)),t.sendSsrcsMapping.delete(2)));const r=this.peerConnections.get(dI.STREAM_TYPE_AUX);r.sendSsrcsMapping&&r.sendSsrcsMapping.size>0&&r.sendSsrcsMapping.has(0)&&(r.sendSsrcsMapping.set(e.desktopVideo.sendSsrcBegin,r.sendSsrcsMapping.get(0)),r.sendSsrcsMapping.delete(0))}getMappingSsrcs(e,t){if(!e)return;let r;return t||"number"!=typeof e?(r=this.peerConnections.get(t),!r.sendSsrcsMapping||r.sendSsrcsMapping.size<1?e:"number"==typeof e?r.sendSsrcsMapping.has(e)?r.sendSsrcsMapping.get(e):e:e.map((e=>r.sendSsrcsMapping.has(e)?r.sendSsrcsMapping.get(e):e))):(r=this.peerConnections.get(dI.STREAM_TYPE_MAIN),r.sendSsrcsMapping.has(e)?r.sendSsrcsMapping.get(e):(r=this.peerConnections.get(dI.STREAM_TYPE_AUX),r.sendSsrcsMapping.get(e)||e))}async createOffer(e,t){const r=this.peerConnections.get(e).connection,i=await r.createOffer(t);return"plan-b"!==this.sdpDescMode&&r.getTransceivers().forEach((e=>{e.direction=Ty.INACTIVE})),i}iceCandidateListener(e,t){this.logger.info(DE,"iceCandidateListener of ".concat(t)),e.connection.onicecandidate=r=>{var i;r.candidate&&"udp"===r.candidate.protocol&&(this.logger.info(DE,"".concat(t," onicecandidate: ").concat(Qg.shieldIpAddress(null===(i=r.candidate)||void 0===i?void 0:i.candidate))),e.candidate||(e.candidate=[]),e.candidate.push(r.candidate))}}onConnection(e,t,r){e.connection.ontrack=e=>{t(e,r)},e.connection.onconnectionstatechange=()=>{if(this.logger.info(DE,"onconnectionstatechange, ".concat(r?"aux":"main"," connect state is: ").concat(e.connection.connectionState," ;iceConnectionState: ").concat(e.connection.iceConnectionState)),"disconnected"!==e.connection.iceConnectionState)clearTimeout(e.disConnectDelayHandleTimer),e.disConnectDelayHandleTimer=null,"failed"===e.connection.iceConnectionState||"closed"===e.connection.iceConnectionState?(this.stats.setConnectionStatusInfo(0,1),this.logger.info(DE,"connect state failed go iceRestart: ".concat(e.connection.iceConnectionState)),e.connection.createOffer({iceRestart:!0}).then((t=>{e.connection.setLocalDescription({type:"offer",sdp:this.rtcSdp.deleteTcpCandidate(this.rtcSdp.transformOfferSdp(t.sdp))}),e.connection.setRemoteDescription({sdp:e.connection.remoteDescription.sdp,type:"answer"})}))):"connected"===e.connection.iceConnectionState&&(this.logger.info(DE,"connect state connect: ".concat(e.connection.iceConnectionState)),this.stats.setConnectionStatusInfo(1,1));else{if(e.disConnectDelayHandleTimer)return;e.disConnectDelayHandleTimer=setTimeout((()=>{this.logger.info(DE,"disConnect state delay handler, go iceRestart: ".concat(e.connection.iceConnectionState)),this.stats.setConnectionStatusInfo(0,1),e.connection.createOffer({iceRestart:!0}).then((t=>{e.connection.setLocalDescription({type:"offer",sdp:this.rtcSdp.deleteTcpCandidate(this.rtcSdp.transformOfferSdp(t.sdp))}),e.connection.setRemoteDescription({sdp:e.connection.remoteDescription.sdp,type:"answer"})})).finally((()=>{clearTimeout(e.disConnectDelayHandleTimer),e.disConnectDelayHandleTimer=null}))}),5e3)}}}async iceAddressCollect(e){await new Promise((t=>{let r=null;const i=()=>{"complete"===e.iceGatheringState&&(clearTimeout(r),this.logger.info(DE,"ICE collect complete"),e.removeEventListener("icegatheringstatechange",i),t())};e.addEventListener("icegatheringstatechange",i),r=setTimeout((()=>{this.logger.error(DE,"ICE collect fail"),clearTimeout(r),e.removeEventListener("icegatheringstatechange",i),t()}),6e3)}))}createPeerConnection(e){const t={rtcpMuxPolicy:this.portType===PI.portReduce?"require":"negotiate",bundlePolicy:this.portType===PI.portReduce?"max-bundle":"balanced"},r=[];if(this.turnServerConfig){for(const e of this.turnServerConfig.turnServers)r.push("turn:".concat(e,":").concat(this.turnServerConfig.udpPort||3478,"?transport=udp"));t.iceServers=[{urls:r,username:this.turnServerConfig.userName,credential:this.turnServerConfig.credential}],t.iceTransportPolicy="relay"}"plan-b"===this.sdpDescMode&&(t.sdpSemantics="plan-b");const i=new RTCPeerConnection(t);var n;this.peerConnections.has(e)&&(null===(n=this.peerConnections.get(e).connection)||void 0===n||n.close());const s={connection:i};return this.peerConnections.set(e,s),this.iceCandidateListener(s,e),s}destroyPeerConnection(e,t){const r=this.peerConnections.get(e);r&&(clearTimeout(r.disConnectDelayHandleTimer),"closed"!==r.connection.signalingState&&(null==t||t.forEach((e=>r.connection.removeTrack(e))),r.connection.close()),"main"===e?this.mainReceiverPreStatisticMap.clear():this.auxReceiverPreStatisticMap.clear(),this.peerConnections.delete(e))}modifySdpCandidates(e){const t=this.peerConnections.get(e);let r=null;return t&&(r="main"===e?this.rtcSdp.modifySdpCandidates(t.connection.localDescription.sdp,t.candidate,t.videoSendSsrcs,t.audioSendSsrc):this.rtcSdp.modifyAuxSdpCandidates(t.connection.localDescription.sdp,t.candidate,t.videoSendSsrcs)),r}async setLocalDescriptionShim(e,t){let r;!this.isFireFox&&t||(r=(await e.createOffer()).sdp),await e.setLocalDescription({type:"offer",sdp:this.rtcSdp.transformOfferSdp(r||t)})}async handleAnswerSdpFromServer(e,t,r){const i=this.peerConnections.get(e).connection,n=this.rtcSdp.transformAnswerSdp(t,i.localDescription.sdp);let s;this.logger.debug(DE,"handleAnswerSdpFromServer, ".concat(e," sdp answer: ").concat(this.rtcSdp.printSdpInfo(n))),s=r?await r(n):{answerSdp:n},s.offerSdp&&s.offerSdp!==i.localDescription.sdp&&await this.setLocalDescriptionShim(i,s.offerSdp);try{await i.setRemoteDescription({type:"answer",sdp:s.answerSdp})}catch(tb){throw this.logger.error(DE,"setRemoteDescription error, answer sdp invalid or offer sdp invalid"),new Eu(ou.RTC_ERR_CODE_ANSWER_SDP_INVALID,(null==tb?void 0:tb.message)||"setRemoteDescription error, answer sdp invalid or offer sdp invalid")}}getSfuInfoFromSdp(e,t){return this.rtcSdp.getSfuInfo(e,t)}async generateAndSetOfferSdpByHandler(e,t){const r=this.peerConnections.get(e).connection;let i;i=t?await t(r.localDescription.sdp):r.localDescription.sdp,await this.setLocalDescriptionShim(r,i)}async generateAndSetAnswerSdpByHandler(e,t){const r=this.peerConnections.get(e).connection;let i;i=t?(await t(r.remoteDescription.sdp)).answerSdp:r.remoteDescription.sdp,await r.setRemoteDescription({type:"answer",sdp:i})}async deleteUser(e,t,r){const i=this.peerConnections.get(e).connection,n=i.remoteDescription.sdp;let s={offerSdp:i.localDescription.sdp,answerSdp:n};if("plan-b"===this.sdpDescMode)s.answerSdp=this.rtcSdp.deleteUser(s.answerSdp,t,r);else{const n=i.getTransceivers();t&&t.length>0&&(s=await this.rtcSdp.deleteUser(s.answerSdp,s.offerSdp,t,n,(()=>this.recordCurrentReceiverStatistic(e)))),r&&r.length>0&&(s=await this.rtcSdp.deleteUser(s.answerSdp,s.offerSdp,r,n,(()=>this.recordCurrentReceiverStatistic(e))))}await this.setLocalDescriptionShim(i,s.offerSdp),await i.setRemoteDescription({type:"answer",sdp:s.answerSdp})}async recordCurrentReceiverStatistic(e){const t=pI.getLatestReport("roomId",e);t&&t.forEach(((t,r)=>{(this.isFireFox||/RTCInboundRTP(Video|Audio)Stream_.*/gi.test(r))&&this["main"===e?"mainReceiverPreStatisticMap":"auxReceiverPreStatisticMap"].set(r,t)}))}getAllIdleReceiverTransceivers(e,t,r){const i=e.getTransceivers(),n=this.rtcSdp.getAllMidsByType(r,t);return i.filter((e=>n.includes("".concat(e.mid))&&e.currentDirection!==Ty.SEND_RECV&&e.currentDirection!==Ty.RECV_ONLY))}getIdleSendTransceiver(e,t,r){const i=e.getTransceivers(),n=this.rtcSdp.getAllMidsByType(r,t);return i.find((e=>n.includes("".concat(e.mid))&&e.currentDirection!==Ty.SEND_ONLY&&e.currentDirection!==Ty.SEND_RECV))}async addTrack(e,t,r){const i=this.peerConnections.get(e).connection;if("plan-b"===this.sdpDescMode)return i.addTrack(t,r);const n=i.localDescription.sdp;let s=this.getIdleSendTransceiver(i,"audio"===t.kind?uI.TRACK_TYPE_AUDIO:uI.TRACK_TYPE_VIDEO,n);if(s){await s.sender.replaceTrack(t),s.direction=s.currentDirection===Ty.RECV_ONLY?Ty.SEND_RECV:Ty.SEND_ONLY;const e=this.rtcSdp.modifyAnswerDirection(i.remoteDescription.sdp,s.mid);await this.setLocalDescriptionShim(i),await i.setRemoteDescription({type:"answer",sdp:e})}else this.logger.info(DE,"addTrack, no avaliable sender, addTranscevier"),s=await this.addTransceiver(i,uI.TRACK_TYPE_VIDEO),await s.sender.replaceTrack(t),s.direction=s.currentDirection===Ty.RECV_ONLY?Ty.SEND_RECV:Ty.SEND_ONLY;return s.sender}removeTrack(e,t){this.peerConnections.get(e).connection.removeTrack(t)}async modifyPublishOfferSdp(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const o=this.peerConnections.get(e).connection;let a,c,u=(await o.createOffer()).sdp;return(n&&n.length>0||s)&&("plan-b"===this.sdpDescMode?u=this.rtcSdp.deleteSSRC(u,n,s):a=this.rtcSdp.deleteSSRC(u,o.remoteDescription.sdp,this.getMappingSsrcs(n,e),this.getMappingSsrcs(s,e))),"plan-b"===this.sdpDescMode?u=this.rtcSdp.modifyPublishOfferSdp(u,r,i):a=this.rtcSdp.modifyPublishOfferSdp(a?a.offerSdp:u,a?a.answerSdp:o.remoteDescription.sdp,t,this.getMappingSsrcs(r,e),this.getMappingSsrcs(i,e)),"plan-b"===this.sdpDescMode?(await o.setLocalDescription({type:"offer",sdp:u}),await o.setRemoteDescription(o.remoteDescription),c=u):(await this.setLocalDescriptionShim(o,a.offerSdp),await o.setRemoteDescription({type:"answer",sdp:a.answerSdp}),c=a.offerSdp),c}async addTopAudioUserBatch(e,t,r,i){const n=this.peerConnections.get("main").connection;let s,o={offerSdp:n.localDescription.sdp,answerSdp:e};"plan-b"!==this.sdpDescMode&&(s=this.getAllIdleReceiverTransceivers(n,uI.TRACK_TYPE_AUDIO,o.answerSdp));for(let a=0;a<r;a++){const e=t+a,r="WebAudio".concat(a)+this.rtcSdp.generateSsrcMslabel(),c={videoSsrc:null,audioSsrc:e};if("plan-b"===this.sdpDescMode)o=this.rtcSdp.addUser(o.answerSdp,r,null,c);else{let t=this.rtcSdp.getIdleTransceiverWithSameSsrc(o.answerSdp,s,e);t||(t=await this.addTransceiver(n,uI.TRACK_TYPE_AUDIO,o)),t.direction=t.currentDirection===Ty.SEND_ONLY?Ty.SEND_RECV:Ty.RECV_ONLY,o=this.rtcSdp.modifySdpByMid(o.answerSdp,o.offerSdp,t.mid,r,null,e),await this.setLocalDescriptionShim(n,o.offerSdp)}i(o.streamId,e)}return o}async addUserBatch(e,t){if(t.size<1)return void this.logger.debug(DE,"addUserBatch interrupted for ssrcInfos is null");const r=this.peerConnections.get(e).connection,i=r.remoteDescription.sdp,n=r.localDescription.sdp;let s,o,a={offerSdp:n,answerSdp:i};"plan-b"!==this.sdpDescMode&&(s=this.getAllIdleReceiverTransceivers(r,uI.TRACK_TYPE_AUDIO,i),o=this.getAllIdleReceiverTransceivers(r,uI.TRACK_TYPE_VIDEO,i));for(const[c,u]of t)for(const e of u){if("plan-b"===this.sdpDescMode)a=this.rtcSdp.addUser(a.answerSdp,c,e.streamId,{videoSsrc:e.videoSsrc,audioSsrc:e.audioSsrc}),a.offerSdp=n;else if(e.audioSsrc){let t=this.rtcSdp.getIdleTransceiverWithSameSsrc(a.answerSdp,s,e.audioSsrc);t||(t=await this.addTransceiver(r,uI.TRACK_TYPE_AUDIO,a)),t.direction=t.currentDirection===Ty.SEND_ONLY?Ty.SEND_RECV:Ty.RECV_ONLY,a=this.rtcSdp.modifySdpByMid(a.answerSdp,a.offerSdp,t.mid,c,e.streamId,e.audioSsrc)}else if(e.videoSsrc){let t=this.rtcSdp.getIdleTransceiverWithSameSsrc(a.answerSdp,o,e.videoSsrc);if(t){if(this.isFireFox){t.receiver.track.enabled=!1;const e=setTimeout((()=>{clearTimeout(e),t.receiver.track.enabled=!0}),300)}}else t=await this.addTransceiver(r,uI.TRACK_TYPE_VIDEO,a);t.direction=t.currentDirection===Ty.SEND_ONLY?Ty.SEND_RECV:Ty.RECV_ONLY,a=this.rtcSdp.modifySdpByMid(a.answerSdp,a.offerSdp,t.mid,c,e.streamId,e.videoSsrc)}await this.setLocalDescriptionShim(r,a.offerSdp),await r.setRemoteDescription({type:"answer",sdp:a.answerSdp})}}async addTransceiver(e,t,r){e.addTransceiver(t,{direction:Ty.INACTIVE});const i=await e.createOffer();await e.setLocalDescription(i);const n=this.rtcSdp.getLeastMid(i.sdp),s=this.rtcSdp.generateMatchedAnswerWithOffer((null==r?void 0:r.answerSdp)||e.remoteDescription.sdp,n,t);return r&&(r.offerSdp=i.sdp,r.answerSdp=s),await e.setRemoteDescription({type:"answer",sdp:s}),e.getTransceivers().find((e=>"".concat(e.mid)===n))}getConnection(e){var t;return this.isConnectionsExist()&&this.peerConnections.get(e)?null===(t=this.peerConnections.get(e))||void 0===t?void 0:t.connection:null}getConnectionRTT(){let e=0;if(!this.isConnectionsExist())return e;const t=pI.getLatestReport("roomId",dI.STREAM_TYPE_MAIN);if(t)try{for(const r of t.values())if("candidate-pair"==r.type){e=Object.prototype.hasOwnProperty.call(r,"currentRoundTripTime")?1e3*(r.currentRoundTripTime||0):Math.abs((r.lastPacketReceivedTimestamp||0)-(r.lastPacketSentTimestamp||0));break}}catch(tb){this.logger.error(DE,"getConnectionRTT failed",tb)}return e}getICETransportStat(e){if(!e)throw this.logger.error(DE,"getICETransportStat, pcType is null"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"pcType is null");const t=pI.getLatestReport("roomId",e);if(!t)return null;try{let e;for(const r of t.values())if("candidate-pair"==r.type){e={currentRoundTripTime:r.currentRoundTripTime||0,availableOutgoingBitrate:r.availableOutgoingBitrate||0,bytesSent:r.bytesSent||0,bytesReceived:r.bytesReceived||0};break}return e}catch(tb){return this.logger.error(DE,"getICETransportStat failed",tb),null}}getStats(e,t,r,i){if(this.isFireFox){let n;for(const s of e.values())if("".concat(s.type,"-").concat(s.mediaType)===r&&s.ssrc===this.getMappingSsrcs(t,i)){n=s;break}return n}const n="".concat(r,"_").concat(t);if(e.has(n))return e.get(n)}}var NE={exports:{}};!function(e,t){self,e.exports=function(){var e={d:function(t,r){for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{GrsBaseInfo:function(){return O},GrsClient:function(){return M},GrsErrorCode:function(){return o},Logger:function(){return l}});var r=function(e){return"string"!=typeof e||""==e},i=function(e){return void 0===e||null==e||"{}"==JSON.stringify(e)},n=function(e){return!(void 0!==e&&e instanceof Array&&"[]"!=JSON.stringify(e))},s=function(e){if("string"!=typeof e||""==e)return{};try{var t=JSON.parse(e);return void 0===t||null==t?{}:t}catch(e){return{}}},o={ERR_OK:0,ERR_INTERNAL_ERROR:1,ERR_INVALID_PARAM:2,ERR_INIT:3,GRS_SET_ROUTER_DIR:4,GRS_SET_SYSTEM_INFO:5,GRS_SERVICE_CONFIGURE_NO_FILE:6,GRS_SERVICE_CONFIGURE_READ_ERROR:7,GRS_SET_CA_FILE:8,GRS_SERVICE_CONFIGURE_PARSE_ERROR:9,GRS_SERVICE_CONFIGURE_PARSE_VALUE_ERROR:10,GRS_ROUTER_CONFIGURE_EMPTY:11,GRS_ROUTER_APP_CONFIGURE_READ_ERROR:12,GRS_ROUTER_SDK_CONFIGURE_READ_ERROR:13,GRS_ROUTER_CONFIGURE_PARSE_VALUE_ERROR:14,GRS_ROUTER_SERVER_NAME_EMPTY:15,GRS_ROUTER_BY_EMPTY:16,GRS_APK_ROUTER_NO_APPLICATION:17,GRS_NOT_FIND:18,GRS_NOT_FIND_APPLICATION:19,GRS_NOT_FIND_SERVICE_LIST:20,GRS_NOT_FIND_SERVING_COUNTRY_GROUP:21,GRS_NOT_FIND_SERVICE:22,GRS_NOT_FIND_ADDRESS:23,GRS_NOT_FIND_COUNTRY:24};function a(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function u(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,i;return t=e,i=[{key:"setExtLogger",value:function(t,r,i){void 0!==t&&"function"==typeof t&&(e.extLogger=t),e.logLevel=r,e.isDebug=i}},{key:"v",value:function(){arguments.length<e.argsSize||(arguments[0]="[Verbose]"+e.TAG_NETWORKKIT_PRE+arguments[0],e.println(e.VERBOSE,arguments))}},{key:"d",value:function(){arguments.length<e.argsSize||(arguments[0]="[Debug]"+e.TAG_NETWORKKIT_PRE+arguments[0],e.println(e.DEBUG,arguments))}},{key:"i",value:function(){arguments.length<e.argsSize||(arguments[0]="[Info]"+e.TAG_NETWORKKIT_PRE+arguments[0],e.println(e.INFO,arguments))}},{key:"w",value:function(){arguments.length<e.argsSize||(arguments[0]="[Warm]"+e.TAG_NETWORKKIT_PRE+arguments[0],e.println(e.WARN,arguments))}},{key:"e",value:function(){arguments.length<e.argsSize||(arguments[0]="[Error]"+e.TAG_NETWORKKIT_PRE+arguments[0],e.println(e.ERROR,arguments))}},{key:"println",value:function(t,r){if((!(t<e.DEBUG)||e.isDebug)&&(e.isDebug||!(t<e.logLevel))&&void 0!==e.extLogger&&"function"==typeof e.extLogger){var i=[].slice.call(r);e.extLogger.apply(e,a(i))}}}],(r=null)&&u(t.prototype,r),i&&u(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();d(l,"TAG_NETWORKKIT_PRE","NetworkKit_"),d(l,"extLogger",void 0),d(l,"isDebug",!1),d(l,"VERBOSE",2),d(l,"DEBUG",3),d(l,"INFO",4),d(l,"WARN",5),d(l,"ERROR",6),d(l,"logLevel",l.INFO),d(l,"argsSize",2);var h=function(e,t,i,s,o,a,c,u){var d=e.name,l=t;if(n(e.countryOrAreaGroups)||(l=e.countryOrAreaGroups),n(l))i[d]="GRS_NOT_FIND_SERVING_COUNTRY_GROUP";else{var h=e.routeBy;if(r(h))i[d]="GRS_ROUTER_BY_EMPTY";else if("unconditional"!==h){var m=f(h,o,a,c,u);if(r(m))i[d]="GRS_NOT_FIND_COUNTRY";else{var _=p(l,m);if(r(_))i[d]="GRS_COUNTRY_CODE_NOT_IN_GROUP";else{var g=e.servings,S=!1;for(var v in g)if(g[v].countryOrAreaGroup===_){s[d]=g[v].addresses,S=!0;break}S||(i[d]="GRS_NOT_FIND_ADDRESS")}}}else s[d]=e.servings[0].addresses}},f=function(e,t,i,n,s){var o="",a=e.split(">");for(var c in a){if("ser_country"===a[c]&&!r(t)){o=t;break}if("reg_country"===a[c]&&!r(i)){o=i;break}if("issue_country"===a[c]&&!r(n)){o=n;break}if("geo_ip"===a[c]&&!r(s)){o=s;break}}return o},p=function(e,t){var r="";for(var i in e)if(e[i].countriesOrAreas.includes(t)){r=e[i].id;break}return r},m=function(e,t){var r={};if(i(e))return r;var n=e.errorList;if(!i(n)&&t in n)return r.results=n[t],r.status="failure",r;var s=e.services;return!i(s)&&t in s?(r.results=s[t],r.status="success",r):(r.results="GRS_NOT_FIND_SERVICE",r.status="notFindService",r)},_=function(e,t,r,i){var n="",s=m(e,r);if("success"===s.status&&i in s.results)return l.i("getGrsUrl","Return The Server Cached Data"),s.results[i];l.i("getGrsUrl","Cannot find "+r+"("+i+") in serverUrlInfo: ",JSON.stringify(e));var o=m(t,r);return"success"===o.status&&i in o.results?(l.i("getGrsUrl","Return The Local JSON Data"),n=o.results[i]):l.i("getGrsUrl","Cannot find "+r+"("+i+") in localUrlInfo: ",JSON.stringify(t)),n},g=function(e,t,r){var i={},n=m(e,r);if("success"===n.status)return l.i("getGrsUrl","Return The Server Cached Data"),n.results;l.i("getGrsUrl","Cannot find "+r+" in serverUrlInfo: ",JSON.stringify(e));var s=m(t,r);return"success"===s.status?i=s.results:l.i("getGrsUrl","Cannot find "+r+" in localUrlInfo: ",JSON.stringify(t)),i};function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){R(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function R(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e){return function(e){if(Array.isArray(e))return I(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return I(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?I(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var y=function(e,t,r,i){return new Promise((function(n,s){var o={};(function(e,t){return new Promise((function(r,i){var n=setTimeout((function(){i(new Error("TIMEOUT"))}),t);e.then((function(e){clearTimeout(n),r(e)})).catch((function(e){clearTimeout(n),i(e)}))}))})(fetch(e,{method:"POST",mode:"cors",cache:"no-cache",body:JSON.stringify(t),headers:r,redirect:"follow",referrer:"no-referrer"}),i).then((function(e){o.header=T(e.headers).reduce((function(e,t){return v(v({},e),{},R({},t[0],t[1]))}),{}),o.statusCode=e.status,o.success=!0,o["cache-time"]=(new Date).getTime(),e.json().then((function(e){o.data=e,n(o)}),(function(e){o.success=!1,o.header["cache-control"]="private,max-age=300",o.data=e,o["cache-time"]=(new Date).getTime(),s(o)}))})).catch((function(e){var t={};o.success=!1,t["cache-control"]="private,max-age=300",o.data=e,o.header=t,o["cache-time"]=(new Date).getTime(),s(o)}))}))},E=function(e){return new Promise((function(t,n){var o=e.uniqueCode(),a=s(localStorage.getItem(o)),c="&";if(l.i("getGrsDataFromServerOrCache","Get uniqueCode key From Cache: key(%s): ",o,a),i(a)||r(JSON.stringify(a)))return l.i("getGrsDataFromServerOrCache","The New GrsClient Not any Cache, start to Query GRS Server"),void b(t,e,a,o,c);var u=a.header["cache-control"].split("=");if(a["cache-time"]+1e3*u[1]>=(new Date).getTime())return l.i("getGrsDataFromServerOrCache","During The Suppression Or The Cache Not Expired"),void t(a);c=r(a.header.ETag)?"&":a.header.ETag,b(t,e,a,o,c)}))},b=function(e,t,n,s,o){C(t,o).then((function(t){if(l.d("getGrsDataFromServerOrCache","handleGrsDataFromServer: ",t),t.success){if(200===t.statusCode)return localStorage.setItem(s,JSON.stringify(t)),void e(t);if(304===t.statusCode)return n["cache-time"]=(new Date).getTime(),n.header=t.header,localStorage.setItem(s,JSON.stringify(n)),void e(n);if(503===t.statusCode)return void function(e,t,n,s){i(e)||r(e)?(t.header["cache-control"]="privateï¼max-age="+t.header["Retry-After"],localStorage.setItem(n,JSON.stringify(t)),s(t)):(e["cache-time"]=(new Date).getTime(),e.header["cache-control"]="privateï¼max-age="+t.header["Retry-After"],localStorage.setItem(n,JSON.stringify(e)),s(e))}(n,t,s,e);i(n)||r(n)?(t.header["cache-control"]="privateï¼max-age=300",localStorage.setItem(s,JSON.stringify(t)),e(t)):(n["cache-time"]=(new Date).getTime(),n.header["cache-control"]="privateï¼max-age=300",localStorage.setItem(s,JSON.stringify(n)),e(n))}})).catch((function(t){l.i("getGrsDataFromServerOrCache","handleGrsDataFromServer catch: ",t),i(n)||r(n)?(localStorage.setItem(s,JSON.stringify(t)),e(t)):(n["cache-time"]=(new Date).getTime(),n.header["cache-control"]="privateï¼max-age=300",localStorage.setItem(s,JSON.stringify(n)),e(n))}))},C=function(e,t){var r=e.getServerConfig().grs_server.grs_query_timeout,i=e.getServerConfig().grs_server.grs_base_url,n=e.getServerConfig().grs_server.grs_query_endpoint,s=[];for(var o in i)s.push(i[o]+n+"?"+e.getGrsReqParamJoint());return function(e,t,r,i){l.i("post","urls: ",e);var n=[];return e.forEach((function(e){n.push(y(e,t,r,1e3*i))})),Promise.race(n)}(s,e._servicList,{"Content-Type":"application/json;charset=UTF-8","User-Agent":e.getUserAgent(),"If-None-Match":t},r)};function A(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function w(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var O=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.packageName="",this.versionName="",this.productName="",this.productLine="",this.appName="",this.serCountry="",this.regCountry="",this.issueCountry="",this.countrySource="",this.serverConfig={},this.apkRouteConfig={},this.sdkRouteConfig={},this._servicList={services:[]},this._cacheControl=3600,this._serviceName="no_service_name",this._keyName="no_key_name"}var t,n;return t=e,(n=[{key:"setPackageName",value:function(e){this.packageName=e}},{key:"getPackageName",value:function(){return this.packageName}},{key:"setVersionName",value:function(e){this.versionName=e}},{key:"getVersionName",value:function(){return this.versionName}},{key:"setProductName",value:function(e){this.productName=e}},{key:"setProductLine",value:function(e){this.productLine=e}},{key:"getProductLine",value:function(){return this.productLine}},{key:"setAppName",value:function(e){this.appName=e}},{key:"getAppName",value:function(){return this.appName}},{key:"setSerCountry",value:function(e){this.serCountry=e.toUpperCase()}},{key:"getSerCountry",value:function(){return this.serCountry}},{key:"setRegCountry",value:function(e){this.regCountry=e.toUpperCase()}},{key:"getRegCountry",value:function(){return this.regCountry}},{key:"setIssueCountry",value:function(e){this.issueCountry=e.toUpperCase()}},{key:"getIssueCountry",value:function(){return this.issueCountry}},{key:"setCountrySource",value:function(e){this.countrySource=e}},{key:"getCountrySource",value:function(){return this.countrySource}},{key:"setServerConfig",value:function(e){this.serverConfig=e}},{key:"getServerConfig",value:function(){return this.serverConfig}},{key:"setApkRouteConfig",value:function(e){if(!i(e)){if(!e.hasOwnProperty("applications")||!e.hasOwnProperty("services")||!e.hasOwnProperty("countryOrAreaGroups"))return;if(e.applications.length<1)return;this.apkRouteConfig=e,this.appName=e.applications[0].name,e.applications[0].hasOwnProperty("cacheControl")&&(this._cacheControl=e.applications[0].cacheControl);var t=new Set([]),r=e.applications[0].customservices;for(var n in r)t.add(r[n].name);var s=e.services;for(var o in s)t.add(s[o].name);var a=e.applications[0].services;for(var c in a)t.add(a[c]);for(var u in this._servicList.services)t.add(this._servicList.services[u]);this._servicList.services=A(t).sort()}}},{key:"getApkRouteConfig",value:function(){return this.apkRouteConfig}},{key:"setSdkRouteConfig",value:function(e){this.sdkRouteConfig=e;var t=new Set([]);for(var r in e){var i=e[r].services;for(var n in i)t.add(i[n].name)}for(var s in this._servicList.services)t.add(this._servicList.services[s]);this._servicList.services=A(t).sort()}},{key:"getSdkRouteConfig",value:function(){return this.sdkRouteConfig}},{key:"setServiceKeyName",value:function(e,t){this._serviceName=e,this._keyName=t}},{key:"hashCode",value:function(){for(var e=0,t=this.packageName+JSON.stringify(this.serverConfig.grs_server.grs_base_url)+JSON.stringify(this._servicList),r=0;r<t.length;r++)e=Math.imul(31,e)+t.charCodeAt(r)|0;return e}},{key:"uniqueCode",value:function(){return this.appName+"#"+this.serCountry+"#"+this.regCountry+"#"+this.issueCountry+"#"+this.hashCode()}},{key:"getGrsReqParamJoint",value:function(){var e="";return r(this.appName)||(e+="app_name="+this.appName),r(this.versionName)||(r(e)||(e+="&"),e+="app_version="+this.versionName),r(this.packageName)||(r(e)||(e+="&"),e+="package_name="+this.packageName),r(this.serCountry)||(r(e)||(e+="&"),e+="ser_country="+this.serCountry),r(this.regCountry)||(r(e)||(e+="&"),e+="reg_country="+this.regCountry),r(this.issueCountry)||(r(e)||(e+="&"),e+="issue_country="+this.issueCountry),r(this.countrySource)||(r(e)||(e+="&"),e+="country_source="+this.countrySource),e}},{key:"getUserAgent",value:function(){var e,t;try{e=((t=navigator.userAgent.toLowerCase()).indexOf("msie")>0?t.match(/msie [\d.]+;/gi):t.indexOf("firefox")>0?t.match(/firefox\/[\d.]+/gi):t.indexOf("chrome")>0?t.match(/chrome\/[\d.]+/gi):t.indexOf("safari")>0&&t.indexOf("chrome")<0?t.match(/safari\/[\d.]+/gi):void 0)[0].replace("/","; ")}catch(t){e="unknown; web-browser"}return this.packageName+"/"+this.versionName+" ("+e+"; NA) network-grs-web/5.0.9.300 "+this.serviceName}}])&&w(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function P(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var M=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._grsBaseInfo=t,this._localUrlInfo={},this._serverUrlInfo={},this._cacheExpirationTime=0,this._isLocalInit=!1}var t,a;return t=e,(a=[{key:"initLocal",value:function(){if(!(this._grsBaseInfo instanceof O))return l.i("GrsClient","new GrsClient(grsBaseInfo): the grsBaseInfo not instanceof GrsBaseInfo",this._grsBaseInfo),o.ERR_INVALID_PARAM;l.i("GrsClient","entry initLocal with GrsBaseInfo: ",this._grsBaseInfo);var e,t=(e=this._grsBaseInfo,r(e.packageName)||r(e.versionName)||r(e.productName)||r(e.productLine)?(l.i("checkGrsBaseInfo","The packageName, versionName, productName, productLine Must Be Set",e),o.ERR_INVALID_PARAM):i(e.getServerConfig())?(l.i("checkGrsBaseInfo","The getServerConfig Must Be Set",e),o.GRS_SERVICE_CONFIGURE_NO_FILE):r(e.getAppName())&&i(e.getSdkRouteConfig())?(l.i("checkGrsBaseInfo","Either set the appName or Give the contents of the SDK file",e),o.ERR_INVALID_PARAM):o.ERR_OK);if(t!==o.ERR_OK)return t;var a=function(e,t){var r=[],s=[],a=[],c=[],u={status:o.ERR_OK};if(!i(e)){if(!e.hasOwnProperty("applications")||!e.hasOwnProperty("services")||!e.hasOwnProperty("countryOrAreaGroups"))return l.e("getAllServicesFromLocal","The Apk Route Config File Must has Property: applications, services and countryOrAreaGroups"),u.status=o.GRS_APK_ROUTER_NO_APPLICATION,u.message="GRS_APK_ROUTER_NO_APPLICATION",u;a=e.applications[0].services;var d=e.applications[0].customservices;for(var h in d)s.includes(d[h].name)||(s.push(d[h].name),r.push(d[h]));var f=e.services;for(var p in f)s.includes(f[p].name)||(s.push(f[p].name),r.push(f[p]));c=e.countryOrAreaGroups}if(!i(t))for(var m in t){if(!t[m].hasOwnProperty("services")||!t[m].hasOwnProperty("countryOrAreaGroups"))return l.e("getAllServicesFromLocal","The Sdk Route Config File Must has Property:  services and countryOrAreaGroups"),u.status=o.GRS_ROUTER_SDK_CONFIGURE_READ_ERROR,u.message="GRS_ROUTER_SDK_CONFIGURE_READ_ERROR",u;n(c)&&(c=t[m].countryOrAreaGroups);var _=t[m].services;for(var g in _)s.includes(_[g].name)||(s.push(_[g].name),r.push(_[g]))}for(var S in a)s.includes(a[S])||s.push(a[S]);return u.services=r,u.countryOrAreaGroups=c,u}(this._grsBaseInfo.getApkRouteConfig(),this._grsBaseInfo.getSdkRouteConfig());if(a.status!=o.ERR_OK)return a.status;this._localUrlInfo=function(e,t,r,n,s,o){var a={},c={};for(var u in e){var d=e[u];h(d,t,a,c,r,n,s,o)}var l={};return i(a)||(l.errorList=a),i(c)||(l.services=c),l}(a.services,a.countryOrAreaGroups,this._grsBaseInfo.getSerCountry(),this._grsBaseInfo.getRegCountry(),this._grsBaseInfo.getIssueCountry(),"");var c=this._grsBaseInfo.uniqueCode(),u=s(localStorage.getItem(c));if(void 0!==u&&null!=u&&"{}"!=JSON.stringify(u)&&u.success&&(200==u.statusCode||304==u.statusCode)){this._serverUrlInfo=u.data;var d=u.header["cache-control"].split("=");this._cacheExpirationTime=u["cache-time"]+1e3*d[1]}return this._isLocalInit=!0,o.ERR_OK}},{key:"syncGetGrsUrl",value:function(e,t){var i=this;return this._grsBaseInfo.setServiceKeyName(e,t),new Promise((function(n,s){if(i._isLocalInit){var o=new Date;if(i._cacheExpirationTime<o.getTime())return l.w("GrsClient","SyncGetGrsUrl: The cache has expired. Request To The server asynchronously"),void E(i._grsBaseInfo).then((function(o){l.i("GrsClient","data: ",o),i._serverUrlInfo=o.data;var a=o.header["cache-control"].split("=");i._cacheExpirationTime=o["cache-time"]+1e3*a[1],o.success&&200===o.statusCode?l.i("GrsClient","Success:  Synchronization of GRS server data",o):l.i("GrsClient","Failure:  Synchronization of GRS server data",o);var c=_(i._serverUrlInfo,i._localUrlInfo,e,t);r(c)?s(new Error("Cannot Get GRS url from serverUrlInfo and localUrlInfo")):n(c)}));var a=_(i._serverUrlInfo,i._localUrlInfo,e,t);r(a)?s(new Error("Cannot Get GRS url from serverUrlInfo and localUrlInfo")):n(a)}else s(new Error("Init() must be Success called before calling the SyncGetGrsUrl()"))}))}},{key:"syncGetGrsUrls",value:function(e){var t=this;return this._grsBaseInfo.setServiceKeyName(e,"no_key_name"),new Promise((function(r,n){if(t._isLocalInit){var s=new Date;if(t._cacheExpirationTime<s.getTime())return l.w("GrsClient","SyncGetGrsUrls: The cache has expired. Request To The server asynchronously"),void E(t._grsBaseInfo).then((function(s){t._serverUrlInfo=s.data;var o=s.header["cache-control"].split("=");t._cacheExpirationTime=s["cache-time"]+1e3*o[1],s.success&&200===s.statusCode?l.i("GrsClient","Success:  Synchronization of GRS server data",s):l.i("GrsClient","Failure:  Synchronization of GRS server data",s);var a=g(t._serverUrlInfo,t._localUrlInfo,e);i(a)?n(new Error("Cannot Get GRS urls from serverUrlInfo and localUrlInfo")):r(a)}));var o=g(t._serverUrlInfo,t._localUrlInfo,e);i(o)?n(new Error("Cannot Get GRS url from serverUrlInfo and localUrlInfo")):r(o)}else n(new Error("Init() must be Success called before calling the SyncGetGrsUrls()"))}))}},{key:"asyncGetGrsUrl",value:function(e,t,r,i){this.syncGetGrsUrl(e,t).then((function(e){r(e)})).catch((function(e){i(e)}))}},{key:"asyncGetGrsUrls",value:function(e,t,r){this.syncGetGrsUrls(e).then((function(e){t(e)})).catch((function(e){r(e)}))}}])&&P(t.prototype,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();return t}()}(NE);const UE={grs_server:{grs_base_url:["https://grs-pub.platform.dbankcloud.com","https://grs-pub.platform.dbankcloud.cn"],grs_query_endpoint:"/grs/2.0/router",grs_query_timeout:2}},LE="access",VE="com.huawei.cloud.hianalytics.aspg",BE="com.huawei.cloud.videortn";class YE{constructor(e){this.logger=e,this.edgeNodeDomains=new Map}async getAccessInfo(e,t){this.edgeNodeDomains.clear();const r={id:((null==t?void 0:t.length)||0)+1,domain:"GRS",start_ms:Hg.getCurrentTimestamp(),delay_ms:0,stepName:"getAccessInfo",rspCode:"",errMsg:""};try{this.grsClient||(this.grsClient=this.createGrsClient(e));const t=cI.getParameter(nI),i=await this.getUrlByGrs(BE,e,t),n=await this.getUrlByGrs(VE,e,t);eI.setReportServer(n),this.logger.info(LE,"doAccess, accessUrl: ".concat(i,", haUrl: ").concat(n)),this.edgeNodeDomains.set("default",i),r.delay_ms=Hg.getCurrentTimestamp()-r.start_ms,r.rspCode="ok",r.errMsg="success"}catch(tb){this.logger.error(LE,"getAccessInfo failed: ".concat(tb)),r.delay_ms=Hg.getCurrentTimestamp()-r.start_ms,r.rspCode=tb.name,r.errMsg=tb.message}return t.push(r),this.edgeNodeDomains}createGrsClient(e){this.logger.info(LE,"createGrsClient, countryCode:".concat(e)),"none"!==Qg.logLevel&&NE.exports.Logger.setExtLogger(this.logger[Qg.logLevel].bind(this.logger),NE.exports.Logger.ERROR+1-ch.indexOf(Qg.logLevel),Qg.logLevel===ch[ch.length-1]);const t=new NE.exports.GrsBaseInfo;t.setPackageName("rtc"),t.setVersionName(Kv),t.setProductLine("rtsa"),t.setProductName("WEB");const r=cI.getParameter(sI)||{},i=r.grs_server_config||UE,n=iR.getProxyServer();if(n){const e=[];for(const t of i.grs_server.grs_base_url){const r=t.replace(/http(s)?:\/\//,"");e.push("".concat(n,"/").concat(r))}i.grs_server.grs_base_url=e}t.setServerConfig(i),t.setSdkRouteConfig(r.rtc_webjs_grs_sdk_global_route_config||ZT),t.setApkRouteConfig(r.grs_app_global_route_config||QT),e&&(t.setSerCountry(e),t.setRegCountry(e),t.setIssueCountry(e));const s=new NE.exports.GrsClient(t),o=s.initLocal();if(o!==NE.exports.GrsErrorCode.ERR_OK)throw this.logger.error(LE,"createGrsClient failed,status: ".concat(o)),new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR,"createGrsClient failed,status: ".concat(o));return this.logger.info(LE,"createGrsClient success"),s}async getUrlByGrs(e,t,r){try{this.logger.info(LE,"getGrsUrl begin, serviceName:".concat(e,", countryCode:").concat(t,", envInfo:").concat(JSON.stringify(r)));const i=e===BE?YE.getGrsKey(t,r):"ROOT";this.logger.info(LE,"getGrsUrl , serviceName:".concat(e,", envKey:").concat(i));const n=await this.grsClient.syncGetGrsUrl(e,i),s=YE.generateUrl(e,n,r);return this.logger.info(LE,"getGrsUrl for serviceName:".concat(e," success:").concat(s)),s}catch(tb){throw this.logger.error(LE,"serviceName:".concat(e," failed to getGrsUrl: ").concat(tb)),new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR,"serviceName:".concat(e," failed to getGrsUrl: ").concat(tb))}}static getGrsKey(e,t){return t?t.grsKey:e?"ROOT":"GLOBAL"}static generateUrl(e,t,r){return e===VE?t:(r=r||{grsKey:"",pathSuffix:""}).pathSuffix?"".concat(t,"/websocket/").concat(r.pathSuffix):t+"/websocket"}}var FE,jE;!function(e){e.joinRoom="JOIN_ROOM_SUC",e.exitRoom="EXIT_ROOM",e.disableVideo="DISABLE_VIDEO",e.disableAudio="DISABLE_AUDIO",e.enableVideo="ENABLE_VIDEO",e.enableAudio="ENABLE_AUDIO"}(FE||(FE={})),function(e){e[e.subscribe=0]="subscribe",e[e.unsubscribe=1]="unsubscribe"}(jE||(jE={}));const zE={LD:{streamUid:-999,pssrc:999,width:160,height:90},SD:{streamUid:-3,pssrc:3,width:320,height:180},HD:{streamUid:-2,pssrc:2,width:640,height:360},FHD:{streamUid:-1,pssrc:1,width:1280,height:720},LD_1:{streamUid:-999,pssrc:999,width:160,height:90},SD_2:{streamUid:-3,pssrc:3,width:320,height:180},HD_3:{streamUid:-2,pssrc:2,width:640,height:360},FHD_4:{streamUid:-1,pssrc:1,width:1280,height:720}},HE="RemoteUserManager";class KE{constructor(e){this.client=e,this.logger=e.logger,this.remoteUserInfos=new Map,this.previousAudioSubscribedUsers=new Map,this.roomSsrc=new Map}checkSsrcIsMute(e){let t=!0;return this.remoteUserInfos.forEach((r=>{1===r.userState&&(r.mainStream&&r.mainStream.remoteTrackInfos&&r.mainStream.remoteTrackInfos.forEach((r=>{r.cssrc===e&&(t=r.mute)})),r.auxStream&&r.auxStream.remoteTrackInfos&&r.auxStream.remoteTrackInfos.forEach((r=>{r.cssrc===e&&(t=r.mute)})))})),t}checkRemoteTop3NeedReport(){let e=0;return this.remoteUserInfos.forEach((t=>{1===t.userState&&t.mainStream&&t.mainStream.remoteTrackInfos&&t.mainStream.remoteTrackInfos.forEach((t=>{t.type===uI.TRACK_TYPE_AUDIO&&e++}))})),!(e<3)}initialize(e,t){e&&t&&(this.localUserId=e,this.audioCssrcs=this.getCssrcRangeByType(t,0),this.mainVideoCssrcs=this.getCssrcRangeByType(t,1),this.auxVideoCssrcs=this.getCssrcRangeByType(t,2))}getStreamInfoByPStreamUid(e){let t=null;return Array.from(this.remoteUserInfos.values()).forEach((r=>{var i,n,s;if(null!==(i=r.mainStream)&&void 0!==i&&i.remoteTrackInfos.get(e.toString()))t=null===(s=r.mainStream)||void 0===s?void 0:s.remoteTrackInfos.get(e.toString());else if(null!==(n=r.auxStream)&&void 0!==n&&n.remoteTrackInfos.get(e.toString())){var o;t=null===(o=r.auxStream)||void 0===o?void 0:o.remoteTrackInfos.get(e.toString())}})),t}getCssrcRangeByType(e,t){if(!e)throw this.logger.error(HE,"sdpRepInfo is null"),new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR);const r=0===t?e.audio:1===t?e.video:e.desktopVideo,i=null==r?void 0:r.receiveSsrcBegin,n=null==r?void 0:r.receiveSsrcEnd;if(!i||!n||i>=n)throw this.logger.error(HE,"begin or end is invalid"),new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR);return KE.getCssrcRange(i,n)}static getCssrcRange(e,t){const r=[];let i;for(i=e;i<=t;i++)r.push(i);return r}refreshRemoteUserList(e,t,r){const i=[],n=this.getUserStreamUpdatedList(e,t);return n?(n.addedUsers.forEach((t=>{const n=this.addUser(t,e,r);n&&i.push(n)})),n.updatedUsers.forEach((t=>{const n=this.updateUser(t,e,r);n&&i.push(n)})),n.removedUsers.forEach((t=>{const n=this.removeUser(t,e,r);n&&i.push(n)})),this.logger.info(HE,"refreshRemoteUserStreamList success, ".concat(this.getTracksUpdateInfosString(i))),i):null}addUser(e,t,r){return this.updateUser(e,t,r)}updateUser(e,t,r){var i,n;if(e.userId===this.localUserId)return null;const s={userId:e.userId,userUid:e.userUid,nickname:e.appData.nickname,roomId:t},o=null===(i=e.videoStreams)||void 0===i?void 0:i.filter((e=>e.content!==AI.desktop)),a=null===(n=e.videoStreams)||void 0===n?void 0:n.filter((e=>e.content===AI.desktop)),c=e.audioStreams,u=this.getUserInfoById(s.userId,s.roomId),d=this.doRefreshRemoteStreamList(s,dI.STREAM_TYPE_MAIN,o,c,r),l=this.doRefreshRemoteStreamList(s,dI.STREAM_TYPE_AUX,a,null,r),h=this.getUserInfoById(s.userId,s.roomId);return{userInfo:h.userInfo,preUserState:u?h.userState:0,curUserState:h.userState,isUserNameChanged:null,mainStream:d,auxStream:l}}removeUser(e,t,r){if(e.userId===this.localUserId)return null;const i={userId:e.userId,userUid:e.userUid,nickname:e.appData.nickname,roomId:t};this.doRefreshRemoteStreamList(i,dI.STREAM_TYPE_MAIN,[],[],r),this.doRefreshRemoteStreamList(i,dI.STREAM_TYPE_AUX,[],[],r);const n={status:FE.exitRoom,userId:e.userId,userUid:e.userUid},s=this.updateUserListInfo(t,[n]);return s&&0!==s.length?s[0]:null}getUserStreamUpdatedList(e,t){const r=this.getAllUserInfos(e),i=[],n=[],s=[];return r.forEach((e=>{if(e.userInfo.userId===kI)return;const r=t.find((t=>t.userId===e.userInfo.userId)),i=this.getAllTracksByMediaType(e.userInfo.roomId,e.userInfo.userId,uI.TRACK_TYPE_VIDEO),o=this.getAllTracksByMediaType(e.userInfo.roomId,e.userInfo.userId,uI.TRACK_TYPE_AUDIO);if(r){r.audioStreams&&(r.audioStreams=r.audioStreams.filter((e=>"main"===e.content)));const e={userId:r.userId,userUid:r.userUid,appData:r.appData,videoStreams:r.videoStreams,audioStreams:r.audioStreams};n.push(e)}else{const t=i.map((e=>({content:e.content,codec:e.codec,fps:e.fps,height:e.height,maxFs:e.maxFs,maxMbps:e.maxMbps,mute:e.mute,pt:e.pt,ssrc:e.pssrc,streamData:e.streamData,streamUid:parseInt(e.trackId),width:e.width}))),r=o.map((e=>({content:e.content,codec:e.codec,maxMbps:e.maxMbps,mute:e.mute,pt:e.pt,ssrc:e.pssrc,streamData:e.streamData,streamUid:parseInt(e.trackId),channels:e.channels,sampleRate:e.sampleRate}))),n={userId:e.userInfo.userId,userUid:e.userInfo.userUid,appData:{nickname:e.userInfo.nickname},videoStreams:t,audioStreams:r};s.push(n)}})),t.forEach((e=>{if(!r.some((t=>t.userInfo.userId===e.userId))){e.audioStreams&&(e.audioStreams=e.audioStreams.filter((e=>"main"===e.content)));const t={userId:e.userId,userUid:e.userUid,appData:e.appData,videoStreams:e.videoStreams,audioStreams:e.audioStreams};i.push(t)}})),{addedUsers:i,updatedUsers:n,removedUsers:s}}updateUserListInfo(e,t){if(!t||!e)return null;const r=[],i=[];return t.forEach((t=>{const n={userId:t.userId,userUid:t.userUid,roomId:e,nickname:t.appData?t.appData.nickname:null},s=this.updateUserInfo(n,t.status);s&&r.push(s),i.push(t.userId)})),r.push(...this.getOtherRemoteUserPublishInfos(i,e)),this.logger.info(HE,"updateUserListInfo success, ".concat(this.getTracksUpdateInfosString(r))),r}updateUserInfo(e,t){if(this.logger.info(HE,"updateUserInfo begin, updateType:".concat(t,", userInfo: ").concat(JSON.stringify(e))),e.userId===this.localUserId)return null;const r=this.getUserInfoById(e.userId,e.roomId),i=r?r.userState:0,n=!!r&&KE.isUserNameChanged(r.userInfo,null==e?void 0:e.nickname);switch(t){case FE.exitRoom:if(!r)return this.logger.error(HE,"remote user leaveï¼ but user not exist"),null;break;case FE.joinRoom:r||this.initializeRemoteUser(e,!0);break;default:this.logger.error(HE,"updateUserInfo, unknown user status:".concat(t))}const s=this.getUserInfoById(e.userId,e.roomId),o=t===FE.joinRoom?KE.getUserUpdateInfoWhenJoin(i,n,s):KE.getUserUpdateInfoWhenQuit(i,s);if(t===FE.exitRoom&&0===s.userState){const t=KE.generateUniqueId(e.userId,e.roomId);this.remoteUserInfos.delete(t)}return o}static getUserUpdateInfoWhenJoin(e,t,r){return r.userState=2===e?1:r.userState,{userInfo:r.userInfo,preUserState:e,curUserState:r.userState,isUserNameChanged:t,mainStream:null,auxStream:null}}static getUserUpdateInfoWhenQuit(e,t){return t.userState=2===e?e:0,{userInfo:t.userInfo,preUserState:e,curUserState:t.userState,isUserNameChanged:null,mainStream:KE.getStreamListUpdateInfoWhenQuitOrRejoin(t,dI.STREAM_TYPE_MAIN,e),auxStream:KE.getStreamListUpdateInfoWhenQuitOrRejoin(t,dI.STREAM_TYPE_AUX,e)}}static getStreamListUpdateInfoWhenQuitOrRejoin(e,t,r){return 2===r?KE.getStreamListUpdateInfoWhenRejoin(e,t):KE.getStreamListUpdateInfoWhenQuit(e,t)}static getStreamListUpdateInfoWhenQuit(e,t){const r=t===dI.STREAM_TYPE_MAIN?e.mainStream:e.auxStream,i=KE.getRemoteTrackInfos(r),n=null==i?void 0:i.filter((e=>e.isSubscribed));return{remoteStream:null==r?void 0:r.remoteStream,preTracks:i,curTracks:i,addedTracks:[],updatedTracks:[],removedTracks:i,subscribedTracks:n,tracks4Subscribe:[],tracks4Unsubscribe:n,allSubscribeTracks:[]}}static getStreamListUpdateInfoWhenRejoin(e,t){const r=t===dI.STREAM_TYPE_MAIN?e.mainStream:e.auxStream,i=KE.getRemoteTrackInfos(r),n=null==i?void 0:i.filter((e=>e.isSubscribed));return{remoteStream:null==r?void 0:r.remoteStream,preTracks:i,curTracks:i,addedTracks:[],updatedTracks:[],removedTracks:i,subscribedTracks:n,tracks4Subscribe:[],tracks4Unsubscribe:[],allSubscribeTracks:n}}getTracks4UnSubscribe(e){if(!e)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);const t=[];return e.forEach((e=>{e.isSubscribed&&(e.isSubscribed=!1,t.push(e))})),this.logger.info(HE,"getTracks4UnSubscribe success, tracks4Unsubscribe: ".concat(JSON.stringify(t))),t}cachePlayInfo(e,t,r,i,n){if(!n)return;const s=this.getUserInfoById(e.userId,e.roomId),o=t===dI.STREAM_TYPE_MAIN?s.mainStream:s.auxStream,a=null==o?void 0:o.subscribeOption;return a?KE.isStreamRemoved(r,i)?(a.audio=!1,a.video=!1,void(a.resolutions=null)):void n.forEach((e=>{if(e.isSubscribed){if(a.audio&&e.type===uI.TRACK_TYPE_AUDIO){var t;const r=null==o||null===(t=o.remoteStream)||void 0===t?void 0:t.getAudioHRTCTrack();r&&(a.audioPlayInfo.playElement=r.getElementId(),a.audioPlayInfo.objectFit=r.getObjectFit(),a.audioPlayInfo.muted=r.getTrackMuted(),e.muted=r.getTrackMuted())}if(a.video&&e.type===uI.TRACK_TYPE_VIDEO){var r;const t=null==o||null===(r=o.remoteStream)||void 0===r?void 0:r.getVideoHRTCTrackByTrackId(e.trackId);if(t){var i;const r=null===(i=a.resolutions)||void 0===i?void 0:i.find((t=>t.resolutionId===e.trackId));r&&(r.playElement=t.getElementId(),r.objectFit=t.getObjectFit(),r.muted=t.getTrackMuted(),e.muted=t.getTrackMuted())}}}})):void 0}static isStreamRemoved(e,t){return!(e&&0!==e.length||t&&0!==t.length)}getTracks4Subscribe(e,t,r,i,n){if(this.logger.debug(HE,"getTracks4Subscribe begin"),!(i&&0!==i.length||n&&0!==n.length))return this.logger.debug(HE,"getTracks4Subscribe success, tracks4Subscribe: []"),[];const s=n.filter((e=>e.isSubscribed)),o=[],a=this.isAudioTrackNeedSubscribe(e.userId,e.roomId,t),c=i.find((e=>e.type===uI.TRACK_TYPE_AUDIO));if(a&&c){c.cssrc=this.allocateAudioReceiveSsrc(e.roomId),c.isSubscribed=!0,c.state=1;const r=this.getAudioTrackPlayInfo(e.userId,e.roomId,t);r&&(c.playElement=r.playElement,c.objectFit=r.objectFit,c.muted=r.muted);const i=s.find((e=>e.type===uI.TRACK_TYPE_AUDIO));i&&(c.state=i.state,c.muted=i.muted),o.push(c)}const u=s.filter((e=>e.type===uI.TRACK_TYPE_VIDEO)),d=i.filter((e=>e.type===uI.TRACK_TYPE_VIDEO));for(const l of d){const r={resolutionId:l.trackId,width:l.width,height:l.height};if(this.updateVideoSubscribeOption(e.userId,e.roomId,t,r,u)){l.cssrc=this.allocateVideoReceiveSsrc(e.roomId,t),l.isSubscribed=!0,l.state=1;const i=this.getVideoTrackPlayInfo(e.userId,e.roomId,t,r);i&&(l.playElement=i.playElement,l.objectFit=i.objectFit,l.muted=i.muted);const n=this.getTrack4Replace(l,u);n&&0!==n.state&&(l.state=n.state,l.muted=n.muted),o.push(l)}}return this.logger.info(HE,"getTracks4Subscribe success, tracks4Subscribe: ".concat(JSON.stringify(o))),o}getAudioTrackPlayInfo(e,t,r){var i;const n=this.getUserInfoById(e,t);return null===(i=(r===dI.STREAM_TYPE_MAIN?n.mainStream:n.auxStream).subscribeOption)||void 0===i?void 0:i.audioPlayInfo}getVideoTrackPlayInfo(e,t,r,i){var n,s;const o=this.getUserInfoById(e,t),a=null===(n=(r===dI.STREAM_TYPE_MAIN?o.mainStream:o.auxStream).subscribeOption)||void 0===n||null===(s=n.resolutions)||void 0===s?void 0:s.find((e=>e.resolutionId===i.resolutionId));return a?{playElement:a.playElement,objectFit:a.objectFit,muted:a.muted}:null}updateVideoSubscribeOption(e,t,r,i,n){const s=this.getUserInfoById(e,t),o=r===dI.STREAM_TYPE_MAIN?s.mainStream:s.auxStream,a=null==o?void 0:o.subscribeOption;if(!a)return!1;if(!a.video)return!1;const c=a.resolutions.find((e=>e.resolutionId===i.resolutionId||e.height===i.height&&e.width===i.width||(null==n?void 0:n.length)));return c&&(c.resolutionId=i.resolutionId),!!c}enableTopThreeAudioMode(e){const t=this.getAllUserInfos(e);null==t||t.forEach((e=>{var t,r;null!==(t=e.mainStream)&&void 0!==t&&t.subscribeOption&&(e.mainStream.subscribeOption.audio=!1),null!==(r=e.auxStream)&&void 0!==r&&r.subscribeOption&&(e.auxStream.subscribeOption.audio=!1)})),this.logger.info(HE,"enableTopThreeAudioMode success")}isAudioTrackNeedSubscribe(e,t,r){var i;const n=this.getUserInfoById(e,t),s=r===dI.STREAM_TYPE_MAIN?n.mainStream:n.auxStream;return null==s||null===(i=s.subscribeOption)||void 0===i?void 0:i.audio}getTrack4Replace(e,t){return(null==t?void 0:t.find((t=>t.trackId===e.trackId||t.height===e.height&&t.width===e.width)))||(null!=t&&t.length?t[0]:null)}getAllUserStreamsByType(e,t,r){return this.getAllUserInfos(e).map((i=>{const n=t&&t!==dI.STREAM_TYPE_MAIN?null:KE.getStreamInfoByType(i,dI.STREAM_TYPE_MAIN,r),s=t&&t!==dI.STREAM_TYPE_AUX?null:KE.getStreamInfoByType(i,dI.STREAM_TYPE_AUX,r);return{userId:i.userInfo.userId,roomId:e,mainStream:n,auxStream:s}}))}static getStreamInfoByType(e,t,r){const i=t===dI.STREAM_TYPE_MAIN?e.mainStream:e.auxStream,n=KE.getRemoteTrackInfos(i),s=KE.getTracksByType(n,r);return{remoteStream:i?i.remoteStream:null,tracks:s}}getUserInfoById(e,t){const r=KE.generateUniqueId(e,t);return this.remoteUserInfos.get(r)}static getTracksByType(e,t){return e&&0!==e.length?t?e.filter((e=>e.type===t)):e:[]}static isUserNameChanged(e,t){return t&&e&&e.nickname&&e.nickname!==t}static getRemoteTrackInfos(e){return null!=e&&e.remoteTrackInfos?Array.from(e.remoteTrackInfos.values()):null}getAllTracksByMediaType(e,t,r){var i,n;const s=KE.generateUniqueId(t,e),o=this.remoteUserInfos.get(s);if(!o)return null;const a=[],c=null===(i=KE.getRemoteTrackInfos(o.mainStream))||void 0===i?void 0:i.filter((e=>e.type===r));c&&a.push(...c);const u=null===(n=KE.getRemoteTrackInfos(o.auxStream))||void 0===n?void 0:n.filter((e=>e.type===r));return u&&a.push(...u),a}getMaxResolutionTrack(e){let t;for(const r of e)r.type!==uI.TRACK_TYPE_AUDIO&&(t?Math.max(r.width,r.height)-Math.max(t.width,t.height)>0&&(t=r):t=r);return this.logger.info(HE,"getMaxResolutionTrackId, maxResolution: ".concat(JSON.stringify(t))),t}getMaxResolutionTrackId(e){var t;if(!e)return null;const r=Array.from(e.remoteTrackInfos.values());let i;for(const n of r)n.type!==uI.TRACK_TYPE_AUDIO&&(i?Math.max(n.width,n.height)-Math.max(i.width,i.height)>0&&(i=n):i=n);return this.logger.info(HE,"getMaxResolutionTrackId, maxResolution: ".concat(JSON.stringify(i))),null===(t=i)||void 0===t?void 0:t.trackId}getAllSubscribedMainStream(e){const t=this.getAllUserInfos(e),r=[];return t.forEach((e=>{var t;null!==(t=e.mainStream)&&void 0!==t&&t.remoteTrackInfos&&Array.from(e.mainStream.remoteTrackInfos.values()).some((e=>e.isSubscribed))&&r.push(e)})),r}batchSubscribeMainStream(e,t){if(!e||!t)return null;const r=this.getAllSubscribedMainStream(e),i=[],n=t.find((e=>e.userId===kI));if(n){this.getUserInfoById(kI,e)||this.createRemoteShadowUser(e,n.resolutionIds)}return this.getAllUserInfos(e).forEach((n=>{const s=t.find((e=>e.userId===n.userInfo.userId));if(s){const t={video:!0,audio:!1,resolutionIds:s.resolutionIds,autoAdjustResolution:s.autoAdjustResolution,minResolution:s.minResolution},r=this.subscribeSingleStream(s.userId,e,dI.STREAM_TYPE_MAIN,t,1,!0);i.push(r)}else{var o;const e=KE.getRemoteTrackInfos(n.mainStream),s=null==e?void 0:e.filter((e=>e.isSubscribed)),a=this.needUnsubscribeMainStream(n,t,r),c=KE.getAnotherStreamUpdateInfo(dI.STREAM_TYPE_MAIN,n),u={userInfo:n.userInfo,curUserState:n.userState,preUserState:n.userState,mainStream:{remoteStream:null===(o=n.mainStream)||void 0===o?void 0:o.remoteStream,preTracks:e,curTracks:e,addedTracks:null,updatedTracks:null,removedTracks:null,subscribedTracks:s,tracks4Subscribe:null,tracks4Unsubscribe:s,allSubscribeTracks:a?null:s},auxStream:c};i.push(u)}})),this.logger.info(HE,"batchSubscribeMainStream success, infos: ".concat(this.getTracksUpdateInfosString(i))),i}needUnsubscribeMainStream(e,t,r){const i=!t.some((t=>t.userId===e.userInfo.userId)),n=r.some((t=>e.userInfo.userId===t.userInfo.userId));return i&&n}createRemoteShadowUser(e,t){const r={userId:kI,userUid:wI,nickname:"",roomId:e},i=[];null==t||t.forEach((e=>{const t=zE[e]||zE.LD,r={content:AI.main,ssrc:t.pssrc,streamUid:t.streamUid,pt:122,width:t.width,height:t.height};i.push(r)})),this.doRefreshRemoteStreamList(r,dI.STREAM_TYPE_MAIN,i,null,!1),this.logger.info(HE,"createRemoteShadowUser success, upstreams: ".concat(JSON.stringify(i)))}subscribeResultCallback(e,t){if(e)try{e.successSubscribeInfos.forEach((e=>{var t,r,i,n;null===(t=e.mainStream)||void 0===t||null===(r=t.tracks)||void 0===r||r.forEach((e=>{e.state=0})),null===(i=e.auxStream)||void 0===i||null===(n=i.tracks)||void 0===n||n.forEach((e=>{e.state=0}))})),e.failSubscribeInfos.forEach((e=>this.releaseResource(e,t))),e.successUnsubscribeInfos.forEach((e=>this.releaseResource(e,!1))),e.failUnsubscribeInfos.forEach((e=>this.recoverUnsubscribeResource(e,t))),this.logger.info(HE,"subscribeResultCallback success")}catch(tb){this.logger.error(HE,"subscribeResultCallback fail, errMsg:".concat(tb))}}releaseResource(e,t){var r,i,n,s;const o=this.getUserInfoById(e.userId,e.roomId);null==e||null===(r=e.mainStream)||void 0===r||null===(i=r.tracks)||void 0===i||i.forEach((r=>{if(this.unAllocateReceiveSsrc(e.roomId,dI.STREAM_TYPE_MAIN,r.type,r.cssrc),r.state=0,r.isSubscribed=!1,r.isTrackReady=!1,r.cssrc=0,t){const e=o.mainStream.subscribeOption;KE.recoverUnsubscribeOption(e,r)}})),null==e||null===(n=e.auxStream)||void 0===n||null===(s=n.tracks)||void 0===s||s.forEach((r=>{if(this.unAllocateReceiveSsrc(e.roomId,dI.STREAM_TYPE_AUX,r.type,r.cssrc),r.state=0,r.isSubscribed=!1,r.isTrackReady=!1,r.cssrc=0,t){const e=o.mainStream.subscribeOption;KE.recoverUnsubscribeOption(e,r)}}))}recoverUnsubscribeResource(e,t){var r,i,n,s;const o=this.getUserInfoById(e.userId,e.roomId);null==e||null===(r=e.mainStream)||void 0===r||null===(i=r.tracks)||void 0===i||i.forEach((r=>{var i;this.recoverReceiveSsrc(e.roomId,dI.STREAM_TYPE_MAIN,r.type,r.cssrc),r.isSubscribed=!0;const n=null===(i=o.mainStream)||void 0===i?void 0:i.remoteTrackInfos;if(n.has(r.trackId)||n.set(r.trackId,r),t){const e=o.mainStream.subscribeOption;KE.recoverSubscribeOption(e,r)}})),null==e||null===(n=e.auxStream)||void 0===n||null===(s=n.tracks)||void 0===s||s.forEach((r=>{var i;this.recoverReceiveSsrc(e.roomId,dI.STREAM_TYPE_AUX,r.type,r.cssrc),r.isSubscribed=!0;const n=null===(i=o.auxStream)||void 0===i?void 0:i.remoteTrackInfos;if(n.has(r.trackId)||n.set(r.trackId,r),t){const e=o.mainStream.subscribeOption;KE.recoverSubscribeOption(e,r)}}))}static recoverSubscribeOption(e,t){if(t.type===uI.TRACK_TYPE_AUDIO)e.audio=!0;else{e.video=!0;const r={resolutionId:t.trackId,width:t.width,height:t.height};e.resolutions.push(r)}}static recoverUnsubscribeOption(e,t){if(t.type===uI.TRACK_TYPE_AUDIO)e.audio=!1;else{if(!e.video)return;e.resolutions?e.resolutions.forEach((t=>{var r;const i=null==e||null===(r=e.resolutions)||void 0===r?void 0:r.map((e=>e.resolutionId)).indexOf(t.resolutionId);i>-1&&e.resolutions.splice(i,1)})):(e.video=!1,e.resolutions=null)}}subscribeStream(e,t,r,i,n,s,o){const a=this.subscribeSingleStream(e,t,r,i,n,s),c=[];if(o&&(o.streamIds=[]),a){c.push(a);(r===dI.STREAM_TYPE_MAIN?a.mainStream.tracks4Subscribe:a.auxStream.tracks4Subscribe).forEach((e=>{e.trackId&&o&&o.streamIds.push(e.trackId)}))}return c.push(...this.getOtherRemoteUserPublishInfos([e],t)),this.logger.info(HE,"subscribeStream success, ".concat(this.getTracksUpdateInfosString(c))),c}subscribeSingleStream(e,t,r,i,n){var s,o;let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!e||!t||!i)return null;const u=this.getUserInfoById(e,t);if(!u)return this.logger.error(HE,"subscribeStream fail, user not exist}"),null;const d=[],l=[],h=[],f=KE.getRemoteTrackInfos(u.mainStream),p=KE.getRemoteTrackInfos(u.auxStream),m=r===dI.STREAM_TYPE_MAIN?f:p,_=null==m?void 0:m.filter((e=>e.isSubscribed));this.updateAudioTrackSubInfo(r,i,c,u,n,d,l,h),this.updateVideoTrackSubInfo(r,i,a,u,d,l,h),this.updateSubscribeOption(e,t,r,i,jE.subscribe);const g={remoteStream:r===dI.STREAM_TYPE_MAIN?null===(s=u.mainStream)||void 0===s?void 0:s.remoteStream:null===(o=u.auxStream)||void 0===o?void 0:o.remoteStream,preTracks:m,curTracks:m,addedTracks:null,updatedTracks:null,removedTracks:null,subscribedTracks:_,tracks4Subscribe:d,tracks4Unsubscribe:l,allSubscribeTracks:h},S=KE.getAnotherStreamUpdateInfo(r,u);return{curUserState:u.userState,preUserState:u.userState,userInfo:u.userInfo,mainStream:r===dI.STREAM_TYPE_MAIN?g:S,auxStream:r===dI.STREAM_TYPE_AUX?g:S}}resubscribeMainStreamAudio(e){const t=this.previousAudioSubscribedUsers.get(e),r=t?Array.from(t.values()):null;if(this.logger.info(HE,"resubscribeMainStreamAudio, preAudioSubscribedUsers:  ".concat(r)),!r)return null;const i={video:!1,audio:!0},n=[];r.forEach((t=>{var r,s;const o=this.subscribeSingleStream(t,e,dI.STREAM_TYPE_MAIN,i,0);(null==o||null===(r=o.mainStream)||void 0===r||null===(s=r.tracks4Subscribe)||void 0===s?void 0:s.length)>0&&n.push(o)}));const s=[];return s.push(...n),s.push(...this.getOtherRemoteUserPublishInfos(r,e)),this.logger.info(HE,"resubscribeMainStreamAudio success, ".concat(this.getTracksUpdateInfosString(s))),n}unsubscribeAllMainStreamAudio(e){const t={video:!1,audio:!0},r=[],i=[];return this.getAllUserInfos(e).forEach((n=>{var s;if(null!==(s=n.mainStream)&&void 0!==s&&s.remoteTrackInfos?Array.from(n.mainStream.remoteTrackInfos.values()).some((e=>e.type===uI.TRACK_TYPE_AUDIO&&e.isSubscribed)):null){i.push(n.userInfo.userId);const s=this.unsubscribeSingleStream(n.userInfo.userId,e,dI.STREAM_TYPE_MAIN,t,1);r.push(s)}})),r.push(...this.getOtherRemoteUserPublishInfos(i,e)),this.logger.info(HE,"unsubscribeAllMainStreamAudio success, ".concat(this.getTracksUpdateInfosString(r))),r}updateAudioTrackSubInfo(e,t,r,i,n,s,o,a){if(!i)return;const c=KE.getRemoteTrackInfos(i.mainStream),u=KE.getRemoteTrackInfos(i.auxStream),d=e===dI.STREAM_TYPE_MAIN?c:u,l=null==d?void 0:d.find((e=>e.type===uI.TRACK_TYPE_AUDIO));if(!l)return void this.logger.info(HE,"updateAudioTrackSubInfo: ".concat(e,", no audio track exist"));const h=l.isSubscribed?l:null;if(t.audio&&!l.isSubscribed){0===n?(l.isSubscribed=!0,l.cssrc=this.allocateAudioReceiveSsrc(i.userInfo.roomId),s.push(l)):this.logger.warn(HE,"updateAudioTrackSubInfo, not common audio mode, but audio option is true, reserve it");const e=this.previousAudioSubscribedUsers.get(i.userInfo.roomId);null==e||e.set(i.userInfo.userId,i.userInfo.userId)}if((h||!h&&s.some((e=>e.type===uI.TRACK_TYPE_AUDIO)))&&a.push(l),r&&!t.audio&&h){l.isSubscribed=!1,o.push(l);const e=this.previousAudioSubscribedUsers.get(i.userInfo.roomId);null==e||e.delete(i.userInfo.userId)}}updateVideoTrackSubInfo(e,t,r,i,n,s,o){const a=KE.getRemoteTrackInfos(i.mainStream),c=KE.getRemoteTrackInfos(i.auxStream),u=e===dI.STREAM_TYPE_MAIN?a:c,d=null==u?void 0:u.filter((e=>e.type===uI.TRACK_TYPE_VIDEO));if(!d||0===d.length)return;const l=[];d.filter((e=>e.isSubscribed)).forEach((e=>{l.push(e)}));const h=[];if(t.video)if(t.resolutionIds)t.resolutionIds.forEach((t=>{const r=i.userInfo.userId===kI?zE[t].streamUid.toString():t,s=d.find((e=>e.trackId.toString()===r));s&&(h.push(s),l.some((e=>e.trackId.toString()===r))||(s.isSubscribed=!0,s.cssrc=this.allocateVideoReceiveSsrc(i.userInfo.roomId,e),n.push(s)))}));else{const t=this.getMaxResolutionTrack(d).trackId,r=t&&d.find((e=>e.trackId===t));r&&(h.push(r),l.some((e=>e.trackId===t))||(r.isSubscribed=!0,r.cssrc=this.allocateVideoReceiveSsrc(i.userInfo.roomId,e),n.push(r)))}const f=n.filter((e=>e.type===uI.TRACK_TYPE_VIDEO));f.forEach((e=>{e.autoAdjustResolution=t.autoAdjustResolution||OI.ON,e.minResolution=t.minResolution||"LD"})),o.push(...f),r?l.forEach((e=>{h.some((t=>t.trackId===e.trackId))?o.push(e):(e.isSubscribed=!1,s.push(e))})):o.push(...l)}unAllocateReceiveSsrc(e,t,r,i){r!==uI.TRACK_TYPE_AUDIO?this.unAllocateVideoReceiveSsrc(e,t,i):this.unAllocateAudioReceiveSsrc(e,i)}recoverReceiveSsrc(e,t,r,i){r!==uI.TRACK_TYPE_AUDIO?this.recoverVideoReceiveSsrc(e,t,i):this.recoverAudioReceiveSsrc(e,i)}unAllocateAudioReceiveSsrc(e,t){const r=this.roomSsrc.get(e);if(!r)throw this.logger.error(HE,"no roomId exist"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);const i=r.audioReceiveSsrcs.indexOf(t);-1===i&&this.logger.error(HE,"unAllocateAudioReceiveSsrc error, ".concat(t," not allocated")),r.audioReceiveSsrcs.splice(i,1),this.logger.info(HE,"unAllocateAudioReceiveSsrc success, ".concat(t))}recoverAudioReceiveSsrc(e,t){const r=this.roomSsrc.get(e);if(!r)throw this.logger.error(HE,"no roomId exist"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);-1===r.audioReceiveSsrcs.indexOf(t)&&r.audioReceiveSsrcs.push(t),this.logger.info(HE,"recoverAudioReceiveSsrc success, ".concat(t))}unAllocateVideoReceiveSsrc(e,t,r){const i=this.roomSsrc.get(e);if(!i)throw this.logger.error(HE,"no roomId exist"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);const n=i.videoReceiveSsrcs.indexOf(r);-1!==n?(i.videoReceiveSsrcs.splice(n,1),this.logger.info(HE,"unAllocateVideoReceiveSsrc success, ".concat(t,", ").concat(r))):this.logger.error(HE,"unAllocateVideoReceiveSsrc error, ".concat(t,",  ").concat(r," not allocated"))}recoverVideoReceiveSsrc(e,t,r){const i=this.roomSsrc.get(e);if(!i)throw this.logger.error(HE,"no roomId exist"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);-1===i.videoReceiveSsrcs.indexOf(r)&&i.videoReceiveSsrcs.push(r),this.logger.info(HE,"recoverVideoReceiveSsrc success, ".concat(t,", ").concat(r))}allocateAudioReceiveSsrc(e){const t=this.roomSsrc.get(e);if(!t)throw this.logger.error(HE,"no roomId exist"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);if(!this.audioCssrcs||0===this.audioCssrcs.length)throw this.logger.error(HE,"audio ssrc not found"),new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR);for(const r of this.audioCssrcs)if(!t.audioReceiveSsrcs.includes(r))return t.audioReceiveSsrcs.push(r),this.logger.info(HE,"allocateAudioReceiveSsrc success, ".concat(r)),r;throw this.logger.error(HE,"have no available audio receive ssrc"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER)}allocateVideoReceiveSsrc(e,t){const r=this.roomSsrc.get(e);if(!r)throw this.logger.error(HE,"no roomId exist"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);return t===dI.STREAM_TYPE_AUX?this.doAllocateVideoReceiveSsrc(this.auxVideoCssrcs,r.videoReceiveSsrcs):this.doAllocateVideoReceiveSsrc(this.mainVideoCssrcs,r.videoReceiveSsrcs)}doAllocateVideoReceiveSsrc(e,t){if(!e||0===e.length)throw this.logger.error(HE,"video ssrc not found"),new Eu(ou.RTC_ERR_CODE_RTC_SDK_ERROR);for(const r of e)if(!t.includes(r))return t.push(r),this.logger.info(HE,"allocateVideoReceiveSsrc success, ".concat(r)),r;throw this.logger.error(HE,"have no available video receive ssrc"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER)}unsubscribeStream(e,t,r,i){const n=this.unsubscribeSingleStream(e,t,r,i,0);this.updateSubscribeOption(e,t,r,i,jE.unsubscribe);const s=[];return n&&s.push(n),s.push(...this.getOtherRemoteUserPublishInfos([e],t)),this.logger.info(HE,"unsubscribeStream success, ".concat(this.getTracksUpdateInfosString(s))),s}updateSubscribeOption(e,t,r,i,n){if(!i)throw this.logger.error(HE,"updateSubscribeOption fail, trackOption is null}"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);const s=this.getUserInfoById(e,t),o=r===dI.STREAM_TYPE_MAIN?s.mainStream:s.auxStream;n===jE.subscribe?o.subscribeOption=this.getFullSubscribeOptions(o,i):(i.audio&&(o.subscribeOption.audio=!1),i.video&&(i.resolutionIds?i.resolutionIds.forEach((e=>{var t,r;const i=null===(t=o.subscribeOption)||void 0===t||null===(r=t.resolutions)||void 0===r?void 0:r.map((e=>e.resolutionId)).indexOf(e);i>-1&&o.subscribeOption.resolutions.splice(i,1)})):(o.subscribeOption.video=!1,o.subscribeOption.resolutions=null)))}getFullSubscribeOptions(e,t){if(!t)throw this.logger.error(HE,"trackOption is null"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);const r=[],i={};if(t.video)if(t.resolutionIds)t.resolutionIds.forEach((t=>{KE.appendResolutions(e,t,r)}));else{const t=this.getMaxResolutionTrackId(e);KE.appendResolutions(e,t,r)}if(t.audio){const t=Array.from(e.remoteTrackInfos.values()).find((e=>e.type===uI.TRACK_TYPE_AUDIO));null!=t&&t.playElement&&(i.playElement=t.playElement,i.objectFit=t.objectFit,i.muted=t.muted)}return{audio:t.audio,video:t.video,resolutions:r,audioPlayInfo:i,autoAdjustResolution:t.autoAdjustResolution,minResolution:t.minResolution}}static appendResolutions(e,t,r){const i=e.remoteTrackInfos.get(t);if(i){const e={resolutionId:t,width:i.width,height:i.height};i.playElement&&(e.playElement=i.playElement,e.objectFit=i.objectFit,e.muted=i.muted),r.push(e)}}getRemoteUserInfoById(e,t){if(!e||!t)return null;const r=this.getUserInfoById(e,t);return r||(this.logger.error(HE,"unsubscribeSingleStream fail, user not exist}"),null)}unsubscribeSingleStream(e,t,r,i,n){var s,o;const a=this.getRemoteUserInfoById(e,t);if(null===a)return null;const c=KE.getRemoteTrackInfos(a.mainStream),u=KE.getRemoteTrackInfos(a.auxStream),d=r===dI.STREAM_TYPE_MAIN?c:u;if(!d||0===d.length)return this.logger.warn(HE,"unsubscribeSingleStream, no track exist ".concat(e)),null;const l=d.filter((e=>e.isSubscribed)),h=[];if(i.audio){const r=d.find((e=>e.type===uI.TRACK_TYPE_AUDIO&&e.isSubscribed));if(r&&(r.isSubscribed=!1,h.push(r),0===n)){const r=this.previousAudioSubscribedUsers.get(t);null==r||r.delete(e)}}i.video&&this.unsubscribeVideo(i,l,h,e,d);const f={remoteStream:r===dI.STREAM_TYPE_MAIN?null===(s=a.mainStream)||void 0===s?void 0:s.remoteStream:null===(o=a.auxStream)||void 0===o?void 0:o.remoteStream,preTracks:d,curTracks:d,addedTracks:null,updatedTracks:null,removedTracks:null,subscribedTracks:l,tracks4Subscribe:null,tracks4Unsubscribe:h,allSubscribeTracks:Array.from(d.values()).filter((e=>e.isSubscribed))},p=KE.getAnotherStreamUpdateInfo(r,a);return{preUserState:a.userState,curUserState:a.userState,userInfo:a.userInfo,mainStream:r===dI.STREAM_TYPE_MAIN?f:p,auxStream:r===dI.STREAM_TYPE_AUX?f:p}}unsubscribeVideo(e,t,r,i,n){if(e.resolutionIds)e.resolutionIds.forEach((e=>{const t=i===kI?zE[e].streamUid.toString():e,s=null==n?void 0:n.find((e=>e.trackId.toString()===t&&e.isSubscribed));s&&(s.isSubscribed=!1,r.push(s))}));else{const e=null==t?void 0:t.filter((e=>e.type==uI.TRACK_TYPE_VIDEO));null==e||e.forEach((e=>{e.isSubscribed=!1,r.push(e)}))}}updateUserName(e,t,r){const i=this.getUserInfoById(e,t);i?(i.userInfo.nickname=r,this.logger.info(HE,"updateUserName success, userId: ".concat(e,", nickName: ").concat(r))):this.logger.error(HE,"updateUserName fail, user not exist}")}isRemoteUserSubscribed(e,t){var r,i;const n=this.getUserInfoById(e,t);if(!n)return this.logger.info(HE,"isRemoteUserSubscribed, user not exist}"),!1;const s=!(null===(r=n.mainStream)||void 0===r||!r.remoteTrackInfos)&&Array.from(n.mainStream.remoteTrackInfos.values()).filter((e=>e.isSubscribed)).length>0,o=!(null===(i=n.auxStream)||void 0===i||!i.remoteTrackInfos)&&Array.from(n.auxStream.remoteTrackInfos.values()).filter((e=>e.isSubscribed)).length>0;return s||o}getUserInfoByStreamId(e,t){return this.getAllUserInfos(e).find((e=>{var r,i;return(null===(r=e.mainStream)||void 0===r?void 0:r.remoteTrackInfos.has(t))||(null===(i=e.auxStream)||void 0===i?void 0:i.remoteTrackInfos.has(t))}))}getAllUserInfos(e){return Array.from(this.remoteUserInfos.values()).filter((t=>t.userInfo.roomId===e))}initializeRemoteUser(e,t){if(!e)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);const r={userInfo:e,userState:t?1:0,mainStream:null,auxStream:null},i=KE.generateUniqueId(e.userId,e.roomId);return this.remoteUserInfos.set(i,r),this.roomSsrc.has(e.roomId)||this.roomSsrc.set(e.roomId,{audioReceiveSsrcs:[],videoReceiveSsrcs:[]}),this.logger.info(HE,"initializeRemoteUser success, userInfo: ".concat(JSON.stringify(e))),r}updateRemoteUser(e){if(!e)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);const t=this.getUserInfoById(e.userId,e.roomId);return t?(e.nickname=e.nickname||t.userInfo.nickname,t.userInfo=e,this.logger.info(HE,"updateRemoteUser success, userInfo: ".concat(JSON.stringify(e))),t):null}initializeRemoteStream(e,t,r){const i=e===dI.STREAM_TYPE_MAIN?"main":"auxiliary",n=new sy({type:i,log:this.logger,userId:t,client:this.client,roomId:r}),s={remoteTrackInfos:new Map,remoteStream:n,subscribeOption:{audio:!1,video:!1}};if(!this.previousAudioSubscribedUsers.has(r)){const e=new Map;this.previousAudioSubscribedUsers.set(r,e)}return this.logger.info(HE,"initializeStreamInfo success, userId: ".concat(t,", type: ").concat(s.remoteStream.getType())),s}refreshRemoteStreamList(e,t,r){const i=null==t?void 0:t.filter((e=>e.content!==AI.desktop)),n=null==t?void 0:t.filter((e=>e.content===AI.desktop)),s=this.getUserInfoById(e.userId,e.roomId),o=this.doRefreshRemoteStreamList(e,dI.STREAM_TYPE_MAIN,i,r,!1),a=this.doRefreshRemoteStreamList(e,dI.STREAM_TYPE_AUX,n,null,!1),c=this.getUserInfoById(e.userId,e.roomId);return this.getAllPublishInfosWhenStreamUpdate(!s,o,a,c)}doRefreshRemoteStreamList(e,t,r,i,n){if(this.logger.info(HE,"doRefreshRemoteStreamList begin, streamType:".concat(t,",isLocalRejoinï¼").concat(n,",")+"userInfo: ".concat(JSON.stringify(e),", allVideoStreams: ").concat(JSON.stringify(r),", allAudioStreams: ").concat(JSON.stringify(i))),e.userId===this.localUserId)return null;const s=this.getUserInfoById(e.userId,e.roomId)?this.updateRemoteUser(e):this.initializeRemoteUser(e,!0),o=this.getStreamInfoByStreamType(t,s,e),a=KE.getRemoteTrackInfos(o),c=null==a?void 0:a.filter((e=>e.isSubscribed)),u=o.remoteTrackInfos,d=[],l=[],h=[];null==a||a.forEach((e=>{this.isPreTrackInvalid(r,i,e,n)&&(n&&e.isSubscribed&&(e.state=3),h.push(e),u.delete(e.trackId))})),this.refreshTracks(r,i,a,u,n,d,l,h),this.cachePlayInfo(e,t,r,i,h);const f=this.getTracks4Subscribe(e,t,o.remoteStream,d,h),p=this.getTracks4UnSubscribe(h),m=Array.from(o.remoteTrackInfos.values());return this.updateRemoteStreamTracks(m,o.remoteStream),{remoteStream:o.remoteStream,preTracks:a,curTracks:m,addedTracks:d,updatedTracks:l,removedTracks:h,subscribedTracks:c,tracks4Subscribe:f,tracks4Unsubscribe:p,allSubscribeTracks:null==m?void 0:m.filter((e=>e.isSubscribed))}}refreshTracks(e,t,r,i,n,s,o,a){(null!=e&&e.length||null!=t&&t.length)&&(null==r||r.forEach((e=>{2===e.state&&(a.push(e),i.delete(e.trackId))}))),this.refreshVideoStreamTracks(e,r,i,n,s,o),this.refreshAudioStreamTracks(t,r,i,n,s,o)}refreshVideoStreamTracks(e,t,r,i,n,s){null==e||e.forEach((e=>{const o=null==t?void 0:t.find((t=>t.trackId===e.streamUid.toString()));if(o){const t=KE.generateUpdateVideoTrack(e,o);r.set(e.streamUid.toString(),t),2===o.state||i?(t.isSubscribed=!1,t.isTrackReady=!1,n.push(t)):KE.isSameResolution(o,e)&&!KE.isMuteStatusChange(o,e)||s.push(o)}else{const t=KE.generateNewVideoTrack(e);r.set(e.streamUid.toString(),t),n.push(t)}}))}refreshAudioStreamTracks(e,t,r,i,n,s){null==e||e.forEach((e=>{if("main"===(null==e?void 0:e.content)){const o=null==t?void 0:t.find((t=>t.trackId===e.streamUid.toString()));if(o){const t=KE.generateUpdateAudioTrack(e,o);r.set(e.streamUid.toString(),t),2===o.state||i?(t.isSubscribed=!1,t.isTrackReady=!1,n.push(t)):KE.isMuteStatusChange(o,e)&&s.push(o)}else{const t=KE.generateNewAudioTrack(e);r.set(e.streamUid.toString(),t),n.push(t)}}}))}remoteUserReconnect(e){if(!e)return;const t=this.getUserInfoById(e.userId,e.roomId);if(!t)return this.logger.error(HE,"remoteUserReconnect, user not exist"),null;this.isRemoteUserSubscribed(e.userId,e.roomId)&&this.cacheHistorySubscription(t),t.userState=2,this.logger.info(HE,"remoteUserReconnect, update user state to rejoining")}cacheHistorySubscription(e){if(!e)return null;const t=this.getSubscribedTracksInfo(e.userInfo.userId,e.userInfo.roomId,dI.STREAM_TYPE_MAIN),r=this.getSubscribedTracksInfo(e.userInfo.userId,e.userInfo.roomId,dI.STREAM_TYPE_AUX);null==t||t.forEach((e=>{e.state=2})),null==r||r.forEach((e=>{e.state=2}))}getSubscribedTracksInfo(e,t,r){var i,n;const s=this.getUserInfoById(e,t);if(!s)return this.logger.error(HE,"getSubscribedMainTracksInfo, user not exist}"),null;const o=r===dI.STREAM_TYPE_MAIN?null===(i=s.mainStream)||void 0===i?void 0:i.remoteTrackInfos:null===(n=s.auxStream)||void 0===n?void 0:n.remoteTrackInfos;return o&&Array.from(o.values()).filter((e=>e.isSubscribed))}getStreamInfoByStreamType(e,t,r){if(!(e===dI.STREAM_TYPE_MAIN?t.mainStream:t.auxStream)){const i=this.initializeRemoteStream(e,r.userId,r.roomId);e===dI.STREAM_TYPE_MAIN?t.mainStream=i:t.auxStream=i}return e===dI.STREAM_TYPE_MAIN?t.mainStream:t.auxStream}static generateNewVideoTrack(e){return{pt:e.pt,content:e.content,streamType:e.content===AI.desktop?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN,trackId:e.streamUid.toString(),isSubscribed:!1,isTrackReady:!1,pssrc:e.ssrc,cssrc:0,type:uI.TRACK_TYPE_VIDEO,width:e.width,height:e.height,state:0,mute:e.mute}}static generateNewAudioTrack(e){return{pt:e.pt,content:e.content,streamType:e.content===AI.desktop?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN,trackId:e.streamUid.toString(),isSubscribed:!1,isTrackReady:!1,pssrc:e.ssrc,cssrc:0,type:uI.TRACK_TYPE_AUDIO,state:0,mute:e.mute}}static generateUpdateVideoTrack(e,t){return{pt:e.pt,content:e.content,streamType:e.content===AI.desktop?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN,trackId:e.streamUid.toString(),isSubscribed:t.isSubscribed,isTrackReady:t.isTrackReady,pssrc:t.pssrc,cssrc:t.cssrc,type:uI.TRACK_TYPE_VIDEO,width:e.width,height:e.height,state:t.state,mute:e.mute}}static generateUpdateAudioTrack(e,t){return{pt:e.pt,content:e.content,streamType:e.content===AI.desktop?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN,trackId:e.streamUid.toString(),isSubscribed:t.isSubscribed,isTrackReady:t.isTrackReady,pssrc:t.pssrc,cssrc:t.cssrc,type:uI.TRACK_TYPE_AUDIO,state:t.state,mute:e.mute}}updateRemoteStream(e,t,r){const i=null==t?void 0:t.filter((e=>e.content!==AI.desktop)),n=null==t?void 0:t.filter((e=>e.content===AI.desktop)),s=this.doUpdateRemoteStream(e,dI.STREAM_TYPE_MAIN,i,r),o=this.doUpdateRemoteStream(e,dI.STREAM_TYPE_AUX,n,null),a=this.getUserInfoById(e.userId,e.roomId);return{userInfo:a.userInfo,preUserState:a.userState,curUserState:a.userState,isUserNameChanged:null,mainStream:s,auxStream:o}}doUpdateRemoteStream(e,t,r,i){this.logger.info(HE,"updateRemoteStreamInfo begin, streamType:".concat(t)+"userInfo: ".concat(JSON.stringify(e),", videoStreams: ").concat(JSON.stringify(r),", audioStreams: ").concat(JSON.stringify(i),","));if(!this.getUserInfoById(e.userId,e.roomId))return this.logger.error(HE,"updateRemoteStream, user not exist"),null;const n=this.getUserInfoById(e.userId,e.roomId),s=this.getStreamInfoByStreamType(t,n,e),o=KE.getRemoteTrackInfos(s),a=null==o?void 0:o.filter((e=>e.isSubscribed)),c=s.remoteTrackInfos,u=[];null==r||r.forEach((e=>{const t=null==o?void 0:o.find((t=>t.trackId===e.streamUid.toString()));if(t&&(!KE.isSameResolution(t,e)||KE.isMuteStatusChange(t,e))){const r=KE.generateUpdateVideoTrack(e,t);c.set(e.streamUid.toString(),r),u.push(t)}})),null==i||i.forEach((e=>{const t=null==o?void 0:o.find((t=>t.trackId===e.streamUid.toString()));if(t&&KE.isMuteStatusChange(t,e)){const r=KE.generateUpdateAudioTrack(e,t);c.set(e.streamUid.toString(),r),u.push(t)}}));const d=Array.from(s.remoteTrackInfos.values());return this.updateRemoteStreamTracks(d,s.remoteStream),{remoteStream:s.remoteStream,preTracks:o,curTracks:d,addedTracks:[],updatedTracks:u,removedTracks:[],subscribedTracks:a,tracks4Subscribe:[],tracks4Unsubscribe:[],allSubscribeTracks:null==d?void 0:d.filter((e=>e.isSubscribed))}}getAllPublishInfosWhenStreamUpdate(e,t,r,i){const n={userInfo:i.userInfo,preUserState:e?0:i.userState,curUserState:i.userState,isUserNameChanged:null,mainStream:t,auxStream:r},s=[];return s.push(n),s.push(...this.getOtherRemoteUserPublishInfos([i.userInfo.userId],i.userInfo.roomId)),this.logger.info(HE,"updateRemoteStreamInfo success, ".concat(this.getTracksUpdateInfosString(s))),s}getOtherRemoteUserPublishInfos(e,t){const r=[];return this.getAllUserInfos(t).forEach((t=>{if(!e.includes(t.userInfo.userId)){var i,n,s,o,a,c;const e=null!==(i=t.mainStream)&&void 0!==i&&null!==(n=i.remoteTrackInfos)&&void 0!==n&&n.size?Array.from(t.mainStream.remoteTrackInfos.values()).filter((e=>e.isSubscribed)):null,u=null!==(s=t.auxStream)&&void 0!==s&&null!==(o=s.remoteTrackInfos)&&void 0!==o&&o.size?Array.from(t.auxStream.remoteTrackInfos.values()).filter((e=>e.isSubscribed)):null,d={userInfo:t.userInfo,curUserState:t.userState,preUserState:t.userState,mainStream:{remoteStream:null===(a=t.mainStream)||void 0===a?void 0:a.remoteStream,allSubscribeTracks:e},auxStream:{remoteStream:null===(c=t.auxStream)||void 0===c?void 0:c.remoteStream,allSubscribeTracks:u}};r.push(d)}})),r}static getAnotherStreamUpdateInfo(e,t){const r=e===dI.STREAM_TYPE_MAIN?t.auxStream:t.mainStream,i=KE.getRemoteTrackInfos(r),n=i?i.filter((e=>e.isSubscribed)):null;return{remoteStream:null==r?void 0:r.remoteStream,preTracks:i,curTracks:i,addedTracks:null,updatedTracks:null,removedTracks:null,subscribedTracks:n?[...n]:null,tracks4Subscribe:null,tracks4Unsubscribe:null,allSubscribeTracks:n?[...n]:null}}getTracksUpdateInfosString(e){if(!e)return"";let t="";return e.forEach((e=>{t=t+KE.getTracksUpdateInfoString(e)+" "})),t}static getTracksUpdateInfoString(e){var t,r,i,n,s,o,a,c,u,d,l,h,f,p,m,_,g,S,v,R,T,I,y,E,b,C,A,k,w,O,P,M,D,x,N,U,L,V,B,Y,F,j,z,H,K,W,G,J,q,X,Q,Z,$,ee;return e?"userId:".concat(e.userInfo.userId,", preUserState: ").concat(e.preUserState,",curUserState: ").concat(e.curUserState,",")+"main stream:"+"".concat(null!==(t=e.mainStream)&&void 0!==t&&null!==(r=t.preTracks)&&void 0!==r&&r.length?"preTracks:"+JSON.stringify(null===(i=e.mainStream)||void 0===i?void 0:i.preTracks)+",":"")+"".concat(null!==(n=e.mainStream)&&void 0!==n&&null!==(s=n.curTracks)&&void 0!==s&&s.length?"curTracks:"+JSON.stringify(null===(o=e.mainStream)||void 0===o?void 0:o.curTracks)+",":"")+"".concat(null!==(a=e.mainStream)&&void 0!==a&&null!==(c=a.addedTracks)&&void 0!==c&&c.length?"addedTracks:"+JSON.stringify(null===(u=e.mainStream)||void 0===u?void 0:u.addedTracks)+",":"")+"".concat(null!==(d=e.mainStream)&&void 0!==d&&null!==(l=d.updatedTracks)&&void 0!==l&&l.length?"updatedTracks:"+JSON.stringify(null===(h=e.mainStream)||void 0===h?void 0:h.updatedTracks)+",":"")+"".concat(null!==(f=e.mainStream)&&void 0!==f&&null!==(p=f.removedTracks)&&void 0!==p&&p.length?"removedTracks:"+JSON.stringify(null===(m=e.mainStream)||void 0===m?void 0:m.removedTracks)+",":"")+"".concat(null!==(_=e.mainStream)&&void 0!==_&&null!==(g=_.subscribedTracks)&&void 0!==g&&g.length?"subscribedTracks:"+JSON.stringify(null===(S=e.mainStream)||void 0===S?void 0:S.subscribedTracks)+",":"")+"".concat(null!==(v=e.mainStream)&&void 0!==v&&null!==(R=v.tracks4Subscribe)&&void 0!==R&&R.length?"tracks4Subscribe:"+JSON.stringify(null===(T=e.mainStream)||void 0===T?void 0:T.tracks4Subscribe)+",":"")+"".concat(null!==(I=e.mainStream)&&void 0!==I&&null!==(y=I.tracks4Unsubscribe)&&void 0!==y&&y.length?"tracks4Unsubscribe:"+JSON.stringify(null===(E=e.mainStream)||void 0===E?void 0:E.tracks4Unsubscribe)+",":"")+"".concat(null!==(b=e.mainStream)&&void 0!==b&&null!==(C=b.allSubscribeTracks)&&void 0!==C&&C.length?"allSubscribeTracks:"+JSON.stringify(null===(A=e.mainStream)||void 0===A?void 0:A.allSubscribeTracks)+",":"")+"aux stream:"+"".concat(null!==(k=e.auxStream)&&void 0!==k&&null!==(w=k.preTracks)&&void 0!==w&&w.length?"preTracks:"+JSON.stringify(null===(O=e.auxStream)||void 0===O?void 0:O.preTracks)+",":"")+"".concat(null!==(P=e.auxStream)&&void 0!==P&&null!==(M=P.curTracks)&&void 0!==M&&M.length?"curTracks:"+JSON.stringify(null===(D=e.auxStream)||void 0===D?void 0:D.curTracks)+",":"")+"".concat(null!==(x=e.auxStream)&&void 0!==x&&null!==(N=x.addedTracks)&&void 0!==N&&N.length?"addedTracks:"+JSON.stringify(null===(U=e.auxStream)||void 0===U?void 0:U.addedTracks)+",":"")+"".concat(null!==(L=e.auxStream)&&void 0!==L&&null!==(V=L.updatedTracks)&&void 0!==V&&V.length?"updatedTracks:"+JSON.stringify(null===(B=e.auxStream)||void 0===B?void 0:B.updatedTracks)+",":"")+"".concat(null!==(Y=e.auxStream)&&void 0!==Y&&null!==(F=Y.removedTracks)&&void 0!==F&&F.length?"removedTracks:"+JSON.stringify(null===(j=e.auxStream)||void 0===j?void 0:j.removedTracks)+",":"")+"".concat(null!==(z=e.auxStream)&&void 0!==z&&null!==(H=z.subscribedTracks)&&void 0!==H&&H.length?"subscribedTracks:"+JSON.stringify(null===(K=e.auxStream)||void 0===K?void 0:K.subscribedTracks)+",":"")+"".concat(null!==(W=e.auxStream)&&void 0!==W&&null!==(G=W.tracks4Subscribe)&&void 0!==G&&G.length?"tracks4Subscribe:"+JSON.stringify(null===(J=e.auxStream)||void 0===J?void 0:J.tracks4Subscribe)+",":"")+"".concat(null!==(q=e.auxStream)&&void 0!==q&&null!==(X=q.tracks4Unsubscribe)&&void 0!==X&&X.length?"tracks4Unsubscribe:"+JSON.stringify(null===(Q=e.auxStream)||void 0===Q?void 0:Q.tracks4Unsubscribe)+",":"")+"".concat(null!==(Z=e.auxStream)&&void 0!==Z&&null!==($=Z.allSubscribeTracks)&&void 0!==$&&$.length?"allSubscribeTracks:"+JSON.stringify(null===(ee=e.auxStream)||void 0===ee?void 0:ee.allSubscribeTracks):""):""}updateRemoteStreamTracks(e,t){if(!t)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);if(!e)return void this.logger.error(HE,"updateRemoteStreamTracks , curAllTracks is null");const r=new Map;e.filter((e=>e.type===uI.TRACK_TYPE_VIDEO)).forEach((e=>{r.set(e.trackId.toString(),{streamId:e.trackId.toString(),width:e.width,height:e.height})}));const i=e.some((e=>e.type===uI.TRACK_TYPE_AUDIO)),n=t.isAuxiliary()?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN;t.updateRemoteResolutions(n,[...r.values()],i)}isPreTrackInvalid(e,t,r,i){return!!i||2!==r.state&&(r.type===uI.TRACK_TYPE_VIDEO&&this.isPreVideoTrackRemoved(e,r)||r.type===uI.TRACK_TYPE_AUDIO&&this.isPreAudioTrackRemoved(t,r))}isPreVideoTrackRemoved(e,t){return!(null!=e&&e.some((e=>e.streamUid.toString()===t.trackId)))}isPreAudioTrackRemoved(e,t){return!(null!=e&&e.some((e=>e.streamUid.toString()===t.trackId)))}static isSameResolution(e,t){if(!e||!t)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);return e.height===t.height&&e.width===t.width}static isMuteStatusChange(e,t){if(!e||!t)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);return e.mute!==t.mute}clear(e){if(e){for(const t of this.remoteUserInfos.keys())t.indexOf("#".concat(e))>0&&(this.remoteUserInfos.get(t),this.remoteUserInfos.delete(t));this.roomSsrc.delete(e),this.previousAudioSubscribedUsers.delete(e)}}static generateUniqueId(e,t){if(!e)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);return"".concat(e,"#").concat(t)}}function WE(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}const GE=[200,201,204];const JE=new class{setLogServerConfigs(e){this.logServerConfigs=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?WE(Object(r),!0).forEach((function(t){bu(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):WE(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({logServerAppId:tR,payLoad:"",signature:""},e),this.logServerConfigs.logServerAppId=this.logServerConfigs.logServerAppId||tR}async uploadLogFile(e,t){let r;try{const i=this.initConfigs(t);if(!i.payLoad||!i.signature)return void e.warn("LogServer","init config failed, do not upload.");const n=await this.getServerInfo(i);if(n&&0===n.resCode){this.serverDomain=n.serverDomain,this.accessToken=n.accessToken;const t=await Qg.getLogFile(e,i.shaSN),s=await this.getUploadInfo(t,i);s&&0===s.resCode?(this.fileUniqueFlag=s.fileUniqueFlag,this.method=s.uploadInfoList[0].method,this.uploadUrl=s.uploadInfoList[0].uploadUrl,this.headers=s.uploadInfoList[0].headers,r=await this.upload2Obs(t.content),r&&(r=await this.notifyUploadSucc(i))):e.warn("LogServer","post upload info fail: ".concat(JSON.stringify(s)))}else e.warn("LogServer","get server fail: ".concat(JSON.stringify(n)))}catch(i){e.warn("LogServer","upload file error: ".concat(i))}finally{e.getProvider().onLogUploadResult(0===r?200:r)}}initConfigs(e){var t,r,i;const n=(null==e?void 0:e.taskId)||Hg.getDeviceID().replace(/[-]/g,""),s=(null==e?void 0:e.payLoad)||(null===(t=this.logServerConfigs)||void 0===t?void 0:t.payLoad);return{shaSN:n,logServerAppId:(null==e?void 0:e.logServerAppId)||(null===(r=this.logServerConfigs)||void 0===r?void 0:r.logServerAppId),payLoad:s,signature:(null==e?void 0:e.signature)||(null===(i=this.logServerConfigs)||void 0===i?void 0:i.signature)}}async getServerInfo(e){const t="".concat(e.payLoad,"&appID=").concat(e.logServerAppId),r=await aR.fetch("".concat(eR,"/v2/getServerDomain?appID=").concat(e.logServerAppId),{method:"POST",mode:"cors",cache:"no-cache",body:t},{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json",Authorization:"HMAC-SHA256 appID=".concat(e.logServerAppId,', signature="').concat(e.signature,'"')});return null==r?void 0:r.data}async getUploadInfo(e,t){const r="".concat(t.payLoad,"&logType=0&fileName=").concat(e.urlFileNameEncode,'&fileHashList=[{"fileMd5":"","fileSha256":"').concat(e.sha256,'","fileSize":"').concat(e.length,'"}]&fileSize=').concat(e.length,"&encryptKey=asdfghhjjfsdafaerqw&patchSize=").concat(104857600,"&patchNum=2&patchVer=0"),i="POST&/v2/getUploadInfo&appID=".concat(t.logServerAppId,"&").concat(r,"&appID=").concat(t.logServerAppId),n=rg.exports.enc.Base64.stringify(rg.exports.HmacSHA256(i,this.accessToken)),s=await aR.fetch("https://".concat(this.serverDomain,"/v2/getUploadInfo?appID=").concat(t.logServerAppId),{method:"POST",mode:"cors",cache:"no-cache",body:r},{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json",Authorization:"HMAC-SHA256 appID=".concat(t.logServerAppId,', signature="').concat(n,'"')});return null==s?void 0:s.data}async upload2Obs(e){const t=await aR.fetch("".concat(this.uploadUrl),{method:"".concat(this.method),mode:"cors",cache:"no-cache",body:e},{Authorization:this.headers.Authorization.toString(),"Content-MD5":"","Content-Type":this.headers["Content-Type"],"x-amz-content-sha256":this.headers["x-amz-content-sha256"],"x-amz-date":this.headers["x-amz-date"]});return GE.includes(null==t?void 0:t.httpCode)}async notifyUploadSucc(e){var t;const r=Hg.getCurrentTime(),i="".concat(r.year).concat(r.month).concat(r.day).concat(r.hour).concat(r.min).concat(r.sec),n="".concat(e.payLoad,"&fileUniqueFlag=").concat(this.fileUniqueFlag,"&uploadTime=").concat(i),s="POST&/v2/notifyUploadSucc&appID=".concat(e.logServerAppId,"&").concat(n,"&appID=").concat(e.logServerAppId),o=rg.exports.HmacSHA256(s,this.accessToken),a=rg.exports.enc.Base64.stringify(o),c=await aR.fetch("https://".concat(this.serverDomain,"/v2/notifyUploadSucc?appID=").concat(e.logServerAppId),{method:"POST",mode:"cors",cache:"no-cache",body:n},{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json",Authorization:"HMAC-SHA256 appID=".concat(e.logServerAppId,', signature="').concat(a,'"')});return c&&(null===(t=c.data)||void 0===t?void 0:t.resCode)}},qE=1e4,XE=(()=>{let e=0;return()=>e++})(),QE={FHD:AI.main,HD:AI.middle1,SD:AI.middle2,LD:AI.slides},ZE="Client";class $E{constructor(e){bu(this,"callbackMap",new Map),bu(this,"onCallbackMap",new Map),bu(this,"status",0),bu(this,"localRejoinFlag",!1),bu(this,"getOnCallback",((e,t)=>{const r="".concat(e,"_").concat(null==t?void 0:t.name),i=t=>{if(this.callbackMap.get(r)){const i=Hg.getCurrentTimestamp();let n=i+5e3,s=!1;const o=setTimeout((()=>{s=!0,clearTimeout(o),this.stat.recordCallbackInfo(e.toString(),"Client",i,n,t,(e=>e&&e instanceof iy?JSON.stringify(e.getStatInfo()):JSON.stringify(e||{})))}),1e4);this.callbackMap.get(r)&&this.callbackMap.get(r)(t),s||(n=Hg.getCurrentTimestamp(),clearTimeout(o),this.stat.recordCallbackInfo(e.toString(),"Client",i,n,t,(e=>e&&e instanceof iy?JSON.stringify(e.getStatInfo()):JSON.stringify(e||{}))))}};return this.callbackMap.set(r,t),this.onCallbackMap.set(r,i),i})),bu(this,"getOffCallback",((e,t)=>{const r="".concat(e,"_").concat(null==t?void 0:t.name),i=this.onCallbackMap.get(r);return this.onCallbackMap.get(r)&&this.onCallbackMap.delete(r),this.callbackMap.get(r)&&this.callbackMap.delete(r),i})),this.taskLocker=new uE,this.roomId="",this.clientConfig=e,this.userInfo=void 0,this.waitConfigCallbackFunc=void 0,this.topNAudioVolume=100,this.audioPolicy=0,this.connectState={prevState:"DISCONNECTED",curState:"DISCONNECTED"},this.clientSymbol=Symbol("client_".concat(XE(),"_").concat(Hg.getCurrentTimestamp())),this.eventEmitter=new xv,this.logger=Qg.getLogger(this),this.logger.info(ZE,"HRTC VERSION = ".concat(Kv,", userAgent = ").concat(navigator.userAgent)),this.top3VolumeUserIds=[],this.stat=new _I(this.logger,this.clientConfig),LI.initDeviceChangedNotify(this.eventEmitter,!1),this.accessManager=new YE(this.logger),this.lastCycleFrameDecodedMap=new Map,this.streamInterruptedUsersMap=new Map,this.streamDetectionCriterion=0,this.audioStreams4TopN=new dE,this.downLinkData=null,this.upLinkData=null,this.preNetQuality=null,this.remoteUserManager=new KE(this),this.stat.setRemoteUserManager(this.remoteUserManager),this.connectionsManager=new xE(this.logger,this.stat),this.streamPublishManager=new hE,this.audioLevelInterval=1e3,this.isLoopRejoining=!1,this.upStreamData=null,this.sdpRepInfo=null,this.startupQoSMap=new Map}getSessionStatus(){return this.status}on(e,t){const r=this.getOnCallback(e,t);this.eventEmitter.on(e,r)}off(e,t){const r=this.getOffCallback(e,t);r&&this.eventEmitter.removeListener(e,r)}getSymbol(){return this.clientSymbol}getInfo(){var e,t;return{appId:this.clientConfig.appId,roomId:this.roomId,userName:null===(e=this.userInfo)||void 0===e?void 0:e.userName,userId:null===(t=this.userInfo)||void 0===t?void 0:t.userId,domain:this.clientConfig.domain,upStreamData:this.upStreamData,sdpRepInfo:this.sdpRepInfo,countryCode:this.clientConfig.countryCode}}enableTopThreeAudioMode(e){return this.enableTopThreeAudioModeImpl(e)}enableTopThreeAudioModeImpl(e){let t=!1;return e&&0===this.status&&(this.audioPolicy=1,t=!0),t}async switchAudioMode(e){try{if(await this.taskLocker.Lock("".concat(ZE,":switchAudioMode")),3!==e&&2!==e)throw this.logger.error(ZE,"audioMode is invalid"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);return e%=2,this.logger.info(ZE,"switchAudioMode start, new audioPolicy: ".concat(e,", original audioPolicy: ").concat(this.audioPolicy)),2===this.status&&(0===e&&1===this.audioPolicy?(this.audioPolicy=e,await this.switchAudioPolicyTop2User()):1===e&&0===this.audioPolicy&&(this.audioPolicy=e,await this.switchAudioPolicyUser2Top(),this.top3VolumeUserIds&&this.top3VolumeUserIds.length>0&&this.eventEmitter.emit(MI.VolumeIndicator,{userVolumeInfos:this.top3VolumeUserIds}))),this.stat.getMediaStat().setAudioPolicy(this.audioPolicy),this.taskLocker.unLock("".concat(ZE,":switchAudioMode end")),0===this.audioPolicy?2:3}catch(tb){this.taskLocker.unLock("".concat(ZE,":switchAudioMode failed")),this.logger.error(ZE,"switchAudioMode, audioPolicy: ".concat(e,", error: ").concat(tb))}return this.audioPolicy}async switchAudioPolicyTop2User(){await this.signal.changeAudioPolicy(0),await this.unsubscribeAudio4Top(),await this.resubscribeUserAudio()}async resubscribeUserAudio(){this.logger.info(ZE,"resubscribeUserAudio start");const e=this.remoteUserManager.resubscribeMainStreamAudio(this.roomId);await this.updateSubscribe(e),null==e||e.forEach((e=>{var t,r,i,n;(null===(t=e.mainStream)||void 0===t||null===(r=t.tracks4Subscribe)||void 0===r?void 0:r.length)>0&&(null===(i=e.mainStream)||void 0===i||null===(n=i.remoteStream)||void 0===n||n.rePlayAudio())}))}async switchAudioPolicyUser2Top(){await this.unsubscribeAudio4SubscribeUsers(),await this.signal.changeAudioPolicy(1),this.remoteUserManager.enableTopThreeAudioMode(this.roomId),await this.connectionsManager.generateAndSetOfferSdpByHandler(dI.STREAM_TYPE_MAIN),await this.connectionsManager.generateAndSetAnswerSdpByHandler(dI.STREAM_TYPE_MAIN,this.addSsrc4Top3.bind(this))}async unsubscribeAudio4SubscribeUsers(){this.logger.info(ZE,"unsubscribeAudio4SubscribeUsers start");const e=this.remoteUserManager.unsubscribeAllMainStreamAudio(this.roomId);await this.updateSubscribe(e)}async unsubscribeAudio4Top(){await this.unsubscribeUsersAudio()}async unsubscribeAudio4SubscribeAll(){await this.unsubscribeUsersAudio()}async unsubscribeUsersAudio(){const e=[];for(const t of this.audioStreams4TopN.getAudioStreams()){const r=t.ssrc;this.audioStreams4TopN.close(t.streamId),this.logger.info(ZE,"delete audio ssrc:".concat(r)),e.push(r)}e.length>0&&await this.connectionsManager.deleteUser(dI.STREAM_TYPE_MAIN,null,e)}async getLocalAudioStats(){const e=new Map,t=this.streamPublishManager.getPublishedMainAudioTrackInfo();if(!t)return this.logger.error(ZE,"local stream has not published yet."),e;if("function"!=typeof t.sender.getStats)return this.logger.error(ZE,"audio rtpsender is not support getStat"),e;const r={bytesSent:0,packetsSent:0},i=this.streamPublishManager.getLocalStream(dI.STREAM_TYPE_MAIN),n=this.userInfo.userId||(null==i?void 0:i.getUserId()),s=pI.getLatestStats("roomId",dI.STREAM_TYPE_MAIN,"".concat(AT.OutboundRTPAudio,"_").concat(t.ssrc));return s&&(r.bytesSent=s.bytesSent,r.packetsSent=s.packetsSent,e.set(n,r)),e}async getLocalVideoStats(){const e=new Map,t={mainStream:[],subStream:null};let r=null,i=null;const n=this.streamPublishManager.getMainStreamVideoPublishInfo();if(n){const i=this.streamPublishManager.getLocalStream(dI.STREAM_TYPE_MAIN),s=this.userInfo.userId||(null==i?void 0:i.getUserId());for(const o of n){r={bytesSent:0,packetsSent:0,framesEncoded:0,framesSent:0,frameWidth:0,frameHeight:0};const i=pI.getLatestStats("roomId",dI.STREAM_TYPE_MAIN,"".concat(AT.OutboundRTPVideo,"_").concat(o.ssrc));i&&(r.bytesSent=Hg.getValue(i.bytesSent,0),r.packetsSent=Hg.getValue(i.packetsSent,0),r.framesEncoded=Hg.getValue(i.framesEncoded,0),r.framesSent=Hg.getValue(i.framesSent,0),r.frameWidth=Hg.getValue(i.frameWidth,0),r.frameHeight=Hg.getValue(i.frameHeight,0),e.has(s)?e.get(s).mainStream.push(r):(t.mainStream.push(r),e.set(s,t)))}}else this.logger.debug(ZE,"have no local mainstream collect stats");const s=this.streamPublishManager.getPublishedAuxVideoTrackInfo();if(s&&"function"==typeof s.sender.getStats){const r=this.streamPublishManager.getLocalStream(dI.STREAM_TYPE_MAIN),n=this.userInfo.userId||(null==r?void 0:r.getUserId());i={bytesSent:0,packetsSent:0,framesEncoded:0,framesSent:0,frameWidth:0,frameHeight:0};const o=pI.getLatestStats("roomId",dI.STREAM_TYPE_AUX,"".concat(AT.OutboundRTPVideo,"_").concat(s.ssrc));o&&(i.bytesSent=Hg.getValue(o.bytesSent,0),i.packetsSent=Hg.getValue(o.packetsSent,0),i.framesEncoded=Hg.getValue(o.framesEncoded,0),i.framesSent=Hg.getValue(o.framesSent,0),i.frameWidth=Hg.getValue(o.frameWidth,0),i.frameHeight=Hg.getValue(o.frameHeight,0),e.has(n)?e.get(n).subStream=i:(t.subStream=i,e.set(n,t)))}else this.logger.debug(ZE,"have no local substream collect stats");return e}async getRemoteAudioStats(){const e=new Map,t=this.remoteUserManager.getAllUserStreamsByType(this.roomId,dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_AUDIO),r=this.connectionsManager.getReceivers(dI.STREAM_TYPE_MAIN);if(!r||0===r.length)return this.logger.error(ZE,"getRemoteAudioStats, peerConnection is not support getReceivers"),e;for(const i of t){const t=i.userId;if(i.mainStream)for(const r of i.mainStream.tracks){const i={bytesReceived:0,packetsReceived:0,packetsLost:0},n=pI.getLatestStats("roomId",dI.STREAM_TYPE_MAIN,"".concat(AT.InboundRTPAudio,"_").concat(r.cssrc));t&&n&&(i.bytesReceived=Hg.getValue(n.bytesReceived,0),i.packetsReceived=Hg.getValue(n.packetsReceived,0),i.packetsLost=Hg.getValue(n.packetsLost,0),this.connectionsManager.calcChangedStatistic(n.id,i,["bytesReceived","packetsReceived","packetsLost"]),e.set(t,i))}}return e}async getRemoteVideoStats(){const e=new Map,t=this.remoteUserManager.getAllUserStreamsByType(this.roomId,null,uI.TRACK_TYPE_VIDEO);for(const r of t)r.mainStream&&await this.getRemoteVideoTracksStatistic(r.userId,dI.STREAM_TYPE_MAIN,!1,r.mainStream.tracks,e),r.auxStream&&await this.getRemoteVideoTracksStatistic(r.userId,dI.STREAM_TYPE_AUX,!0,r.auxStream.tracks,e);return e}isSendingStream(){var e,t;const r=(null===(e=this.connectionsManager.getSenders(dI.STREAM_TYPE_MAIN))||void 0===e?void 0:e.length)>0,i=(null===(t=this.connectionsManager.getSenders(dI.STREAM_TYPE_AUX))||void 0===t?void 0:t.length)>0;return r||i}isReceivingStream(){var e,t;const r=(null===(e=this.connectionsManager.getReceivers(dI.STREAM_TYPE_MAIN))||void 0===e?void 0:e.length)>0,i=(null===(t=this.connectionsManager.getReceivers(dI.STREAM_TYPE_AUX))||void 0===t?void 0:t.length)>0;return r||i}async getRemoteVideoTracksStatistic(e,t,r,i,n){if(i&&0!==i.length)for(const s of i){const i=pI.getLatestStats("roomId",r?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN,"".concat(AT.InboundRTPVideo,"_").concat(s.cssrc));if(!i)continue;const o={bytesReceived:0,packetsReceived:0,packetsLost:0,framesDecoded:0,frameWidth:0,frameHeight:0};o.bytesReceived=Hg.getValue(i.bytesReceived,0),o.packetsReceived=Hg.getValue(i.packetsReceived,0),o.packetsLost=Hg.getValue(i.packetsLost,0),o.framesDecoded=Hg.getValue(i.framesDecoded,0),this.connectionsManager.calcChangedStatistic(i.id,o,["bytesReceived","packetsReceived","packetsLost","framesDecoded"]);const a=i.trackId||i.remoteId;if(a&&pI.getLatestStats("roomId",r?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN,a)){const e=pI.getLatestStats("roomId",r?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN,a);o.frameWidth=e.frameWidth,o.frameHeight=e.frameHeight}if(n.has(e))t===dI.STREAM_TYPE_AUX?n.get(e).subStream=o:n.get(e).mainStream.push(o);else{const r={mainStream:[],subStream:null};t===dI.STREAM_TYPE_AUX?r.subStream=o:r.mainStream.push(o),n.set(e,r)}}}async getDownloadStatistic(e){const t=new Map,r=this.remoteUserManager.getAllUserStreamsByType(this.roomId,null,e);for(const s of r)await this.getTrackDownloadStatistic([...s.mainStream.tracks,...s.auxStream.tracks],t);if(0===t.size)return this.downLinkData=null,-1;let i=0,n=0;for(const[s,o]of t)if(this.downLinkData&&this.downLinkData.has(s)){const e=o.packetsReceived-this.downLinkData.get(s).packetsReceived;e>0&&(n+=e,i+=o.packetsLost-this.downLinkData.get(s).packetsLost)}else n+=o.packetsReceived,i+=o.packetsLost;return this.downLinkData=t,n>0?i/n*100:-1}async getTrackDownloadStatistic(e,t){const r=this.connectionsManager.getReceivers(dI.STREAM_TYPE_MAIN);for(let i=0;i<r.length;i++){if("function"==typeof r[i].getStats)for(const r of e){const e=r.type===uI.TRACK_TYPE_VIDEO?"".concat(AT.InboundRTPVideo):"".concat(AT.InboundRTPAudio),i=pI.getLatestStats("roomId",dI.STREAM_TYPE_MAIN,"".concat(e,"_").concat(r.cssrc)),n={packetsReceived:0,packetsLost:0};i&&(n.packetsReceived=Hg.getValue(i.packetsReceived,0),n.packetsLost=Hg.getValue(i.packetsLost,0),this.connectionsManager.calcChangedStatistic(i.id,n),t.set(r.cssrc.toString(),n))}}}static getSender(e,t,r,i){return"audio"===e?r?r.sender:null:t||i?t&&t.sender||i&&i.sender:null}static getSenderType(e,t){return"audio"===e||t&&t.sender?dI.STREAM_TYPE_MAIN:dI.STREAM_TYPE_AUX}async getUploadStatistic(e){const t=this.streamPublishManager.getPublishedMainVideoTrackInfo(),r=this.streamPublishManager.getPublishedMainAudioTrackInfo(),i=this.streamPublishManager.getPublishedAuxVideoTrackInfo();if(!t&&!r&&!i)return-1;const n=$E.getSender(e,t,r,i);if(!n||"function"!=typeof n.getStats)return-1;const s={packetsLost:0,packetsSent:0},o=e===uI.TRACK_TYPE_VIDEO?"".concat(AT.OutboundRTPVideo):"".concat(AT.OutboundRTPAudio),a=e===uI.TRACK_TYPE_VIDEO?(null==t?void 0:t.ssrc)||(null==i?void 0:i.ssrc):r.ssrc,c=pI.getLatestStats("roomId",$E.getSenderType(e,t),"".concat(o,"_").concat(a));let u,d,l="";if(c&&(s.packetsSent=Hg.getValue(c.packetsSent,0),l=c.remoteId||""),l&&pI.getLatestStatsByRemoteId("roomId",$E.getSenderType(e,t),l)){const r=pI.getLatestStatsByRemoteId("roomId",$E.getSenderType(e,t),l);s.packetsLost=Hg.getValue(r.packetsLost,0)}return this.upLinkData?(d=s.packetsSent-this.upLinkData.packetsSent,u=s.packetsLost-this.upLinkData.packetsLost):(d=s.packetsSent,u=s.packetsLost),this.upLinkData=s,d>0?u/d*100:-1}getConnectionState(){return this.connectState.curState}async getTransportStats(){const e=this.stat.getMediaStat().getTransportMediaStats(),t=this.streamPublishManager.getPublishedMainVideoTrackInfo();if(t){const r=pI.getLatestStats("roomId",dI.STREAM_TYPE_MAIN,"".concat(AT.RemoteInboundRtpVideo,"_").concat(t.ssrc))||{};e.rtt=1e3*(r.roundTripTime||0)}else e.rtt=this.connectionsManager.getConnectionRTT();return e}getICETransportStat(e){return this.connectionsManager.getICETransportStat(e)}cleanTransportStats(){this.stat.clearMediaStatBytes()}onLogUploadRequest(e){this.stat.reportSignalReqForLogUpload(e)}onLogUploadResponse(e,t){this.stat.reportSignalRepForLogUpload(e,t)}onLogUploadResult(e){this.eventEmitter.emit(MI.LogUploaded,e),this.logger.info(ZE,"LogUploaded status[".concat(e,"]"))}onLogUploadProgress(e){this.eventEmitter.emit(MI.LogUploadProgress,e)}async join(e,t){return await this.joinImpl(e,t)}async joinImpl(e,t){Qg.addPrivacyString(null==t?void 0:t.userId),Qg.addPrivacyString(null==t?void 0:t.userName),Qg.addPrivacyString(null==t?void 0:t.signature),this.logger.info(ZE,"join room roomId:".concat(e," userId:").concat(t.userId," role:").concat(t.role));const r=[];let i="";try{var n,s;if(0!==this.status)throw this.logger.error(ZE,"room status error!"),this.stat.reportJoinInfo(wT.ROOM_NOT_AVAILABLE,void 0,!1,void 0,"room status error!"),new Eu(ou.RTC_ERR_CODE_STATUS_ERROR);rR.checkJoinParams(e,t);const o=dy.init(this.clientSymbol,e,t);this.userInfo=o,this.roomId=e;const a=await this.accessManager.getAccessInfo(this.clientConfig.countryCode,r);this.stat.getMediaStat().setAudioPolicy(this.audioPolicy),this.stat.setLocalUserInfo(o),await this.taskLocker.Lock("".concat(ZE,":joinImpl")),this.newSignal(a),this.signalEvent(),this.status=1,i=await this.signal.connect(o,r),this.logger.info(ZE,"joinImpl, actualAcsIp:".concat(i)),await this.waitNotifyConfig(r),await this.connectionsManager.initConnectionAndSdp(dI.STREAM_TYPE_MAIN,{onTrackHandler:this.onTrackHandler.bind(this)}),await this.connectionsManager.initConnectionAndSdp(dI.STREAM_TYPE_AUX,{onTrackHandler:this.onTrackHandler.bind(this)});const c=await this.signal.join(this.userInfo,this.connectionsManager.modifySdpCandidates(dI.STREAM_TYPE_MAIN),this.connectionsManager.modifySdpCandidates(dI.STREAM_TYPE_AUX),this.audioPolicy,this.connectionsManager.getPortType());this.sdpRepInfo=c.sdp,c.userInfos.forEach((e=>{this.stat.getMediaStat().setEncryInfo(e.userId,e.userEid)}));const u=String(c.roomUid);this.stat.setRoomUid(u);const d=null===(n=c.negSdp.find((e=>0===e.type)))||void 0===n?void 0:n.sdp,l=null===(s=c.negSdp.find((e=>1===e.type)))||void 0===s?void 0:s.sdp;let h;1===this.audioPolicy&&(h=this.addSsrc4Top3.bind(this)),this.connectionsManager.setSsrcsMapping(this.sdpRepInfo),await this.connectionsManager.handleAnswerSdpFromServer(dI.STREAM_TYPE_MAIN,d,h),await this.connectionsManager.handleAnswerSdpFromServer(dI.STREAM_TYPE_AUX,l),this.upStreamData=c.userInfos.find((e=>{var t;return e.userId===(null===(t=this.userInfo)||void 0===t?void 0:t.userId)})),this.remoteUserManager.initialize(this.userInfo.userId,c.sdp),this.stat.setSFUAddress(this.connectionsManager.getSfuInfoFromSdp(d,l)),this.signal.keepAlive(),this.status=2,this.logger.info(ZE,"join room success"),this.streamPublishManager.setSdpRepInfo(this.sdpRepInfo),this.statJoinRoomInfo(i,!1,r),this.cleanNetworkStatistic(),this.netQualityRegularReport(),this.cleanTransportStats(),this.setAudioLevelStatTimer();const f=setTimeout((async()=>{clearTimeout(f),await this.doRefreshRoomUserInfos(this.userInfo.roomId,c.userInfos,!1)}),0);this.taskLocker.unLock("".concat(ZE,":joinImpl"))}catch(tb){throw this.taskLocker.unLock("".concat(ZE,":joinImpl")),this.logger.error(ZE,"join occur errorï¼ ".concat(tb)),this.cleanup(),this.stat.reportJoinInfo(null==tb?void 0:tb.code,i,!1,r,null==tb?void 0:tb.message),await JE.uploadLogFile(this.logger),tb}}async reportLogs(){await JE.uploadLogFile(this.logger)}statJoinRoomInfo(e,t,r){this.stat.reportJoinInfo(0,e,t,r,""),this.stat.getMediaStat().setConnectionsManager(this.connectionsManager),pI.init(this.connectionsManager),this.stat.getMediaStat().setLocalMainStreamInfo(this.userInfo.userId,this.streamPublishManager.getPublishedMainStreamInfos()),this.stat.getMediaStat().setLocalAuxsStreamInfo(this.userInfo.userId,this.streamPublishManager.getPublishedAuxStreamInfo()),this.stat.startMediaCollector()}async enableRtcStats(e,t){return await this.enableRtcStatsImpl(e,t)}async enableRtcStatsImpl(e,t){if(2!==this.status)throw this.logger.error(ZE,"cannot enableRtcStats before join room"),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"cannot enableRtcStats before join room");if(!e)return clearTimeout(this.rtcStatsInterval),this.rtcStatsInterval=null,void this.logger.info(ZE,"enableRtcStats is disable");if(!Number.isInteger(t)||t<100)throw this.logger.error(ZE,"invalid interval"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);if(e&&this.rtcStatsInterval)throw this.logger.error(ZE,"enableRtcStats has been invoked, no need do again"),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"enableRtcStats has been invoked, no need do again");return this.rtcStatsCriterion=t,this.doEnableRtcStats()}async doEnableRtcStats(){let e=0;const t=()=>{this.rtcStatsInterval=setTimeout((async()=>{const r=(await this.stat.buildRtcStatsDebugInfo(this.rtcStatsCriterion/1e3)).mediaStatsDebugInfo;this.doTriggerRtcStats(r,e),e++,t()}),0===e?0:this.rtcStatsCriterion)};t()}doTriggerRtcStats(e,t){if(0===t)return;if(!e||0==e.length)return;const r=[];e.forEach((e=>{if(!e.event)return;const t=e.streams||[];switch(e.event){case BT.QoS_UP_STREAM_VIDEO:this.addRtcStatInfos(t,!1,uI.TRACK_TYPE_VIDEO,r);break;case BT.QoS_UP_STREAM_AUDIO:this.addRtcStatInfos(t,!1,uI.TRACK_TYPE_AUDIO,r,AI.main);break;case BT.QoS_AUX_UP_STREAM_VIDEO:this.addRtcStatInfos(t,!1,uI.TRACK_TYPE_VIDEO,r,AI.desktop);break;case BT.QoS_DOWN_STREAM_VIDEO:this.addRtcStatInfos(t,!0,uI.TRACK_TYPE_VIDEO,r);break;case BT.QoS_DOWN_STREAM_AUDIO:this.addRtcStatInfos(t,!0,uI.TRACK_TYPE_AUDIO,r,AI.main);break;case BT.QoS_AUX_DOWN_STREAM_VIDEO:this.addRtcStatInfos(t,!0,uI.TRACK_TYPE_VIDEO,r,AI.desktop);break;default:this.logger.debug(ZE,"".concat(e.event," no need stats"))}})),this.connectState.curState===vI[RI.CONNECTED]&&r.length>0&&this.eventEmitter.emit(MI.RtcStats,r)}addRtcStatInfos(e,t,r,i,n){let s={};const o=this.userInfo.userName||this.userInfo.userId;for(let g=0;g<e.length;g++){var a,c,u;s.isRemote=t,s.mediaType=r,s.bitrate=(null===(a=e[g])||void 0===a?void 0:a.bit_rate)||0,s.jitter=(null===(c=e[g])||void 0===c?void 0:c.jitter)||0,s.pktLossRate=(null===(u=e[g])||void 0===u?void 0:u.pktLoss)||0;let S=null;if(t){var d,l,h,f,p;S=this.remoteUserManager.getUserInfoByStreamId(this.roomId,"".concat(null===(d=e[g])||void 0===d?void 0:d.stream_uid));const t=(null===(l=S)||void 0===l||null===(h=l.userInfo)||void 0===h?void 0:h.nickname)||(null===(f=S)||void 0===f||null===(p=f.userInfo)||void 0===p?void 0:p.userId)||"remoteTop3";s.userName=t}else{var m;s.userName=o,s.rtt=(null===(m=e[g])||void 0===m?void 0:m.rtt)||0}var _;if(n?s.streamType=n:r===uI.TRACK_TYPE_VIDEO&&(s.streamType=t?"main"===S.mainStream.remoteTrackInfos.get(e[g].stream_uid.toString()).content?AI.main:AI.slides:"".concat(e[g].ssrc_uid.split("-")[0])==="".concat(this.sdpRepInfo.video.sendSsrcBegin)?AI.main:AI.slides),r!==uI.TRACK_TYPE_AUDIO)s.frameRate=(null===(_=e[g])||void 0===_?void 0:_.frame_rate)||0;i.push(s),s={}}}async leave(){return await this.leaveImpl()}async leaveImpl(){return new Promise(((e,t)=>{this.logger.info(ZE,"leave room"),2!==this.status&&4!==this.status?t(new Eu(ou.RTC_ERR_CODE_STATUS_ERROR)):(this.status=3,this.signal.leave().then((r=>{if(r instanceof Eu)return this.stat.reportLeavInfo(OT.LEAVE_ROOM_ERROR),void t(r);this.doLeaveRoom(),this.stat.reportLeavInfo(OT.LEAVE_ROOM_SUCCESS),this.logger.info(ZE,"leave success"),e()})))}))}doLeaveRoom(){this.cleanup(),this.cleanTransportStats(),this.stat.leaveRoom(),eI.immediateReportRecords()}resetConnection(){const e=[],t=this.streamPublishManager.getPublishedMainVideoTrackInfo();t&&e.push(t.sender);const r=this.streamPublishManager.getPublishedMainAudioTrackInfo();r&&e.push(r.sender),this.connectionsManager.destroyPeerConnection(dI.STREAM_TYPE_MAIN,e);const i=this.streamPublishManager.getPublishedAuxVideoTrackInfo();this.connectionsManager.destroyPeerConnection(dI.STREAM_TYPE_AUX,i?[i.sender]:[])}async rejoin(e,t){this.logger.info(ZE,"rejoin room roomId:".concat(e," JoinConfig:").concat(JSON.stringify(t)));const r=[];let i="";try{var n,s,o;rR.checkJoinParams(e,t);const a=dy.init(this.clientSymbol,e,t);this.userInfo=a,this.roomId=e,this.stat.setLocalUserInfo(a),this.resetConnection(),this.streamPublishManager.reset(),clearTimeout(this.netQualityTimer),null===(n=this.signal)||void 0===n||n.reset(),this.status=1,i=await this.signal.connect(a,r),this.logger.info(ZE,"rejoin, actualAcsIp:".concat(i)),await this.waitNotifyConfig(r),await this.connectionsManager.initConnectionAndSdp(dI.STREAM_TYPE_MAIN,{onTrackHandler:this.onTrackHandler.bind(this)}),await this.connectionsManager.initConnectionAndSdp(dI.STREAM_TYPE_AUX,{onTrackHandler:this.onTrackHandler.bind(this)});const c=await this.signal.join(this.userInfo,this.connectionsManager.modifySdpCandidates(dI.STREAM_TYPE_MAIN),this.connectionsManager.modifySdpCandidates(dI.STREAM_TYPE_AUX),this.audioPolicy,this.connectionsManager.getPortType());this.sdpRepInfo=c.sdp,c.userInfos.forEach((e=>{this.stat.getMediaStat().setEncryInfo(e.userId,e.userEid)}));const u=String(c.roomUid);this.stat.setRoomUid(u);const d=null===(s=c.negSdp.find((e=>0===e.type)))||void 0===s?void 0:s.sdp,l=null===(o=c.negSdp.find((e=>1===e.type)))||void 0===o?void 0:o.sdp;let h;1===this.audioPolicy&&(h=this.addSsrc4Top3.bind(this)),this.connectionsManager.setSsrcsMapping(this.sdpRepInfo),await this.connectionsManager.handleAnswerSdpFromServer(dI.STREAM_TYPE_MAIN,d,h),await this.connectionsManager.handleAnswerSdpFromServer(dI.STREAM_TYPE_AUX,l),this.upStreamData=c.userInfos.find((e=>{var t;return e.userId===(null===(t=this.userInfo)||void 0===t?void 0:t.userId)})),this.remoteUserManager.initialize(this.userInfo.userId,c.sdp),this.stat.setSFUAddress(this.connectionsManager.getSfuInfoFromSdp(d,l)),this.signal.keepAlive(),this.status=2,this.localRejoinFlag=!0,this.streamPublishManager.setSdpRepInfo(this.sdpRepInfo),this.statJoinRoomInfo(i,!0,r),this.cleanNetworkStatistic(),this.netQualityRegularReport(),this.cleanTransportStats(),this.setAudioLevelStatTimer();const f=setTimeout((async()=>{clearTimeout(f),await this.doRefreshRoomUserInfos(this.userInfo.roomId,c.userInfos,!0)}),0);this.logger.info(ZE,"rejoin, rejoin room success")}catch(tb){throw this.logger.error(ZE,"rejoin room fail, error:".concat(tb)),this.stat.reportJoinInfo(null==tb?void 0:tb.code,i,!0,r,null==tb?void 0:tb.message),await JE.uploadLogFile(this.logger),tb}}async changeStreamMuteStatusNotify(e,t,r,i){const n={"x-nuwa-trace-id":Hg.generateRandomId(32,16),"x-nuwa-span-id":Hg.generateRandomId(16,16),videoStreams:[]};if(t===uI.TRACK_TYPE_VIDEO){const t={ssrc:0,mute:e};if(r===AI.desktop)t.ssrc=this.sdpRepInfo.desktopVideo.sendSsrcBegin;else if(t.ssrc=this.sdpRepInfo.video.sendSsrcBegin,i){const t={ssrc:this.sdpRepInfo.video.sendSsrcEnd,mute:e};n.videoStreams.push(t)}n.videoStreams.push(t)}else{const t={ssrc:this.sdpRepInfo.audio.sendSsrcBegin,mute:e};n.audioStreams=[t]}await this.signal.changeStreamStatus(n)}async setSendBitrate(e,t,r){if(!e)return void this.logger.info(ZE,"sender is null");if("function"!=typeof e.getParameters)return void this.logger.info(ZE,"sender not support getParameters");if("function"!=typeof e.setParameters)return void this.logger.info(ZE,"sender not support setParameters");const i=e.getParameters();i.encodings.length<=0?this.logger.info(ZE,"sender has no track, can not set maxBitRate"):(i.encodings[0].maxBitrate=t,await e.setParameters(i),this.logger.info(ZE,"success set ".concat(r," sender maxBitrate: ").concat(t)))}static judgeNetworkQuality(e){return-1===e?0:e<1?1:e<3?2:e<6?3:e<12?4:e<20?5:6}async calcNetworkQuality(){const e={uploadPkgLoss:0,downloadPkgLoss:0};if(this.getConnectionState()!==vI[RI.CONNECTED])return{uploadPkgLoss:6,downloadPkgLoss:6};let t=await this.getUploadStatistic("video");return t<0&&(t=await this.getUploadStatistic("audio")),e.uploadPkgLoss=$E.judgeNetworkQuality(t),t=await this.getDownloadStatistic(uI.TRACK_TYPE_VIDEO),t<0&&(t=await this.getDownloadStatistic(uI.TRACK_TYPE_AUDIO)),e.downloadPkgLoss=$E.judgeNetworkQuality(t),e}netQualityRegularReport(){clearTimeout(this.netQualityTimer),this.netQualityTimer=setTimeout((()=>{clearTimeout(this.netQualityTimer),this.calcNetworkQuality().then((e=>{if(!this.preNetQuality||this.preNetQuality.uploadPkgLoss!==e.uploadPkgLoss||this.preNetQuality.downloadPkgLoss!==e.downloadPkgLoss){const t={uplinkNetworkQuality:e.uploadPkgLoss,downlinkNetworkQuality:e.downloadPkgLoss};this.logger.info(ZE,"emit:".concat(MI.NetworkQuality,", quality:").concat(JSON.stringify(t))),this.eventEmitter.emit(MI.NetworkQuality,t),this.preNetQuality=e}})).finally(this.netQualityRegularReport.bind(this))}),2e3)}validatePublishRequest(e){if(2!==this.status)throw this.logger.error(ZE,"can not publish stream before join room"),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"can not publish stream before join room");if(this.userInfo.role===ay)throw this.logger.error(ZE,"the player role can not publish stream"),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"the player role can not publish stream");if(!e)throw this.logger.error(ZE,"stream is null"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);if(e.hasAudioTrack()||e.hasVideoTrack()||this.logger.warn(ZE,"stream has no audio and video"),"local"!==e.getType())throw this.logger.error(ZE,"stream type: ".concat(e.getType()," cannot publish")),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"stream type: ".concat(e.getType()," cannot publish"))}async publish(e){try{return await this.publishImpl(e),void(e.isAuxiliary()&&this.stat.reportAuxiliaryStreamShareInfo(PT.ACTION_START,MT.RESULT_SUCCESS))}catch(t){throw e.isAuxiliary()&&this.stat.reportAuxiliaryStreamShareInfo(PT.ACTION_START,MT.RESULT_ERROR),t}}async publishImpl(e){try{if(await this.taskLocker.Lock("".concat(ZE,":publishImpl")),!e)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"stream is null");if(await this.publishStream(e),!e.isAuxiliary()){this.stat.getMediaStat().setLocalMainStreamInfo(this.userInfo.userId,this.streamPublishManager.getPublishedMainStreamInfos())&&e.hasAudioTrack()&&this.buildSendMediaStreamInfo(yI.Audio)}}catch(tb){throw this.logger.error(ZE,"publishImpl fail, errMsg = ".concat(tb)),tb}finally{this.taskLocker.unLock("".concat(ZE,":publishImpl"))}}async publishStream(e){this.logger.info(ZE,"publish ".concat(e.isAuxiliary()?"aux":"main"," stream")),this.validatePublishRequest(e);const t=e,r=this.streamPublishManager.generatePubInfoWhenPublish(t);await this.sendPublishRequest(r.allTracks2Publish),await this.updateStreamTracks(t,r),t.addClient(this)}async sendPublishRequest(e){e&&await this.sendPublishReq(e)}async updateStreamTracks(e,t){if(!e)return;const r=e.isAuxiliary();t.tracks2UnPublish&&0!==t.tracks2UnPublish.length||t.tracks2NewPublish&&0!==t.tracks2NewPublish.length?r?await this.updateAuxStreamTrack(e,t):await this.updateMainStreamTrack(e,t):this.logger.info(ZE,"update ".concat(r?"aux":"main"," streamTracks, no new publish and unpublish, so no need update sdp"))}async updateMainStreamTrack(e,t){const r=t.tracks2UnPublish.filter((e=>e.type===uI.TRACK_TYPE_VIDEO)),i=this.removeTracksWhenPublish(r),n=t.tracks2UnPublish.filter((e=>e.type===uI.TRACK_TYPE_AUDIO)),s=this.removeTracksWhenPublish(n),o=s.length>0?s[0]:null,a=t.tracks2NewPublish.filter((e=>e.type===uI.TRACK_TYPE_VIDEO)),c=await this.addVideoTracksWhenPublish(e,a),u=t.tracks2NewPublish.filter((e=>e.type===uI.TRACK_TYPE_AUDIO)),d=await this.addAudioTrackWhenPublish(e,u),l=t.tracks2KeepPublish.filter((e=>e.type===uI.TRACK_TYPE_AUDIO)),h=this.getKeepAudioTrackSsrcSender(l),f=t.tracks2KeepPublish.filter((e=>e.type===uI.TRACK_TYPE_VIDEO)),p=this.getKeepVideoTracksSsrcSender(f);await this.generateNewOfferSdp(h,d,p,c,i,o),u.length>0&&await this.sendAudioMedia(e,d),a.length>0&&await this.sendVideoMedia(e,c),null==r||r.forEach((e=>{this.streamPublishManager.unPublishTrackSuccess(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_VIDEO,e.upstream.streamUid.toString())})),null==n||n.forEach((e=>{this.streamPublishManager.unPublishTrackSuccess(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_AUDIO,e.upstream.streamUid.toString())}))}async updateAuxStreamTrack(e,t){if(t.tracks2NewPublish&&t.tracks2NewPublish.length>0){const r=t.tracks2NewPublish&&t.tracks2NewPublish.filter((e=>e.type===uI.TRACK_TYPE_VIDEO))[0].ssrc,i=await this.connectionsManager.addTrack(dI.STREAM_TYPE_AUX,e.getVideoTrack(),e.getMediaStream());await this.connectionsManager.modifyPublishOfferSdp(dI.STREAM_TYPE_AUX,this.userInfo.userId,[r]),this.logger.info(ZE,"aux send bitrate ".concat(e.getScreenSendBitrate())),await this.setSendBitrate(i,e.getScreenSendBitrate(),"auxVideo"),this.streamPublishManager.publishAuxVideoTrackOK(i,r);const n=this.streamPublishManager.getLocalStream(dI.STREAM_TYPE_AUX);n&&(n.off(pT,this.addLocalAuxStreamEndedHandler.bind(this)),n.on(pT,this.addLocalAuxStreamEndedHandler.bind(this))),await e.resumeMixScreenAudio()}else{const r=t.tracks2UnPublish;let i=0;r.forEach((e=>{i=e.ssrc,this.connectionsManager.removeTrack(dI.STREAM_TYPE_AUX,e.sender)})),await this.connectionsManager.modifyPublishOfferSdp(dI.STREAM_TYPE_AUX,this.userInfo.userId,[],0,[i]),await e.stopMixScreenAudio()}}async sendAudioMedia(e,t){if(t)try{await this.setSendBitrate(t.sender,e.getAudioSendBitrate(),"audio"),this.streamPublishManager.publishMainAudioTrackOK(t.sender,t.ssrc),this.logger.info(ZE,"sendAudioMedia, send audio media successfully")}catch(tb){throw this.logger.error(ZE,"sendAudioMedia, occur error: ".concat(tb)),tb}}async sendVideoMedia(e,t){if(0!==t.length)try{const r=[];t.forEach((t=>{r.push(this.setSendBitrate(t.sender,e.getVideoMaxSendBitrate(t.resolutionId),"mainVideo"))})),await Promise.all(r).then((()=>{t.forEach((e=>{this.streamPublishManager.publishMainVideoTrackOK(e.sender,e.ssrc,e.streamId)}))})),this.logger.info(ZE,"sendVideoMedia, send video media successfully")}catch(tb){throw this.logger.error(ZE,"sendVideoMedia, occur error: ".concat(tb)),tb}}async generateNewOfferSdp(e,t,r,i,n,s){try{const o=[];r.forEach((e=>o.push(e.ssrc))),i.forEach((e=>o.push(e.ssrc)));const a=t?t.ssrc:e?e.ssrc:null,c=[];n.forEach((e=>c.push(e.ssrc)));const u=s?s.ssrc:null,d=await this.connectionsManager.modifyPublishOfferSdp(dI.STREAM_TYPE_MAIN,this.userInfo.userId,o,a,c,u);return this.logger.info(ZE,"generateNewOfferSdp successfully"),d}catch(tb){throw this.logger.error(ZE,"generateNewOfferSdp, occur error: ".concat(tb)),tb}}async sendPublishReq(e){try{const t=[];e.forEach((e=>{t.push(e.upstream),this.logger.info(ZE,"prepare to send publish req, streamId:".concat(e.upstream.streamUid))})),await this.signal.publish(t),this.logger.info(ZE,"sendPublishReq successfully")}catch(tb){throw this.logger.error(ZE,"sendPublishReq, occur error: ".concat(tb)),tb}}async addVideoTracksWhenPublish(e,t){if(0===t.length)return[];try{const r=[];for(const i of t){const t=e.getVideoTrack(i.resolutionId),n=i.ssrc,s=await this.connectionsManager.addTrack(dI.STREAM_TYPE_MAIN,t,e.getMediaStream());r.push({ssrc:n,sender:s,streamId:i.upstream.streamUid.toString(),resolutionId:i.resolutionId}),this.logger.info(ZE,"addVideoTracksWhenPublish, add video track of resolutionId:".concat(i.resolutionId,",")+"physical track id:".concat(t.id,", streamId: ").concat(i.upstream.streamUid," with ssrc: ").concat(n," to connection successfully"))}return r}catch(tb){throw this.logger.error(ZE,"addVideoTracksWhenPublish, occur error: ".concat(tb)),tb}}async addAudioTrackWhenPublish(e,t){if(0===t.length)return null;try{const r=e.getPublishAudioTrack(),i=t[0].ssrc,n={ssrc:i,sender:await this.connectionsManager.addTrack(dI.STREAM_TYPE_MAIN,r,e.getMediaStream()),streamId:t[0].upstream.streamUid.toString(),resolutionId:null};return this.logger.info(ZE,"addAudioTrackWhenPublish, add audio track for streamId: ".concat(t[0].upstream.streamUid,",")+"physical track id:".concat(null==r?void 0:r.id," to connection successfully")),n}catch(tb){throw this.logger.error(ZE,"addAudioTrackWhenPublish, occur error: ".concat(tb)),tb}}removeTracksWhenPublish(e){if(0===e.length)return[];try{const t=[];return e.forEach((e=>{this.connectionsManager.removeTrack(dI.STREAM_TYPE_MAIN,e.sender),t.push({ssrc:e.ssrc,sender:e.sender,streamId:e.upstream.streamUid.toString(),resolutionId:e.resolutionId}),this.logger.info(ZE,"removeTracksWhenPublish, remove ".concat(e.type," track for streamId: ").concat(e.upstream.streamUid," to connection successfully"))})),t}catch(tb){throw this.logger.error(ZE,"removeTracksWhenPublish, occur error: ".concat(tb)),tb}}getKeepAudioTrackSsrcSender(e){const t=[];return e.forEach((e=>{t.push({ssrc:e.ssrc,sender:e.sender,streamId:e.upstream.streamUid.toString(),resolutionId:e.resolutionId})})),t.length>0?t[0]:null}getKeepVideoTracksSsrcSender(e){const t=[];return e.forEach((e=>{t.push({ssrc:e.ssrc,sender:e.sender,streamId:e.upstream.streamUid.toString(),resolutionId:e.resolutionId})})),t}buildSendMediaStreamInfo(e,t){switch(e){case yI.Aux:{const e=this.streamPublishManager.generateAuxOptTag();e&&this.stat.reportStartSendMediaStream(xT.AUX,e);break}case yI.Video:{const e=this.streamPublishManager.generateMainVideoOptTags();e&&e.length>0&&e.forEach((e=>{t.find((t=>-1!=e.indexOf("".concat(t))))&&this.stat.reportStartSendMediaStream(xT.VIDEO,e)}));break}case yI.Audio:{const e=this.streamPublishManager.generateMainAudioOptTag();e&&this.stat.reportStartSendMediaStream(xT.AUDIO,e);break}}}async unpublish(e){try{return await this.unpublishImpl(e),void(e.isAuxiliary()&&this.stat.reportAuxiliaryStreamShareInfo(PT.ACTION_STOP,MT.RESULT_SUCCESS))}catch(t){throw e.isAuxiliary()&&this.stat.reportAuxiliaryStreamShareInfo(PT.ACTION_STOP,MT.RESULT_ERROR),t}}async unpublishImpl(e){if(this.userInfo.role===ay)throw this.logger.error(ZE,"the player role can not unpublish stream"),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"the player role can not unpublish stream");if(!e)throw this.logger.error(ZE,"stream is null"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);if("local"!==e.getType())throw this.logger.error(ZE,"stream type: ".concat(e.getType()," cannot unpublish")),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"stream type: ".concat(e.getType()," cannot unpublish"));try{await this.taskLocker.Lock("".concat(ZE,":unpublishImpl")),await this.unPublishStream(e)}finally{this.taskLocker.unLock("".concat(ZE,":unpublishImpl"))}}async unPublishStream(e){const t=e.isAuxiliary(),r=t?"aux":"main";try{this.logger.info(ZE,"unpublish ".concat(r," stream:").concat(e.getId()));const i=e,n=this.streamPublishManager.generatePubInfoWhenUnPublish(i);await this.sendPublishRequest(n.allTracks2Publish),await this.updateStreamTracks(i,n),i.removeClient(this),t?this.streamPublishManager.unPublishAuxStreamOK():this.streamPublishManager.unPublishMainStreamOK(),this.logger.info(ZE,"unpublish ".concat(r,"stream success: ").concat(e.getId()))}catch(tb){throw this.taskLocker.unLock("".concat(ZE,":unpublish ").concat(r," stream")),this.logger.error(ZE,"unpublish ".concat(r," stream, ").concat(e.getId()," occur error: ").concat(tb)),tb}}async rejoinPublishStreams(e){let t=[];for(const r of e){this.logger.info(ZE,"rejoin publish ".concat(r.isAuxiliary()?"aux":"main"," stream"));const e=r;e.removeClient(this),this.validatePublishRequest(r);const i=this.streamPublishManager.generatePubInfoWhenPublish(e);await this.updateStreamTracks(e,i),e.addClient(this),t=[...t,...i.allTracks2Publish]}t=[...new Set(t)],await this.sendPublishRequest(t)}addLocalAuxStreamEndedHandler(e){this.streamPublishManager.isAuxVideoTrackValid(e)&&this.unpublish(this.streamPublishManager.getLocalStream(dI.STREAM_TYPE_AUX))}async subscribeAudio(e){return await this.subscribeAudioImpl(e)}async subscribeAudioImpl(e){if(!e)throw this.logger.error(ZE,"subscribeAudioImpl, userId is null"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"userId is null");const t=new sy({type:"main",log:this.logger,userId:e,client:this,roomId:this.roomId});this.logger.info(ZE,"subscribeAudioImpl begin, userId:".concat(e)),await this.subscribeImpl(t,{audio:!0,video:!1});const r=this.remoteUserManager.getUserInfoById(e,this.roomId);if(r){let e=!1;for(const t of null===(i=r.mainStream.remoteTrackInfos)||void 0===i?void 0:i.values()){var i;if(t.type===uI.TRACK_TYPE_AUDIO&&t.isSubscribed){e=!0;break}}if(e)return r.mainStream.remoteStream}}async unSubscribeAudio(e){return await this.unSubscribeAudioImpl(e)}async unSubscribeAudioImpl(e){if(!e)throw this.logger.error(ZE,"unSubscribeAudioImpl, userId is null"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"userId is null");const t=new sy({type:"main",log:this.logger,userId:e,client:this,roomId:this.roomId});this.logger.info(ZE,"unSubscribeAudioImpl begin, userId:".concat(e)),await this.unsubscribeImpl(t,{audio:!0,video:!1})}startupQoSReportPlay(e,t){const r=this.startupQoSMap.get(e);if(r){const e={timestamp:r.start,traceId:r.traceId,spanId:"0.1.1",originIntfName:r.interfaceName,interfaceName:"play",source:"",target:"",resultCode:"",successFlag:"T",duration:t-r.start,async:"N",extendInfo:JSON.stringify({id:r.id,streamIds:r.streamIds})};this.stat.setFirstFrameInfo(e),r.start=t,r.interfaceName="play"}}startupQoSReportCanPlay(e){const t=Hg.getCurrentTimestamp(),r=(null==e?void 0:e.id)&&this.startupQoSMap.get(null==e?void 0:e.id);if(r){const e={timestamp:r.start,traceId:r.traceId,spanId:"0.1.1.1",originIntfName:r.interfaceName,interfaceName:"canplay",source:"",target:"",resultCode:"",successFlag:"T",duration:t-r.start,async:"N",extendInfo:JSON.stringify({id:r.id,streamIds:r.streamIds})};this.stat.setFirstFrameInfo(e)}}async subscribe(e,t){return await this.subscribeImpl(e,t)}async subscribeImpl(e,t){const r=Hg.getCurrentTimestamp(),i={traceId:Hg.generateRandomId(32,16),spanId:"0",originIntfName:"",interfaceName:"subscribe",id:e.getUniqueId(),start:r};if(!e)throw this.logger.error(ZE,"subscribeImpl, stream is null"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"stream is null");if(t||(t={video:!0,audio:!0}),t.audio||t.video){if(t.video&&![OI.ON,OI.OFF,null,void 0].includes(t.autoAdjustResolution))throw this.logger.error(ZE,"the autoAdjustResolution value must be 1 or 2 or empty."),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);await this.doSubscribe(e,t,i)}}async doSubscribe(e,t,r){if(this.connectState.curState!==vI[RI.CONNECTED])throw this.logger.error(ZE,"cannot do subscribe when network disconnected"),new Eu(ou.RTC_ERR_CODE_WEBSOCKET_NOT_CONNECTED);const i=e.getUserId(),n=e.isAuxiliary()?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN;this.logger.info(ZE,"start subscribe, ".concat(i,", ").concat(n,", option: ").concat(JSON.stringify(t))),0!==this.audioPolicy&&t.audio&&this.logger.info(ZE,"doSubscribe, ".concat(this.audioPolicy," is not common audio mode, but audio option is true, reserve it"));try{await this.taskLocker.Lock("".concat(ZE,":doSubscribe"));const e=this.remoteUserManager.subscribeStream(i,this.roomId,n,t,this.audioPolicy,!1,r);return await this.updateSubscribe(e,r)}catch(tb){throw this.logger.error(ZE,"subscribe release lock, subscribe userId ".concat(e.getUserId()," occur error ").concat(tb)),tb}finally{this.taskLocker.unLock("".concat(ZE,":doSubscribe"))}}async batchSubscribe(e){return await this.doBatchSubscribe(e)}checkSubscribeParams(e){e.forEach((e=>{if(![OI.OFF,OI.ON,null,void 0].includes(e.autoAdjustResolution))throw this.logger.error(ZE,"the autoAdjustResolution value must be 1 or 2"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);if(!["FHD","HD","SD","LD",null,void 0].includes(e.minResolution))throw this.logger.error(ZE,"the minResolution value must be 'FHD','HD','SD','LD'"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER)}))}async doBatchSubscribe(e){this.logger.info(ZE,"doBatchSubscribe, subscribeInfos:  ".concat(JSON.stringify(e)));try{this.checkSubscribeParams(e);const t=e.map((e=>({userId:e.userId,resolutionIds:e.resolutionIds,autoAdjustResolution:e.autoAdjustResolution,minResolution:e.minResolution})));await this.taskLocker.Lock("".concat(ZE,":doBatchSubscribe"));const r=this.remoteUserManager.batchSubscribeMainStream(this.roomId,t);await this.updateSubscribe(r)}catch(tb){throw this.logger.error(ZE,"batchSubscribe failed, ".concat(tb)),tb}finally{this.taskLocker.unLock("".concat(ZE,":doBatchSubscribe"))}}async batchDeleteUnusedSsrcInSdp(e,t,r){(t&&0!==t.length||r&&0!==r.length)&&(this.logger.info(ZE,"batchDeleteUnusedSsrcInSdp, streamType: ".concat(e,", videoSsrc2Del: ").concat(t,", audioSsrc2Del:").concat(r)),await this.connectionsManager.deleteUser(e,t,r))}async enableStreamStateDetection(e,t){if(2!==this.status)throw this.logger.error(ZE,"cannot enable stream detection before join room"),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"cannot enable stream detection before join room");if(!e)return clearTimeout(this.streamInterruptedDetectInterval),this.streamInterruptedDetectInterval=null,this.lastCycleFrameDecodedMap.clear(),void this.streamInterruptedUsersMap.clear();if(!Number.isInteger(t)||t<1||t>60)throw this.logger.error(ZE,"invalid interval for enable stream detection"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);if(e&&this.streamInterruptedDetectInterval)throw this.logger.error(ZE,"cannot double enable stream detection"),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"cannot double enable stream detection");if(this.streamDetectionCriterion=t,this.lastCycleFrameDecodedMap&&0===this.lastCycleFrameDecodedMap.size){this.remoteUserManager.getAllUserStreamsByType(this.roomId,null,null).forEach((e=>{const t=e.userId;e.mainStream&&this.lastCycleFrameDecodedMap.set(t+",0",{userId:t,decodedFrame:0}),e.auxStream&&this.lastCycleFrameDecodedMap.set(t+",1",{userId:t,decodedFrame:0})}))}await this.startStreamDetection()}async startStreamDetection(){if(!this.streamInterruptedDetectInterval){const e=1e3,t=()=>{this.streamInterruptedDetectInterval=setTimeout((async()=>{const r=await this.stat.collectReceiverDecodedFrameMap(),i=[],n=[],s=Math.round(1e3*this.streamDetectionCriterion/e);this.streamInterruptedUsersMap.forEach(((e,t)=>{r.has(t)||this.streamInterruptedUsersMap.delete(t)})),r.forEach(((e,t)=>{const r=this.lastCycleFrameDecodedMap&&this.lastCycleFrameDecodedMap.get(t);if(r&&r.decodedFrame===e.decodedFrame){const e=this.streamInterruptedUsersMap.get(t);e?this.streamInterruptedUsersMap.set(t,e+1):this.streamInterruptedUsersMap.set(t,1)}if(r&&r.decodedFrame!==e.decodedFrame){if(this.streamInterruptedUsersMap.get(t)>=s){const r=t.split(",");r[0]!==kI&&n.push({userId:r[0],isScreen:e.isAux})}this.streamInterruptedUsersMap.delete(t)}})),this.lastCycleFrameDecodedMap=r,this.streamInterruptedUsersMap&&this.streamInterruptedUsersMap.forEach(((e,t)=>{if(e===s){const e=t.split(",");e[0]!==kI&&(i.push({userId:e[0],isScreen:"1"===e[1]}),this.logger.info(ZE,"stream interrupted, userId: ".concat(e[0],", isAux: ").concat(e[1])))}})),i.length>0&&this.connectState.curState===vI[RI.CONNECTED]&&(this.logger.info(ZE,"find stream interrupted users, ".concat(JSON.stringify(i))),this.eventEmitter.emit(MI.StreamInterrupted,i)),n.length>0&&this.connectState.curState===vI[RI.CONNECTED]&&(this.logger.info(ZE,"find stream recovered users, ".concat(JSON.stringify(n))),this.eventEmitter.emit(MI.StreamRecovered,n)),t()}),e)};t()}}async unsubscribe(e,t){return await this.unsubscribeImpl(e,t)}async unsubscribeImpl(e,t){if(this.logger.info(ZE,"start unsubscribe"),this.connectState.curState!==vI[RI.CONNECTED])throw this.logger.error(ZE,"cannot do subscribe when network disconnected"),new Eu(ou.RTC_ERR_CODE_WEBSOCKET_NOT_CONNECTED);if(!e)throw this.logger.error(ZE,"stream is null"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER,"stream is null");const r=e.getUserId(),i=e.isAuxiliary()?dI.STREAM_TYPE_AUX:dI.STREAM_TYPE_MAIN;this.logger.info(ZE,"start doUnsubscribe, ".concat(r,", ").concat(i,", option: ").concat(JSON.stringify(t)));try{const e=t||{video:!0,audio:!0};await this.taskLocker.Lock("".concat(ZE,":doUnsubscribe"));const n=this.remoteUserManager.unsubscribeStream(r,this.roomId,i,e);await this.updateSubscribe(n)}catch(tb){throw this.logger.error(ZE,"subscribe userId ".concat(e.getUserId()," occur error ").concat(tb)),tb}finally{this.taskLocker.unLock("".concat(ZE,":doUnsubscribe"))}}async switchRole(e,t){return await this.switchRoleImpl(e,t)}async switchRoleImpl(e,t){if(this.logger.info(ZE,"switchRole from ".concat(this.userInfo.role," to ").concat(e)),2!==this.status&&4!==this.status)throw new Eu(ou.RTC_ERR_CODE_STATUS_ERROR);if(this.userInfo.role===e)throw this.logger.error(ZE,"new role same with old role, no need switch."),new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"new role same with old role, no need switch.");try{this.userInfo.role===oy&&e===ay&&(this.streamPublishManager.isMainStreamPublished()&&await this.unpublish(this.streamPublishManager.getLocalStream(dI.STREAM_TYPE_MAIN)),this.streamPublishManager.isAuxVideoTrackPublished()&&await this.unpublish(this.streamPublishManager.getLocalStream(dI.STREAM_TYPE_AUX))),await this.taskLocker.Lock("".concat(ZE,":switchRoleImpl"));const r=await this.signal.switchRole(e,t);this.logger.debug(ZE,"swithRole resp: ".concat(JSON.stringify(r))),this.userInfo.role===ay&&e===oy&&(this.stat.getMediaStat().setLocalMainStreamInfo(this.userInfo.userId,this.streamPublishManager.getPublishedMainStreamInfos()),this.stat.getMediaStat().setLocalAuxsStreamInfo(this.userInfo.userId,this.streamPublishManager.getPublishedAuxStreamInfo())),this.userInfo.role=e,this.stat.reportSwitchRoleInfo(e,UT),this.taskLocker.unLock("".concat(ZE,":switchRoleImpl")),this.logger.info(ZE,"switchRole success")}catch(tb){throw this.taskLocker.unLock("".concat(ZE,":switchRoleImpl")),this.logger.error(ZE,"switchRole  switchRole failed, errMsg = ".concat(tb)),this.stat.reportSwitchRoleInfo(e,LT),tb}}getPublishAudioSender(){var e;return null===(e=this.streamPublishManager.getPublishedMainAudioTrackInfo())||void 0===e?void 0:e.sender}getPublishedMainAudioTrackInfo(){return this.streamPublishManager.getPublishedMainAudioTrackInfo()}getPublishedMainVideoTrackInfos(){return this.streamPublishManager.getPublishedMainVideoTrackInfos()}getPublishVideoSender(e){if(e===dI.STREAM_TYPE_AUX){const e=this.streamPublishManager.getPublishedAuxVideoTrackInfo();if(e)return[e.sender]}const t=[];return this.streamPublishManager.getPublishedMainVideoTrackInfos().forEach((e=>{t.push(e.sender)})),t}getMainStreamSenderByTrack(e){if(!e)return null;const t=this.streamPublishManager.getPublishedMainVideoTrackInfos().find((t=>t.upstream.streamUid.toString()===e));return null==t?void 0:t.sender}async waitForTrackBatch(e){const t=e.map((e=>{var t,r;return(null===(t=e.mainStream)||void 0===t||null===(r=t.tracks)||void 0===r?void 0:r.length)>0?1:0})).reduce(((e,t)=>e+t),0),r=e.map((e=>{var t,r;return(null===(t=e.auxStream)||void 0===t||null===(r=t.tracks)||void 0===r?void 0:r.length)>0?1:0})).reduce(((e,t)=>e+t),0);this.logger.debug(ZE,"wait for track batch begin, mainStreamCount:".concat(t,", auxStreamCount:").concat(r,"  "));for(let i=0;i<100;i++){if(this.computeSucceedStreamCount(dI.STREAM_TYPE_MAIN,t,e)+this.computeSucceedStreamCount(dI.STREAM_TYPE_AUX,r,e)===t+r)break;if(99===i)return void this.logger.error(ZE,"waitForTrackBatch subscribe on track timeout");await Hg.sleep(50)}}computeSucceedStreamCount(e,t,r){let i=0;return t&&(i=r.map((t=>this.isStreamTrackReady(e,t)?1:0)).reduce(((e,t)=>e+t),0)),i}newSignal(e){this.signal||(this.signal=new aE(this.clientConfig.appId,e,this))}onTrackHandler(e,t){if(this.logger.info(ZE,"peerconnection ontrack event: ".concat(e.track.kind)),e.track.kind===uI.TRACK_TYPE_VIDEO||0===this.audioPolicy&&e.track.kind===uI.TRACK_TYPE_AUDIO){var r,i;const n=e.streams[0].id,s=this.remoteUserManager.getUserInfoByStreamId(this.roomId,n),o=t?null==s||null===(r=s.auxStream)||void 0===r?void 0:r.remoteStream:null==s||null===(i=s.mainStream)||void 0===i?void 0:i.remoteStream;o?(this.logger.info(ZE,"connection.ontrack streamId=".concat(n,", hasAudio:").concat(o.hasAudioTrack()," hasVideo:").concat(o.hasVideoTrack())),o.addRemoteTrack(e.track,n)):this.logger.info(ZE,"ontrack stream: ".concat(n,"  is not existed"))}this.logger.info("onConnection","audio policy:".concat(this.audioPolicy,",track kind:").concat(e.track.kind)),1===this.audioPolicy&&e.track.kind===uI.TRACK_TYPE_AUDIO&&this.saveAudioStream4TopN(e)}static isStreamAdd(e,t){if(!t)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);const r=e===dI.STREAM_TYPE_MAIN?t.mainStream:t.auxStream;return 0===r.preTracks.length&&r.curTracks.length>0}static isStreamRemove(e,t){if(!t)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);const r=e===dI.STREAM_TYPE_MAIN?t.mainStream:t.auxStream;return r.preTracks.length>0&&0===r.curTracks.length}static isStreamUpdate(e,t){if(!t)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);const r=e===dI.STREAM_TYPE_MAIN?t.mainStream:t.auxStream;return r.addedTracks.length>0||r.updatedTracks.length>0||r.removedTracks.length>0}static getMuteChangeStatus(e,t,r){if(!r)throw new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);const i=e===dI.STREAM_TYPE_MAIN?r.mainStream:r.auxStream;return $E.getMediaMuteChangeFlag(i,t)}static getMediaMuteChangeFlag(e,t){const r=e.preTracks.find((e=>e.type===t)),i=e.curTracks.find((e=>e.type===t)),n=!r||r.mute,s=!i||i.mute;return $E.getMuteChangeFlag(n,s)}static getMuteChangeFlag(e,t){return e!==t?t?0:1:2}async updateSubscribe(e,t){if(this.connectState.curState!==vI[RI.CONNECTED])throw this.logger.error(ZE,"cannot do subscribe or unSubscribe when network disconnected"),new Eu(ou.RTC_ERR_CODE_WEBSOCKET_NOT_CONNECTED);if(!e||0===e.length)return null;if(!$E.isSubscriptionChange(e))return this.logger.info(ZE,"no need update subscription"),null;try{const r={successSubscribeInfos:[],failSubscribeInfos:[],successUnsubscribeInfos:[],failUnsubscribeInfos:[]};await this.subscribeSignal(e,r,t);const i=[],n=[],s=[],o=[];r.successUnsubscribeInfos.forEach((e=>{var t,r,a,c;null===(t=e.mainStream)||void 0===t||null===(r=t.tracks)||void 0===r||r.forEach((e=>{e.type===uI.TRACK_TYPE_VIDEO?i.push(e.cssrc):s.push(e.cssrc)})),null===(a=e.auxStream)||void 0===a||null===(c=a.tracks)||void 0===c||c.forEach((e=>{e.type===uI.TRACK_TYPE_VIDEO?n.push(e.cssrc):o.push(e.cssrc)}))})),this.clearResource(e),await this.generateReceiveSdp(dI.STREAM_TYPE_MAIN,r.successSubscribeInfos,i,s),await this.generateReceiveSdp(dI.STREAM_TYPE_AUX,r.successSubscribeInfos,n,o);const a=await this.handleRemoteStreamsState(r.successSubscribeInfos),c={successSubscribeInfos:[],failSubscribeInfos:[],successUnsubscribeInfos:[],failUnsubscribeInfos:[]};return(null==a?void 0:a.successSubscribeInfos)&&c.successSubscribeInfos.push(...a.successSubscribeInfos),(null==a?void 0:a.failSubscribeInfos)&&c.failSubscribeInfos.push(...a.failSubscribeInfos),(null==r?void 0:r.failSubscribeInfos)&&c.failSubscribeInfos.push(...r.failSubscribeInfos),(null==r?void 0:r.successUnsubscribeInfos)&&c.successUnsubscribeInfos.push(...r.successUnsubscribeInfos),(null==r?void 0:r.failUnsubscribeInfos)&&c.failUnsubscribeInfos.push(...r.failUnsubscribeInfos),await this.rollbackResource(c.failSubscribeInfos),this.remoteUserManager.subscribeResultCallback(c,!1),this.logger.info(ZE,"updateSubscribe end. ".concat(this.getSubscribeResultString(c))),c}catch(tb){this.logger.error(ZE,"updateSubscribe fail. errMsg:".concat(tb));const r=this.getSubscribeExceptionResult(e);throw this.remoteUserManager.subscribeResultCallback(r,!0),this.logger.info(ZE,"updateSubscribe fail end. ".concat(this.getSubscribeResultString(r))),tb}}getSubscribeExceptionResult(e){const t={successSubscribeInfos:[],failSubscribeInfos:[],successUnsubscribeInfos:[],failUnsubscribeInfos:[]};return e.forEach((e=>{var r,i,n,s,o,a,c,u;const d={userId:e.userInfo.userId,roomId:this.roomId,mainStream:{remoteStream:null===(r=e.mainStream)||void 0===r?void 0:r.remoteStream,tracks:null===(i=e.mainStream)||void 0===i?void 0:i.tracks4Subscribe},auxStream:{remoteStream:null===(n=e.auxStream)||void 0===n?void 0:n.remoteStream,tracks:null===(s=e.auxStream)||void 0===s?void 0:s.tracks4Subscribe}},l={userId:e.userInfo.userId,roomId:this.roomId,mainStream:{remoteStream:null===(o=e.mainStream)||void 0===o?void 0:o.remoteStream,tracks:null===(a=e.mainStream)||void 0===a?void 0:a.tracks4Unsubscribe},auxStream:{remoteStream:null===(c=e.auxStream)||void 0===c?void 0:c.remoteStream,tracks:null===(u=e.auxStream)||void 0===u?void 0:u.tracks4Unsubscribe}};this.appendSubscribeResult(t.failSubscribeInfos,d),this.appendSubscribeResult(t.failUnsubscribeInfos,l)})),this.logger.info(ZE,"getSubscribeExceptionResult. ".concat(this.getSubscribeResultString(t))),t}getSubscribeResultString(e){var t,r,i,n;let s;return null==e||null===(t=e.successSubscribeInfos)||void 0===t||t.forEach((e=>{s="".concat(s||""," subscribe success list: ").concat(this.getRemoteUserSubscribeInfoString(e),", ")})),null==e||null===(r=e.failSubscribeInfos)||void 0===r||r.forEach((e=>{s="".concat(s||""," subscribe failed list: ").concat(this.getRemoteUserSubscribeInfoString(e),",")})),null==e||null===(i=e.successUnsubscribeInfos)||void 0===i||i.forEach((e=>{s="".concat(s||""," unsubscribe success list: ").concat(this.getRemoteUserSubscribeInfoString(e),",")})),null==e||null===(n=e.failUnsubscribeInfos)||void 0===n||n.forEach((e=>{s="".concat(s||""," unsubscribe failed list: ").concat(this.getRemoteUserSubscribeInfoString(e))})),s}async rollbackResource(e){if(e&&0!==e.length)try{const t=[],r=[],i=[],n=[];e.forEach((e=>{var s,o,a,c;null===(s=e.mainStream)||void 0===s||null===(o=s.tracks)||void 0===o||o.forEach((e=>{e.type===uI.TRACK_TYPE_VIDEO?t.push(e.cssrc):r.push(e.cssrc)})),null===(a=e.auxStream)||void 0===a||null===(c=a.tracks)||void 0===c||c.forEach((e=>{e.type===uI.TRACK_TYPE_VIDEO?i.push(e.cssrc):n.push(e.cssrc)}))})),await this.batchDeleteUnusedSsrcInSdp(dI.STREAM_TYPE_MAIN,t,r),await this.batchDeleteUnusedSsrcInSdp(dI.STREAM_TYPE_AUX,i,n)}catch(tb){this.logger.error(ZE,"rollbackResource fail, errMsg:".concat(tb))}}isNormalStateStream(e){const t=e.tracks.filter((e=>e.isTrackReady)),r=e.tracks.filter((e=>e.isTrackReady&&0===e.state));return t.length&&t.length===r.length}async handleReadyStream(e,t){var r,i,n,s;e===dI.STREAM_TYPE_MAIN&&(null===(r=t.mainStream)||void 0===r||null===(i=r.tracks)||void 0===i?void 0:i.length)>0?await this.handleReadyStreamByType(t.userId,e,t.mainStream):e===dI.STREAM_TYPE_AUX&&(null===(n=t.auxStream)||void 0===n||null===(s=n.tracks)||void 0===s?void 0:s.length)>0&&await this.handleReadyStreamByType(t.userId,e,t.auxStream)}async handleReadyStreamByType(e,t,r){this.logger.debug(ZE,"handleReadyStreamByType, ".concat(t,", ").concat(JSON.stringify(r.tracks)));try{if(this.isNormalStateStream(r)&&(this.logger.info(ZE,"emit ".concat(MI.StreamSubscribed,", userId: ").concat(e,", ").concat(t)),this.eventEmitter.emit(MI.StreamSubscribed,{stream:r.remoteStream}),t===dI.STREAM_TYPE_MAIN)){const t=setTimeout((async()=>{clearTimeout(t),this.reportMediaStatus(e,this.roomId)}),0)}const i=r.tracks.some((e=>e.type===uI.TRACK_TYPE_VIDEO&&e.isTrackReady));for(const e of r.tracks)e.isTrackReady&&await this.handleReadyTrack(e,r.remoteStream,i)}catch(tb){this.logger.error(ZE,"handleReadyStreamByType fail, errMsg:".concat(tb))}}getMediaNotifyInfo(e,t){const r=[],i=this.remoteUserManager.getAllUserStreamsByType(t,null,null);return null==i||i.forEach((i=>{const n=i.mainStream,s=null==n?void 0:n.tracks.find((e=>e.type===uI.TRACK_TYPE_AUDIO&&e.isTrackReady));if(s){const i={mediaType:uI.TRACK_TYPE_AUDIO,roomId:t,userId:e,status:s.mute?TI.MediaStatusUnavailable:TI.MediaStatusAvailable,reason:s.mute?EI.MediaUnmuted:EI.MediaMuted};r.push(i)}const o=null==n?void 0:n.tracks.find((e=>e.type===uI.TRACK_TYPE_VIDEO&&e.isTrackReady));if(o){const t={mediaType:uI.TRACK_TYPE_VIDEO,roomId:this.roomId,userId:e,status:o.mute?TI.MediaStatusUnavailable:TI.MediaStatusAvailable,reason:o.mute?EI.MediaUnmuted:EI.MediaMuted};r.push(t)}})),r}reportMediaStatus(e,t){this.getMediaNotifyInfo(e,t).forEach((t=>{const r=t.mediaType===uI.TRACK_TYPE_AUDIO?t.status===TI.MediaStatusAvailable?"UnmuteAudio":"MuteAudio":t.status===TI.MediaStatusAvailable?"UnmuteVideo":"MuteVideo";this.logger.info(ZE,"emit ".concat(MI[r],", userId: ").concat(e,", type: ").concat(t.mediaType,", status: ").concat(t.status)),this.eventEmitter.emit(MI[r],t)}))}async handleReadyTrack(e,t,r){const i=e.type===uI.TRACK_TYPE_VIDEO||e.type===uI.TRACK_TYPE_AUDIO&&!r,n=[2,3,1].includes(e.state);i&&e.playElement&&n&&(this.logger.info(ZE,"handleReadyTrack, auto play"),this.logger.info(ZE,"video track.muted[".concat(e.muted,"]")),await t.play(e.playElement,{objectFit:e.objectFit,muted:e.muted,resolutionId:e.type===uI.TRACK_TYPE_VIDEO?e.trackId:null}));const s=e.type===uI.TRACK_TYPE_AUDIO,o=[2,3,1].includes(e.state);if(s&&e.playElement&&o){this.logger.info(ZE,"audio track.muted[".concat(e.muted,"]"));const r=t.getAudioHRTCTrack();e.muted?r.muteTrack():r.unmuteTrack()}}async handleRemoteStreamsState(e){if(!e||0===e.length)return null;await this.waitForTrackBatch(e),this.logger.info(ZE,"handleRemoteTracksState, waitForTrackBatch return");const t=[],r=[];for(const a of e){var i,n,s,o;const e=$E.newRemoteUserSubscribeInfo(a.userId,this.roomId,null===(i=a.mainStream)||void 0===i?void 0:i.remoteStream,null===(n=a.auxStream)||void 0===n?void 0:n.remoteStream),c=$E.newRemoteUserSubscribeInfo(a.userId,this.roomId,null===(s=a.mainStream)||void 0===s?void 0:s.remoteStream,null===(o=a.auxStream)||void 0===o?void 0:o.remoteStream);await this.handleRemoteStreamsStateByType(a,dI.STREAM_TYPE_MAIN,e,c),await this.handleRemoteStreamsStateByType(a,dI.STREAM_TYPE_AUX,e,c),(e.mainStream.tracks.length||e.auxStream.tracks.length)&&t.push(e),(c.mainStream.tracks.length||c.auxStream.tracks.length)&&r.push(c),this.stat.getMediaStat().setSubscribeInfo(a)}return{successSubscribeInfos:t,failSubscribeInfos:r,successUnsubscribeInfos:null,failUnsubscribeInfos:null}}isStreamTrackReady(e,t){const r=e===dI.STREAM_TYPE_MAIN?t.mainStream:t.auxStream,i=null==r?void 0:r.remoteStream,n=null!=r&&r.tracks?Array.from(r.tracks.values()):null,s=null==n?void 0:n.filter((e=>e.type===uI.TRACK_TYPE_VIDEO)).map((e=>e.trackId)),o=null==n?void 0:n.some((e=>e.type===uI.TRACK_TYPE_AUDIO));return null==i?void 0:i.isTracksReady(s,o)}async handleRemoteStreamsStateByType(e,t,r,i){var n;const s=this.isStreamTrackReady(t,e);let o=e.mainStream,a=null===(n=e.mainStream)||void 0===n?void 0:n.tracks,c=r.mainStream,u=i.mainStream;var d;t===dI.STREAM_TYPE_AUX&&(o=e.auxStream,a=null===(d=e.auxStream)||void 0===d?void 0:d.tracks,c=r.auxStream,u=i.auxStream);let l=!1;var h,f;s?(null===(h=a)||void 0===h||h.forEach((e=>{e.isTrackReady=!0,l=!0})),a&&c.tracks.push(...a)):null===(f=a)||void 0===f||f.forEach((e=>{var t;null!==(t=o)&&void 0!==t&&t.remoteStream.isTrackReady(e.type,e.trackId)?(e.isTrackReady=!0,l=!0,c.tracks.push(e)):u.tracks.push(e)}));l&&await this.handleReadyStream(t,e)}getRemoteUserSubscribeInfoString(e){var t,r,i,n;if(!e)return"";let s,o;return null===(t=e.mainStream)||void 0===t||null===(r=t.tracks)||void 0===r||r.forEach((e=>{s="".concat(s||""," ").concat(JSON.stringify(e))})),null===(i=e.auxStream)||void 0===i||null===(n=i.tracks)||void 0===n||n.forEach((e=>{o="".concat(o||""," ").concat(JSON.stringify(e))})),"  userId:".concat(e.userId,", mainTracks:").concat(s,", auxTracks:").concat(o,"  ")}releaseTrack(e,t){t.type===uI.TRACK_TYPE_VIDEO?(e.stop({audio:!1,video:!0,resolutionIds:[t.trackId]}),e.removeRemoteVideoTrack(t.trackId),this.logger.info(ZE,"releaseTrack ".concat(t.type))):(e.stop({audio:!0}),e.removeRemoteAudioTrack(),this.logger.info(ZE,"releaseTrack ".concat(t.type)))}clearResource(e){try{null==e||e.forEach((e=>{var t,r,i,n;null===(t=e.mainStream)||void 0===t||null===(r=t.tracks4Unsubscribe)||void 0===r||r.forEach((t=>{this.stat.getMediaStat().deleteSubscribeInfo(e.userInfo.userId,dI.STREAM_TYPE_MAIN,t.trackId),this.releaseTrack(e.mainStream.remoteStream,t)})),null===(i=e.auxStream)||void 0===i||null===(n=i.tracks4Unsubscribe)||void 0===n||n.forEach((t=>{this.stat.getMediaStat().deleteSubscribeInfo(e.userInfo.userId,dI.STREAM_TYPE_AUX,t.trackId),this.releaseTrack(e.auxStream.remoteStream,t)}))}))}catch(tb){this.logger.error(ZE,"clearResource error: ".concat(tb))}}async generateReceiveSdp(e,t,r,i){this.logger.info(ZE,"generateReceiveSdp, stream type: ".concat(e,", removeVideoSsrcs: ").concat(r,", removeAudioSsrcs: ").concat(i));const n=t.some((t=>{var r;const i=e===dI.STREAM_TYPE_MAIN?t.mainStream:t.auxStream;return(null==i||null===(r=i.tracks)||void 0===r?void 0:r.length)>0})),s=!!r.length||!!i.length;if(!n&&!s)return null;s&&await this.connectionsManager.deleteUser(e,r,i);const o=new Map;for(const u of t){var a,c;const t=e===dI.STREAM_TYPE_MAIN?null===(a=u.mainStream)||void 0===a?void 0:a.tracks:null===(c=u.auxStream)||void 0===c?void 0:c.tracks;if(t&&!(t.length<1))for(const r of t){this.logger.info(ZE,"generateReceiveSdp, userId : ".concat(u.userId,", stream type: ").concat(e,", track type: ").concat(r.type,", ssrc: ").concat(r.cssrc));const t={streamId:r.trackId};r.type===uI.TRACK_TYPE_VIDEO?t.videoSsrc=r.cssrc:t.audioSsrc=r.cssrc,o.has(u.userId)?o.get(u.userId).push(t):o.set(u.userId,[t])}}await this.connectionsManager.addUserBatch(e,o)}static getWatchType4Ops(e){return 0===e?"cancel_watch":1===e?"watch":"batch_watch"}static isSubscriptionChange(e){return e.some((e=>{var t,r,i,n,s,o,a,c;return(null===(t=e.mainStream)||void 0===t||null===(r=t.tracks4Subscribe)||void 0===r?void 0:r.length)>0||(null===(i=e.mainStream)||void 0===i||null===(n=i.tracks4Unsubscribe)||void 0===n?void 0:n.length)>0||(null===(s=e.auxStream)||void 0===s||null===(o=s.tracks4Subscribe)||void 0===o?void 0:o.length)>0||(null===(a=e.auxStream)||void 0===a||null===(c=a.tracks4Unsubscribe)||void 0===c?void 0:c.length)>0}))}appendSubscribeResult(e,t){var r,i,n,s;if(t&&(null!==(r=t.mainStream)&&void 0!==r&&null!==(i=r.tracks)&&void 0!==i&&i.length||null!==(n=t.auxStream)&&void 0!==n&&null!==(s=n.tracks)&&void 0!==s&&s.length)){const r=e.find((e=>e.userId===t.userId&&e.roomId===t.roomId));var o,a;if(r)null!==(o=r.mainStream)&&void 0!==o&&o.tracks?r.mainStream.tracks.push(...t.mainStream.tracks):r.mainStream=t.mainStream,null!==(a=r.auxStream)&&void 0!==a&&a.tracks?r.auxStream.tracks.push(...t.auxStream.tracks):r.auxStream=t.auxStream;else e.push(t)}}async subscribeSignal(e,t,r){const i=[],n=[],s=[];if(e.forEach((e=>{if(0===e.curUserState){var r,o,a,c,u,d;const i=$E.newRemoteUserSubscribeInfo(e.userInfo.userId,this.roomId,null===(r=e.mainStream)||void 0===r?void 0:r.remoteStream,null===(o=e.auxStream)||void 0===o?void 0:o.remoteStream);null===(a=e.mainStream)||void 0===a||null===(c=a.tracks4Unsubscribe)||void 0===c||c.forEach((e=>{i.mainStream.tracks.push(e)})),null===(u=e.auxStream)||void 0===u||null===(d=u.tracks4Unsubscribe)||void 0===d||d.forEach((e=>{i.auxStream.tracks.push(e)})),this.appendSubscribeResult(t.successUnsubscribeInfos,i)}else{var l,h,f,p;s.push(e),null===(l=e.mainStream)||void 0===l||null===(h=l.allSubscribeTracks)||void 0===h||h.forEach((t=>{$E.getUserTrackSubscribeInfo(e.userInfo,i,n,t)})),null===(f=e.auxStream)||void 0===f||null===(p=f.allSubscribeTracks)||void 0===p||p.forEach((t=>{$E.getUserTrackSubscribeInfo(e.userInfo,i,n,t)}))}})),!$E.isSubscriptionChange(s))return;const o=$E.getWatchType4Ops(i.length);let a;this.logger.info(ZE,"subscribeSignal, fullVideoSubscribeInfos: ".concat(JSON.stringify(i)," ,")+"fullAudioSubscribeInfos: ".concat(JSON.stringify(n)));const c=[],u=Hg.getCurrentTimestamp();if(r){const e={timestamp:r.start,traceId:r.traceId,spanId:"0",originIntfName:"",interfaceName:"subscribe",source:"",target:"",resultCode:"",successFlag:"T",duration:u-r.start,async:"N",extendInfo:JSON.stringify({id:r.id})};this.stat.setFirstFrameInfo(e)}try{await this.doMySubscribe(i,n,c,o)}catch(l){throw a=l,l}finally{if(r){const e=Hg.getCurrentTimestamp(),t={timestamp:u,traceId:r.traceId,spanId:"0.1",originIntfName:r.interfaceName,interfaceName:"subscribeSignal",source:"",target:"",resultCode:"",successFlag:a?"F":"T",duration:e-u,async:"N",extendInfo:JSON.stringify({id:r.id,streamIds:r.streamIds})};this.stat.setFirstFrameInfo(t),r.interfaceName="subscribeSignal",r.start=e,this.startupQoSMap.set(r.id,r)}}c[0].audioUpstreams||c[0].videoUpstreams||this.logger.error(ZE,"subscribeSignal, subscribe stream subscribed no result record, subsResult:".concat(JSON.stringify(c[0])));const d=$E.getUserUpdateInfos(s);this.getSubscribeResult(d,c[0].videoUpstreams,c[0].audioUpstreams,t)}async doMySubscribe(e,t,r,i){if(3!==this.status){const n=await this.signal.subscribe(e,t,i);r.push(n)}else{const i=[];e.forEach((e=>{i.push({cSsrcId:e.cSsrcId,code:0,pSsrcId:e.pSsrcId,pStreamUid:e.pStreamUid,pUserId:e.pUserId,pUserUid:e.pUserUid})}));const n=[];t.forEach((e=>{n.push({cSsrcId:e.cSsrcId,code:0,pSsrcId:e.pSsrcId,pStreamUid:e.pStreamUid,pUserId:e.pUserId,pUserUid:e.pUserUid})})),r.push({audioUpstreams:n,videoUpstreams:i})}}static getUserTrackSubscribeInfo(e,t,r,i){const n={pSsrcId:i.pssrc,cSsrcId:i.cssrc,pStreamUid:parseInt(i.trackId),pUserId:e.userId,pUserUid:e.userUid};i.type===uI.TRACK_TYPE_AUDIO?r.push(n):(n.mediaData={width:i.width,height:i.height},i.autoAdjustResolution===OI.ON&&(n.minReceiveContent=QE[i.minResolution]),t.push(n))}static getUserUpdateInfos(e){return e.filter((e=>{var t,r,i,n,s,o,a,c;return(null===(t=e.mainStream)||void 0===t||null===(r=t.allSubscribeTracks)||void 0===r?void 0:r.length)>0||(null===(i=e.mainStream)||void 0===i||null===(n=i.tracks4Unsubscribe)||void 0===n?void 0:n.length)>0||(null===(s=e.auxStream)||void 0===s||null===(o=s.allSubscribeTracks)||void 0===o?void 0:o.length)>0||(null===(a=e.auxStream)||void 0===a||null===(c=a.tracks4Unsubscribe)||void 0===c?void 0:c.length)>0}))}getSubscribeResult(e,t,r,i){const n=new Map;null==t||t.forEach((e=>{const t=e.pUserId+"#"+this.roomId,r=n.get(t);if(r)r.tracks.push(e);else{const r={userId:e.pUserId,userUid:e.pStreamUid,tracks:[e]};n.set(t,r)}})),null==r||r.forEach((e=>{const t=e.pUserId+"#"+this.roomId,r=n.get(t);if(r)r.tracks.push(e);else{const r={userId:e.pUserId,userUid:e.pStreamUid,tracks:[e]};n.set(t,r)}})),e.forEach((e=>{this.getStreamSubscribeResult(e,!0,n,i)})),e.forEach((e=>{this.getStreamSubscribeResult(e,!1,n,i)})),this.logger.info(ZE,"getSubscribeResult success, ".concat(this.getSubscribeResultString(i)))}getStreamSubscribeResult(e,t,r,i){var n,s,o,a;if(!t)return this.handleUnsubscribeReq(dI.STREAM_TYPE_MAIN,e,i),void this.handleUnsubscribeReq(dI.STREAM_TYPE_AUX,e,i);const c=i.successSubscribeInfos,u=i.failSubscribeInfos,d=$E.newRemoteUserSubscribeInfo(e.userInfo.userId,this.roomId,null===(n=e.mainStream)||void 0===n?void 0:n.remoteStream,null===(s=e.auxStream)||void 0===s?void 0:s.remoteStream),l=$E.newRemoteUserSubscribeInfo(e.userInfo.userId,this.roomId,null===(o=e.mainStream)||void 0===o?void 0:o.remoteStream,null===(a=e.auxStream)||void 0===a?void 0:a.remoteStream),h=e.userInfo.userId+"#"+this.roomId,f=r.get(h);var p,m,_,g;if(!f&&this.hasTrackSignalReq(e))return u.push({userId:e.userInfo.userId,roomId:this.roomId,mainStream:{remoteStream:null===(p=e.mainStream)||void 0===p?void 0:p.remoteStream,tracks:null===(m=e.mainStream)||void 0===m?void 0:m.tracks4Subscribe},auxStream:{remoteStream:null===(_=e.auxStream)||void 0===_?void 0:_.remoteStream,tracks:null===(g=e.auxStream)||void 0===g?void 0:g.tracks4Subscribe}}),void this.logger.error(ZE,"subscribe user ".concat(e.userInfo.userId,", isSubscribe: ").concat(t," subscribed failed,mcs not response"));this.getTracksSubscribeResults(t,e,f,d,l),this.appendToSubscribeResult(d,c,l,u)}appendToSubscribeResult(e,t,r,i){var n,s,o,a,c,u,d,l;((null===(n=e.mainStream)||void 0===n||null===(s=n.tracks)||void 0===s?void 0:s.length)>0||(null===(o=e.auxStream)||void 0===o||null===(a=o.tracks)||void 0===a?void 0:a.length)>0)&&this.appendSubscribeResult(t,e),((null===(c=r.mainStream)||void 0===c||null===(u=c.tracks)||void 0===u?void 0:u.length)>0||(null===(d=r.auxStream)||void 0===d||null===(l=d.tracks)||void 0===l?void 0:l.length)>0)&&this.appendSubscribeResult(i,r)}static newRemoteUserSubscribeInfo(e,t,r,i){return{userId:e,roomId:t,mainStream:{remoteStream:r,tracks:[]},auxStream:{remoteStream:i,tracks:[]}}}handleUnsubscribeReq(e,t,r){const i=e===dI.STREAM_TYPE_MAIN?t.mainStream:t.auxStream,n=null==i?void 0:i.tracks4Unsubscribe;if(null!=n&&n.length){var s,o,a,c,u;const d=null===(s=i.tracks4Subscribe)||void 0===s?void 0:s.some((e=>2===e.state)),l=r.successSubscribeInfos.find((e=>e.userId===t.userInfo.userId&&e.roomId===t.userInfo.roomId)),h=e===dI.STREAM_TYPE_MAIN?null==l||null===(o=l.mainStream)||void 0===o?void 0:o.tracks:null==l||null===(a=l.auxStream)||void 0===a?void 0:a.tracks,f=!h||0===(null==h?void 0:h.filter((e=>2===e.state)).length),p={userId:t.userInfo.userId,roomId:this.roomId,mainStream:{remoteStream:null===(c=t.mainStream)||void 0===c?void 0:c.remoteStream,tracks:e===dI.STREAM_TYPE_MAIN?n:[]},auxStream:{remoteStream:null===(u=t.auxStream)||void 0===u?void 0:u.remoteStream,tracks:e===dI.STREAM_TYPE_AUX?n:[]}};this.logger.info(ZE,"handleUnsubscribeReq, hasSubscribeReq:".concat(d,", allSubscribeReqFailed:").concat(f)),d&&f?this.appendSubscribeResult(r.failUnsubscribeInfos,p):this.appendSubscribeResult(r.successUnsubscribeInfos,p)}}hasTrackSignalReq(e){var t,r,i,n;return(null===(t=e.mainStream)||void 0===t||null===(r=t.allSubscribeTracks)||void 0===r?void 0:r.filter((e=>e.type===uI.TRACK_TYPE_VIDEO)).length)>0||(null===(i=e.auxStream)||void 0===i||null===(n=i.allSubscribeTracks)||void 0===n?void 0:n.filter((e=>e.type===uI.TRACK_TYPE_VIDEO)).length)>0}getTracksSubscribeResults(e,t,r,i,n){var s,o,a,c;const u=e?null===(s=t.mainStream)||void 0===s?void 0:s.tracks4Subscribe:null===(o=t.mainStream)||void 0===o?void 0:o.tracks4Unsubscribe;null==u||u.forEach((s=>{this.getTrackSubscribeResult(e,t.userInfo.userId,s,dI.STREAM_TYPE_MAIN,r,i,n)}));const d=e?null===(a=t.auxStream)||void 0===a?void 0:a.tracks4Subscribe:null===(c=t.auxStream)||void 0===c?void 0:c.tracks4Unsubscribe;null==d||d.forEach((s=>{this.getTrackSubscribeResult(e,t.userInfo.userId,s,dI.STREAM_TYPE_AUX,r,i,n)}))}getTrackSubscribeResult(e,t,r,i,n,s,o){var a;const c=i===dI.STREAM_TYPE_MAIN?o.mainStream:o.auxStream,u=i===dI.STREAM_TYPE_MAIN?s.mainStream:s.auxStream,d=null==n||null===(a=n.tracks)||void 0===a?void 0:a.find((e=>e.cSsrcId===r.cssrc));d?0!==d.code?(c.tracks.push(r),this.logger.error(ZE,"isSubscribe:".concat(e,", subscribe user ").concat(t," ").concat(i," streamUid:").concat(d.pStreamUid," subscribed failed,code:").concat(d.code))):u.tracks.push(r):this.logger.error(ZE,"isSubscribe:".concat(e,", subscribe user ").concat(t,", ").concat(i,"\n      track req id: ").concat(r.trackId,", ssrc ").concat(r.cssrc," subscribed failed,mcs not response"))}async updateUserList(e){this.logger.info(ZE,"updateUserList start");try{e.infos.forEach((e=>{this.stat.getMediaStat().setEncryInfo(String(e.userId),String(e.userEid))})),await this.taskLocker.Lock("".concat(ZE,":updateUserList"));const t=this.remoteUserManager.updateUserListInfo(this.roomId,e.infos);if(this.logger.info(ZE,"updateUserList , begin"),!t||0===t.length)return void this.logger.error(ZE,"updateUserList , userUpdateInfos is null");t.forEach((e=>{if(e.isUserNameChanged&&(this.logger.info(ZE,"emit ".concat(MI.UserNameChanged,", ").concat(e.userInfo.userId,"}")),this.eventEmitter.emit(MI.UserNameChanged,{roomId:this.roomId,userId:e.userInfo.userId,userName:e.userInfo.nickname})),0===e.preUserState&&1===e.curUserState)this.logger.info(ZE,"emit ".concat(MI.PeerJoin,", ").concat(e.userInfo.userId,":").concat(e.userInfo.nickname)),this.eventEmitter.emit(MI.PeerJoin,{userId:e.userInfo.userId,userName:e.userInfo.nickname});else if(1===e.preUserState&&0===e.curUserState){var t,r,i,n;(null===(t=e.mainStream)||void 0===t||null===(r=t.removedTracks)||void 0===r?void 0:r.length)>0&&(this.logger.info(ZE,"emit ".concat(MI.StreamRemoved,", ").concat(e.userInfo.userId,", ").concat(dI.STREAM_TYPE_MAIN)),this.eventEmitter.emit(MI.StreamRemoved,{stream:e.mainStream.remoteStream})),(null===(i=e.auxStream)||void 0===i||null===(n=i.removedTracks)||void 0===n?void 0:n.length)>0&&(this.logger.info(ZE,"emit ".concat(MI.StreamRemoved,", ").concat(e.userInfo.userId,", ").concat(dI.STREAM_TYPE_AUX)),this.eventEmitter.emit(MI.StreamRemoved,{stream:e.auxStream.remoteStream})),this.logger.info(ZE,"emit ".concat(MI.PeerLeave,", ").concat(e.userInfo.userId)),this.eventEmitter.emit(MI.PeerLeave,{userId:e.userInfo.userId,userName:e.userInfo.nickname,reason:0}),this.stat.getMediaStat().updateAudioStreamInfos(e.userInfo.userId,"removed")}})),await this.updateSubscribe(t)}catch(tb){this.logger.error(ZE,"updateUserList occur exception ".concat(tb))}finally{this.taskLocker.unLock("".concat(ZE,":updateUserList"))}}async refreshRemoteStreamList(e){this.logger.info(ZE,"refreshRemoteStreamList start");try{await this.taskLocker.Lock("".concat(ZE,":refreshRemoteStreamList"));const t={userId:e.userId,userUid:e.userUid,roomId:this.roomId,nickname:null},r=this.remoteUserManager.refreshRemoteStreamList(t,e.allVideoStreams,e.allAudioStreams);if(this.logger.info(ZE,"refreshRemoteStreamList begin"),!r||0===r.length)return void this.logger.error(ZE,"refreshRemoteStreamList , userUpdateInfos is null");const i=r.find((t=>t.userInfo.userId===e.userId));this.updateSingleUser(i),await this.updateSubscribe(r)}catch(tb){this.logger.error(ZE,"refreshRemoteStreamList occur exception ".concat(tb))}finally{this.taskLocker.unLock("".concat(ZE,":refreshRemoteStreamList"))}}updateSingleUser(e){var t,r;e.isUserNameChanged&&(this.logger.info(ZE,"emit ".concat(MI.UserNameChanged,", ").concat(e.userInfo.userId,"}")),this.eventEmitter.emit(MI.UserNameChanged,{roomId:this.roomId,userId:e.userInfo.userId,userName:e.userInfo.nickname})),0===e.preUserState&&1===e.curUserState&&(this.logger.info(ZE,"emit ".concat(MI.PeerJoin,", ").concat(e.userInfo.userId,":").concat(e.userInfo.nickname)),this.eventEmitter.emit(MI.PeerJoin,{userId:e.userInfo.userId,userName:e.userInfo.nickname}));const i=null===(t=e.mainStream)||void 0===t?void 0:t.remoteStream;i&&($E.isStreamAdd(dI.STREAM_TYPE_MAIN,e)?(this.logger.info(ZE,"emit ".concat(MI.StreamAdded,", ").concat(e.userInfo.userId,", ").concat(i.getType(),"}")),this.eventEmitter.emit(MI.StreamAdded,{stream:i}),this.updateAudioStreamInfo(e.userInfo.userId,"add",i)):$E.isStreamRemove(dI.STREAM_TYPE_MAIN,e)?(this.logger.info(ZE,"emit ".concat(MI.StreamRemoved,", ").concat(e.userInfo.userId,", ").concat(i.getType(),"}")),this.eventEmitter.emit(MI.StreamRemoved,{stream:i}),this.updateAudioStreamInfo(e.userInfo.userId,"removed",i)):$E.isStreamUpdate(dI.STREAM_TYPE_MAIN,e)&&(this.logger.info(ZE,"emit ".concat(MI.StreamUpdated,", ").concat(e.userInfo.userId,", ").concat(i.getType(),"}")),this.eventEmitter.emit(MI.StreamUpdated,{stream:i}),this.updateAudioStreamInfo(e.userInfo.userId,"update",i)));const n=null===(r=e.auxStream)||void 0===r?void 0:r.remoteStream;n&&($E.isStreamAdd(dI.STREAM_TYPE_AUX,e)?(this.logger.info(ZE,"emit ".concat(MI.StreamAdded,", ").concat(e.userInfo.userId,", ").concat(n.getType(),"}")),this.eventEmitter.emit(MI.StreamAdded,{stream:n})):$E.isStreamRemove(dI.STREAM_TYPE_AUX,e)&&(this.logger.info(ZE,"emit ".concat(MI.StreamRemoved,", ").concat(e.userInfo.userId,", ").concat(n.getType(),"}")),this.eventEmitter.emit(MI.StreamRemoved,{stream:n}))),1===e.preUserState&&0===e.curUserState&&(this.logger.info(ZE,"emit ".concat(MI.PeerLeave,", ").concat(e.userInfo.userId)),this.eventEmitter.emit(MI.PeerLeave,{userId:e.userInfo.userId,userName:e.userInfo.nickname,reason:0}),this.stat.getMediaStat().updateAudioStreamInfos(e.userInfo.userId,"removed")),this.handleMuteStatus(e)}updateAudioStreamInfo(e,t,r){var i;if("add"===t)null!==(i=r.getStreamInfo())&&void 0!==i&&i.audioProfile&&this.stat.getMediaStat().updateAudioStreamInfos(e,"add");else if("removed"===t)this.stat.getMediaStat().updateAudioStreamInfos(e,"removed");else{var n;null!==(n=r.getStreamInfo())&&void 0!==n&&n.audioProfile?this.stat.getMediaStat().updateAudioStreamInfos(e,"add"):this.stat.getMediaStat().updateAudioStreamInfos(e,"removed")}}remoteUserDisconnectNotify(e){e&&this.logger.info(ZE,"remoteDisconnectNotify, userId:".concat(e.userId))}remoteUserReconnectNotify(e){if(!e)return;this.logger.info(ZE,"remoteReconnectNotify, userId:".concat(e.userId));const t={userId:e.userId,userUid:e.userUid,roomId:this.roomId,nickname:null};this.remoteUserManager.remoteUserReconnect(t,e.videoStreams,e.audioStreams)}updateAppData(e){const t=e.userId,r=e.appData.nickname;t&&e.userId!==this.userInfo.userId&&(this.remoteUserManager.updateUserName(t,this.roomId,r),this.eventEmitter.emit(MI.UserNameChanged,{roomId:this.roomId,userId:t,userName:r}))}async updateRemoteStream(e){this.logger.info(ZE,"updateRemoteStream start");try{await this.taskLocker.Lock("".concat(ZE,":updateRemoteStream"));const t={userId:e.userId,userUid:e.userUid,roomId:this.roomId,nickname:null},r=this.remoteUserManager.updateRemoteStream(t,e.videoStreams,e.audioStreams);if(this.logger.info(ZE,"updateRemoteStream , begin"),!r)return void this.logger.error(ZE,"updateRemoteStream , userUpdateInfos is null");this.handleMuteStatus(r)}catch(tb){this.logger.error(ZE,"updateRemoteStream occur exception ".concat(tb))}finally{this.taskLocker.unLock("".concat(ZE,":updateRemoteStream"))}}handleMuteStatus(e){this.logger.info(ZE,"handleMuteStatus begin");const t=$E.getMuteChangeStatus(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_AUDIO,e);2!==t&&(this.emitMediaStatusChange(e.userInfo.userId,e.userInfo.roomId,uI.TRACK_TYPE_AUDIO,t),1===t?this.stat.getMediaStat().updateAudioStreamInfos(this.userInfo.userId,"add"):this.stat.getMediaStat().updateAudioStreamInfos(this.userInfo.userId,"removed"));const r=$E.getMuteChangeStatus(dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_VIDEO,e);2!==r&&this.emitMediaStatusChange(e.userInfo.userId,e.userInfo.roomId,uI.TRACK_TYPE_VIDEO,r)}async removeRemoteStream(e){this.logger.info(ZE,"removeRemoteStream start");try{await this.taskLocker.Lock("".concat(ZE,":removeRemoteStream"));const t={userId:e.userId,userUid:e.userUid,roomId:this.roomId,nickname:null},r=this.remoteUserManager.refreshRemoteStreamList(t,e.allVideoStreams,e.allAudioStreams);if(this.logger.info(ZE,"removeRemoteStream begin"),!r||0===r.length)return void this.logger.error(ZE,"removeRemoteStream , userUpdateInfos is null");const i=r.find((t=>t.userInfo.userId===e.userId));this.updateSingleUser(i),await this.updateSubscribe(r)}catch(tb){this.logger.error(ZE,"removeRemoteStream occur exception ".concat(tb))}finally{this.taskLocker.unLock("".concat(ZE,":removeRemoteStream"))}}emitMediaStatusChange(e,t,r,i){if(!this.remoteUserManager.isRemoteUserSubscribed(e,t))return void this.logger.debug(ZE,"no subscription, no need report media status");const n={roomId:t,userId:e,status:1===i?TI.MediaStatusAvailable:TI.MediaStatusUnavailable,reason:1===i?EI.MediaUnmuted:EI.MediaMuted},s=r===uI.TRACK_TYPE_AUDIO?1===i?"UnmuteAudio":"MuteAudio":1===i?"UnmuteVideo":"MuteVideo";this.logger.info(ZE,"emit ".concat(MI[s],", userId: ").concat(e,", type: ").concat(r,", status: ").concat(n.status)),this.eventEmitter.emit(MI[s],n)}waitNotifyConfig(e){return new Promise((t=>{const r={id:e.length+1,domain:"",start_ms:Hg.getCurrentTimestamp(),delay_ms:0,stepName:"configNotify",rspCode:"",errMsg:""};let i=null;this.waitConfigCallbackFunc=()=>{clearTimeout(i),t(),r.delay_ms=Hg.getCurrentTimestamp()-r.start_ms,r.rspCode="OK",e.push(r)},i=setTimeout((()=>{this.logger.error(ZE,"wait config timeout"),r.rspCode="".concat(ou.RTC_ERR_CODE_WAIT_CONFIG_FAIL),r.errMsg=Iu[ou.RTC_ERR_CODE_WAIT_CONFIG_FAIL],r.delay_ms=Hg.getCurrentTimestamp()-r.start_ms,e.push(r),t()}),qv)}))}handleConfigNotifyBody(e){const{controlDisconnectTimeout:t="30",controlHoldTimeout:r="120",controlPingPeriod:i="5"}=e.appConfigs||{},n={heartBeatRetryTimes:parseInt(t)/parseInt(i)||Qv,connectionTimeout:parseInt(r)||Zv,heartBeatPeriod:parseInt(i)||Xv};this.waitConfigCallbackFunc&&this.waitConfigCallbackFunc(),this.stat.setTraceInfo(e.traceId),JE.setLogServerConfigs(e.logServerConfigs),this.signal.setConfigParams(n)}async uploadLog(e){await JE.uploadLogFile(this.logger,e)}async handleWatchMsg(e){if(null!=e)try{await this.taskLocker.Lock("".concat(ZE,":handleWatchMsg"));const t=e,r=t.videoSsrcIds,i=t.audioSsrcIds,n=r.filter((e=>this.sdpRepInfo.video.sendSsrcRange.find((t=>e===t)))),s=r.filter((e=>this.sdpRepInfo.desktopVideo.sendSsrcRange.find((t=>e===t)))),o=[],a=[],c={mainStreamVideoTracks2Update:{},mainStreamAudioTracks2Update:{},auxStreamTracks2Update:{}};if(n&&n.length>0){const e=this.streamPublishManager.generatePubInfoWhenWatch(dI.STREAM_TYPE_MAIN,n,[]);await this.publishWhenWatch(dI.STREAM_TYPE_MAIN,e),e.tracks2NewPublish.forEach((e=>{r.find((t=>t===e.ssrc))&&o.push({ssrcId:e.ssrc,status:0})})),e.tracks2KeepPublish.forEach((e=>{o.push({ssrcId:e.ssrc,status:0})})),c.mainStreamVideoTracks2Update=e}if(i&&i.length>0){const e=this.streamPublishManager.generatePubInfoWhenWatch(dI.STREAM_TYPE_MAIN,[],i);await this.publishWhenWatch(dI.STREAM_TYPE_MAIN,e),e.tracks2NewPublish.forEach((e=>{i.find((t=>t===e.ssrc))&&a.push({ssrcId:e.ssrc,status:0})})),e.tracks2KeepPublish.forEach((e=>{a.push({ssrcId:e.ssrc,status:0})})),c.mainStreamAudioTracks2Update=e}if(s&&s.length>0){const e=this.streamPublishManager.generatePubInfoWhenWatch(dI.STREAM_TYPE_AUX,s,[]);await this.publishWhenWatch(dI.STREAM_TYPE_AUX,e),e.tracks2NewPublish.forEach((e=>{r.find((t=>t===e.ssrc))&&o.push({ssrcId:e.ssrc,status:0})})),e.tracks2KeepPublish.forEach((e=>{o.push({ssrcId:e.ssrc,status:0})})),c.auxStreamTracks2Update=e}this.logger.info(ZE,"handle watch success, videoSsrcs: ".concat(JSON.stringify(r),", audioSsrcs: ").concat(JSON.stringify(i)));const u=this.stat.getSpanId(t["x-nuwa-span-id"]),d=Hg.generateRandomId(16,16);this.stat.setParentSpanId(d,u);const l={type:"WATCH_STREAM_NOTIFY",requestId:t.requestId,traceId:t.traceId,version:t.version,videoSsrcIds:o,audioSsrcIds:a,"x-nuwa-trace-id":t["x-nuwa-trace-id"],"x-nuwa-span-id":d};await this.signal.pushStreamResponse(l),this.reportMediaStreamInfo(c,o),this.logger.info(ZE,"handleWatchMsg success")}catch(tb){this.logger.error(ZE,"handleWatchMsg occur error ".concat(tb))}finally{this.taskLocker.unLock("".concat(ZE,":handleWatchMsg"))}else this.logger.error(ZE,"message is null")}reportMediaStreamInfo(e,t){var r,i;if(null!==(r=e.mainStreamVideoTracks2Update.tracks2NewPublish)&&void 0!==r&&r.find((e=>e.type===uI.TRACK_TYPE_VIDEO))){this.stat.getMediaStat().setLocalMainStreamInfo(this.userInfo.userId,this.streamPublishManager.getPublishedMainStreamInfos())&&this.buildSendMediaStreamInfo(yI.Video,t)}if(null!==(i=e.auxStreamTracks2Update.tracks2NewPublish)&&void 0!==i&&i.filter((e=>e.type===uI.TRACK_TYPE_VIDEO))){this.stat.getMediaStat().setLocalAuxsStreamInfo(this.userInfo.userId,this.streamPublishManager.getPublishedAuxStreamInfo())&&this.buildSendMediaStreamInfo(yI.Aux)}}async publishWhenWatch(e,t){if(!t||0===t.tracks2NewPublish.length&&0===t.tracks2KeepPublish.length)return void this.logger.info(ZE,"handleWatchMsg, not published stream");const r=this.streamPublishManager.getLocalStream(e);await this.sendPublishRequest(t.allTracks2Publish),await this.updateStreamTracks(r,t),this.logger.info(ZE,"handleWatchMsg, published stream")}setCameraCaptureReport(e,t){this.stat.setCameraInfo(e,t)}signalEvent(){this.signal.on(CI.watchStreamNotify,(e=>{this.handleWatchMsg(e)})),this.signal.on(CI.pushStreamNotify,(e=>{this.refreshRemoteStreamList(e)})),this.signal.on(CI.stopPushStreamNotify,(e=>{this.removeRemoteStream(e)})),this.signal.on(CI.changeStreamStatusNotify,(e=>{this.updateRemoteStream(e)})),this.signal.on(CI.appDataChangeNotify,(e=>{this.updateAppData(e)})),this.signal.on(CI.disconnectNotify,(e=>{this.remoteUserDisconnectNotify(e)})),this.signal.on(CI.reconnectNotify,(e=>{this.remoteUserReconnectNotify(e)})),this.signal.on(CI.configNotify,(e=>{this.handleConfigNotifyBody(e)})),this.signal.on(CI.top3AudioVolumeNotify,(e=>{this.handleMaxVolumeNotify(e)})),this.signal.on(CI.statusChangeNotify,(async e=>{await this.updateUserList(e)})),this.signal.on(CI.uploadLogNotify,(async e=>{await this.uploadLog(e)})),this.signal.on(CI.publishStatusNotify,(e=>{this.handlePublishStatusNotify(e)})),this.signal.on(fy.Reconnected,(async()=>{await this.refreshRoomUserInfos()})),this.signal.on(fy.SessionUnavailable,(async()=>{this.logger.info(ZE,"".concat(fy.SessionUnavailable));await this.rejoinLoop(120)})),this.signal.on(fy.ConnectionUnavailable,(async()=>{this.logger.info(ZE,"".concat(fy.ConnectionUnavailable));await this.rejoinLoop(120)})),this.signal.on(fy.AuthenticateFail,(async()=>{this.logger.info(ZE,"".concat(fy.AuthenticateFail)),this.doLeaveRoom()})),this.signal.on(fy.SignatureExpired,(e=>{this.handleNotifySignatureExpired(e)})),this.signal.on(MI.ConnectionStateChanged,(e=>{this.handleNotifyConnectStateChange(e)})),this.signal.on(MI.NetworkQuality,(e=>{this.eventEmitter.emit(MI.NetworkQuality,e)})),this.signal.on(fy.ClientBanned,(()=>{this.kickRoom()}))}kickRoom(){this.eventEmitter.emit(MI.ClientBanned,{userId:this.userInfo.userId}),this.cleanup(),this.cleanTransportStats(),this.stat.leaveRoom(),eI.immediateReportRecords(),this.logger.info(ZE,"kick leave success")}async refreshRoomUserInfos(){const e=await this.signal.queryRoomUsers(null);await this.doRefreshRoomUserInfos(this.roomId,e.userInfos,!1)}async doRefreshRoomUserInfos(e,t,r){try{this.logger.debug(ZE,"doRefreshRoomUserInfos, begin"),await this.taskLocker.Lock("".concat(ZE,":doRefreshRoomUserInfos"));const i=this.remoteUserManager.refreshRemoteUserList(e,t,r);if(!i)return null;i.forEach((e=>{this.updateSingleUser(e)})),await this.updateSubscribe(i)}catch(tb){this.logger.error(ZE,"doRefreshRoomUserInfos, error:".concat(tb))}finally{this.taskLocker.unLock("".concat(ZE,":doRefreshRoomUserInfos"))}}async rejoinLoop(e){if(this.isLoopRejoining)this.logger.info(ZE,"rejoinLoop, isLoopRejoining so return");else try{this.isLoopRejoining=!0;const t=async e=>await this.handleRejoin(e),r=e=>"function"==typeof(null==e?void 0:e.getCode)&&e.getCode()===ou.RTC_ERR_CODE_STATUS_ERROR;return await ly.callWithRetryTimes(t,!1,e,qE,r)}catch(tb){this.logger.error(ZE,"rejoinLoop, rejoin room failed, leave room, error:".concat(tb)),this.localRejoinFlag||(this.connectState={prevState:vI[RI.RECONNECTING],curState:vI[RI.DISCONNECTED]},this.eventEmitter.emit(MI.ConnectionStateChanged,this.connectState));try{await this.leaveImpl()}catch(tb){this.logger.error(ZE,"rejoinLoop, leave failed, error:".concat(tb))}}finally{this.isLoopRejoining=!1}}async handleRejoin(e){if(this.logger.info(ZE,"handleRejoin, client status: ".concat(this.status,", tryNumber:").concat(e)),0===this.status)throw this.logger.error(ZE,"handleRejoin, status:".concat(0)),new Eu(ou.RTC_ERR_CODE_STATUS_ERROR,"handleRejoin but status is Idle");try{await this.taskLocker.Lock("".concat(ZE,":handleRejoin")),this.status=4,await this.rejoin(this.roomId,dy.transLocalUserToJoinConfig(this.userInfo)),2===this.getSessionStatus()&&(this.logger.info(ZE,"handleRejoin, rejoin room success"),this.connectState={prevState:vI[RI.RECONNECTING],curState:vI[RI.CONNECTED]},this.eventEmitter.emit(MI.ConnectionStateChanged,this.connectState),await this.rejoinPublish(),this.localRejoinFlag=!1)}finally{this.taskLocker.unLock("".concat(ZE,":handleRejoin"))}}async rejoinPublish(){this.logger.info(ZE,"rejoin publish stream"),this.connectState.prevState=vI[RI.DISCONNECTED];const e=[],t=this.streamPublishManager.getLocalStream(dI.STREAM_TYPE_MAIN),r=this.streamPublishManager.getLocalStream(dI.STREAM_TYPE_AUX);t&&e.push(t),r&&e.push(r),e.length>0&&await this.rejoinPublishStreams(e)}handleNotifySignatureExpired(e){this.logger.error(ZE,"signatureExpired");const t={errorCode:null==e?void 0:e.code,errorMsg:null==e?void 0:e.reason};this.eventEmitter.emit(MI.SignatureExpired,t)}handleNotifyConnectStateChange(e){this.logger.info(ZE,"ConnectStateChange"),this.eventEmitter.emit(MI.ConnectionStateChanged,e),this.connectState.curState=e.curState}cleanNetworkStatistic(){this.preNetQuality=null,this.downLinkData=null,this.upLinkData=null}cleanup(){var e,t;null===(e=this.signal)||void 0===e||e.disconnect(),this.signal=void 0,this.resetConnection(),null===(t=this.remoteUserManager)||void 0===t||t.clear(this.roomId);const r=this.streamPublishManager.getLocalStream(dI.STREAM_TYPE_MAIN);if(r){r.removeClient(this)}this.streamPublishManager.reset(),clearTimeout(this.streamInterruptedDetectInterval),clearTimeout(this.rtcStatsInterval),clearTimeout(this.netQualityTimer),pI.reset(),this.cleanNetworkStatistic(),this.streamInterruptedDetectInterval=null,this.rtcStatsInterval=null,this.lastCycleFrameDecodedMap.clear(),this.streamInterruptedUsersMap.clear(),this.startupQoSMap.clear(),this.status=0,this.taskLocker.clear(),this.stat.getMediaStat().clearEncryUserId(),clearInterval(this.audioLevelTimer)}async addSsrc4Top3(e){var t;return this.audioStreams4TopN.close(),await this.addSsrc2SdpBatch(e,null===(t=this.sdpRepInfo.audio)||void 0===t?void 0:t.topNSsrcBegin)}setAudioLevelStatTimer(){this.audioLevelTimer&&clearInterval(this.audioLevelTimer),this.logger.info(ZE,"setAudioLevelStatTimer"),this.audioLevelTimer=setInterval((()=>{try{this.audioStreams4TopN.getAudioLevel().forEach((e=>{const t=Math.round(100*e.level);this.stat.getMediaStat().updateAudioLevel({type:"remotetop3",level:t,ssrc:e.ssrc})}));const e=this.remoteUserManager.getAllUserStreamsByType(this.roomId,dI.STREAM_TYPE_MAIN,uI.TRACK_TYPE_AUDIO),t=[];e.forEach((e=>{const r=e.mainStream.tracks.find((e=>e.isTrackReady&&e.type===uI.TRACK_TYPE_AUDIO&&e.isSubscribed));r&&t.push({userId:e.userId,ssrc:r.cssrc})}));for(const n of t){const e=this.remoteUserManager.getUserInfoById(n.userId,this.roomId),t=Math.round(100*e.mainStream.remoteStream.getAudioLevel());this.stat.getMediaStat().updateAudioLevel({type:"remote",level:t,ssrc:n.ssrc,userId:n.userId})}const r=this.streamPublishManager.getLocalStream(dI.STREAM_TYPE_MAIN),i=Math.round(100*(r?r.getAudioLevel():0));this.stat.getMediaStat().updateAudioLevel({type:"local",level:i})}catch(tb){this.logger.error(ZE,"setAudioLevelStatTimer, occur error: ".concat(tb))}}),this.audioLevelInterval)}async addSsrc2SdpBatch(e,t){if(!t)return null;const r={answerSdp:e},i=await this.connectionsManager.addTopAudioUserBatch(r.answerSdp,t,3,((e,t)=>{this.audioStreams4TopN.addAudioStream(e,t)}));return this.stat.getMediaStat().setStartSsrc(t),i}async saveAudioStream4TopN(e){this.logger.info(ZE,"AudioPolicyï¼TOPN_AUDIOPOLICY, save audio stream, streamId: ".concat(e.streams[0].id));if(null!=this.audioStreams4TopN.getAudioStream(e.streams[0].id)){this.audioStreams4TopN.updateAudioStream(e.streams[0].id,e.track),this.logger.info(ZE,"AudioPolicyï¼TOPN_AUDIOPOLICY, save audio stream ok, streamId: ".concat(e.streams[0].id));try{await this.audioStreams4TopN.play(e.streams[0].id),this.audioStreams4TopN.setAudioVolume4Id(e.streams[0].id,this.topNAudioVolume),this.logger.info(ZE,"AudioPolicyï¼TOPN_AUDIOPOLICY, auto play audio success, streamId: ".concat(e.streams[0].id))}catch(e){this.logger.error(ZE,"AudioPolicyï¼TOPN_AUDIOPOLICY, auto play audio fail, ".concat(null==e?void 0:e.message,", streamId: ").concat(e.streams[0].id))}}else this.logger.error(ZE,"AudioPolicyï¼TOPN_AUDIOPOLICY, audio stream of streamId: ".concat(e.streams[0].id," not exist"))}handleMaxVolumeNotify(e){try{e.topUserAudios&&e.topUserAudios.length>0?(this.top3VolumeUserIds.length=0,e.topUserAudios.forEach((e=>{e.volume=100*(60-(e.volume>60?60:e.volume))/60,this.top3VolumeUserIds.push({user_id:e.userId,volume:e.volume})})),1===this.audioPolicy&&this.eventEmitter.emit(MI.VolumeIndicator,{userVolumeInfos:this.top3VolumeUserIds})):this.logger.error(ZE,"handleMaxVolumeNotify error,topUserAudios is null")}catch(t){this.logger.error(ZE,"handleMaxVolumeNotify error ".concat(null==t?void 0:t.message))}}handlePublishStatusNotify(e){try{e.urlStatus&&(this.logger.info(ZE,"emit ".concat(MI.LiveStreamingUpdated)),this.eventEmitter.emit(MI.LiveStreamingUpdated,e.urlStatus))}catch(t){this.logger.error(ZE,"handlePublishStatusNotify error ".concat(t))}}setVolume4TopThree(e){this.setVolume4TopThreeImpl(e)}setVolume4TopThreeImpl(e){this.logger.debug(ZE,"setVolume4TopThreeImpl volume: "+e),e>100||e<0||1===this.audioPolicy&&(this.topNAudioVolume=e,this.audioStreams4TopN.setAudioVolume(e))}muteAudio4TopThree(e){this.muteAudio4TopThreeImpl(e)}muteAudio4TopThreeImpl(e){this.logger.debug(ZE,"muteAudio4TopThree enable: "+e),1===this.audioPolicy&&this.audioStreams4TopN.muteAudio(e)}isTopNAudioMuted(){return this.isTopNAudioMutedImpl()}isTopNAudioMutedImpl(){let e=!1;return 1===this.audioPolicy&&(e=this.audioStreams4TopN.isAudioMuted(),this.logger.debug(ZE,"isTopNAudioMutedImpl : "+e)),e}async changeUserName(e){return await this.changeUserNameImpl(e)}async changeUserNameImpl(e){try{if(rR.checkUserName(e),this.userInfo.role===ay)throw new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"player can not change user name");return await this.signal.appData(this.userInfo.appData,"nickname",e),this.userInfo.appData.nickname=e,!0}catch(tb){return this.logger.error(ZE,"changeUserNameImpl, error:".concat(tb)),!1}}reportAudioMuteInfo(e,t){this.stat.reportAudioMuteInfo(e,t)}reportVideoMuteInfo(e,t){this.stat.reportVideoMuteInfo(e,t)}async startLiveStreaming(e,t,r,i){return await this.startLiveStreamingImpl(e,t,r,i)}async startLiveStreamingImpl(e,t,r,i){if(this.logger.info(ZE,"startLiveStreaming:  publishConfig: ".concat(JSON.stringify(r),", userConfig: ").concat(JSON.stringify(i))),!(t&&e&&r&&i))throw this.logger.error(ZE,"startLiveStreaming failed for parameter error: empty parameter"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);if(2!==this.status||this.userInfo.role!==oy)throw this.logger.error(ZE,"startLiveStreaming failed for permission not allowed"),new Eu(ou.RTC_ERR_CODE_ROLE_NO_PERMISSION);const n=this.getLiveStreamingUserInfos(i,99===r.template);if(0===n.length)throw this.logger.error(ZE,"startLiveStreaming failed for parameter error:".concat(JSON.stringify(i))),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);try{await this.signal.startLiveStreaming(e,t,r,n),this.logger.info(ZE,"startLiveStreaming success, taskId: ".concat(e,", url: ").concat(t))}catch(tb){throw this.logger.error(ZE,"startLiveStreaming failed: ".concat(tb)),tb}}getLiveStreamingUserInfos(e,t){if(!e||0===e.length)return null;const r=[],i=this.userInfo.userId;return e.forEach((e=>{const n={userId:e.userId,audioStreams:[],videoStreams:[],layouts:[]};if(t&&!e.layouts)throw this.logger.error(ZE,"getLiveStreamingUserInfos, layouts is null when template=99"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);e.userId===i?this.getLocalLiveStreamingUserInfos(e,n,t):this.getRemoteLiveStreamingUserInfos(e,n,t),(n.audioStreams.length||n.videoStreams.length)&&r.push(n)})),this.logger.info(ZE,"getLiveStreamingUserInfos, publishInfos : ".concat(JSON.stringify(r))),r}getLocalLiveStreamingUserInfos(e,t,r){const i=this.streamPublishManager.getPublishedMainStreamInfos();if(e.audio){var n;const e=null==i||null===(n=i.find((e=>e.type===uI.TRACK_TYPE_AUDIO)))||void 0===n?void 0:n.ssrc;e&&t.audioStreams.push(e)}if(!e.resolutionIds||0===e.resolutionIds.length)return;const s=this.streamPublishManager.getPublishedAuxVideoTrackInfo();e.resolutionIds.forEach((n=>{var o;const a=null==i||null===(o=i.find((e=>e.resolutionId===n)))||void 0===o?void 0:o.ssrc;a?$E.updateSlidePublishInfo(e,t,a,n,r):(null==s?void 0:s.resolutionId)===n&&$E.updateSlidePublishInfo(e,t,s.ssrc,n,r)}))}static getSsrcLayout(e,t){return{alpha:t.alpha,localX:t.localX,localY:t.localY,renderMode:t.renderMode,ssrc:e,subBackGroundColor:t.subBackGroundColor,subHeight:t.subHeight,subWidth:t.subWidth,zorder:t.zorder}}getRemoteLiveStreamingUserInfos(e,t,r){const i=this.remoteUserManager.getAllUserStreamsByType(this.roomId,null,null),n=null==i?void 0:i.find((t=>t.userId===e.userId));if(n){if(e.audio){var s,o,a;const e=null===(s=n.mainStream)||void 0===s||null===(o=s.tracks)||void 0===o||null===(a=o.find((e=>e.type===uI.TRACK_TYPE_AUDIO)))||void 0===a?void 0:a.pssrc;e&&t.audioStreams.push(e)}if(!e.resolutionIds||0===e.resolutionIds.length)return;for(const i of e.resolutionIds){var c,u,d;const s=null===(c=n.mainStream)||void 0===c||null===(u=c.tracks)||void 0===u||null===(d=u.find((e=>e.trackId===i)))||void 0===d?void 0:d.pssrc;if(s)$E.updateSlidePublishInfo(e,t,s,i,r);else{var l,h,f;const s=null===(l=n.auxStream)||void 0===l||null===(h=l.tracks)||void 0===h||null===(f=h.find((e=>e.trackId===i)))||void 0===f?void 0:f.pssrc;s&&$E.updateSlidePublishInfo(e,t,s,i,r)}}}}static updateSlidePublishInfo(e,t,r,i,n){if(t.videoStreams.push(r),n&&e.layouts){const n=e.layouts.find((e=>e.resolutionId===i));if(n){const e=$E.getSsrcLayout(r,n);t.layouts.push(e)}}}async updateLiveStreaming(e,t,r,i){return await this.updateLiveStreamingImpl(e,t,r,i)}async updateLiveStreamingImpl(e,t,r,i){if(this.logger.info(ZE,"updateLiveStreaming: publishConfig: ".concat(JSON.stringify(r),", userConfig: ").concat(JSON.stringify(i))),!(t&&e&&r&&i))throw this.logger.error(ZE,"updateLiveStreaming failed for parameter error: empty param"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);if(2!==this.status||this.userInfo.role!==oy)throw this.logger.error(ZE,"updateLiveStreaming failed for permission not allowed"),new Eu(ou.RTC_ERR_CODE_ROLE_NO_PERMISSION);const n=this.getLiveStreamingUserInfos(i,99===r.template);try{await this.signal.updateLiveStreaming(e,r,n),this.logger.info(ZE,"updateLiveStreaming success, taskId: ".concat(e,", url: ").concat(t))}catch(tb){throw this.logger.error(ZE,"updateLiveStreaming failed: ".concat(tb)),tb}}async stopLiveStreaming(e){return await this.stopLiveStreamingImpl(e)}async stopLiveStreamingImpl(e){if(this.logger.info(ZE,"stopLiveStreaming:  taskId: ".concat(e)),!e)throw this.logger.error(ZE,"stopLiveStreaming failed for parameter error: taskId is empty"),new Eu(ou.RTC_ERR_CODE_INVALID_PARAMETER);try{await this.signal.stopLiveStreaming(e),this.logger.info(ZE,"stopLiveStreaming success, taskId: ".concat(e))}catch(tb){throw this.logger.error(ZE,"stopLiveStreaming failed: ".concat(tb)),tb}}setProxyServer(e){iR.setPorxyServer(e)}setTurnServer(e){var t;null===(t=this.connectionsManager)||void 0===t||t.setTurnServer(e)}}Mv([$I("Client$enableTopThreeAudioMode#boolean#boolean")],$E.prototype,"enableTopThreeAudioMode",null),Mv([ZI("Client$join#Promise<void>#string#JoinConfig")],$E.prototype,"join",null),Mv([ZI("Client$enableRtcStats#Promise<void>#boolean#number")],$E.prototype,"enableRtcStats",null),Mv([ZI("Client$leave#Promise<void>")],$E.prototype,"leave",null),Mv([ZI("Client$publish#Promise<void>#Stream")],$E.prototype,"publish",null),Mv([ZI("Client$unpublish#Promise<void>#Stream")],$E.prototype,"unpublish",null),Mv([ZI("Client$subscribeAudio#Promise<RemoteStream | void>#string")],$E.prototype,"subscribeAudio",null),Mv([ZI("Client$unSubscribeAudio#Promise<void>#string")],$E.prototype,"unSubscribeAudio",null),Mv([ZI("Client$subscribe#Promise<void>#RemoteStream#SubscribeOption")],$E.prototype,"subscribe",null),Mv([ZI("Client$batchSubscribe#Promise<void>#SubscribeParam[]")],$E.prototype,"batchSubscribe",null),Mv([ZI("Client$unsubscribe#Promise<void>#Stream#SubscribeOption")],$E.prototype,"unsubscribe",null),Mv([ZI("Client$switchRole#Promise<void>#number#Authorization")],$E.prototype,"switchRole",null),Mv([$I("Client$setVolume4TopThree#void#number")],$E.prototype,"setVolume4TopThree",null),Mv([$I("Client$muteAudio4TopThree#void#boolean")],$E.prototype,"muteAudio4TopThree",null),Mv([$I("Client$isTopNAudioMuted#boolean")],$E.prototype,"isTopNAudioMuted",null),Mv([ZI("Client$changeUserName#Promise<boolean>#string")],$E.prototype,"changeUserName",null),Mv([ZI("Client$startLiveStreaming#Promise<boolean>#string#string[]#PublishConfig#UserConfig[]")],$E.prototype,"startLiveStreaming",null),Mv([ZI("Client$updateLiveStreaming#Promise<void>#string#string[]#PublishConfig#UserConfig[]")],$E.prototype,"updateLiveStreaming",null),Mv([ZI("Client$stopLiveStreaming#Promise<void>#string")],$E.prototype,"stopLiveStreaming",null),Mv([$I("Client$setProxyServer#void#string")],$E.prototype,"setProxyServer",null),Mv([$I("Client$setTurnServer#void#TurnServerConfig")],$E.prototype,"setTurnServer",null);class eb{static setLogLevel(e){Qg.setAllLogLevel(e)}static checkSystemRequirements(e){return hT.checkSystemRequirements(e)}static isScreenShareSupported(){return hT.isRTCScreenShareSupported()}static getDevices(){return JT()}static getCameras(){return async function(){return new Promise(((e,t)=>{JT().then((r=>{const i=r.filter((e=>"videoinput"===e.kind));i&&0!==i.length?e(i):t(new Eu(ou.RTC_ERR_CODE_NO_AVAILABLE_VIDEO_INPUT_DEVICES))})).catch((e=>{t(e)}))}))}()}static getMicrophones(){return async function(){return new Promise(((e,t)=>{JT().then((r=>{const i=r.filter((e=>"audioinput"===e.kind));i&&0!==i.length?e(i):t(new Eu(ou.RTC_ERR_CODE_NO_AVAILABLE_AUDIO_INPUT_DEVICES))})).catch((e=>{t(e)}))}))}()}static getSpeakers(){return async function(){return new Promise(((e,t)=>{JT().then((r=>{const i=r.filter((e=>"audiooutput"===e.kind));i&&0!==i.length?e(i):t(new Eu(ou.RTC_ERR_CODE_NO_AVAILABLE_AUDIO_OUTPUT_DEVICES))})).catch((e=>{t(e)}))}))}()}static createClient(e){return rR.checkAppid(e.appId),rR.checkCountryCode(e.countryCode),e.domain&&rR.checkDomain(e.domain),new $E(e)}static setParameter(e,t){return cI.setParameter(e,t)}static createStream(e){if(e.screen){if(!0===e.video||!0===e.audio||e.videoSource||e.audioSource)throw new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION);if(!this.isScreenShareSupported())throw new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION,"screen share is not supported")}else{if(!0!==e.video&&!0!==e.audio&&!e.videoSource&&!e.audioSource)throw new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION);if((!0===e.video||!0===e.audio)&&(e.videoSource||e.audioSource))throw new Eu(ou.RTC_ERR_CODE_INVALID_OPERATION)}return new ny(e)}}return{VERSION:Kv,setLogLevel(e){let t;const r=Hg.getCurrentTimestamp();try{eb.setLogLevel(e)}catch(i){throw t=i,i}finally{const i=Hg.getCurrentTimestamp(),n="default$setLogLevel#void#LogLevel";SI.getStat().setApiCallInfo(n,r,i,t,null,e)}},async checkSystemRequirements(e){let t,r;const i=Hg.getCurrentTimestamp();try{return r=await eb.checkSystemRequirements(e),r}catch(n){throw t=n,n}finally{const e=Hg.getCurrentTimestamp(),n="default$checkSystemRequirements#Promise<boolean>";SI.getStat().setApiCallInfo(n,i,e,t,r)}},isScreenShareSupported(){let e,t;const r=Hg.getCurrentTimestamp();try{return t=eb.isScreenShareSupported(),t}catch(i){throw e=i,i}finally{const i=Hg.getCurrentTimestamp(),n="default$isScreenShareSupported#boolean";SI.getStat().setApiCallInfo(n,r,i,e,t)}},getDevices:async()=>await eb.getDevices(),getCameras:async()=>await eb.getCameras(),getMicrophones:async()=>await eb.getMicrophones(),getSpeakers:async()=>await eb.getSpeakers(),setParameter(e,t){let r,i;const n=Hg.getCurrentTimestamp();try{return i=eb.setParameter(e,t),i}catch(s){throw r=s,s}finally{const s=Hg.getCurrentTimestamp(),o="default$setParameter#boolean";SI.getStat().setApiCallInfo(o,n,s,r,i,e,t)}},createClient(e){let t,r;const i=Hg.getCurrentTimestamp();try{return r=eb.createClient(e),r}catch(n){throw t=n,n}finally{const r=Hg.getCurrentTimestamp(),n="default$createClient#Client#ClientConfig";SI.getStat().setApiCallInfo(n,i,r,t,"",e)}},createStream(e){let t,r;const i=Hg.getCurrentTimestamp();try{return r=eb.createStream(e),r}catch(s){throw t=s,s}finally{var n;const s=Hg.getCurrentTimestamp(),o="default$createStream#LocalStream#StreamConfig";SI.getStat().setApiCallInfo(o,i,s,t,null===(n=r)||void 0===n?void 0:n.getStatInfo(),e)}}}}));
